---

title: Modular systems and methods for managing data storage operations
abstract: The invention is a modular backup and retrieval system. The software modules making up the backup and retrieval system run independently, and can run either on the same computing devices or on different computing devices. The modular software system coordinates and performs backups of various computing devices communicating to the modules. At least one module on one of the computing devices acts as a system manager for a network backup regimen. A management component acts as a manager for the archival and restoration of the computing devices on the network. It manages and allocates library media usage, maintains backup scheduling and levels, and supervises or maintains the archives themselves through pruning or aging policies. A second software module acts as a manager for each particular library media.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08433679&OS=08433679&RS=08433679
owner: CommVault Systems, Inc.
number: 08433679
owner_city: Oceanport
owner_country: US
publication_date: 20080609
---
The present application is a continuation of U.S. patent application Ser. No. 09 354 063 filed Jul. 15 1999 which is hereby incorporated herein by reference in its entirety.

The present invention is directed to storage and retrieval systems. In particular the invention is directed towards a modular storage and retrieval system for a computer or a series of interconnected computers.

Conventional backup devices usually employ a monolithic backup and retrieval system servicing a single server with attached storage devices. These systems usually control all aspects of data backup or retrieval including timing the backup directing the files to be backed up directing the mode of the archival request and directing the storage process itself through an attached storage device or devices. Further these backup and retrieval systems are not scalable and often direct only one type of backup and retrieval system whether it is a network backup or a single machine backup.

Due to the monolithic structure of these backup and retrieval systems a slight change in the operation of any one of several functional aspects of the backup and retrieval system requires an expenditure of a large amount of effort. The effort would include upgrading and changing the backup and retrieval system perhaps even up to reinstalling the backup and retrieval system in its entirety.

In addition the operation of a backup and retrieval system across a network containing several different types of hardware and operating systems present many challenges to an enterprise scale backup. These problems include data coherency bridging file system protocols and accessibility issues across multiple hardware and operating system configurations.

Other solutions do not address scalability issues hierarchy issues and the problems inherent in the storage of different files in a network file system. Many other problems and disadvantages of the prior art will become apparent to one skilled in the art after comparing such prior art with the present invention as described herein.

The invention is directed towards a backup and retrieval system. The backup system comprises a first software agent for managing the overall backup and retrieval functions across one or more computers. The system comprises a second software agent in communication with the first software agent where the second software agent is communicatively coupled to at least one library media. The second software agent controls and manages the physical backup of data onto the library media.

Another embodiment of the backup and retrieval system uses a third software agent. The third software agent manages the archival parameters of a single computing device. The third software agent is in communication with both the first and second software agents.

The first second and third components may reside on a single computing device may be split among several computing devices and may reside in any combination on a single computing device. Exemplary embodiments of the backup system may take the form where the first software agent and the second software agent operate on the same computing device where the first and third software agents operate on the same computing device there the first second or third software agents operate on the same computing device where the second and third agents operate on the same computing device where the three software agents all operate on different computing devices or any combination involving the three software agents operating or not operating on common computing devices.

In one embodiment the first software agent manages archival functions for a plurality of computing devices in communication with it. Thus the first software agent acts as an enterprise wide backup and retrieval manager for the computing devices it is in contact with.

The backup and retrieval system may also take the form where the second software agent creates an index of information on the location of archived data during the course of creating an archive on the library media. Thus the location of the archived data is preserved and the second software agent communicates at least part of the indexed information to the first software agent. Also the library media can comprise a plurality of different types of archival media.

In one embodiments the first software agent can take the form of a management component. Similarly the second software agent can take the form of a media component and the third software agent can take the form of a client component.

In the present invention the functions of the archival process are split among several software components or agents. The independent software agents focus specifically on one task of the archival process and may be cohesively operated in a network environment across several machines.

For example the network device operates a manager module or software agent . The manager module coordinates the usage of the library media and between usage of the network devices and backups.

The manager module may also keep and dynamically maintain schedule or policies pertaining to the backup process across the network or other sets of administrative duties such as maintaining and enforcing pruning policies aging policies or the like. The manager module could keep track of scheduling backups of the network devices and keep track of the archival levels of each backup for each network device keep track of the various applications running on the network devices and their need for backup. The manager module would also set the proper library media to which to direct the backup material.

The manager module may also dynamically keep track of the parameters for the backup process and may alter the scheduling or the level of backup dynamically based on the particular network device s or the backup device s limitations. The manager module may also dynamically alter the backup scheduling or other administrative aspects of a particular backup based on the condition of the network and its usage.

The network devices and contain media modules and respectively. The media modules communicate with the manager module and coordinate backups to the respective library media. Each media module is responsible for the archival functions of a logical library media. As such the particular media module would coordinate the actions of the storage device which it is responsible for with the manager module.

For example if the manager module determined that network device is ready for a backup the media module would initiate a backup to a single storage device or media library or libraries. The manager module could determine that the backup of the network device should be directed to the library media . The backup data from the network device would be directed to the media module on the network device via a network where the media module would direct the physical backup of the data from the network device onto the library media .

It should be noted that the manager module could direct the backup of the network devices or through contacting and directing the client modules or . The files and or data units to be backed up from any of the network devices or may be directed to any of the backup devices or through the use of the media modules or .

During the backup process the media module responsible for the physical backing up of the file and or data unit could then index the data as the information is being archived. This allows quick retrieval of any portion of data. Portions of the index data are then communicated to the manager module to enable the manager module to quickly and easily locate and determine the status of backup files and or data units for management purposes. The management module receives aggregate information concerning data bundles tape offsets and physical volumes where the data is stored on the backed up files and or data units. Thus most of the information in the index regarding the backed up files and or data units is kept local to the specific media manager that is responsible for the backup of the particular file and or data unit. This saves network and communication overhead and localizes and decentralizes the internals of the indices to the locus of storage.

As such this alleviates bottlenecks as the manager module when large numbers of clients are browsing or restoring data. By distributing the indexing data around the network at the specific media modules the manager module acts like a directory service identifying which media module a specific client request should be serviced by. Thus the load to provide browse restore information is spread across many media modules.

Another software module or agent may be a client module. A client module could be responsible for the machine level backup parameters. The client module running on the network device could be responsible for the backup parameters for the network device . These parameters may include requesting a change in scheduling setting the priorities of the files and or data to be archived in the case where the services are to be rationed or split across different types of library media.

The manager module after determining that the network device is in need of a backup could communicate with the client module to initiate the backup. The manager module could indicate the specific media module or modules to which the client component should send the data and or files to be backed up. The client component could then initiate a direct communication with the specific media module or modules for transmissions of the backup. For example if the manager module determines that the library media is to be used in the particular backup of the network device the manager module would indicate to the client module that the media module will be responsible for the backup.

In response the client module will direct the data and or files directly to the media module . There the medial module would direct the actual archive of the data on the backup device the media module is responsible for. It should be noted that the other client modules and could be similarly directed. Thus data and or files on many different network devices may archive data to many different library media.

It should be understood that the modules indicated in may be subdivided into further functional units. Thus the single manager module media module and client module may actually comprise several interconnected functional modules.

The indexing sub agent interfaces with an attached library media and records the address on the library media where the particular information may be accessed. Thus when the particular library media stores a file and or data at a particular location the location on the library media is reported to the indexing sub agent where the location is recorded. Through this indexing a media module may report to a controlling manager module the physical location of the recorded file and or data.

The media data mover sub agent manages the actual physical transfer of the file and or data to and from the physical library medium. Media data mover sub agent also manages the transfer of the file and or data to the requesting management module or client module. Thus the transfer of the data can be divorced from the indexing function of the media module. In fact different functional agents may be employed for these tasks.

The library sub agent is responsible for controlling the physical library media. Typically the library sub agent presents a single interface to the rest of the backup system. Layered underneath the library sub component are device drivers for controlling any particular library medium or the interface to a jukebox control system. As such a library medium may be interchanged seamlessly with the rest of the backup system including other sub agents associated with the media manipulation.

Additional sub modules or sub agents can include an application sub agent an archive sub agent a job sub agent a media sub agent and a data transfer sub agent . The functionality of the sub agents and include the functionality associated with management module or the overall management of the modular backup system.

The application sub agent stores configuration parameters and current states for each application. The application sub agent could store the backup preference time information for all pertinent backup levels. The application sub agent could also be adaptive in nature. For example the application sub agent could determine new start times based on a last successful backup at each level.

The archive sub agent tracks the location of all archived files archived file copies existing on other media and portions of the archived files and the archived file copies as they exist across library media. The archive sub agent also tracks related archived files grouped together in an archive group.

The job sub agent tracks all jobs. The jobs may be currently running waiting for resource pending later or failed. The job sub agent is responsible for restarting failed jobs starting jobs when a drive becomes available reporting upon all running pending and waiting jobs killing jobs and preempting jobs which are preemptable based on priorities.

The media sub agent keeps track of all sets of related media and indirectly controls the library media via a library sub agent associated with a media module. The media sub agent and the job sub agent act together to track library media utilization. The media sub agent knows how many drives are in use or available through each media module. Sine the job sub agent knows which jobs are using which drives available through a particular media module the media sub agent and the job sub agent can coordinate to keep track of all the jobs and all the media used by those jobs.

The data transfer sub agent can independently coordinate the transfer of data to other components. The data transfer sub agent can receive a block of data a file or both and transfer the information to a particular client module or media module while the other sub agent associated with the functions of the manager module operate. Thus the data transfer sub agent can serve as a queue or buffer in transferring data out of the manager module with which it is associated and free system resources for the operation of other sub agents associated with the manager module functionality or other modules or sub agents running on the same computing device.

Client sub agents are designed for specific application environments and understand the semantics of those environments in order to determine backup units and candidates for backup based on specific criteria. These criteria can be modification time specific types of files and or data units created by an application and other such criteria. The client sub agents also understand how to reconstruct valid and consistent environments upon restore.

It should be noted that the sub agents could exist as integrated modules in another agent or operate in an independent manner. However the sub agents or modules existing under an agent provide functionality in a modular fashion in either case.

Media modules and are also communicatively coupled to both the manager module and the client modules and . In this manner the manager module may oversee and direct the interactions of the client modules with the media modules. It may also formulate and keep track of the usage of the media modules and help maintain a coherent backup strategy. The media modules and are communicatively coupled to library media and for which the media modules and are responsible for operating and maintaining respectively. Thus a modular interconnected backup system is shown.

The library media may also be jukebox type media employing magneto optical platters or cartridge tapes. In this case the media module would contain software for operating the robotic jukebox devices as well as for operating the physical reading and writing of the information to the media. The software for such communication and or manipulation may reside under an application programming interface API module where the device drivers for the specific library media may be interchangeably interfaced to the media module .

A file is archived on the storage device . A separate file spans the storage devices as a file portion and a file portion in the storage devices and . A copy of the file is maintained separately in the storage device . Additionally the archived files may be stored on a differential block basis. For example the file is stored on the library media device . However at a later time an incremental backup has determined that the file has been altered but only in one sector. The backup and retrieval system could operate in a fashion such that the backup of the altered version of the file comprises only those sections of the file that have changed. Thus the blocks and represent the portions of the file that have changed. The file when overlaid with the blocks and stands for the current altered version of the file .

The three software components and are software agents. These software agents may reside on several different computing devices. The software agents can comprise sub agents as described above in relation to or contain their functionality as included modules. As such the components of the modular storage and retrieval system of a management component the client component and the media component are typically software programs running on the respective computing devices.

A management component is the software agent that can control the actions of the media components with which the management component is associated. The management component tracks and operates the global archival parameters of the computing devices for which it is responsible. The management component can initiate new jobs keep track of all running and waiting jobs control allocation of media drives and keep track of the status of the client components and the media components with which it is associated.

The management component also keeps track of other important parameters regarding the archival functionality of the computing devices with which it is associated. For example the management component can keep track of backup schedules for each computing device with which it is associated track the level of backup such as incremental differential or full back up for the associated computing devices and determine and resolve conflicts between backups or other archival requests competing for the same temporal and or physical resources of the backup system.

The management component may also maintain the archives through various policies. The policies may include drive cleaning policies index pruning policies aging policies and library media volume maintenance. For example the management component may implement a policy that initially archives files and or data on a relatively fast media. Upon another archival cycle the management component may relocate the first set of archived files and or data to another slower type media due to the presence of another set of a newly archived data and or files. Alternatively for example older differential or incremental backups maybe completely deleted from an archive upon the completion and verification of a newer full backup. One skilled in the art should recognize that since the management component is a software agent these policies might be fully programmable and automatically adaptable to changing conditions in the computing devices serviced by the backup and retrieval system as well as traffic on a network or networks linking them. The management component may contain the ability to implement one or more of these policies in a fully adaptable archival management scheme.

The policies may include prioritizing the archived files and or data to various library media and according to various criteria. These criteria may include priorities of files as determined by a network or machine file system as determined by a network or machine system administrator or as determined by an application running on a network machine for example. One skilled in the art should recognize that these policies are also fully adaptable in an archival management scheme.

The management component is communicatively coupled to at least one media component . A media component is a software agent that controls the library media and that house the archived data. The management component can direct the particular media component controlling a particular library media and to perform a particular archival request such as a backup or a retrieval.

In a backup function the management component could format or direct the particular files and or data to the media component for storage. The media component would receive the files and or data and direct them to a particular library media and that the media component controls. Upon successful archival of the files and or data to the library media and the media component would then create an index detailing the location of the archived files and or data on the library media and . This index could include the actual media library device used and the parameters of that media library device where the particular file and or data is located within the particular media library device. For example if the media library device. For example if the media library device was a magnetic disk the index created might contain the block track and sector numbers of the magnetic disk where the particular file and or data is located on the magnetic disk. One skilled in the art should recognize that this index need not be restricted to a physical device but may be extended to any addressable type device including virtual devices. Further one skilled in the art will recognize that each library media device could contain its own unique mode of operation and known unique mode of indexing any data or file stored on it.

A client component directs and manages the archival functions of a particular computing device falling within the aegis of the backup system. A particular client component directs and tracks the archival parameters for a particular computing device. Additionally a particular client component may also serve to interact with the management component for unscheduled backup activities. A user may interface with the backup system through a graphical user interface in any particular client component . The particular client component can set backup priorities of files and or data contained on the particular computing device and request rescheduling of archival actions for the computing device for which it is responsible.

For example a particular client component can set the level of backup for a particular machine. It may also set a filter of the types of data and or files to include or exclude from any type of backup. A particular client component manages the timing and the level of backup manages the files and or data to be backed up and can be used to request specific unscheduled archival actions from the management component .

In an exemplary embodiment the backup system operates as a cohesive unit. Either a particular client component responsible for a particular computing device or a management component can initiate a backup of the particular computing device.

In the first case the particular client component either automatically through interaction with the operating system of the particular computing device or through interaction with application software running on the particular computing device initiates a backup archival request. The backup archival request may contain either a list of particular files and or data to be archived or it may contain the criteria by which the particular file and or data may be selected to be archived. The backup archival request may contain the particular files and or data to be archived.

If the backup archival request by the particular client component contains the particular files and or data from the particular computing device in the archival request the management component then determines from the system wide parameters it manages which library media and should archive the particular files and or data to be archived. This determination may also involve priority of the information.

The management component then forwards the information to be archived to the particular media component responsible for the library media and that will be used in the archival action. The particular media component responsible for the library media and receives the information to be archived and proceeds to direct the particular library media and to archive the information as requested. The particular media component records an index entry of the archived information. This index entry can contain an indication of the information archived the particular library media and which physically archives the information and the address on the particular library media and at which the information may be retrieved.

Upon a successful archival of the information on the library media and the particular media component proceeds to acknowledge that successful completion of the archival action by forwarding to the management component information on the successful archival action. This information includes the indexing information by which the management component may track and manage the archived information.

If the back up archival request by the particular client component contains a list or indication of particular files and or data to be archived the management component may acknowledge the request by requesting transmittal of the particular files and or data by the particular client component . Once the management component receives the particular files and or data the management component determines the proper library media and on which to archive the information. The management component then requests that the particular media component responsible for the library media and archive the data. The management component forwards the information about the data to be archived to the selected media component . The selected media component then coordinates the physical archival action with the library media and . Upon a successful archival of the information on the library media and the particular media component proceeds to acknowledge that successful completion of the archival action by forwarding to the management component information on the successful archival action. This information includes the indexing information by which the management component may track and manage the archived information.

In another embodiment the management component would determine a specific library media and on which to archive the information. It could then pass the media component responsible for that library media and other information by which the specific media manager and the requesting client component could establish communication between themselves. The data and or files could then be passed between the specific media component and the requesting client component .

Alternatively the management component may initiate the archival action based on the system wide parameters as controlled by management component . For example the management component may determine that a particular computing device is due for a backup. This backup may be one for an incremental backup a differential backup or a full backup. The management component would then request that the particular client component responsible for interacting with and managing the particular computing device make a determination of the files and or data that are due for the particular backup requested. The particular client component responsible for managing the particular computing device would then act to collect the files and or data to be archived on the particular computing device.

In one embodiment the particular client component would forward to the management component a description of the information to be archived from the computing device. This description may also contain an indication of the priority for the retrieval of the information provided. Thus the management component would then determine the proper library media and on which to archive the information from the computing device. Upon receipt of this information and the determination of the proper library media and to be used in the archival action for each file and or data the management component may request the actual data and or files from the particular client component to be archived. The particular client component may then forward the information to be archived to the particular media components responsible for the actual physical archival action.

In another embodiment the particular client component would forward to the management component both the files and or data to be archived along with the corresponding information for each. In this embodiment any network traffic between the management component in the particular client component would be reduced.

In yet another embodiment the particular client component would forward the information concerning the data and or files to be archived to the management component . The management component would then determine the proper library media and or medium on which to archive the data and or files. The management component may then initiate the archival action by forwarding a request to the particular media components selected to handle the physical archival actions. This request could contain the pertinent file information. The particular media components may then request directly from the particular client component the files and or data to be archived. Thus in this case the management component indirectly manages the actual archival process. It indirectly manages the archival process by providing the files and or data to be archived to the particular media components by providing the information on the files and or data. Additionally it provides the means to instigate communication directly between particular media components and the particular client component .

In any case the particular media components manage and direct the physical archiving process. The particular media components create an index entry for each file and or data unit archived. Each particular media component forwards batches of metadata back to the management component . This metadata contains that information by which the management component may track and manage the archived data. The metadata may also contain information on the origination of the data and or files permissions associated with the data and or files and other administrative information.

The management component tracks the archival process through the metadata passed back from the particular media components . Thus for any given archived file and or data the management component can precisely track where the information is archived even when portions of the archived data span several library media and . Given the information as passed from the particular media components to the management component regarding the archived files and or data the management component can track all versions of the archived information including all full backups all differential backups sector based backups of large data fields or files and all portions of the archived file and or data that may reside across several media as well as operating system information on the data and or files as well as other information deemed important by an administrator.

Turning now to the restoration or retrieval process a restoration or retrieval may be initiated either by the management component or by the particular client component . Upon the initiation of a restoration request by the particular client component the management component uses the information created by the indexing function of the media component to determine where to locate the file and or data or the portions spanning several library media making up the file and or data. Upon determining the correct location of the requested file and or data or the portions making up that file and or data the management component requests the particular media components to find and retrieve the requested file and or data or portions making up the requested file and or data.

In one embodiment the particular media component or components relay the requested information back to the management component . If the requested information spans portions the management component may assemble the whole of the requested file and or data for relaying back to the requesting client component . Upon receipt of the requested information the requesting client component makes the retrieved information available to the particular computing device which it is responsible for.

In another embodiment the management component also relays to the particular media components information on the requested file and or data or portions of the requested file and or data. In addition the management component makes available to the particular media components the location of the requesting client component . Thus when the particular media components retrieve the information the particular media components may forward the retrieved information to the requesting client component directly. The requesting client component then assembles the retrieved information for presentment to the particular computing device for which it is responsible.

The use of the particular components is not restricted to any particular machine. The components may reside on the same computing devices on different computing devices or may be combined in any different combination of computing devices.

Each of the client components and directs and manages the archival functions of the computing devices and respectively. The management component directs and manages the archival activities of the computing devices and .

All archival requests from the computing devices from the client components on the computing devices or from the management component are directed to the media component . The media component processes and manages all archival requests for the three computing devices such as backups and retrievals. Backups and retrievals to and from the computing devices and involve requests from the client component on the respective computing devices to the management component and possibly transfers of data between the management component and the particular client components residing on these machines.

Another computing device contains a client component . Other computing devices and contain associated client components and . The client components and communicate with the management component . The client components and can also communicate with the media component .

A computing device contains a client component of and a media component . Another library media is managed and controlled by the media component operating on the computing device .

A computing device contains solely a media component . Attached to the computing device is another library media . Archival requests to and from the library media are managed by the media component . As shown the computing device can be a dedicated library media controller.

Any of the client components and may request archival requests such as backups and retrievals. The management component can direct any backup requests by any client component to any of the attached library media and . The management component would direct the backup requests to the associated media components responsible for management and control of the particular library media. In this example the media components and would field and process the requests for the library media and respectively.

The management component may monitor the usage of all the library media and direct backup requests to an appropriate library media as dictated by the usage of the particular media. The computing device may also monitor the traffic on a network connecting the various computing devices. Based on network traffic flow the management component may appropriately direct backups to less heavily trafficked computing devices on the network . Thus the management component may adaptably react to changing characteristics in a network environment. Thus the backup for any of the computing devices or may end up on any library media in communication with a media component. Archival requests to and from the computing devices and such as backup and retrieval requests may be implemented through the media component .

A computing device containing a client component communicates with the computing device . Another computing device containing a client component communicates with the computing device . Yet another computing device containing a client component communicates with the computing device . The management component manages the archival parameters for the attached computing devices and . The computing device serves as a combination of a dedicated data storage device and a network archival manager.

In view of the above detailed description of the present invention and associated drawings other modifications and variations will now become apparent to those skilled in the art. It should also be apparent that such other modifications and variations may be effected without departing from the spirit and scope of the present invention as set forth in this specification.

