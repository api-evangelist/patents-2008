---

title: Methods and apparatus to detect border gateway protocol session failures
abstract: Methods and apparatus to detect border gateway protocol (BGP) session failures are disclosed. A disclosed example apparatus comprises a database interface to obtain provisioned configuration information for a provider edge (PE) router, a BGP engine to receive one or more BGP messages from a route reflector, the one or more BGP messages representing a list of active routes for the PE router, and a session analyzer to compare the list of active routes with the provisioned configuration information to determine whether a provisioned route is not present in the list of active routes, and to declare a BGP session failure when the provisioned route is not present in the list of active routes.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07804781&OS=07804781&RS=07804781
owner: AT&T Intellectual Property I, L.P.
number: 07804781
owner_city: Reno
owner_country: US
publication_date: 20081120
---
This disclosure relates generally to border gateway protocols BGPs and more particularly to methods and apparatus to detect BGP session failures.

Enterprise customers are increasingly adopting multiprotocol label switching MPLS based VPN services to implement a communication network among their respective customer sites via a service provider s network. Such MPLS based VPNs provide direct any to any reachability among an enterprise s customer sites. A BGP is traditionally used to route data within a communication network and or between different communication networks.

Example methods and apparatus to detect border gateway protocol BGP session failures are disclosed. A disclosed example apparatus includes a database interface to obtain provisioned configuration information for a provider edge PE router a BGP engine to receive one or more BGP messages from a route reflector the one or more BGP messages representing a list of active routes for the PE router and a session analyzer to compare the list of active routes with the provisioned configuration information to determine whether a provisioned route is not present in the list of active routes and to declare a BGP session failure when the provisioned route is not present in the list of active routes

A disclosed example method includes obtaining provisioning data for a PE router receiving one or more BGP messages from a route reflector the one or more BGP messages representing a list of active routes for the PE router comparing the list of active routes with the provisioning data to determine whether a provisioned route is not present in the list of active routes and declaring a BGP session failure when the provisioned route is not present in the list of active routes

In the interest of brevity and clarity throughout the following disclosure references will be made to an example communication system of . However the methods and apparatus described herein to detect BGP session failures are applicable to other types of networks constructed using other network technologies topologies and or protocols. As described herein a BGP session failure may be caused by for example one or more routes that are down inoperable and or flapping and or one or more routers and or network interfaces that are down inoperable and or flapping. The examples disclosed herein may also be used to detect the cause s and or type s of BGP session failure s that have and or are occurring.

To route and or transport data between and or among the example CE routers the example MPLS based service provider network of includes a plurality of PE routers three of which are designated at reference numerals and . The example PE routers of are communicatively coupled to each other via any number and or type s of communication paths not shown that allow any particular PE router to communicate with at least some but not necessarily all of the other PE routers .

For each VPN implemented by the service provider network each of the example PE routers of has a corresponding VPN routing and forwarding VRF table. In the illustrated example of the PE routers have a VRF table for the example VPN that communicatively couples the CE routers . The example VRF tables of are used by the example PE routers to route and or forward a packet received at a particular PE router to and or toward its final destination. In general when a packet is received at a PE router from a CE router associated with a particular VPN the PE router uses the final destination specified and or identified in the packet to perform a query of the VRF table associated with that VPN. Based on a result of the query the PE router determines how the packet is to be routed or forwarded within the service provider network and or delivered to a particular CE router .

By sending for example BGP route advertisements each of the example PE routers of publishes and or exports information concerning the CE router s that are currently and or actively communicatively coupled to the PE router . Isolation between different VPNs is achieved via route targets RTs import policies and export policies. Specifically all routes of a particular VPN are tagged with an RT parameter and or value associated with the VPN. For example when the example PE router sends a BGP advertisement containing information regarding the CE router associated with VPN A that is communicatively coupled to the PE router the BGP advertisement includes the RT A that is associated with VPN A. Based on received BGP route advertisements the example PE routers of build compile update maintain and or construct a VRF table for each VPN. Specifically when the example PE routers receive BGP advertisements tagged with an RT associated with a particular VPN they import those routes only into the VRF table associated with that VPN as dictated by the VPN s import policy ies .

To facilitate sharing of routing information among the example PE routers the example service provider network of includes any number of route reflectors route servers intelligent route reflectors and or intelligent route service control points one of which is designated at reference numeral . Because not all of the example PE routers are necessarily communicatively coupled in a full mesh topology for example when at least one PE router does not have a direct communication path to another PE router the example route reflector of forwards BGP advertisements among and or to the PE routers . By forwarding each received BGP advertisement the example route reflector enables each of the PE routers to build compile and or construct a VRF table for each VPN that can be used by the PE router to route data from any CE router of a particular VPN to any other CE router of the VPN even if such routing of data requires use of one or more intervening PE routers .

The example PE routers of are provisioned and or configured based on data information and or parameters stored in a network and or VPN configuration database . The example configuration database of defines for each of the example PE routers and for each VPN supported by the example service provider network the set of CE routers that are supposed to be communicatively coupled to the PE router . However due to any number and or type s of failures errors and or faults a particular PE router may not be actively and or currently communicatively coupled and or coupleable to one or more of the CE routers despite how the PE routers and the CE routers are provisioned. Example failures errors and or faults include but are not limited to network interface faults router faults and or communication path faults. When an operator of a particular VPN and or an operator of the service provider network updates the example configuration database the provisioned configuration s of the affected PE router s and or the affected CE router s are likewise updated by the example service provider network .

To proactively detect BGP session failures the example service provider network of includes a BGP session monitor . By monitoring BGP session status information for the communication system the example BGP session monitor of can automatically detect BGP session failures prior to in some instances a customer becoming aware of and or reporting a problem thereby improving customer satisfaction improving network reliability and or avoiding network reachability failures. An example manner of implementing the example BGP session monitor of is described below in connection with . Example processes that may be carried out to implement the example BGP session monitor of are described below in connection with .

The example BGP session monitor of compares provisioning information and or data stored in the configuration database with current and or active route information acquired via received BGP advertisements and or messages to determine identify and or detect routers and or PE to CE routes that have failed are down are inoperable and or are flapping. BGP advertisements and or messages include but are not limited to a BGP message transmitted initial configuration and or startup to advertise one or more routes a BGP message transmitted to advertise one or more additional routes and or a BGP message transmitted to withdraw one or more routes. As used herein the term flapping refers to a condition characterized by an alternation between two states. For example a flapping network interface alternates between a working state and an inoperative state. Likewise an example route that is flapping is alternating between an active state and an inactive state. The route information acquired via received BGP advertisements is indicative of the currently active and or currently available routes of the communication system and as described above may be different from the provisioned configuration of the communication system .

The example BGP session monitor of identifies and or detects a potential BGP session failure by determining whether a route provisioned in the configuration database is not present in the list of active routes advertised via one or more BGP messages. In examples described herein the example BGP session monitor determines the number of times that a provisioned route does not appear as an active route during a sliding window of time to determine whether the route and or a router or network interface associated with the route is down and or flapping. For example if a provisioned route is missing throughout the sliding window interval the route can be declared as down. If other routes associated with the down provisioned route are likewise down the example BGP session monitor declares that a network interface of a router shared by all of the missing routes and or the router itself are down. However if a provisioned route is only missing for a portion of the sliding window the provisioned route may instead be flapping between an active state and an inactive state and may benefit from servicing to avoid a complete failure.

To obtain active and or current route information the example BGP session monitor of establishes a passive peered BGP communication session with the example route reflector . The example route reflector of sends and or forwards a copy of each BGP advertisement that it receives to the BGP session monitor via the communication session. In many examples a service provider network includes and or implements more than one route reflector . However because such route reflectors are implemented coupled and or located to distribute BGP advertisements throughout the entire network the example BGP session monitor need only establish a passive and or peering relationship with a representative subset of the route reflectors . For example the BGP session monitor may select a route reflector from each geographic region and or logical portion of the service provider network .

When the example BGP session monitor of detects and or identifies a BGP session failure the BGP session monitor automatically generates and or creates a trouble ticket and submits the generated trouble ticket to any type of trouble ticket system . In the illustrated example of the automatically generated trouble ticket includes information useful to effect resolution of the identified problem. An example trouble ticket identifies one or more particular routers network interfaces and or communication paths that appear to be faulty. That is the trouble ticket identifies the cause and or type of the detected and or identified BGP session failure.

The example trouble ticket system of routes and or assigns a trouble ticket submitted by the example BGP session monitor to one or more of a customer and or a work center via any type of interface system . For example the interface system of can send such notices via pager text message email updated web based interface display updated work list and or facsimile. Additionally the example interface system of implements one or more user interfaces that allow the users and to access the example trouble ticket system . Example user interfaces are web based interfaces that allow a user to for example generate submit update close forward route assign and or search for trouble tickets.

While an example communication system has been illustrated in one or more of the interfaces data structures elements processes and or devices illustrated in may be combined divided re arranged omitted eliminated and or implemented in any other way. Further the example PE routers the example route reflector the example configuration database the example BGP session monitor the example trouble ticket system and or the example interface system of may be implemented by hardware software firmware and or any combination of hardware software and or firmware. Thus for example any of the example PE routers the example route reflector the example configuration database the example BGP session monitor the example trouble ticket system and or the example interface system may be implemented by one or more circuit s programmable processor s application specific integrated circuit s ASIC s programmable logic device s PLD s and or field programmable logic device s FPLD s etc. Further still a communication system may include interfaces data structures elements processes and or devices instead of or in addition to those illustrated in and or may include more than one of any or all of the illustrated interfaces data structures elements processes and or devices.

To send receive and process BGP route advertisements the example BGP session monitor of includes any type of multi protocol BGP engine . When a BGP route advertisement is received from the example route reflector via the example network interface the example multi protocol BGP engine of stores the routes advertised in the BGP route advertisement in a production route database using for example a flat file format. The example multi protocol BGP engine also establishes a passive peered BGP communication session via which BGP advertisements are received from the route reflector .

To obtain provisioning data and or information the example BGP session monitor of includes any type of configuration database interface . Using any number and or type s of method s and or application programming interface s the example configuration database interface allows a BGP session analyzer to obtain data and or information representative of provisioned routes for the example communication system .

To identify missing routes the example BGP session monitor of includes the example BGP session analyzer . The example BGP session analyzer of compares the list of active and or current routes stored in the production route database with a list of provisioned routes obtained via the configuration database interface to identify provisioned routes that are not currently active and or available within the communication system . Such routes may be indicative of down failed and or flapping routes routers and or network interfaces. Example processes that may be carried out to implement the example BGP session analyzer and or more generally the example BGP session monitor are described below in connection with .

To analyze missing routes identified by the example BGP session analyzer the example BGP session monitor of includes a missing route analyzer . For a missing route the example missing route analyzer of determines and or counts the number of times that the provisioned route has been missing during a time period and whether other routes associated with the missing provisioned route are also missing. By analyzing the pattern of missing routes the example missing route analyzer determines whether and or which router s network interface s and or communication path s are down failed and or flapping. An example process that may be carried out to implement the example missing route analyzer and or more generally the example BGP session monitor is described below in connection with .

To generate and submit trouble tickets the example BGP session monitor of includes any type of trouble ticket system interface . When the example missing route analyzer identifies one or more routes network interfaces and or communication paths that are down failed and or flapping the example trouble ticket system interface of generates and submits one or more corresponding trouble tickets to the example trouble ticket system via the network interface .

While an example BGP session monitor has been illustrated in one or more of the interfaces data structures elements processes and or devices illustrated in may be combined divided re arranged omitted eliminated and or implemented in any other way. Further the example network interface the example multi protocol BGP engine the example production route database the example configuration database interface the example BGP session analyzer the example missing route analyzer the example trouble ticket system interface and or more generally the example BGP session monitor of may be implemented by hardware software firmware and or any combination of hardware software and or firmware. Thus for example any or the example network interface the example multi protocol BGP engine the example production route database the example configuration database interface the example BGP session analyzer the example missing route analyzer the example trouble ticket system interface and or more generally the example BGP session monitor may be implemented by one or more circuit s programmable processor s application specific integrated circuit s ASIC s programmable logic device s PLD s and or field programmable logic device s FPLD s etc. Further still a BGP session monitor may include interfaces data structures elements processes and or devices instead of or in addition to those illustrated in and or may include more than one of any or all of the illustrated interfaces data structures elements processes and or devices. For example a BGP session monitor may implement network interfaces for respective ones of the multi protocol BGP engine the example configuration database interface and the example trouble ticket system interface .

The example process of begins with the example BGP session monitor selecting one or more route reflectors block and the example BGP engine establishing passive and or peered communication sessions with the selected route reflector s block . The BGP session monitor sets a variable t to zero for each provisioned route sets a variable Cij to zero and opens a new data file in the production route database to store a list of routes advertised in received BGP messages during an upcoming period of time block . The BGP engine begins to send keep alive messages to the route reflector and to receive BGP advertisements from the route reflector block . Until the variable t equals a length T of the time period block the BGP engine stores route information contained in received BGP advertisements into the open data file block and updates the variable t block . Control then returns to block to continue sending keep alive messages and received BGP advertisements. In some examples the variable t is implementing using a real time clock. For instance the real time clock can be reset at block and then the output of the real time clock can be compared with the value T to detect the end of each BGP advertisement collection period. Additionally or alternatively the value T can represent a future time such that it is not necessary to reset the real time clock. That is T can be computed by adding a length of time to the current output of the real time clock.

At the end of the time period block the BGP session monitor closes the current data file block and resets the variable t to zero and opens a new data file block . The example BGP session analyzer processes the production route list stored in the closed data file block by for example carrying out the example processes of . That is all BGP messages receiving during a particular period of time of length T are saved in a data file. At the end of each period of time block the data file is closed block and processed block and another data file is opened for subsequent BGP messages block . Control then returns to block to continue sending keep alive messages and received BGP advertisements. While not depicted in processing of the previously collected active route information at block continues in parallel with the collection of active route information in the newly opened data file.

The example process of can be carried out to compare an active list of routes with a provisioned list of routes to identify missing routes and to identify one or more reasons for the missing route s . The example process of begins with the example BGP session analyzer of compiling a list of active routes that were advertised during the previous time period block . In some examples the BGP session analyzer compiles an ordered list of advertised routes and removes duplicate routes. The example BGP session analyzer obtains a list of provisioned routes via the example configuration database interface block and compares the list of advertised routes to the list of provisioned routes block .

For a presently considered provisioned route i j the BGP session analyzer checks whether the variable Cij associated with the route i j is equal to a variable C that represents the length of a sliding window block . When the end of the sliding window for the route i j is reached block the BGP session analyzer resets the variable Cij block . The BGP session monitor determines whether the provisioned route i j is missing from the list of advertised routes block . If the provisioned route i j is missing block the example missing route analyzer analyzes the missing route by for example carrying out the example process of block . If there are more routes to process block control returns to block to process the next route.

Returning to block if the provisioned route i j is not missing block control proceeds to block without further analyzing the route i j .

Returning to block if the variable Cij is not equal to C block and the variable Cij is not equal to zero block the BGP session analyzer increments the value of the variable Cij block .

The example process of can be carried out to analyze a missing provisioned route i j identified by the BGP session analyzer . For example the example process of can be called from block of the example process of . The example process of begins with the example missing route analyzer of comparing the variable Cij to zero block . If the variable Cij is zero block the missing route analyzer initializes a variable Mij which is used to represent the number of times the route i j is missing to one and initializes the variable Cij to one to start a sliding window time interval for the route i j block . Control then returns from the example process of to for example the example process of at block .

If the variable Cij is not zero block the missing route analyzer increments the variable Mij to indicate that the route i j was missing another time block . If the end of the sliding window for the provisioned route i j has not been reached block control returns from the example process of to for example the example process of at block .

If the end of the sliding window for the provisioned route i j has been reached block the missing route analyzer compares the variable Mij with a threshold M block . If the variable Mij is less than the threshold M block control returns from the example process of to for example the example process of at block without declaring a BGP session failure. The value of the threshold M is selected to avoid false BGP session failure declarations when a particular route is not always advertised during each time interval T where T represents the length of each BGP message collection window.

Returning to block if the variable Mij is greater than or equal to M block the missing route analyzer determines whether the variable Mij is less than a threshold C. The threshold Cis less or equal to C block . In some example the threshold Cis selected to be equal to C. If the variable Mij is less than C block the provisioned route i j is declared to be flapping block . If during the sliding window all routes all j or all routes i all were either flapping or down block the example trouble ticket system interface of creates and submits a trouble ticket indicating that either router i or router j is flapping block . Otherwise block the example trouble ticket system interface creates and submits a trouble ticket indicating that route i j is flapping block . Control returns from the example process of to for example the example process of at block .

Returning to block if the variable Mij is not less than the threshold C block the provisioned route i j is declared to be down block . If during the sliding window all routes all j or all routes i all were down block the example trouble ticket system interface of creates and submits a trouble ticket indicating that router i or router j is down block . Otherwise block the example trouble ticket system interface creates and submits a trouble ticket indicating that route i j is down block . Control returns from the example process of to for example the example process of at block .

The processor platform P of the example of includes at least one general purpose programmable processor P. The processor P executes coded instructions P and or P present in main memory of the processor P e.g. within a RAM P and or a ROM P . The processor P may be any type of processing unit such as a processor core a processor and or a microcontroller. The processor P may execute among other things the example processes of to implement the example methods and apparatus described herein.

The processor P is in communication with the main memory including a ROM P and or the RAM P via a bus P. The RAM P may be implemented by DRAM SDRAM and or any other type of RAM device and ROM may be implemented by flash memory and or any other desired type of memory device. Access to the memory P and the memory P may be controlled by a memory controller not shown . One or both of the example memories P and P may be used to implement the example configuration database of and or the example production route database of .

The processor platform P also includes an interface circuit P. The interface circuit P may be implemented by any type of interface standard such as an external memory interface serial port general purpose input output etc. One or more input devices P and one or more output devices P are connected to the interface circuit P. The input devices P and or output devices P may be used to for example implement the network interface of .

Although certain example methods apparatus and articles of manufacture have been described herein the scope of coverage of this patent is not limited thereto. On the contrary this patent covers all methods apparatus and articles of manufacture fairly falling within the scope of the appended claims either literally or under the doctrine of equivalents.

