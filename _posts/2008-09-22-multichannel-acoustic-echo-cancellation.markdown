---

title: Multichannel acoustic echo cancellation
abstract: A multi-party spatial audio conferencing system is configured to receive far end signals from remote participants. The system comprises a speaker array that outputs spatialized sound signals and one or more microphones that capture and relay a sound signal comprising an echo of the spatialized sound signal to a multichannel acoustic echo cancellation (MC-AEC) unit having a plurality of echo cancellers. Respective echo cancellers perform cancellation of an echo associated with a far end signal from one of the multiple participants according to an algorithm based upon echo cancellation coefficients. The echo cancellation coefficients are determined from the input channel signals, the spatialization parameters associated with each input channel, and the audio signals captured by the microphones. This allows respective echo cancellation filters to be updated simultaneously even though the corresponding remote participant is not talking.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08605890&OS=08605890&RS=08605890
owner: Microsoft Corporation
number: 08605890
owner_city: Redmond
owner_country: US
publication_date: 20080922
---
In recent history technology has allowed the world to become increasingly integrated and globalized. Many companies are now global entities comprising offices and manufacturing sites geographically dispersed throughout the world. People also are more likely than ever to change their residence multiple times during their lives. With such an integrated yet geographically diverse world people often need to communicate with others who are far away. In order to facilitate this communication teleconferencing and video conferencing are commonplace. Teleconferencing connects two or more participants over a network. The participants often rely upon a conferencing system that may include a microphone and a speaker. Video conferencing further includes a camera and a video monitor allowing the participants to converse while viewing video images of each other.

Teleconferencing and video conferencing systems both commonly suffer from the problem of acoustic echo which is a delayed and distorted version of an original sound reflected back to its source. Traditionally a system prone to acoustic echo problems includes a speaker microphone pair on both ends called the near end and the far end of the connection. When near end participants talk their voices are picked up by the near end microphone transmitted to the far end and presented as a sound signal via the far end speaker. However the far end microphone will also pick up this sound signal directly or indirectly and the far end system will send it back to the near end. This causes the near end participants to hear a delayed and distorted version of their own speech which decreases the perceived audio quality.

Acoustic echo cancellation AEC systems are part of practically all speakerphone e.g. teleconferencing and or videoconferencing communication systems. In recent years increased use of teleconferencing and videoconferencing have produced a high demand for improved sound quality of audio conferencing systems. This high demand continually drives improvement of acoustic echo cancellation systems.

Although the problem of echo reduction has been described in the context of teleconferencing and video conferencing it will be appreciated that it can also occur whenever a speaker and microphone are configured to be in a closed loop.

This Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key factors or essential features of the claimed subject matter nor is it intended to be used to limit the scope of the claimed subject matter.

As provided herein audio signals captured by one or more microphones comprised within an audio conferencing system are adjusted to provide an improvement in acoustic echo cancellation AEC . More particularly a multi party spatial audio conferencing system e.g. a conferencing system that gives a listener the impression that remote participants are dispersed throughout a three dimensional virtual environment comprises a speaker array configured to output spatialized audio signals and one or more microphones configured to capture and relay a sound signal comprising an echo of the spatialized audio signal to a multi channel acoustic echo cancellation MC AEC unit having a plurality of echo cancellers. Respective echo cancellers perform cancellation of an echo associated with a far end signal from one of the multiple participants according to an algorithm based upon spatialization parameters associated with respective input channels. The output of the MC AEC unit is an audio signal having an improved sound quality e.g. reduced echo higher echo return loss enhancement ERLE .

Essentially far end signals from remote participants are received e.g. by a conferencing system over multiple input channels. The far end signals are spatialized e.g. processed to give a listener the impression that a sound source is within a three dimensional environment by outputting respective far end signals from a plurality of speakers wherein different gain and delay modulations are applied to the far end signal output from different speakers resulting in different remote participants having different virtual locations. Output spatialized audio signals undergo changes resulting in a sound signal comprising an echo having a mixture of far end signals. The sound signal is captured by a microphone and conveyed to an MC AEC unit comprising a plurality of echo cancellers. Respective echo cancellers remove an echo substantially equal to the product of an echo cancellation coefficient and a far end signal of one of the multiple input channels. The product of the echo cancellation coefficient and a respective far end signal is substantially equal to the echo captured by the microphone for the far end e.g. the product of the echo cancellation coefficient and the far end signal is equal to the contribution of that far end signal to the echo captured by the microphones. The echo cancellation coefficients are determined by summing over a product of a room impulse response RIR model of the convolution of the far end signal and spatialization parameters.

To the accomplishment of the foregoing and related ends the following description and annexed drawings set forth certain illustrative aspects and implementations. These are indicative of but a few of the various ways in which one or more aspects may be employed. Other aspects advantages and novel features of the disclosure will become apparent from the following detailed description when considered in conjunction with the annexed drawings.

The claimed subject matter is now described with reference to the drawings wherein like reference numerals are used to refer to like elements throughout. In the following description for purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of the claimed subject matter. It may be evident however that the claimed subject matter may be practiced without these specific details. In other instances structures and devices are shown in block diagram form in order to facilitate describing the claimed subject matter.

Audio conferencing systems which simultaneously present multiple voices through a single channel can result in audio voice output which is difficult to comprehend thereby causing conference participants to often have difficulty identifying the voices of remote e.g. far end participants especially in groups having unfamiliar members. Therefore more recent teleconferencing systems have begun to perform audio spatialization e.g. mapping the voices of far end participants over a virtual 3 dimensional environment to make it appear as though remote participant voices are coming from different locations. This enhances the collaborative experience during multi party conferencing by allowing improved distinction between remote voices. Unfortunately stereo acoustic echo cancellation AEC suffers from among other things a misconvergence problem when applied to a spatialized conferencing system because of cross correlation between the loudspeakers signals. If the loudspeakers signals are used as reference signals for AEC there are many solutions and the echo canceller may converge to any of the solutions which does not correspond to the true echo path. This misconvergence problem reduces audio quality thereby making it difficult to distinguish the location of a sound and making it difficult to distinguish between far end voices. Accordingly there is room for improvement with regard to acoustic echo cancellation for spatialized multi party conferencing systems.

As provided herein a system and technique are set forth for improved multichannel acoustic echo cancellation MC AEC of a spatialized audio signal e.g. comprising an echo of a speakerphone output captured by one or more microphones. The system comprises a multichannel acoustic echo cancellation MC AEC unit e.g. AEC filter having a plurality of echo cancellers configured to execute an algorithm upon the captured sound signal which respectively removes echo corresponding to an associated far end channel. More particularly respective echo cancellers subtract out the product of an echo cancellation coefficient and an associated far end input signal e.g. from a remote participant . The product of the echo cancellation coefficient and the associated far end input signal is substantially equal to the contribution of the far end input signal to the echo captured by the microphone. The echo cancellation coefficient is determined at a specific time for respective far end signals by summing over the product of spatialization parameters e.g. gain and delay modulations and a model of the room impulse response RIR of a respective far end signal resulting in an interdependence between echo cancellers.

A dynamic processing unit spatializes the far end signals prior to being output by a speaker array comprising a plurality of speakers . Spatialization is the mixing of far end signals from different channels such that the voice of remote e.g. far end participants appear to be output from different virtual locations e.g. audio signals are processed to give a listener the impression that a sound source is within a three dimensional environment . For example if there are three remote participants spatialization will output the voice of respective participants from different virtual locations as shown in .

Referring again to the plurality of speakers output spatialized far end signals y . . . y e.g. a sound from a remote participant output by a telephone associated with a conference system user . The spatialized signals y N 1 S will disperse through a room comprising the plurality of speakers and one or more microphones e.g. a speakerphone system that may be undergoing changes h . . . h e.g. a convolution . The one or more microphones capture the sound signals originating from far end participants e.g. emanating from the speakers potentially giving rise to acoustic echo. The one or more microphones may additionally capture a near end voice e.g. from the conference system user if the conferencing system user is speaking.

A multichannel acoustic echo cancellation MC AEC unit receives the captured sound signal from the one or more microphones . The MC AEC unit generally comprises a linear adaptive filter configured to perform acoustic echo cancellation AEC on captured sound signals according to an algorithm as provided herein e.g. see . The MC AEC unit reduces the echo by an amount substantially equal to the echo captured by the microphone . The MC AEC unit simulates e.g. models the echo captured by the one or more microphones by taking the product of an echo cancellation coefficient and an associated far end signal. The echo cancellation coefficient is a numerical value comprised within a vector that generally relates a received input signal from a channel to the amount of echo resulting from that channel received by the one or more microphones e.g. an echo cancellation coefficient with larger values generally corresponds to a channel which produces a larger echo compared with an echo cancellation coefficient having a smaller value . The echo cancellation coefficient is dependent upon the gain and delay modulations used to spatialize the far end input signal and a model of the room impulse response RIR H . . . Hof a respective far end signal wherein the room impulse response RIR e.g. a program that calculates room impulse response H can be modeled by a finite impulse response FIR filter with L taps in the frequency domain.

In one particular embodiment an additional dynamic processor not shown is configured to convert captured sound signals from the time domain denoted in this disclosure as lower case letters to the frequency domain denoted in this disclosure as upper case letters prior to performing acoustic echo cancellation. Conversion to the frequency domain allows the echo cancellation to be performed in the frequency domain which decreases the computation time for MC AEC.

The MC AEC system of can be incorporated into a wide variety of electronic devices to provide improved echo reduction. For example a cellular phone comprising a transmission device configured to facilitate communication with other remote participants could incorporate the MC AEC system of for improved echo reduction while operating in a speakerphone mode. In particular in 3G cellular phones video capabilities will increase resulting in wider use of speakerphones. In such 3G cellular phones the need for AEC will increase. Similarly a video conferencing system comprising a visual display unit and a visual recording device could comprise the MC AEC system of thereby providing a video conferencing system that offers increased echo return loss enhancement ERLE . It will be appreciated that the inventors have contemplated use of the MC AEC system of for use in a wide variety of applications.

Cumulatively the speakers output spatialized sound signals y . . . ycomprising far end signals of multiple channels e.g. x . . . x . After sound signals are output they undergo changes e.g. attenuation reflection reverberation which are described by the convolution of the far end signal y t and a room impulse response RIR term h t e.g. y h t in time which is approximated by the product Y f H f in frequency . The room impulse response describes how a far end signal ychanges after it leaves the plurality of speakers . The changes in the spatialized audio signals h . . . hresult in sound signals comprising an echo which has a mixture of far end signals from a plurality of channels.

One or more microphones capture the signal d e.g. the microphone input comprising the convolution of the spatialized audio signal e.g. y . . . y and the room impulse response term h t at a given time instant t. The received sound signal dis communicated to a MC AEC . As illustrated in the MC AEC unit comprises a plurality of echo cancellers . Respective echo cancellers e.g. or store an echo cancellation coefficient Wand are configured to receive a far end signal from a single channel x e.g. echo canceller stores echo cancellation coefficient Wand receives input from channel x . At the specific time instant t the echo cancellation coefficient is substantially equal to a sum over all speakers of a product of the modeled RIR e.g. of a spatialized far end signal and the gain and delay modulations used to spatialize the far end signal

The echo cancellers multiple their respective echo cancellation coefficient by an associated far end signal e.g. W X where N 1 . . . P . The product of the echo cancellation coefficient and the far end signal is substantially equal to a subset of the received signal corresponding to the echo from that input channel. For respective channels an echo canceller then subtracts the product of the echo cancellation coefficient and the far end signal from the received sound signal dresulting in a received signal with reduced echo e.g. combination of the echo cancellation coefficients W and far end signals cancel out the microphone input d . The resultant signal output from the MC AEC is equal in the frequency domain to the captured signal Dminus the echo subtracted by the P echo cancellers 

The MC AEC system illustrated in has a number of advantages over prior art acoustic echo cancellation systems. For example due to the interdependence of echo cancellation coefficients even echo cancellers that are not in use are constantly updated. The MC AEC system and algorithm provided herein for example adapt the per channel impulse response CIR and also resolve the RIR between loudspeakers and the one or more microphones . Therefore as long as one channel is active the RIRs and CIRs for other input channels are adapted simultaneously. For example if a remote participant is silent for long periods of time the adaptation from other channels will benefit adaptation for that silent channel resulting in a reduced echo when the participant resumes talking.

At a multichannel far end input is received from a plurality of remote participants by way of a plurality of input channels.

The received audio signals are spatialized and output from a plurality of speakers e.g. two or more speakers at . In general for a teleconferencing system comprising S speakers and P channels the output of respective speakers is equal to in the frequency domain the sum of the product of the gain and delay modulation Gand the channel signal Xover all channels P.

At the room impulse response of spatialized sound signals are simulated e.g. modeled . Simulation of the RIR obtains RIR terms H t for respective time instances and channels which are equal to the actual convolution of spatialized audio signals output by the plurality of speakers. The room impulse response RIR is simulated for example using a FIR filter with L tapes. The simulation results can be used to determined the echo cancellation coefficients.

At the near end signal and a convolution of the far end signal are captured by a microphone. In alternative embodiments a plurality of microphones arranged in varying geometric layouts may also capture the far end signal. In general the microphone will capture a sound signal that can be described as the sum of the output of the speakers e.g. the sum of the product of the gain and delay modulation and the channel signal over all channels and a convolution term which describes how the spatialized signal propagates after being output from the microphone. Mathematically this can be written as 

The captured sound signals e.g. the near end and convolution of the far end signal are optionally converted from the time domain denoted as lower case characters to the frequency domain denoted as upper case characters at to facilitate faster processing. Conversion to the frequency domain can be performed using a Discrete Fourier Transform DFT or a Fast Fourier Transform FFT or Modulated Complex Lapped Transformation MCLT for example. Respective audio frames frames are converted to the frequency domain and presented as a vector of complex numbers.

At one or more echo cancellation coefficients are determined. The echo cancellation coefficients are determined in such a manner that there is an interdependence between echo cancellation coefficient used by different echo cancellers. The echo cancellation coefficients are determined for example by solving a statistical parameter estimation method e.g. a constrained Kalman filter problem wherein available constraints among the parameters are imposed automatically. In one example the constraint is determined by applying echo cancellation to the system at a time when the only sound being received by the microphone is echo e.g. therefore echo cancellation removes all sound . Mathematically this constraint can be written as 

At the acoustic echo is cancelled. The echo cancellation coefficient determined in is utilized by respective echo cancellers to remove echo from the captured signal. Respective echo cancellers will input the product of their associated echo cancellation coefficient and input channel signal to the MC AEC unit. The MC AEC unit will receive the captured signal from the one or more microphones and subtract input of respective echo cancellers

At a state vector is estimated for the MC AEC system. The state vector is a vector comprising variables which can be used to mathematically describe the state of the system e.g. the state vector comprises variables on which calculations can be performed to determine attributes of the system . For example the state vector can comprise the echo cancellation coefficient W and the modeled room impulse response H. This results in a P S L dimensional vector S where echo cancellation coefficient and room impulse response sufficiently describe the system to perform acoustic echo cancellation.

At a scalar measurement of the system state at a current time is taken. The scalar measurement takes into account the audio signal and noise e.g. error at a time instant t. The measurement can be written as where is the observation noise e.g. the microphone noise and the ambient noise that can also model the inaccuracy of the observation system and Ais a vector describing the audio signal carried by the channels

At a constraint is applied to the state equation and the state equation is solved. The constraint on the state parameters can be determined for example by applying echo cancellation to the system at a time when the only sound being received by the microphone is echo. This constraint can be written in terms of the state equation and a matrix comprising the gain and delay modulations for spatialization 

The state equation is solved according to the constraints at . The constraint depends upon a covariance matrix of the noise term. This covariance matrix can be set to different values depending on user preference. For example the covariance matrix is set equal to zero for strict imposition of the constraint while a softer constraint uses a non zero covariance matrix. In practice a soft constraint is often used to provide a more stable system on account of nonlinearity in loudspeakers and clock drift between loudspeakers and sound capture. Alternatively the covariance matrix can be varied over time e.g. start with a large value and decrease it over time .

In an alternative embodiment the computational time of the method illustrated in can be reduced by introducing sequential scalar updates. For example the CKF can be applied sequentially to measurements Yresulting in a measurement of Ywhere j is an element of the measurement matrix e.g. Y bS for j 1 . . . PL 1 . In such an embodiment sequential application of the CKF inhibits inversion of a large matrix thereby reducing the computational cost.

Still another embodiment involves a computer readable medium comprising processor executable instructions configured to apply one or more of the techniques presented herein. An exemplary computer readable medium that may be devised in these ways is illustrated in wherein the implementation comprises a computer readable medium e.g. a CD R DVD R or a platter of a hard disk drive on which is encoded computer readable data . This computer readable data in turn comprises a set of computer instructions configured to operate according to one or more of the principles set forth herein. In one such embodiment the processor executable instructions may be configured to perform a method such as the exemplary method of for example. In another such embodiment the processor executable instructions may be configured to implement a system configured to improve the suppression of residual echo. Many such computer readable media may be devised by those of ordinary skill in the art that are configured to operate in accordance with the techniques presented herein.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

As used in this application the terms component module system interface and the like are generally intended to refer to a computer related entity either hardware a combination of hardware and software software or software in execution. For example a component may be but is not limited to being a process running on a processor a processor an object an executable a thread of execution a program and or a computer. By way of illustration both an application running on a controller and the controller can be a component. One or more components may reside within a process and or thread of execution and a component may be localized on one computer and or distributed between two or more computers.

Furthermore the claimed subject matter may be implemented as a method apparatus or article of manufacture using standard programming and or engineering techniques to produce software firmware hardware or any combination thereof to control a computer to implement the disclosed subject matter. The term article of manufacture as used herein is intended to encompass a computer program accessible from any computer readable device carrier or media. Of course those skilled in the art will recognize many modifications may be made to this configuration without departing from the scope or spirit of the claimed subject matter.

Although not required embodiments are described in the general context of computer readable instructions being executed by one or more computing devices. Computer readable instructions may be distributed via computer readable media discussed below . Computer readable instructions may be implemented as program modules such as functions objects Application Programming Interfaces APIs data structures and the like that perform particular tasks or implement particular abstract data types. Typically the functionality of the computer readable instructions may be combined or distributed as desired in various environments.

In other embodiments device may include additional features and or functionality. For example device may also include additional storage e.g. removable and or non removable including but not limited to magnetic storage optical storage and the like. Such additional storage is illustrated in by storage . In one embodiment computer readable instructions to implement one or more embodiments provided herein may be in storage . Storage may also store other computer readable instructions to implement an operating system an application program and the like. Computer readable instructions may be loaded in memory for execution by processing unit for example.

The term computer readable media as used herein includes computer storage media. Computer storage media includes volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions or other data. Memory and storage are examples of computer storage media. Computer storage media includes but is not limited to RAM ROM EEPROM flash memory or other memory technology CD ROM Digital Versatile Disks DVDs or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by device . Any such computer storage media may be part of device .

Device may also include communication connection s that allows device to communicate with other devices. Communication connection s may include but is not limited to a modem a Network Interface Card NIC an integrated network interface a radio frequency transmitter receiver an infrared port a USB connection or other interfaces for connecting computing device to other computing devices. Communication connection s may include a wired connection or a wireless connection. Communication connection s may transmit and or receive communication media.

The term computer readable media may include communication media. Communication media typically embodies computer readable instructions or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term modulated data signal may include a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal.

Device may include input device s such as keyboard mouse pen voice input device touch input device infrared cameras video input devices and or any other input device. Output device s such as one or more displays speakers printers and or any other output device may also be included in device . Input device s and output device s may be connected to device via a wired connection wireless connection or any combination thereof. In one embodiment an input device or an output device from another computing device may be used as input device s or output device s for computing device .

Components of computing device may be connected by various interconnects such as a bus. Such interconnects may include a Peripheral Component Interconnect PCI such as PCI Express a Universal Serial Bus USB firewire IEEE 1394 an optical bus structure and the like. In another embodiment components of computing device may be interconnected by a network. For example memory may be comprised of multiple physical memory units located in different physical locations interconnected by a network.

Those skilled in the art will realize that storage devices utilized to store computer readable instructions may be distributed across a network. For example a computing device accessible via network may store computer readable instructions to implement one or more embodiments provided herein. Computing device may access computing device and download a part or all of the computer readable instructions for execution. Alternatively computing device may download pieces of the computer readable instructions as needed or some instructions may be executed at computing device and some at computing device .

Various operations of embodiments are provided herein. In one embodiment one or more of the operations described may constitute computer readable instructions stored on one or more computer readable media which if executed by a computing device will cause the computing device to perform the operations described. The order in which some or all of the operations are described should not be construed as to imply that these operations are necessarily order dependent. Alternative ordering will be appreciated by one skilled in the art having the benefit of this description. Further it will be understood that not all operations are necessarily present in each embodiment provided herein.

Moreover the word exemplary is used herein to mean serving as an example instance or illustration. Any aspect or design described herein as exemplary is not necessarily to be construed as advantageous over other aspects or designs. Rather use of the word exemplary is intended to present concepts in a concrete fashion. As used in this application the term or is intended to mean an inclusive or rather than an exclusive or . That is unless specified otherwise or clear from context X employs A or B is intended to mean any of the natural inclusive permutations. That is if X employs A X employs B or X employs both A and B then X employs A or B is satisfied under any of the foregoing instances. In addition the articles a and an as used in this application and the appended claims may generally be construed to mean one or more unless specified otherwise or clear from context to be directed to a singular form.

Also although the disclosure has been shown and described with respect to one or more implementations equivalent alterations and modifications will occur to others skilled in the art based upon a reading and understanding of this specification and the annexed drawings. The disclosure includes all such modifications and alterations and is limited only by the scope of the following claims. In particular regard to the various functions performed by the above described components e.g. elements resources etc. the terms used to describe such components are intended to correspond unless otherwise indicated to any component which performs the specified function of the described component e.g. that is functionally equivalent even though not structurally equivalent to the disclosed structure which performs the function in the herein illustrated exemplary implementations of the disclosure. In addition while a particular feature of the disclosure may have been disclosed with respect to only one of several implementations such feature may be combined with one or more other features of the other implementations as may be desired and advantageous for any given or particular application. Furthermore to the extent that the terms includes having has with or variants thereof are used in either the detailed description or the claims such terms are intended to be inclusive in a manner similar to the term comprising. 

