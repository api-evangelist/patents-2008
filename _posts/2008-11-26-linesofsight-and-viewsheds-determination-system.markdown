---

title: Lines-of-sight and viewsheds determination system
abstract: A method for processing three-dimensional data that defines a three-dimensional scene, and determining and displaying lines-of-sight (LOS) and viewsheds on all visible surfaces of the scene, includes: i) assigning at a user-selected location at least one viewpoint in the scene; ii) applying ray tracing from locations in the scene to the viewpoint to determine locations in the scene that are in a line of sight (LOS) and outside the LOS of the viewpoint, thus determining the viewshed relative to the viewpoint; and iii) color-coding every visible surface in the scene. The color coding then differentially indicates the locations in the line of sight (LOS) and outside the LOS of the viewpoint, producing a display of a color-coded viewshed relative to the viewpoint. Additionally ray tracing can be applied from locations above the scene to determine headroom contours for those locations in the scene.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08325178&OS=08325178&RS=08325178
owner: The United States of America, as represented by the Secretary of the Navy
number: 08325178
owner_city: Washington
owner_country: US
publication_date: 20081126
---
The present invention relates generally to a method and software for indicating areas visible to snipers sentries or any observers at known positions as well as for indicating positions from which these entities can be seen. In particular the present invention uses digital 3D terrain data that is obtained from stereo imagery LIDAR or any source of elevation data to determine and display such locations.

Previous methods for determining lines of sight LOS and viewsheds have various disadvantages. For example such approaches are limited to one sniper or viewpoint. In a combat environment there are often many snipers look outs and adversaries whose viewsheds must be known. Prior systems are also limited to a stationary sniper target or observer. In reality targets and snipers change positions often. Protectees and other potential targets such as vehicles move through terrain and threats need to be evaluated at every point along a route.

Prior methods require that terrain surfaces be displayed only from directly above. There is no three dimensional view. These methods color code only surfaces visible from directly above the scene. While this is a fast technique it provides no information about walls doors windows or any vertical or near vertical surfaces that may be within an observers field of view.

Prior methods work only with Digital Elevation Models DEM . These are simple elevation fields that show only the surface of a terrain much like an inverted muffin tin . DEM s are elevation values that are obtained from directly above a terrain by aircraft or satellites. No spatial information is available for true three dimensional features such as building interiors tunnels caves or areas under trees bridges and overhangs.

Prior methods color code only ground surfaces that are in the direct line of sight from a viewpoint. This can be misleading and dangerous. This information only shows where a sniper can see the ground or the surface of a rooftop for example. Uncolored areas may be interpreted as safe when in fact they may not be. For example a sniper may not be able to see the ground surface on which a target stands but he may be able to see all the target above his knees. Old methods do not provide this information.

Prior methods use ray tracing to show a limited number of rays emanating from a viewpoint. These are usually in one horizontal plane through the viewer s eyes. This is unsatisfactory. The entire three dimensional field of view needs to be known.

According to the invention a method for processing three dimensional data that defines a three dimensional scene and determining and displaying lines of sight LOS and viewsheds on all visible surfaces of the scene includes i assigning at a user selected location at least one viewpoint in the scene ii applying ray tracing from locations in the scene to the viewpoint to determine locations in the scene that are in a line of sight LOS and outside the LOS of the viewpoint thus determining the viewshed relative to the viewpoint and iii color coding every visible surface in the scene. The color coding then differentially indicates the locations in the line of sight LOS and outside the LOS of the viewpoint producing a display of a color coded viewshed relative to the viewpoint. The invention also includes the computer software comprising source or operating code that is operable to carry out the method as well as the computer software product having a computer readable medium including stored instructions that when executed by a computer cause the computer to carry out the method.

Old methods are limited to one sniper or viewpoint whereas the invention can use an unlimited number of snipers targets or viewpoints at the same time.

Old methods are limited to a stationary sniper target or observer. The invention functions with moving snipers or targets and can thus be used for convoy protection.

Old methods color code only ground surfaces visible from directly above to indicate the viewshed from a viewpoint. The invention color codes every surface in a 3D scene including roof tops walls under bridges and overhangs windows water towers watch towers trees and all terrain features.

Old methods show lines of sight and viewsheds by color coding only DEM s. The invention shows lines of sight and viewsheds for DEM s and for any type of three dimensional scene. This includes features not visible in DEM s such as building interiors vehicle interiors tunnels caves and areas under bridges overhangs and trees.

Old methods color code only ground surfaces that are in the direct line of sight from a viewpoint. The invention color codes areas within a viewpoint s direct line of sight but also provides color coded headroom contours. These contours show areas where for example a sniper cannot see the ground but can see anything taller than 1 meter or anything taller than 2 meters. Headroom contours indicate vertical cover and show walk crawl belly crawl areas to plan unobserved safe movement through a sniper s area of responsibility for instance.

Old methods use ray tracing to show a selected but limited number of rays emanating from a viewpoint by using colored lines to show the selected number of lines of sight. This limits the resolution of images or animations. The invention shows every object that can be observed by the viewer in any direction and at any distance. By color coding surfaces it shows all viewsheds and lines of sight at one time. All objects viewable within a 360 degree sphere around the viewer are color coded. The resolution of images and animations produced by the invention is limited only by the resolution of the imported 3D geometry.

Old methods do not show overlapping fields of fire or overlapping viewsheds for two or more snipers or observers. The invention uses a user selected color to indicate regions with overlapping viewsheds from two or more snipers or observers.

Old methods cannot determine optimal firing or viewing positions based on constrained angles between the viewer and targets. The invention shows firing positions calculated for limited solid angles and also indicates glass surfaces that have reduced transparency due to reflections and refractions at acute angles.

The invention calculates distances and angles between any number of points within a 3D scene and then imports these numbers into simple or sophisticated algorithms to arrive at any required solution involving distances angles or viewsheds.

The present invention employs ray tracing e.g. as described in U.S. Pat. No. 4 865 423 by Akio Doi issued Sep. 12 1989 and in Turner Whined An Improved Illumination Model for Shaded Display Communications of the ACM Vol. 23 No. 6 pp. 343 49 June 1980 both of which are incorporated herein by reference. Ray tracing is also described in Rob Cook and Ken Torrance A Reflectance Model for Computer Graphics Vol. 1 No. 1 January 1982 also incorporated herein by reference.

Ray tracing shown in starts with a ray L Line of Sight or LOS emitted from a viewpoint that is posited for each pixel I j on screen matched with a plane of projection and the surfaces of objects intersecting ray L are searched. Of objects and the first intersected by ray L and the first seen is object whose intersecting surface is closer to the viewpoint.

Another description of ray tracing is found in US Patent Application No. 2008 0074420A1 published Mar. 27 2008 and incorporated herein by reference. It describes ray tracing as a technique that traces the propogation of imaginary rays which behave similarly to rays of light into a three dimensional scene which is to be rendered onto a computer screen. As with the above discussion with respect to the rays originate from the eyes of the viewer sitting behind the computer screen and traverse through pixels which make up the computer screen towards the three dimensional scene. Each ray proceeds into the scene and may intersect with objects in the scene. If a ray intersects an object within the scene properties of the object and several other contributing factors are used to calculate the amount of color and light or lack thereof the ray is exposed to. These calculations are then used to determine the final color of the pixel through which the ray has passed. As will be discussed below the invention applies a further technique of assigning pixels colors in accordance with its novel approach.

The process of tracing rays is carried out many times for a single scene. For example a single ray may be traced for each pixel in the display. Once a sufficient number of rays have been traced to determine the color of all the pixels that make up the two dimensional synthesis of the computer screen and again as further modified by the invention technique the two dimensional scene can be displayed on the computer screen.

The subject reference includes a figure included herein as and maintaining the original reference numerals of the reference it shows a three dimensional scene including objects and light sources . Scene may be rendered into a two dimensional picture by an image processing system described further below which may also display it on a monitor . Monitor includes pixels of different colors to render the two dimensional picture.

Ray tracing is applied by the image processing system to render the three dimensional scene into the two dimensional picture. The image processing system shoots rays from the viewer into the scene . The rays have properties and behavior similar to light rays. Ray passes through a plane represented by monitor where the final two dimensional picture will be rendered by the image processing system where pixel is the point where ray passes through the plane monitor. Image processing systems employ a grid of possibly millions of pixels to render the final scene on the monitor and calculate the colors assigned to the pixels which as already mentioned is then further refined by the technique of the invention.

One or more secondary rays are issued where a primary or original ray intersects an object . Secondary rays are assigned different characteristics depending on the nature of the object or its surface and the presence or absence of other objects interfering with or otherwise obstructing the path of the secondary ray.

The invention also employs ray tracing in its system and method while utilizing a new approach as follows.

Referring now to one embodiment of the invention is a LOS and viewshed determining system that includes an image acquisition system e.g. a LIDAR based system as shown for acquiring one or more elevation fields of an area including three dimensional 3D features within the area . Elevation fields are input to a processor that includes a machine readable storage media for saving and for processing the elevation fields by means of the sniper detection system programmed instructions hereinafter the software stored on the media . A monitor displays the images to a user who has access to a graphical user interface GUI with user selectable parameters as is further described below.

Suitable data acquisition systems can include airborne based LIDAR Light Detection and Ranging stereoscopic satellite imagery and space shuttle radar topography data. The software is a complete visual solution for 3D data sets. Any questions concerning visual surveillance line of sight concealment enfilade defilade or restricted fields of fire will be answered with color coded imagery or animations produced by the software. The software will be deployed for both offensive and defensive operations. The software uses ray tracing for measurements within any 3D scene and is therefore very flexible.

Rays are traced by deconstructing the scene into triangles and determining which if any triangles are intersected by the ray and how the ray behaves if an intersection takes place. The invention uses ray tracing to determine if light is blocked by any triangle along its path. If so part of the triangle is visible from the ray s point of origin. The region behind the triangle is not visible.

Color coding is performed for every surface in any 3D scene including roof tops walls windows vehicles water towers watch towers building interiors trees and all terrain features and objects on the terrain. All objects viewable within a 360 degree sphere around the viewer s are color coded. The color coding will indicate visible non visible and nearly visible areas as described below.

LOS employs the simplest type of ray tracing. Referring now to the software casts a primary ray into the scene from each pixel on the screen. If the primary ray intersects the scene secondary rays are cast toward the target or in this case the sniper. If the secondary ray hits the target the associated screen pixel is shaded red to indicate a direct line of sight to the sniper. This gives the appearance of the terrain under the pixel being shaded red. If the secondary ray collides with part of the scene before it hits the target the screen pixel is shaded green to indicate that the sniper cannot see this area. Colors are selectable by the user.

Referring now to the software also determines headrooms as follows. A primary ray hits a surface of the scene and a secondary ray is fired at the target. If secondary ray collides with a surface before hitting the target a second secondary ray will be fired from a position one meter above the position from which ray was fired. If the secondary ray hits the target the associated screen pixel is color coded to indicate that a headroom of 0 1 meter exists at the point where the primary ray intersected the ground. If ray had collided with a surface prior to hitting the target a third secondary ray could be fired from a position two meters above the position from which ray was fired. Should this ray hit the target the screen pixel will be colored to indicate that a headroom of 1 2 meters exists at the point where the primary ray intersected the ground. Secondary rays may be fired from any desired distances above the original intersection of the primary ray. As many secondary rays as desired may be fired at the target and the user can choose the colors used to indicate headrooms by means of the GUI. The software indicates all surfaces in direct line of sight to an observer or multiple observers by coloring that surface with colors selected by the user.

The software can use an unlimited number of snipers targets or viewpoints at the same time. shows a 3D scene as in but with three snipers positioned as shown and with the results as indicated where the overall LOS area in red is much greater with concomitant decreases in available headroom for seeking cover from the three snipers. shows the same scene with the optional color coding that is enabled to show overlapping fields of fire from two or more snipers. Overlapping fields of fire may be shown for any number of snipers or observers. Similarly the fields of view of guards in watch towers are color coded for force protection of fixed compounds.

This is similar to LOS ray tracing. The software casts a primary ray into the scene from each pixel on the screen. If a primary ray intersects the scene secondary rays will be cast from the point of intersection toward each target in turn or in this case each sniper. If any secondary ray hits any sniper the screen pixel is shaded red. This gives the appearance of the terrain under the pixel being shaded red. If all of the second rays collide with part of the scene before they hit the sniper the screen pixel is shaded green. If several secondary rays hit sniper icons that pixel will be shaded the color that indicates overlapping fields of fire or overlapping fields of view in this case blue.

Range rings are drawn by determining the distance from the intersection point of a primary ray to the target or sniper. If the distance is equal to a preselected range ring distance the screen pixel will be colored white or any selected color . This gives the appearance of the terrain under the pixel being shaded white in these figures. When the scene is completely rendered all pixels that correspond to selected distances will be white giving the appearance of circles around a target.

The software will optionally show all positions on a terrain surface from which multiple targets can be viewed. For example if a scout needs to view a rooftop two hilltop observation points a front door and a point on a road the software will color code all the surfaces in a 3D scene from which the scout can observe all five locations. show an example where a scout located within the bright green areas can observe all five positions indicated by the white circles circumscribing white Xs without moving with also showing the user added color coding.

The software casts a primary ray into the scene from each pixel on the screen. If a primary ray intersects the scene secondary rays will be cast from the point of intersection toward each target in turn. If all secondary rays hit their targets the screen pixel is shaded bright green. This gives the appearance of the terrain under the pixel being shaded bright green. If any of the secondary rays collide with part of the scene before they hit the target the screen pixel is not shaded.

Optimal firing positions for angle limited window shots in a complex urban environment are shown in . Law enforcement officers must occasionally make shots through windows in cases such as a hostage situation rapidly deteriorating. Ammunition designed for this purpose requires a limited solid angle from the perpendicular line off the face of the glass windowpane less than 30 degrees in order to maintain accuracy and lethality. The software calculates thousands or millions of conic sections 3 the intersections between a cone and a plane to determine the areas from which this shot can be made the technique for this being that described in Yates R. C. Conics . pp. 36 56 J. W. Edwards Ann Arbor Mich. 1952 incorporated herein by reference. The graphical user interface allows the user to select this function and select the colors and angle used. In this example an angle of 30 degrees was used.

The software casts a primary ray into the scene from each pixel on the screen. If the primary ray intersects the scene a secondary ray will be cast toward the target or in this case the hostage taker. If the secondary ray hits the target conic section calculations are then performed. These will determine if the primary intersection point lies within the intersection of two geometric shapes 1 a 30 degree cone perpendicular to the window glass with its origin in front of the target and 2 the horizontal plane on which the primary intersection point lies. If this is true the screen pixel is shaded red. This gives the appearance of the terrain under the pixel being shaded red. If the secondary ray collides with part of the scene before it hits the sniper or if its origin lies outside the intersection of the cone and the plane the screen pixel is shaded a color that indicates that a shot should not be taken from that location. In the case of the areas from which a shot should not be taken are left unshaded not color coded .

Agencies with the responsibility of protecting individuals need to distribute their limited assets such as special agents efficiently. The software determines areas from which a protectee can be directly observed by a potential assailant and enables the placement of agents in locations to observe a developing threat. shows a protectee in a vehicle in an urban environment. Areas from which the protectee can be directly engaged are colored red. shows the situation after the placement of four agents on the indicated rooftops. Areas that were previously colored red are now colored blue if at least one agent can directly observe that position. Agents can be moved or reduced or increased in number and the software recodes the scene to show which threat areas are covered and which are not.

The software casts a primary ray into the scene from each pixel on the screen. If the primary ray intersects the scene a secondary ray will be cast toward the target or in this case the protectee. If the secondary ray hits the protectee the point from which the ray originated is in a threat area and the screen pixel is shaded red. This gives the appearance of the terrain under the pixel being shaded red. If the secondary ray collides with part of the scene before it hits the protectee the screen pixel is shaded green and that location is considered safe.

If a secondary ray is determined to originate from a threat area an area from which the protectee can be seen additional secondary rays are then fired from that location to each point where an agent is located. If any ray intersects at least one agent the threat area is considered to be a covered area an area within view of an agent and the primary ray s screen pixel is changed to another color blue in this case.

The software functions with moving snipers or targets and can thus be used for convoy protection through the use of animations. show a protectee in a vehicle at a fixed location. This vehicle can be programmed to move along the street to a destination position. An animation made of this transit shows threat positions changing as the vehicles position changes. The software color codes each frame of the animation showing active threat areas and threat areas covered by agents for each frame of the animation. For any moving entity over any type of terrain the software color codes threat areas as they change with time.

This functions identically to Guarding a Protectee above except that the calculations are repeated for every position along the vehicles path. An image is rendered for each position and the resulting images are strung together as an animation.

Guarding a protectee or making observations in an urban environment means that the effects of glass in windows must be considered. A viewpoint that results in a line of sight that has a low angle of incidence off the plane of the glass limits what the observer can see behind the glass due to reflections and refractions especially at night. The software optionally measures the angle of incidence from an observer to all the windows in his field of view and indicates whether the angle of incidence is too small. shows an example where a 20 degree minimum angle of incidence is required. The software applies in this example a light blue color to indicate which surfaces are not visible to any of the four agents with angle of incidence greater than 20 degrees. Agents will have a limited view and may not be able to see movement behind windows within the area that is shaded light blue.

These calculations are identical to those for Guarding a Protectee above with the following exceptions. When a secondary ray is cast from any vertical surface in the scene to the location of an agent and the ray hits the agent the solid angle between the plane of that vertical surface and the ray is determined. If that angle is less than the minimum required angle of incidence the screen pixel from which the primary ray emanated is shaded light blue in this case to indicate a problem. The vertical surface under that screen pixel will appear to be light blue.

The software works with any kind of 3D data set. shows a color coded image produced by the software from LIDAR data. In addition 3D scenes are created by using stereoscopic satellite imagery.

In summation besides sniper and counter sniper operations these applications are designed for direct action mission planning law enforcement SWAT operations covert ingress and egress special reconnaissance planning route planning for convoys or protectees and general force protection. Intelligence products include multiple viewpoint imagery animations of routes large overlay images or maps and color coded 3D geometry and textures i.e. OpenFlight export . Civilian applications include LOS and viewshed determination for architectural plans construction projects guard towers the positioning of video surveillance cameras and highway planning.

It should be noted that the LOS and viewshed determining method of the present invention can be accomplished by executing one or more sequences of one or more computer readable instructions read into a memory of one or more computers from volatile or non volatile computer readable media capable of storing and or transferring computer programs or computer readable instructions for execution by one or more computers. Volatile computer readable media that can be used can include a compact disk hard disk floppy disk tape magneto optical disk PROM EPROM EEPROM flash EPROM DRAM SRAM SDRAM or any other magnetic medium punch card paper tape or any other physical medium. Non volatile media can include a memory such as a dynamic memory in a computer. In addition computer readable media that can be used to store and or transmit instructions for carrying out methods described herein can include non physical media such as an electromagnetic carrier wave acoustic wave or light wave such as those generated during radio wave and infrared data communications.

For example a field agent with a laptop running the Software can by means of mobile to mobile radios a prearranged hand signal convention or other standard field communication means alert other agents to take cover outside a sniper s viewshed and or to determine suitable positions from which to either target a sniper position e.g. to assume a sniper position in order to cover a convoy or a target of interest.

The Software is currently used as a Plug In with Autodesk Maya but it may be used with any geospatial or 3D software that has an application programming interface API . These may include but are not limited to the Autodesk product line the ESRI product line Google Earth the Terrex product line the Multigen product line and ERDAS Imagine products. It may also be used as a stand alone software application.

Thus while the present invention has been described with respect to exemplary embodiments thereof it will be understood by those of ordinary skill in the art that variations and modifications can be effected within the scope and spirit of the invention.

