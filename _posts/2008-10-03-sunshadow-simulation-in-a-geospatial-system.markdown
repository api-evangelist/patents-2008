---

title: Sun-shadow simulation in a geospatial system
abstract: A method, apparatus, and article of manufacture provide the ability to display a sun and shadow simulation in a 3D system. A 3D view of a real world scene is displayed, using a 3D graphics application, on a display device. A plug-in is installed into the application. A calendar period (e.g., a month, day, and year) is defined by the user. A timeline arc is displayed with the calendar period defining a radius of the arc, and starting stopping endpoints of the timeline arc defining an interval of time during the calendar period. A timeline slider is displayed on the arc that indicates a time of day within the calendar period. A visualization is displayed, in the 3D view, of shadows cast by a sun on objects in the 3D view. A position of the sun is based on the calendar period and the time of day.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08291345&OS=08291345&RS=08291345
owner: Autodesk, Inc.
number: 08291345
owner_city: San Rafael
owner_country: US
publication_date: 20081003
---
This application claims the benefit under 35 U.S.C. Section 119 e of the following co pending and commonly assigned U.S. provisional patent application s which is are incorporated by reference herein 

Provisional Application Ser. No. 60 997 868 filed Oct. 5 2007 by RICHARD D. HOWARD JARROD LOPICCOLO GRANT ANDERSON ROY LINDAUER THOMAS HELMAN and MATTHEW LARSEN entitled FRAMEWORK FOR AGGREGATING DESIGN MODELS AND GIS DATA IN A GEOSPATIAL ENVIRONMENT 

This application is related to the following co pending and commonly assigned patent application which application is incorporated by reference herein 

U.S. patent application Ser. No. 12 245 562 entitled USER DEFINED SCENARIOS IN A THREE DIMENSIONAL GEO SPATIAL SYSTEM by Richard D. Howard Jarrod Lopiccolo Grant Anderson Roy Lindauer Thomas Helman and Matthew Larsen filed Oct. 3 2008 and

U.S. patent application Ser. No. 12 286 911 entitled VIEWPORT OVERLAYS TO EXPOSE ALTERNATE DATA REPRESENTATIONS by Richard D. Howard filed Oct. 3 2008.

The present invention relates generally to three dimensional 3D applications and in particular to a method apparatus and article of manufacture for a producing a sun shadow simulation while directly controlling sun shadow settings for the time of day and day of year.

Geographic information systems GIS are commonly used and generally refer to an information system that integrates hardware software and data in order to capture store analyze manage and display present data that is spatially referenced i.e. linked to location or is geographically referenced . GIS systems commonly provide a two dimensional 2D visualization of data in the form of maps globes reports and charts. However prior art GIS systems fail to provide the capability to merge GIS data with additional information in order to visualize analyze and simulate trends phenomena states and events. Further three dimensional 3D systems also fail to provide such capabilities.

In addition prior art systems fail to provide the ability for a user to easily visualize how the sun and shadow produced by objects in a 3D environment. Prior art systems further fail to provide the ability to directly control the sun shadow settings for time of day and day of year in such a visualization.

Certain cities may have regulations that prohibit shadows from being cast on neighboring buildings. Alternatively users may desire to view the effect of the sun on a building when designing the placement or architecture of the building.

One or more embodiments of the invention allow a user to specify a location of a building as well as a particular time and date. Thereafter the user can view the building from different perspectives under the simulated sun position and shadows cast as a result. The user has the ability to specify time and date and view it visually. Further the user can grab an icon of an arc representing the sun position on the date set e.g. summer solstice and can view the shadow cast at each time during the day. The user can also grab a point on the arc and drag it to adjust the date e.g. to switch to the winter solstice . Thereafter the use can simply press a play button that initiates a visual representation of the shadow and sun that is cast as an icon moves across the arc.

In one or more embodiments the user can view any direction and swing around to see the sun shadow from a different viewpoint. Further the user can turn off the textures in a displayed scene to view the scene in black and white or without the building and surrounding area details.

In the following description reference is made to the accompanying drawings which form a part hereof and which is shown by way of illustration several embodiments of the present invention. It is understood that other embodiments may be utilized and structural changes may be made without departing from the scope of the present invention.

One or more embodiments of the invention provide an application and development framework for aggregating design models and GIS data within an immersive 3D geospatial environment for the purposes of visualizing analyzing and simulating trends phenomena state and events in ways that are not possible within conventional 2D GIS or existing 3D application software. In other words embodiments of the invention provide the ability to view analyze simulate trends phenomena states and events in a digital city.

3D Geospatial Environment containing both simplified and fully textured rendition based on high resolution lidar and ortho photography for content such as Digital Terrain Models Streets and Roadways Water Features Railways Buildings Utility Infrastructure and Street Furniture 

Importation storage and data mapping of full 3D design models from various software e.g. software available from the assignee of the present invention including AutoCAD Map3D Revit Architecture Civil3D and Inventor as well as support for GIS formats via Autodesk Feature Data Objects FDO technology 

Real time 3D rendering and animation including transparency reflections lights shadows and atmospheric effects 

One or more embodiments of the invention are implemented by a computer implemented graphics program wherein the graphics program is represented by a window displayed on the display device . Generally the graphics program comprises logic and or data embodied in or readable from a device media carrier or signal e.g. one or more fixed and or removable data storage devices connected directly or indirectly to the computer one or more remote devices coupled to the computer via a data communications device etc.

In one or more embodiments instructions implementing the graphics program are tangibly embodied in a computer readable medium e.g. data storage device which could include one or more fixed or removable data storage devices such as a zip drive floppy disc drive hard drive CD ROM drive DVD drive tape drive etc. Further the graphics program is comprised of instructions which when read and executed by the computer causes the computer to perform the steps necessary to implement and or use the present invention. Graphics program and or operating instructions may also be tangibly embodied in a memory and or data communications devices of computer thereby making a computer program product or article of manufacture according to the invention. As such the terms article of manufacture and computer program product as used herein are intended to encompass a computer program accessible from any computer readable device or media.

A network such as the Internet connects clients to server computers . Additionally network may utilize radio frequency RF to connect and provide the communication between clients and servers . Clients may execute a client application or Web browser e.g. as described above and communicate with server computers executing Web servers . The software executing on clients may be downloaded from server computer to client computers and installed as a plug in or ActiveX control of a Web browser. Accordingly clients may utilize ActiveX components component object model COM or distributed COM DCOM components to provide a user interface on a display of client .

Web server may host an Active Server Page ASP or Internet Server Application Programming Interface ISAPI application which may be executing scripts. The scripts invoke objects that execute business logic referred to as business objects . The business objects then manipulate data in database through a database management system DBMS . Alternatively database may be part of or connected directly to client instead of communicating obtaining the information from database across network . When a developer encapsulates the business functionality into objects the system may be referred to as a component object model COM system. Accordingly the scripts executing on web server and or application invoke COM objects that implement the business logic. Further server may utilize Microsoft s Transaction Server MTS to access required data stored in database via an interface such as ADO Active Data Objects OLE DB Object Linking and Embedding DataBase or ODBC Open DataBase Connectivity .

Those skilled in the art will recognize many modifications may be made to this exemplary environment without departing from the scope of the present invention. For example those skilled in the art will recognize that any combination of the above components or any number of different components including different logic data different peripherals and different devices may be used to implement the present invention so long as similar functions are performed thereby.

The Graphical User Interface displays information to the operator and provides the functionality for the operator s interaction with the graphics program .

The Image Engine processes the DWG files and delivers the resulting graphics to the monitor for display. In one or more embodiments the Image Engine provides a complete application programming interface API that allows other computer programs to interface to the graphics program as needed.

The Database is comprised of two separate types of databases 1 a 3D database known as the 3D world space that stores 3D information and 2 one or more 2D databases known as the 2D view ports that stores 2D information derived from the 3D information.

As used herein the graphics program may consist of a variety of different type of applications including GIS CAD computer aided design solid modeling systems animation products rendering systems etc. Embodiments of the invention are not limited to those software applications explicitly described herein but by the limitations set forth in the claims.

Embodiments of the invention provide an architecture and method of using plug in modules for user defined 3D 4D visualization analysis and simulation. Users clients are provided with the ability to search for download and immediately use plug ins from an online catalog offered by one or more servers . These plug ins can be supplied by software developers and enable users to visualize analyze and simulate trends phenomena state and events via software application .

Such a plug in environment allows many different types of applications to load specific data types and allows interaction between those data types. Most traditional plug in environments do not allow this. Plug ins for different data types may include textures 3D models 2D models particle systems and geo based behavior systems behaviors based on specific geo information .

Another advantage of the plug in architecture is that it allows user to load models seamlessly without having to go through the lengthy steps of importing files. Accordingly a full 3D environment and real time rendering capability of embodiments of the invention combined with the analytic capabilities supplied by a plug in developer allows user to visualize their data in ways not formerly possible.

Plug ins are loaded and associated with specific models and scenarios within the digital city of embodiments of the invention. A user can override model and linked data values enter plug in parameters and control the visualization of results. Plug ins have the ability to automatically add themselves or make calculations based on the data of a particular file making up a digital city environment.

For example based on GIS fault data an earthquake preparedness drill particle system could be suggested and or instantiated. Another example would be a recommended parking configuration based on the number of roads or total lanes adjacent to a particular structure. Alternatively a road configuration could be suggested based on the parking structures and parking places in a given city block.

The location plug in contains the display and overrides to the geospatial location and position information for the building. In this regard if location panel were expanded the user would have the option of specifying where Building A is located. For example the user can specify the latitude longitude and elevation. Alternatively the user can enter an address e.g. number street city state and or zip etc. . Further entering information in one field of the location panel may automatically retrieve and output information in another field e.g. entry of an address may automatically fill in the corresponding latitude longitude and elevation. In addition once the location information is entered the object e.g. Building A would automatically move to the location specified. The resulting visualization from the location plug in provides a visual representation of Building A in a 3D environment.

The occupancy plug in allows the user to establish the current number of occupants A to be displayed and overrides B i.e. the maximum number of occupants to the number of occupants for Building A . The visualization of the occupancy plug in would provide for multiple dots indicative of persons in Building A or distributed throughout building A .

The utilities plug in contains the display and overrides to the utility usage i.e. water and power for Building A . The visualization of the utilities plug in results in line or effect simulating power and water usage in Building A .

The greenhouse emissions plug in contains the display and overrides to the LEED Leadership in Energy and Environmental Design green building rating system emissions impact score for the Building A . The values on greenhouse emissions panel are automatically i.e. without additional user input updated based on the occupancy panel and utility consumption panel for a selected building. Alternatively the user may have the options of setting the greenhouse emissions values in panel and the system can automatically adjust either the occupancy values or utility values that are necessary to reach the greenhouse emissions values set forth in panel . In this regard the user can determine which values panels and are locked and which can be adjusted depending on the values specified in the other panels. The visualization of greenhouse emissions plug in would result in a halo type effect displayed around and emanating from Building A .

Accordingly developers and plug in authors can harness to the full power of 3D rendering to convey the results of their calculations. In this regard the 3D simulation illustrated in may change its coloring or areas displayed based on the visualizations resulting from plug ins . Check boxes C C may be utilized to determine whether a resulting visualization for the respective plug in is displayed in the 3D rendering of . For example the user may check boxes e.g. check boxes C C C and C within panel to determine which plug ins will be reflected in the display of building A of . This allows users to visualize and analyze their data in new and powerful ways.

One or more embodiments of the invention use plug ins to create animations that simulate results over time 4D . In addition plug ins can be used to simulate human behavior in the 3D environment. Given some human interaction and a stimulus in that environment the plug in architecture allows a user to predict and visualize certain human behaviors. The architecture also allows the user to visualize different temporal simulations like the sun and moon weather patterns and phenomena such as tornadoes and snowfall see detailed examples below .

One or more embodiments of the invention all the user to define scenarios that incorporate specific model and linked data overrides plug ins and their settings and visualization traits. In other words a group of settings are stored into a type of visual bookmark that allows the user to define specific what if scenarios. Each scenario or bookmark captures specific model and linked data overrides supplied by the user a set of plug ins and their settings and visualization parameters and traits.

By bookmarking scenarios and sub scenarios with different settings the user can quickly compare and analyze their information and make informed decisions. This essentially allows a user to save certain data sets apply them to scenes recall them and compare and contrast. In the prior art to visualize and compare different scenarios the users were required to modify a file save it with a certain criteria render it and repeat the process for each different scenario and comparing the final renderings. The ability to store the various settings into a bookmark is faster and interactive so the user is not required to save files using different settings.

Alternatively the user can select the scenario bookmark in panel which allows the user to select a set of predefined settings. Once the desired properties for a bookmark have been established i.e. in dialog box panel the user can opt to create a bookmark to associate all of the settings with a bookmark placeholder or thumbnail for those settings using dialog box . Once created and if in the appropriate mode the user may be presented with a group of selectable icons or menu options representative of the various bookmarks that have been established. For example icons and are representative of various bookmarked scenarios that have been established by a user. Thus each scenario represented by bookmarked icons provides a selection of one or more plug ins and properties settings that permit the user to define a particular visualization in a 3D 4D environment.

In view of the above bookmarked scenarios can be viewed as a way of storing both a set of data a specific set of models that have been loaded into a server into a name a set with a series of plug ins and potentially some overriding information for those plug ins.

One example of a plug in that may be used allows the user to directly control the sun shadow settings for the time of day and day of year while visualizing the results of such settings. In this regard embodiments of the invention include an innovative control for both the direct control of and playback of sun shadow simulations over specific days of year and times of day.

Additional settings for the sun shadow simulation plug in includes settings for the month day and year . In response to setting the month day and year the plug in may utilize the location information to determine calculate the sunrise sunset and length of day . Alternatively the user can manually enter the information in all of the fields as desired e.g. while ignoring the location information .

It should be noted that while the user can manually enter the information in fields the information may also be altered graphically. illustrates the sun shadow simulation for June 20while illustrates the sun shadow simulation for December 21. Referring to the user can directly control the day of year by dragging the timeline arc higher overhead summer sun as in and lower horizon winter sun as in on the screen. As the user drags the arc a date label adjacent to the arc illustrated directly above the center of the arc in dynamically reflects the current day of year see text label June 20in and December 21 in . Further as the date changes the sunrise and sunset labels e.g. below the timeline will automatically and dynamically change based on the calculations and settings established. Thus depending on the date the sunrise and sunset times may change and be automatically reflected by the labels in the timeline arc which may have default values for the sunrise sunset times.

As settings are established one can view shadows or simulations of the shadows in the visualization of the digital city geo spatial system illustrated. Such shadow rendering as illustrated in is operational during the date change e.g. when the arc is dragged allowing the user to visualize the effect of the sun shadows for a specific time of day over seasons.

Accordingly once the settings have been established the user has the ability to view a simulation of the sun and shadows cast in a 4D manner i.e. the fourth dimension being time . In this regard the timeline arc allows the user to move a timeline slider across the timeline arc and view the resulting simulation based on the settings established. Thus the user can use the playback buttons to start stop and restart the simulation over time. When started using control the timeline slider moves from the beginning to the end of the arc while the sun and shadows cast therefrom are simulated in the virtual scene that is displayed. The user is also free to drag the timeline slider across the length of the arc to visualize shadows at a specific time of day.

In addition playback control allows the user to drag e.g. reposition the start and stop endpoints of timeline arc in order to simulate a shorter interval of sun shadow than the full sunrise to sunset time period. Additional labels appear under the timeline arc when the endpoints are moved allowing the user to dynamically set a specific start and stop time. For example as illustrated in the labels are 05 31 08 00 NOON 16 00 and 20 31 indicating different times along the timeline arc .

In certain situations a user might also want to know how much moonlight might be cast at a certain time of the night during a particular season. During the summer the amount of light might be different from the winter due to the possibility of snow being on the ground. In another scenario the phases of the moon can be simulated in order to determine the tide. This type of information might be of interest to a builder near the ocean or a waterway near the ocean.

In addition to the above embodiments of the invention allow the user to modify the position or angle the user is viewing from. In this regard the user can utilize icon to reposition the perspective of the user within the 3D scene to allow the user to view shadows from multiple different positions perspectives including directly above from behind a building from on a particular floor of the building etc. Alternative methods for changing the position and or perspective of the user are intended to fall within the scope of the present invention.

At step a plug in is installed into the 3D graphics application. As used herein the plug in is the sun shadow simulation plug in.

At step a user defines for the plug in a calendar period comprising a month day and year. The user may define the calendar period using a number of different methodologies. In one example settings with a month field a day field and a year field are displayed in a panel of the graphics application. The user can then input the desired calendar information into the appropriate field. Alternatively the timeline arc can be dragged by the user to modify the radius of the arc. A smaller radius i.e. the arc is raised higher thereby curving the arc more reflects a calendar period in a summer solstice while a larger radius i.e. the arc is lower with less curvature as it approaches a straight line reflects a period in a winter solstice. As the user defines the calendar period labels that are proximate adjacent to the timeline arc are automatically i.e. without additional user input and dynamically updated. Thus as the user is dragging the arc the labels will dynamically and automatically update such that the user has feedback regarding the calendar period being defined. Such labels may provide month day and or year indicators for the calendar period of timeline arc.

At step and consistent with the calendar period being defined in step i.e. the order of steps and may be interchangeable a timeline arc is displayed. The calendar period defines the radius of the arc and a starting endpoint and stopping endpoint of the timeline arc define an interval of time during the calendar period. Such an interval of time may be sunrise to sunset or another period of time established defined by the user. The user can adjust modify the interval of time merely by modifying the starting endpoint or stopping endpoint e.g. by dragging a endpoints using a cursor control device .

At step a visualization is displayed in the 3D view of shadows cast by a sun on objects in the 3D view. The position of the sun in the visualization is based on the calendar period e.g. specified in the timeline arc and time of day specified by the timeline slider . The visualization may further consist of a playback simulation where the timeline slider is automatically i.e. without additional user input moved across the timeline arc such that the position of the sun and the visualization is automatically and dynamically updated as the slider moves across the timeline arc. In other words the user can use playback control to have the timeline slider move across the timeline arc at a defined rate such a rate may be specified by the user wherein during such playback the shadows and sun position are automatically and dynamically updated in synchronization with the timeline slider movement. Such a playback operation can effectively allow the user to view the shadows cast from sunrise to sunset during a particular time of year i.e. the defined calendar period . Further while the user is dragging the timeline arc at step i.e. to modify the radius the visualization may also automatically and dynamically update so that the user can visualize the shadows at a particular time over seasons.

In addition during step the user can modify the viewpoint perspective of the user within the visualization by identifying a new user location e.g. a different location in 3D space . Identifying the 3D location may be conducted by the user clicking in a desired location in the 3D space specifying a geospatial location e.g. using latitude longitude and elevation coordinates or using any type of tool or widget to manipulate and change the user s location and or perspective.

While the above logical flow is described with respect to sun shadows similar steps can be used to simulate moonlight and or phases of the moon and the resulting tide flow.

This concludes the description of the preferred embodiment of the invention. The following describes some alternative embodiments for accomplishing the present invention. For example any type of computer such as a mainframe minicomputer or personal computer or computer configuration such as a timesharing mainframe local area network or standalone personal computer could be used with the present invention.

The foregoing description of the preferred embodiment of the invention has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed. Many modifications and variations are possible in light of the above teaching. It is intended that the scope of the invention be limited not by this detailed description but rather by the claims appended hereto.

