---

title: System and article of manufacture for transparent file restore
abstract: Provided is a system and program for automatically handling an error when retrieving a file for an application. An error is detected while the application retrieves a file from the storage device. A user defined policy is checked to determine whether a backup copy should be restored, and the file is restored from the backup copy if the user defined policy indicates that the backup copy should be used.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07685180&OS=07685180&RS=07685180
owner: International Business Machines Corporation
number: 07685180
owner_city: Armonk
owner_country: US
publication_date: 20081118
---
This application is a continuation application of and claims the benefit of TRANSPARENT FILE RESTORE U.S. Pat. No. 7 509 357 having application Ser. No. 11 190 251 filed Jul. 26 2005 which is a continuation of and claims the benefit of METHOD SYSTEM PROGRAM FOR A TRANSPARENT FILE RESTORE U.S. Pat. No. 6 950 836 issued on Sep. 27 2005 having application Ser. No. 10 099 338 filed Mar. 14 2002 the disclosure of each of which is incorporated herein by reference in its entirety.

The present invention relates to a system method and program for automatically restoring corrupt or missing data files.

Applications running on a host or server system typically retrieve and store data files on a storage device. The storage device may be comprised of a simple disk drive or multiple disks such as the case with a Direct Access Storage Device DASD Just a Bunch of Disks JBOD a Redundant Array of Independent Disks RAID etc. Periodically access to a file or a collection of files can simply fail for a number of reasons such as a media Input Output I O error due to a corrupted file or the prior deletion of the file unintentional or not. The most common cause of I O errors is the operating system crashing e.g. resource sharing errors software incompatibility etc. or improper shutdown of the system.

When such errors occur the application accessing the data file usually fails also. Typically the user must start a separate application to restore the necessary files and then restart the failed application from the beginning. A significant loss of time and productivity is often incurred during this process. Furthermore the end user may not always be familiar with the operation to restore the lost or corrupt file s and this process may require the intervention of a support person or group to complete.

For these reasons there is a need in the art to provide techniques to better manage access failures to avoid system disruption.

Provided is a method system and program for automatically handling an error when retrieving a file for an application. An error is detected while the application retrieves a file from the storage device. A user defined policy is checked to determine whether a backup copy should be restored and the file is restored from the backup copy if the user defined policy indicates that the backup copy should be used.

Additionally all modifications to files are monitored in a change log and all file retrieval requests are monitored for errors. Moreover a determination is made on whether the file has been modified since the backup copy was made. The determination can be made by comparing the modification date in the change log and the time of when the backup copy was made.

In further implementations the user defined policy is capable of indicating when the backup copy should be used in one of multiple circumstances. The multiple circumstances can include but are not limited to situations where the file is damaged and no modifications were made since the backup copy was made the file is damaged and modifications to the file have been made since the backup copy was made the file is missing and no modifications were made since the backup copy was made and the file is missing and modifications to the file have been made since the backup copy was made.

In still further implementations the backup copy is transmitted according to the user defined policy wherein the backup copy is provided to the application if the user defined policy authorizes the use of the backup copy or the error message is provided to the application without the backup copy if the user defined policy does not authorize the use of the backup copy.

By providing an automatic file restore function when an error occurs during the retrieval of a file the application will not fail because of the error. Thus the present invention alleviates the need to start a separate application to restore the necessary files and eliminates the need to restart the failed application from the beginning. Moreover the end user will not need the intervention of a support person or group to complete the file restore even if the user is not familiar with the operation to restore the lost or corrupt file s . Thereby a significant amount of time cost and productivity is saved.

In the following description reference is made to the accompanying drawings which form a part hereof and which illustrate several embodiments of the present invention. It is understood that other embodiments may be utilized and structural and operational changes may be made without departing from the scope of the present invention.

Control begins at block where the application performs a read operation. At block all read events on files by the application are monitored using the restore filter driver . If no problems are detected during the retrieval process then the file is passed on i.e filtered to the application at block and the host system continues to operate normally. However if the file to be retrieved is detected as being damaged or missing at block the error message is intercepted by the file restore filter at block . Depending on whether the error message sends back a file error as being damaged or missing the transparent file restore function applies different logic with regards to checking the currency of the backup copy at block . For damaged files the file restore filter checks the backup copy to determine if the backup copy is current by comparing the date of the last file backup with the date of the damaged file. On the other hand if the file is missing i.e. deleted the change log is checked to determine whether the backup copy is current. Depending on the user setting i.e. a check is made on the user defined policy at block the transparent file restore function will perform the appropriate function based on the state of the backup copy and the user defined policy at block . Additionally the user defined policy may specify no further action to perform beyond passing and logging an error message. The user defined policy may be set for four different error circumstances 1 File is unreadable and no changes since last backup 2 File is unreadable but was changed since last backup 3 File is Missing and no changes since last backup or 4 File is Missing but was changed since last backup. The user can choose to restore the backup copy or to not restore the backup copy and just pass on the error to the application for each circumstance. If at block the file exists on the backup server and the user defined policy indicates that the file should be restored a storage manager program e.g. Tivoli Storage Manager is called at block to restore the file and the application is allowed to proceed with the backup version of the restored file without causing the application to fail due to the error. Otherwise an error message is printed at block and a dialog displayed to ask the user whether to proceed with the restore. Tivoli is a trademark of International Business Machines Corporation. Windows is a trademark of Microsoft Corporation.

If at block the user selects to proceed with the restore control proceeds to block to perform the restore. Otherwise if the user does not select to proceed with restore then an error message is returned at block to the application . The various user defined policies for each error circumstance will now be discussed below in conjunction with .

If at block no changes were made to the damaged file since the last backup at block the file is retrieved from the backup server and transparently restored to the application . If changes were made to the file since the last backup the file restore filter checks the user defined policy for the user preference at block . If at block the option to restore transparently is selected the file is retrieved from the backup server and written to the storage device at block . The backup copy is saved to the storage device and the backup copy data is made available to the application . If the option to restore transparently is not selected by the user the error message is passed through to the application at block .

The preferred embodiments may be implemented as a method apparatus or article of manufacture using standard programming and or engineering techniques to produce software firmware hardware or any combination thereof. The term article of manufacture as used herein refers to code or logic implemented in hardware logic e.g. an integrated circuit chip Field Programmable Gate Array FPGA Application Specific Integrated Circuit ASIC etc. or a computer readable medium e.g. magnetic storage medium e.g. hard disk drives floppy disks tape etc. optical storage CD ROMs optical disks etc. volatile and non volatile memory devices e.g. EEPROMs ROMs PROMs RAMs DRAMs SRAMs firmware programmable logic etc. . Code in the computer readable medium is accessed and executed by a processor. The code in which preferred embodiments are implemented may further be accessible through a transmission media or from a file server over a network. In such cases the article of manufacture in which the code is implemented may comprise a transmission media such as a network transmission line wireless transmission media signals propagating through space radio waves infrared signals etc. Of course those skilled in the art will recognize that many modifications may be made to this configuration without departing from the scope of the present invention and that the article of manufacture may comprise any information bearing medium known in the art.

The preferred logic of describes specific operations occurring in a particular order. In alternative implementations certain of the logic operations may be performed in a different order modified or removed. Moreover steps may be added to the above described logic and still conform to the described implementations. Further operations described herein may occur sequentially or certain operations may be processed in parallel.

In addition the file restore filter was described as being implemented in the kernel of the operating system. Alternatively the file restore filter can be implemented in alternative ways such as a part of the application program that interacts with the operating system part of the operating system a separate application program etc.

The foregoing description of the preferred embodiments of the invention has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed. Many modifications and variations are possible in light of the above teaching. It is intended that the scope of the invention be limited not by this detailed description but rather by the claims appended hereto. The above specification examples and data provide a complete description of the manufacture and use of the composition of the invention. Since many embodiments of the invention can be made without departing from the spirit and scope of the invention the invention resides in the claims hereinafter appended.

