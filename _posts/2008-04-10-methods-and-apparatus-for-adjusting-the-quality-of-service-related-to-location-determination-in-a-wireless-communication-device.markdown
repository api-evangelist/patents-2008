---

title: Methods and apparatus for adjusting the quality of service related to location determination in a wireless communication device
abstract: Methods, systems, devices and computer program products for executing a predetermined routine including one or more location determination modes to determine a geographic position, i.e., the location of a wireless communication device. In certain aspects, the predetermined routine may be configured to adjust the Quality of Service (QoS) for one or more of the location determination modes implemented in the routine. Based on the pre-configuration of the routine, adjustment of the QoS of one or more location determination modes may occur as a matter of course or the routine may be configured to adaptively adjust the QoS based on conditions, such as network conditions, environmental conditions and the like, existing at the point in time in which the location determination mode is executed.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08275393&OS=08275393&RS=08275393
owner: Qualcomm Incorporated
number: 08275393
owner_city: San Diego
owner_country: US
publication_date: 20080410
---
The present Application for Patent claims priority to Provisional Application No. 60 939 370 entitled Methods and Apparatus for Improved Position Location filed May 22 2007 and Provisional Application No. 60 991 573 entitled Methods and Apparatus for Multi Mode Location Determination in a Wireless Communication Device filed Nov. 30 2007 both of which are assigned to the assignee hereof and hereby expressly incorporated by reference herein.

The disclosed aspects relate to wireless communication devices and more particularly to systems methods and apparatus that provide for adjusting the Quality of Service QoS related to location determination in wireless communication devices and in one embodiment lowering the QoS after an unsuccessful location determination.

Wireless communication devices such as cellular telephones portable computers and the like have rapidly gained in popularity over the past decade. These devices are increasingly becoming multifaceted devices capable of providing a wide range of functions. For example today s cellular telephone may also embody computing capabilities Internet access electronic mail text messaging digital photographic capability an audio MP3 player video gaming capabilities video broadcast reception capabilities and the like.

In addition to the myriad of functions listed mobile communication devices may be equipped with location determination devices and routines such as Global Positioning System GPS sensors and routines or the like that provide for the device to determine their respective geographic position at any point in time. Location information is most commonly used in navigation systems which track geographic position with respect to a mapped destination and may be incorporated with wireless communication devices such as cellular telephones or the like. However use of positioning information in wireless communication devices is not limited to navigational systems. Other applications may also rely on location information. For example performance tracking systems which may reside internally at the wireless device or externally at the network level benefit from knowing the location at which a performance problem occurs such as the location of a call drop an out of service OOS occurrence or a call failure. Additionally many other applications are relying on environmental characteristics of the device such as the location of the device to modify or update the methodology of the application.

Currently various modes of operation exist for determining location. For example GPS Galileo GLONASS GLObal NAvigation Satellite System or other satellite based systems may rely on a Mobile Station Based MS Based mode a Mobile Station Assisted MS Assisted mode a Standalone mode or any other feasible mode currently known or known in the future. The various modes offer different methods for determining location. For example in MS Based mode the wireless device obtains information related to the location of satellites from a network Location Determining Entity PDE and then performs the location determination calculation at the wireless communication device. The satellite location information is commonly referred to as Ephemeris data and Almanac data. Almanac data is course orbital parameters for all the satellites in the system and is considered valid for up to several months. Ephemeris data by comparison is very precise orbital and clock correction for each satellite and is considered valid for about 30 minutes. Thus in MS Based mode a wireless device may but is not always required to obtain the information from the PDE depending on the currentness of the satellite information.

In MS Assisted mode the wireless device relies on the PDE to perform the location and as such is required to communicate with the PDE each time a location determination is performed. Therefore by comparison while MS based mode requires a wireless signal to communicate with the PDE for some of the location determinations MS assisted mode requires a wireless signal to communicate with the PDE for all of the location determinations.

In contrast in Standalone mode all the functions are carried out at the wireless device and since no PDE satellite information is required no wireless signal is required. However Standalone mode requires that the wireless device receive signals from at least four of the GPS satellites while MS Assisted mode can calculate a fix with few and in some instances not any satellites. Thus Standalone mode has a high failure rate when attempts are made indoors while the MS Assisted mode has much higher availability indoors.

In current practice the applicable location determination mode is defined by the application or is chosen at the initialization start up stage. Thus the chosen mode applies to a location determinations request even if the mode may not be the best mode for all scenarios. Various conditions may exist throughout the executing duration of an application that are relevant to the effectiveness of the chosen mode. For example MS Assisted mode requires a wireless signal such as a CDMA Code Division Multiple Access signal or GSM Global System for Mobile signal and therefore if the chosen mode is MS Assisted location determination will not occur if a wireless connection is not available. Other conditions that affect the performance of location determination modes are the current environment of the device battery life voice call state data call state the currentness of the satellite information and the like.

In addition to relying on satellites to determine location MS Assisted mode will record the current network parameters to obtain a network based location determination. Network parameters and associated network based location determination refers to any terrestrial based parameters and terrestrial based location determination. Examples of network based methods used to determine wireless device location include but are not limited to Advanced Forward Link Trilateration AFLT Enhanced Forward Link Trilateration EFLT Enhanced Observed Time Difference EOTD Observed Time Difference of Arrival OTDOA and the like. AFLT is the method generally associated with MS Assisted mode and is a wireless device based location determination that uses a phase offset technique to determine location. To determine location the wireless device takes measurements of signals from nearby cellular base stations and reports the pilot phase measurements back to the network which are then used to trilaterate an approximate location of the wireless device. Characteristically network based methods tend to be less accurate than satellite based location fixes.

As previously noted satellite based location determination methods generally require information from at least three satellites. Thus the wireless device must be located in an area capable of receiving information from multiple satellites. Indoor locations dense urban areas and certain natural structures like canyons and the like may offer challenges to accurate and time efficient satellite fixes. In addition other limitations such as erratic ionospheric conditions noise at the wireless device level and the like may prohibit obtaining a satellite based fix or impact the accuracy of the satellite based fix. In these instances it may be desirable to rely on network based parameters to obtain a network based location determination.

In the same regard certain wireless device applications that require location information may favor a faster location determination fix even if some degree of accuracy is sacrificed. For example in the mobile environment applications that track the occurrence of a call event such as a call drop a call failure or the like may be more concerned with determining the location at the moment the call event occurs as opposed to determining a more accurate location at a point in time removed from the call event. This is especially evident in the scenario in which the call event occurs in a moving vehicle the call event tracking application desires an immediate location determination fix regardless of accuracy to be able to associate location with the call event. If the call event tracking application has to wait a certain amount of time for the location determination fix the resulting location may be a significant distance from the location at which the call event occurred depending on the speed of the vehicle. In this instance the application may place a higher priority on speed at which a location is determined as opposed to the precise accuracy of the determined location.

Therefore a need exists to provide systems and methods for accelerating location determination in wireless communication devices. As such the desired systems and methods may provide more efficient location fixes in terms of time to process the location fix. Such systems and method will greatly benefit applications that place a higher priority on the speed at which a fix is obtained as opposed to the accuracy of the fix. In addition the desired systems and methods should take into account conditions that exist at the point in time when a location determination is made to insure the likelihood of location determination success and further expedite the location determination process.

The following presents a simplified summary of one or more aspects in order to provide a basic understanding of such aspects. This summary is not an extensive overview of all contemplated aspects and is intended to neither identify key or critical elements of all aspects nor delineate the scope of any or all aspects. Its sole purpose is to present some concepts of one or more aspects in a simplified form as a prelude to the more detailed description that is presented infra.

Present aspects provide for methods devices systems and computer program products for accelerating location determination in a wireless communication device. Specifically aspects of the predetermined routine may be configured to adjust the Quality of Service QoS for one or more of the location determination modes implemented in the routine. QOS settings enable an application to modify the balance between speed of fix and accuracy the two parameters generally being inversely related in any given scenario. Based on the pre configuration of the routine adjustment of the QoS used in one or more location determination modes may occur as a matter of course or the routine may be configured to dynamically adjust the QoS based on surrounding conditions such as network conditions environmental conditions and the like existing at the point in time in which the location determination mode is executed or adaptively adjust the QoS based on historical conditions that affect location determination.

In one aspect a method for location determination in a wireless communication device is defined. The method includes providing for a predetermined location determination routine that includes a plurality of location determination modes at least one of which is a Quality of Service QoS adjustable location determination mode. The method further includes receiving a request for a location of the wireless communication device and attempting to obtain a location of the wireless communication device by executing a first location determination mode from the predetermined location determination routine. Additionally the method includes adjusting the QoS of the QoS adjustable location determination mode to a lower level if the attempt to obtain a location by executing the first location determination mode fails attempting to obtain the location of the wireless communication device by executing the QoS adjustable location determination mode and storing in memory a result of the attempt to obtain the location of the wireless communication device by executing the QoS adjustable location determination mode.

In one aspect of the method the Quality of Service QoS adjustable location determination mode is further defined as Mobile Station Assisted mode MS Assisted mode which characteristically provides for recording network parameters and obtaining a network based location determination in addition to providing a satellite based location determination. If the QoS of the MS Assisted mode is set low for example to a minimum level such as zero the mode will only have sufficient time to record the current network parameters and characteristically not enough time to search for satellite signals. In this instance the mode will generally only obtain a network based location determination fix.

In an additional aspect the method may include determining prior to adjusting the QoS of the QoS adjustable location determination mode whether to make a lower QoS adjustment for the QoS adjustable location determination mode. The determination as to whether to adjust the QoS may be based on pre configuration of the predetermined location determination routine existing conditions affecting location determination and or historical conditions affecting location determination. Thus determining whether to adjust the QoS based on existing conditions provides for dynamic adjustment of the QoS and determining whether to adjust the QoS based on historical conditions provides for adaptive adjustment of the QoS. Example of existing conditions and or historical conditions include but are not limited to wireless signal state voice call state data call state battery power state and location determination entity information state.

In one aspect the method may further include adjusting the QoS of the QoS adjustable location determination mode to a higher level after the attempt to obtain a location of the wireless communication device by executing the QoS adjustable location determination mode. The adjustment to the higher level may be a re adjustment to a level prior to the lower level adjustment or the adjustment may be to a level above or below the previous level. The adjustment to the higher level may be necessary if the QoS adjustable location determination mode is subsequently attempted by the predetermined location determination routine. In such aspects the method may further include determining prior to adjusting the QoS of the QoS adjustable location determination mode to a higher level whether to make a higher QoS adjustment for the QoS adjustable location determination mode. The determination may be based on preconfiguration of the routine existing conditions and or historical conditions.

A further aspect is provided for by at least one processor configured to determine location in wireless device. The processor includes a first module for providing for a predetermined location determination routine that includes a plurality of location determination modes including a Quality of Service QoS adjustable location determination mode. The processor also includes a second module for receiving a request for a location of the wireless communication device and a third module for attempting to obtain a location of the wireless communication device by executing a first location determination mode from the predetermined location determination routine. Additionally the processor includes a fourth module for adjusting the QoS of the QoS adjustable location determination mode to a lower level if the attempt to obtain a location by executing the first location determination mode fails a fifth module for attempting to obtain the location of the wireless communication device by executing the QoS adjustable location determination mode and a sixth module for storing in memory a result of the attempt to obtain the location of the wireless communication device by executing the QoS adjustable location determination mode.

Another related aspect is defined by a computer program product that includes a computer readable medium. The medium includes at least one instruction for causing a computer to provide for a predetermined location determination routine that includes a plurality of location determination modes including a Quality of Service QoS adjustable location determination mode. The medium additionally includes at least one instruction for causing the computer to receive a request for a location of the wireless communication device and at least one instruction for causing the computer to attempt to obtain a location of the wireless communication device by executing a first location determination mode from the predetermined location determination routine. Additionally the medium includes at least one instruction for causing the computer to adjust the QoS of the QoS adjustable location determination mode to a lower level if the attempt to obtain a location by executing the first location determination mode fails at least one instruction for causing the computer to attempt to obtain the location of the wireless communication device by executing the QoS adjustable location determination mode and at least one instruction for causing the computer to store in memory a result of the attempt to obtain the location of the wireless communication device by executing the QoS adjustable location determination mode.

Yet another related aspect is defined by a wireless communication device. The device includes means for providing for a predetermined location determination routine that includes a plurality of location determination modes including a Quality of Service QoS adjustable location determination mode. The device also includes means for receiving a request for a location of the wireless communication device and means for attempting to obtain a location of the wireless communication device by executing a first location determination mode from the predetermined location determination routine. Additionally the device includes means for adjusting the QoS of the QoS adjustable location determination mode to a lower level if the attempt to obtain a location by executing the first location determination mode fails means for attempting to obtain the location of the wireless communication device by executing the QoS adjustable location determination mode and means for storing in memory a result of the attempt to obtain the location of the wireless communication device by executing the QoS adjustable location determination mode.

A further aspect of the innovation is provided for by a wireless communication device. The device includes a computer platform including at least one processor and a memory. The device also includes a predetermined location determination routine stored in the memory and executable by the at least one processor. The routine includes a plurality of location determination mode including a Quality of Service QoS adjustable location determination mode that includes a QoS adjustable parameter. The parameter is operable to be adjusted to a lower level such as a minimum level if another location determination mode in the routine is executed and fails to obtain a fix. In one aspect of the device the QoS adjustable location determination mode is further defined as Mobile Station Assisted mode MS Assisted mode .

Another aspect of the device includes a QoS adjuster stored in the memory and executable by the at least one processor. The QoS adjuster is operable to determine whether to make the lower QoS adjustment for the QoS adjustable location determination mode prior to adjusting the QoS. In such aspects the QoS adjuster may be further operable to determine whether to make a dynamic lower QoS adjustment for the QoS adjustable location determination mode based on one or more existing conditions affecting location determination. In another aspect the QoS adjuster may be further operable to determine whether to make an adaptive lower QoS adjustment for the QoS adjustable location determination mode based on historical conditions affecting location determination. The existing and or historical conditions may include but are not limited to wireless signal state voice call state data call state battery power state and location determination entity information state.

Thus present aspects provide for methods systems devices and computer program products that improve the ability of the wireless device to determine location. According to present aspects the predetermined routine may be configured to adjust the Quality of Service QoS for one or more of the location determination modes implemented in the routine. Based on the pre configuration of the routine adjustment of the QoS of one or more location determination modes may occur as a matter of course or the routine may configured to dynamically adjust the QoS based conditions such as network conditions environmental conditions and the like existing at the point in time in which the location determination mode is executed or adaptively adjust the QoS based on historical conditions that affect location determination.

The present devices apparatus methods computer readable media and processors now will be described more fully hereinafter with reference to the accompanying drawings in which aspects of the invention are shown. The devices apparatus methods computer readable media and processors may however be embodied in many different forms and should not be construed as limited to the aspects set forth herein rather these aspects are provided so that this disclosure will be thorough and complete and will fully convey the scope of the invention to those skilled in the art. Like numbers refer to like elements throughout.

The various aspects are described herein are in connection with a wireless communication device. A wireless communication device can also be called a subscriber station a subscriber unit mobile station mobile remote station access point remote terminal access terminal user terminal user agent a user device or user equipment. A subscriber station may be a cellular telephone a cordless telephone a Session Initiation Protocol SIP phone a wireless local loop WLL station a personal digital assistant PDA a handheld device having wireless connection capability or other processing device connected to a wireless modem.

Present aspects provide for systems methods devices and computer program products for executing a predetermined routine including one or more location determination modes to determine a geographic position i.e. the location of a wireless communication device. In certain aspects the predetermined routine may be configured to adjust the Quality of Service QoS for one or more of the location determination modes implemented in the routine. In one aspect the QoS for a location determination mode may be adjusted lower after an unsuccessful location determination occurs within the routine. Based on the pre configuration of the routine adjustment of the QoS of one or more location determination modes may occur as a matter of course or the routine may configured to adaptively adjust the QoS based conditions such as network conditions environmental conditions and the like existing at the point in time in which the location determination mode is executed.

Currently various modes exist for determining location many of the modes rely on satellite based systems such as Global Positioning System GPS Galileo GLONASS GLObal NAvigation Satellite System and the like for determining location. Examples of such modes include but are not limited to Mobile Station Based mode MS Based mode Mobile Station Assisted MS Assisted mode Standalone mode and the like.

Additionally certain modes that rely on satellite based systems such as MS Assisted mode and the like record the current network parameters to obtain a network based location determination. It is also possible for the location determination routine to implement modes that are solely based on network parameters and provide only network based location determination. For example if the predetermined routine does not include an MS Assisted mode of location determination the routine may be configured with a mode that is solely based on obtaining network parameters. Network based location determination may include but is not limited to Advanced Forward Link Trilateration AFLT Enhanced Forward Link Trilateration EFLT Enhanced Observed Time Difference EOTD and the like. These network based location determination methods rely on timing signals between network nodes such as communication network base stations Wi Fi hotspots or any other communication network component.

In this regard many wireless communication devices are configured to implement more than one location determination mode. This is generally necessary because individual location requesting applications such as mapping applications system diagnostic applications and the like may be configured to request a location using a specific location determination mode.

According to certain aspects the predetermined routine may determine which location determination mode s to execute on a per request basis. In this regard the mode used to determine location may not be static. According to one or more of the present aspects each instance of a location request results in the identification of one or more location determination modes based on a predetermined routine. In accordance with some present aspects the predetermined routine may select the mode by sequencing through multiple trials and attempting multiple location determination attempts for each of the sequenced trials until a successful location determination results. In other aspects the predetermined routine may select the mode by determining one or more existing conditions that affect location determination and selecting a location determination mode based on the existing condition s . In some aspects the predetermined routine may determine one or more existing conditions that affect location determination and identify a location determination mode if the existing conditions provide for determining location using the mode.

In addition to determining the mode based on conditions the predetermined routine may be configured to adjust the QoS for one or more of the modes implemented in the routine based on one or more existing conditions that affect location determination or based on pre configuration of the predetermined routine. In this regard the application associated with the predetermined routine may place a high priority on the rate at which a location is determined and as such the QoS may be lowered for one or more of the modes implemented in the predetermined routine to assure that a fix is returned in an expedited manner. In other instances existing conditions such as network conditions environmental conditions or the like may dictate that a higher QoS be implemented such as restoring a location determination mode to its original QoS after the QoS has previously been lowered for a prior location determination fix.

In certain aspects location determination provides for sequencing through multiple trials to determine which location determination mode is capable of resulting in a successful location determination. The selection of which location determination mode to attempt within a given trail may be based on current existing conditions that affect the location determination process.

Referring to a block diagram is illustrated of a predetermined location determination routine implemented by a wireless device to determine location in accordance with an aspect of the present innovation. The predetermined location routine may include one or more location determination modes . The modes may include but are not limited to MS Based mode MS Assisted mode Standalone mode which rely on satellite based measurements to return a location fix and in some instances such as MS Assisted mode provide network measurements applicable to provide a network based location determination fix. In addition modes may include AFLT EFLT EOTD and the like which rely on network based measurements to return a location fix. Additionally other satellite based network based and or hybrid location determination modes that currently exist or may exist in the future may be implemented without departing from the innovative concepts herein disclosed.

One or more of the location determination modes within the predetermined routine may include an adjustable QoS parameter that defines the level of quality imparted to the location determination process. In this regard QoS may be defined by how long the mode is allowed to search for necessary signals such as satellite signals or network signals necessary to provide the desired location fix i.e. the search time . Thus a higher QoS generally correlates to longer allowable search times while a lower QoS generally correlates to shorter allowable search times. Longer search times can assist in the location of a sufficient number of satellites particularly in instances in which the wireless device is located indoors in dense urban areas or heavily wooded areas.

Modes having adjustable QoS parameters are especially suited to hybrid modes that are capable of returning both satellite based location fixes and network based location fixes. Thus in a hybrid mode such as MS Assisted mode which provides for both satellite based and network based location determination adjusting the QoS may determine which of the location determinations the mode returns. For example if the QoS for MS Assisted is set to a high level the mode will generally have adequate time to search for requisite satellite signals and as such a more accurate satellite based location determination results. Conversely if the QoS for MS Assisted is set to a low level the mode may not have adequate time to search for requisite satellite signals and as such the only location that is returned is a less accurate network based location determination. However as previously discussed in certain applications or instances the need to provide a location fix in a timely manner may have higher priority than the need to provide accuracy in terms of a precise location. In such applications or instances reducing the QoS may be the preferred manner in which to implement the mode.

In Code Division Multiple Access CDMA communication networks the QoS for a location determination mode may range from about to about . The value of the QoS represents the maximum number of seconds the search engine is provided to search for requisite satellites. If the QoS value is set low a faster more shallow and less sensitive search for satellites results. If the QoS value is set high a longer deeper and more sensitive search for satellites results. In the instance of hybrid modes such as MS Assisted or the like setting the QoS to a low value may result in only the ability to record necessary network parameters and the subsequent network based location determination returned because inadequate time is provided to perform a satellite based search. In one aspect of the innovation the adjustable QoS may be set to a predetermined value such as zero 0 or some other predetermined value to assure that only network based location determinations are obtained. In this aspect setting the QoS to a value that limits the location determination process to network based fixes assures that location determination process occurs as efficiently as possible in terms of time required to determine a location fix.

In addition the predetermined location determination routine may include a QoS adjuster operable to adjust the QoS parameter for one or more location determination modes . As illustrated the QoS adjuster may be a standalone program component or the QoS adjuster may be included within one or more of the location determination modes that include the adjustable QoS parameter. The QoS adjuster may be operable to adjust the QoS for one or more location determination modes based on existing conditions that exist at the time that a mode is to be implemented or based on historical conditions. As such the QoS adjuster provides for QoS to be adjusted dynamically according to existing conditions and or adaptively according to historical conditions.

In alternate aspects in which adjustment to the QoS is limited to being preconfigured within the location determination routine such that the QoS for a predetermined mode is adjusted to a predetermined level the need for a QoS adjuster may be obviated.

In one example in which the QoS is adjusted based on preconfiguration of the routine a first QoS may be applied to a mode occurring at the onset of the predetermined location determination routine such as mode that occurs after the initial location determination mode in the routine has failed and a second QoS may be applied to the same mode implemented later in the predetermined location determination routine. In this example the first QoS may be set low to assure that only network based searching and network based location determinations occur and the second QoS may be set high or re stored to an original setting to allow for adequate time to search for satellites and thus determine a satellite based location.

In another example in which the QoS adjuster relies on existing conditions to adjust the QoS the QoS adjuster may determine or identify the requisite existing conditions such as network conditions environmental conditions or the like to determine if QoS adjustment is warranted and if so the appropriate amount or level of QoS adjustment. For instance assessment of existing conditions may determine that a satellite based location determination attempt would be futile and therefore QoS may need to be adjusted to lower levels so that only requisite time is provided to record the current network parameters.

In yet another example in which the QoS adjuster relies on historical conditions to adjust QoS the QoS adjuster may access a historical condition database to determine if historical conditions dictate QoS adjustment and if so the appropriate amount or level of QoS adjustment. For example if historical data indicates that during a particular time of day and or week the wireless device is typically located in an office building within a dense urban area the QoS adjuster may need to set the QoS to a low or minimal level at that particular time of day and or week because the likelihood of successfully determining a satellite based location determination may be minimal. In other aspects the historical conditions may be relied upon by the QoS adjuster to continuously adjust the QoS level for one or more modes depending on the historical conditions of the network environment or the like. In this regard the QoS adjuster may be constantly monitoring the historical conditions affecting location determination and adaptively adjusting QoS parameters in response to the historical conditions.

Referring to a block diagram is depicted of a wireless communication device configured for location determination according to present aspects. Wireless communication device is operable to determine location based on the identification of at least one location determination predetermined routine. As such wireless communication device is capable of receiving satellite signals from location satellites such as GPS Galileo GLONASS satellites or the like. Received satellite signals are used by one or more of the location determination modes to determine the location of the wireless device. In addition wireless communication device is in wireless communication with Position Determining Entity . In some location determination modes the PDE provides the wireless communication device with location information such as data used to locate satellites and in some aspects PDE performs the final location calculation. In other satellite based location determination modes communication with the PDE is not required.

The wireless communication device includes a computing platform having a processing unit and a memory . Computer platform also includes a communications module operable for transmitting and receiving wireless communication and receiving satellite signals . Location determination requests commonly referred to as fixes may originate from applications not shown in stored in memory and executable on wireless device . Alternatively location determination requests may be wirelessly received by the communication module in response to requests by wireless network devices not shown in .

Memory also includes a location determination module that is operable to attempt location determination for the wireless device based on received location determination requests . The location determination module includes at least one predetermined mode routine that is operable to identify at least one location determination mode on a per location request basis. Location determination modes may include but are not limited to MS Based mode MS Assisted mode Standalone mode and any other known or future known satellite based or hybrid based location determination modes. Additionally location determination modes may include network based determination modes such as such as AFLT EFLT EOTD and the like which determine location based on timing signals between network base stations.

As discussed in relation to one or more of the location determination modes may include an adjustable QoS parameter and as such the mode routine may include a QoS adjuster operable to adjust the QoS for the specified location determination mode dynamically adjust the QoS based on existing conditions such as existing network conditions existing environmental conditions or the like and or adaptively adjust the QoS based on historical conditions such historical network conditions historical location patterns historical environmental conditions and the like. Alternatively in other aspects QoS adjustment may be preconfigured in the routine such that one or more predetermined modes are defined that have a predetermined QoS adjustment level.

In some aspects mode routine may be configured to sequence through multiple trials trying to successfully determine a location . In addition mode routine may be configured to provide for multiple attempts within a given trial before the routine abandons the trial and moves to the next trial in the sequence. In other aspects mode routine may be configured to determine one or more existing conditions that affect location determination and select a mode and in some aspects a QoS level based on the determination of the one or more existing conditions. Existing conditions are defined as the current status or value of a wireless device condition. Examples of existing conditions include but are not limited to current wireless signal state such as Code Division Multiple Access CDMA signal state or Global System for Mobile GSM communications signal state Universal Mobile Telecommunications System UMTS signal state Wireless Fidelity Wi Fi signal state Worldwide Interoperability for Microwave Access WiMAX signal state current state of information communicated from the PDE such as ephemeris data almanac data and the like current communications state such as voice call state data session state or the like current battery power state current environmental condition s state such as visibility or received signal strength of the satellites and any other existing conditions which may affect location determination.

Referring to according to one aspect a detailed block diagram representation of wireless communication device is depicted. The wireless communication device may include any type of computerized communication device such as cellular telephone Personal Digital Assistant PDA two way text pager portable computer and even a separate computer platform that has a wireless communications portal and which also may have a wired connection to a network or the Internet. The wireless communication device can be a remote slave or other device that does not have an end user thereof but simply communicates data across the wireless network such as remote sensors diagnostic tools data relays and the like. The present apparatus and methods can accordingly be performed on any form of wireless communication device or wireless computer module including a wireless communication portal including without limitation wireless modems PCMCIA cards access terminals desktop computers or any combination or sub combination thereof.

The wireless communication device includes computer platform that can transmit data across a wireless network and that can receive and execute routines and applications. Computer platform includes memory which may comprise volatile and nonvolatile memory such as read only and or random access memory RAM and ROM EPROM EEPROM flash cards or any memory common to computer platforms. Further memory may include one or more flash memory cells or may be any secondary or tertiary storage device such as magnetic media optical media tape or soft or hard disk.

Further computer platform also includes processor which may be an application specific integrated circuit ASIC or other chipset processor logic circuit or other data processing device. Processor or other processor such as ASIC may execute an application programming interface API layer that interfaces with any resident programs such as location requesting applications location determination module and mode routines stored in the memory of the wireless device . However API is typically not capable of determining which location determination mode to use for a given location determination request. API is typically a runtime environment executing on the respective wireless device. One such runtime environment is Binary Runtime Environment for Wireless BREW software developed by Qualcomm Inc. of San Diego Calif. Other runtime environments may be utilized that for example operate to control the execution of applications on wireless computing devices.

Processor includes various processing subsystems embodied in hardware firmware software and combinations thereof that enable the functionality of communication device and the operability of the communication device on a wireless network. For example processing subsystems allow for initiating and maintaining communications and exchanging data with other networked devices. In aspects in which the communication device is defined as a cellular telephone the communications processor may additionally include one or a combination of processing subsystems such as sound non volatile memory file system transmit receive searcher layer 1 layer 2 layer 3 main control remote procedure handset power management digital signal processor messaging call manager Bluetooth system Bluetooth LPOS position engine user interface sleep data services security authentication USIM SIM voice services graphics USB multimedia such as MPEG GPRS etc all of which are not individually depicted in for the sake of clarity . For the disclosed aspects processing subsystems of processor may include any subsystem components that interact with the location determination module .

Computer platform additionally includes communications module embodied in hardware firmware software and combinations thereof that enables communications among the various components of the wireless communication device as well as between the wireless device and wireless network . In described aspects the communication module enables the communication of all correspondence between wireless communication device the location satellites shown in and the PDE shown in . Thus communication module may include the requisite hardware firmware software and or combinations thereof for establishing a wireless network communication connection and for receiving satellite signals. In some aspects the communication module may be operable to receive location determination requests communicated from wireless network devices and or network entities and to internally communicate the location determination requests to the location determination module .

The memory of computer platform may include one or more applications that include location determination requests . Applications may include a mapping application that allows a user to track their location in relation to a preferred destination a performance diagnostic application that associates a location with a performance event such as a call drop a call failure call success an Out Of Service OOS event or the like and any other application that may require location information. It should be noted that for certain applications for example a performance diagnostic application location determination may occur in the background while other applications or features on the device are executing. For example voice calls or data sessions e.g. Internet sessions Short Message Service SMS communication may transpire while location determination attempts are being made.

Memory of computer platform includes location determination module that is operable to attempt location determination for the wireless device based on received location determination requests . The location determination module includes at least one predetermined mode routine that is operable identify at least one location determination mode on a per location request basis. The location determination modes may include satellite based location determination modes network based location determination modes and hybrid location determination modes or the like. Hybrid location determination modes are defined as modes which provide both satellite based location determination and network based location determination. The modes may include but are not limited to MS Based mode MS Assisted mode Standalone mode AFLT mode EFLT mode EOTD mode and any other known or future known location determination mode.

MS Based mode location determination is characterized in that calculation of the device location occurs at the wireless device and while PDE information such as ephemeris data or almanac data is required to determine the location each location determination attempt may not require communication with the PDE if the PDE information is current enough to determine location. If the wireless device requires updating of the PDE information the wireless device communicates through the wireless network with the PDE to obtain current ephemeris data and or almanac data. Once the wireless device has verified or obtained PDE information the wireless device uses the PDE information to set the parameters for receiving the satellite signals and subsequently receives the timing signals broadcasted from the satellites. Once the satellite signals are received the wireless device decodes the signals using the PDE information to aid in setting the decode parameters. The wireless device then uses the decoded timing information and executes a location determination function to determine device location.

MS Assisted mode location determination is characterized in that calculation of the device location occurs at the PDE and as such communication with the PDE is required for each location determination attempt that uses MS Assisted mode. If the wireless device requires updating of the PDE information the wireless device communicates through the wireless network with the PDE to obtain current ephemeris data and or almanac data. Once the wireless device has verified or obtained PDE information the wireless device uses the PDE information to set the parameters for receiving the satellite signals and subsequently receives the timing signals broadcasted from the satellites. Once the satellite signals are received the wireless device decodes the signals using the PDE information to aid in setting the decode parameters. The wireless device uses the decoded timing information to make measurements related to the distance from the satellites and the wireless device communicates the measurement information to the PDE. The PDE uses the measurement information and executes a location determining function to determine the location of the wireless device. Thus for MS Assisted mode a wireless network signal must be active because MS Assisted mode requires that the location calculation occur at the PDE .

In addition MS Assisted mode may be configured to record current network parameters and obtain a network based location determination in instances in which a satellite based measurement is not available or unreliable. As such MS Assisted mode may be characterized as a hybrid mode and is especially suited to having an adjustable QoS parameter . For example by adjusting the QoS to a lower level MS Assisted mode will have minimal or no time to search for satellite signals and therefore in most instances will return a network based location result. However if the QoS is adjusted to a higher level or re stored to an original setting MS Assisted mode may have sufficient time to acquire the necessary satellite signals and therefore may return a more accurate satellite based location fix.

Standalone mode is characterized in that calculation of the device location occurs at the wireless device and no PDE information is required to determine location. However Standalone mode is generally the most processing intensive satellite based mode and thus utilizes the most battery power in a wireless device application. In the Standalone mode of operation location determination is performed using only satellite data no network assistance data is required. In Standalone mode the wireless device receives timing signals broadcasted from satellites. The wireless device uses the timing signals and executes a location determining function to determine a device location.

AFLT mode is characterized by the wireless device taking measurements of signals from nearby base stations and reports the time and or distance readings back to the communication network which are then used to triangulate an approximate location of the wireless device. In general at least three surrounding base stations are required to get an optimal AFLT position fix. Like other network based location determination modes while AFLT is generally considerably less accurate than satellite based location determination fixes and while AFLT fixes may not include altitude and velocity information AFLT provides for an efficient or a more likely successful location determination in instances in which satellite based fixes are not available or otherwise undeterminable.

In some aspects mode routine may be configured to sequence through multiple trials trying to successfully determine a location . In addition mode routine may be configured to provide for multiple attempts within a given trial before the routine abandons the trial and moves to the next trial in the sequence. which will be described in length infra. Provides for a mode selection method based on sequencing through trials and attempting multiple location determination attempts within a given trial. Sequencing through multiple trials and allowing for multiple attempts within a given trial allows for the mode routine to prioritize modes based on the effectiveness efficiency past performance and battery power usage of the various sequenced modes. For example in some routines MS Based mode may be the first mode in the sequence because it affords relatively high probability of success only requires wireless communication with the PDE if the PDE information requires updating and limits the use of battery power. Conversely in some routines Standalone mode may be the last mode in the sequence and may be limited to one attempt because it requires a high amount of battery power.

In other aspects mode routine may be configured to determine one or more existing conditions that affect location determination and select a mode and or in some instances determine whether QoS should be adjusted for that mode and if so the level of QoS adjustment based on the determination of the one or more existing conditions. Examples of existing conditions include but are not limited to current wireless signal state such as Code Division Multiple Access CDMA signal state or Global System for Mobile GSM communications signal state Universal Mobile Telecommunications System UMTS signal state Wireless Fidelity Wi Fi signal state Worldwide Interoperability for Microwave Access WiMAX signal state current state of information communicated from the PDE such as ephemeris data almanac data and the like current communications state such as voice call state data session state or the like current battery power state current environmental condition s state such as visibility or received signal strength of the satellites and any other existing conditions which may affect location determination. Thus mode routine may communicate with wireless signal monitor to determine the current state of the wireless signal voice call module to determine if a voice call is currently active and data call module to determine if a data session is currently active. Additionally mode routine may communicate with PDE information module to determine the currency of PDE information such as ephemeris data and almanac data battery monitor to determine the current battery power level and other environmental condition modules to determine other environmental conditions that affect location determination. It should be noted that while the wireless signal monitor the voice call module data call module and battery monitor are described in the wireless device of as modules and monitors residing in memory in other aspects any or all of these modules and monitors may exist as processing subsystems of processor .

In addition to choosing a mode based on the existing conditions existing conditions may be used in mode routine to suspend the determination of the location determination routine or to delay the determination of the location. For example certain conditions such as a voice call or data call occurring while a location attempt is being made may adversely affect the performance of the voice call or data call. Rather than diminishing the user s experience by adversely affecting the voice call or data call the mode routine may be configured to delay the routine for a predetermined period of time or until the voice call or data call is ended or the mode routine may be configured to suspend the routine.

In instances in which mode routine is configured to determine more than one existing condition and select a mode based on the more than one existing conditions the selection of the mode may be based on prioritizing the plurality of conditions to select a mode weighting the plurality of conditions to select a mode or implementing any other logical decision making process to select a mode.

In some aspects the mode routine may be configured to determine one or more existing conditions and further determine whether an available mode may be attempted based on the existing conditions. For example in one aspect a wireless device may be limited to one location determination mode. In this aspect one or more existing conditions may be determined and subsequently a decision is made as to whether to proceed with an attempt of the location determination mode based on the existing conditions. For example if the wireless device is limited to MS Assisted mode location determination and one of the existing conditions is the state of a wireless signal determination that a wireless signal is not currently available will result in no attempt being made to use MS assisted mode to determine location.

In some aspects the mode routine may be configured to determine one or more existing conditions and based on the existing conditions determine which mode is the best mode for location determine or the best sequence of modes for location determination. It should be noted that the best mode might be defined in terms of the mode that may yield the highest likelihood of a successful location determination or the mode that uses the least amount of device resources or the mode that properly balances the likelihood of success and limits the use of device resources.

As illustrated in the methods discussed in relation to infra in some aspects the mode routine may provide for sequencing through multiple trials allowing for multiple attempts within a given trial and determining within one or sequenced trials one or more existing conditions that affect location determination.

In additional aspects as discussed in relation to mode routine may be configured to sequence through multiple trials that implement one or more location determination modes to attempt to successfully determine a location . In such aspects the mode routine may additionally include one or more location determination modes having an adjustable QoS parameter that may be adjusted based on a preconfiguration of the routine or may be adjusted based on existing and or historical conditions. In one specific aspect location determination mode having an adjustable QoS is implemented after the first unsuccessful attempt within the primary trial of the mode routine such that the QoS of the mode is adjusted lower

In other aspects mode routine may be configured to determine historical existing conditions that affect location determination and select a mode and or in some instances determine whether QoS should be adjusted for that mode and if so the level of QoS adjustment necessary. As such memory may include a historical conditions database that stores historical data related to network conditions wireless device locations environmental conditions and the like. As such historical conditions database may be in communication with one or more of the wireless signal monitor voice call module data call module battery monitor other environmental condition modules or the like to monitor and record historical conditions. The QoS adjuster may continually monitor the historical conditions database to adaptively adjust QoS parameters based on the overall historical condition data and or patterns or trends in the historical condition data. In addition the historical conditions database may be accessed on a per location request basis to determine the current historical status prior to initiating the routine or prior to initiating one or more modes within the routine .

Additionally wireless communication device has input mechanism for generating inputs into communication device and output mechanism for generating information for consumption by the user of the communication device. For example input mechanism may include a mechanism such as a key or keyboard a mouse a touch screen display a microphone etc. In certain aspects the input mechanisms provides for user input to interface with an application such application to initiate a location determination request. Further for example output mechanism may include a display an audio speaker a haptic feedback mechanism etc. In the illustrated aspects the output mechanism may include a display operable to display an application interface for requesting location determination or a map that provides a determined device location.

Referring to a flow diagram is presented of a method for determining the location of a wireless communication device. At Event a request for location determination is received. The request may be an internal request received from an application that requires location determination such as a mapping application a performance diagnostic application or the like or the request may be an external requested received wirelessly from a network device or entity.

At Event at least one location determination mode is identified based on a predetermined routine. It should be noted that in some instances the wireless device may only have one available location determination mode in which case the only available mode will be identified mode as determined by the mode routine. As previously noted in some aspects identifying a location determination mode may include sequencing through multiple trials and allowing for multiple location determination attempts within a given trial and or determining one or more existing conditions that affect location determination and selecting a mode based on the determined existing conditions. In addition one or more of the identified modes may have an adjustable QoS parameter. The adjustable QoS parameter may be preconfigured by the predetermined routine or the QoS parameter may be adjusted based on existing conditions that temporal with the execution of the mode.

In one specific aspect in which the wireless device has only one available location determination mode the mode routine may determine existing conditions and based on the existing conditions a determination may be made as to whether to attempt the available mode. Additionally in aspects in which the predetermined routine includes only one mode the one mode may have an adjustable QoS parameter that is operable to be adjusted based on the existing conditions that exist temporal with the execution of the mode.

In other aspects the mode routine may determine existing conditions and based on the existing conditions determine the best mode from among a plurality of available location determination modes or determine a best sequence for the modes.

At Event the identified mode attempts to obtain the location of the wireless communication device. In some aspects the selected mode may be attempted numerous times until a successful location determination results. In other aspects such as when mode sequencing is implemented multiple modes may be selected and executed until a successful location determination results. It should also be noted that in some instances execution of the selected mode or selected modes might result in a failure to determine a location. In certain instances in which specific conditions exist failure to determine a location may be an acceptable result of the location determination process to insure the integrity of other device functions such as voice call or data call quality battery power consumption and the like. In those aspects in which the mode routine includes one or more location determination modes having an adjustable QoS parameter successful location determination at an adjusted QoS level may not prohibit further attempts to obtain a location fix based on another mode or an attempt of the location determination mode having the adjustable QoS parameter at a higher or lower QoS.

At Event the result of the attempt to obtain location of the wireless device is stored in memory. Storing the result of the attempt to obtain location in memory may involve returning the location to the internal application that requested location determination and storing the location within the application or storing the result of the attempt to obtain location in memory may involve communicating the location to the network device entity that requested location determination and subsequently remotely storing the location in a network database.

Referring now to a flow diagram is depicted of a method for location determination in which the mode routine selects the mode based on sequencing through multiple trials and allowing for multiple attempts within a given trial in accordance with a specific aspect. At Event a request for location determination is received. As previously noted the request may be an internal request received from an application or the request may be an external requested received from a network device entity. At Event an attempt is made to determine location using a first location determination mode. In the illustrated aspect of the first location determination mode is the first mode in a sequence of modes and defines the first trial. The sequence order may be determined based on various factors that affect the efficiency and effectiveness of the location determination process as well as the effectiveness of other applications and features being executed on the wireless device.

At Event a determination is made as to whether the attempt was successful in determining the location of the device. If the attempt to determine location was successful then at Event the location is stored either in an internal database or in an external database such as a network database. If the attempt to determine location was not successful then at Event a determination is made as whether additional attempts are available for the first trial. In this regard the mode routine may be configured to provide for more than one attempt for a given trial. For example the mode routine may be configured to provide for three attempts using the first location determination mode before sequencing to the second location determination mode. If additional attempts are available for the first trial the routine will return to Event and an additional attempt is made using the first location determination mode.

If no further attempts are available for the first trial then at Event the routine will sequence to the second location determination mode and an attempt is made to determine location using the second location determination mode. At Event a determination is made as to whether the attempt was successful in determining the location of the device. If the attempt to determine location was successful then at Event the location is stored either in an internal database or in an external database such as a network database. If the attempt to determine location was not successful then at Event a determination is made as whether additional attempts are available for the second trial. If additional attempts are available for the second trial the routine will return to Event and an additional attempt is made using the second location determination mode.

The sequencing through trials to determine a location continues until the last trial in the sequence is encountered. In the illustrated aspect of the last trial in the sequence the nth trial as defined by the nth location determination mode. The nth trial may be the second trial in the sequence or any subsequent trial in the sequence. If no further attempts are available for the second trial then at Event the routine will sequence to the nth trial and an attempt is made to determine location using the nth location determination mode. At Event a determination is made as to whether the attempt was successful in determining the location of the device. If the attempt to determine location was successful then at Event the location is stored either in an internal database or in an external database such as network database. If the attempt to determine location was not successful then at Event a determination is made as whether additional attempts are available for the nth trial. If further attempts are available for the nth trial the routine returns to Event and an additional attempt is made using the nth mode. If no further attempts are available then at Event the location determination process ends in this instance without having successfully determined a location.

In alternate aspects the mode routine may include a single location determination mode. In which case steps of would not be required. By way of example single location determination mode may be implemented if the device only accommodates a single mode of location determination.

Referring to a flow diagram is depicted of a specific aspect of a method of location determination in which the location determination routine implements location determination mode in which the QoS is adjusted in an attempt to obtain a location fix. Once the QoS adjustable location determination mode is attempted the routine follows by sequencing through multiple trials that are each associated with a separate location determination mode and allowing for multiple attempts within a given trial. The flow presented in is identical to the flow presented in with the exception of Events and . Therefore the discussion of the flow of will be limited to a discussion of the additional Events and .

Once the wireless device has received a request for location determination Event at Event the mode routine will attempt a location determination mode in which the QoS parameter is or has been adjusted. The QoS may be adjusted based on a preconfigured value of adjustment in the location determination routine or the QoS may be dynamically adjusted based on existing conditions or historical conditions or the QoS may have been adjusted adaptively based on the monitoring of historical conditions. In one specific aspect the location determination mode in which the QoS parameter is adjusted is further defined as MS Assisted mode. In such an aspect the QoS parameter associated with MS Assisted mode may be adjusted down or lowered such that a minimal search time is provided for locating the satellite signals. In this scenario the MS Assisted mode is likely to return a network based location determination. In the aspect illustrated by lowering the QoS level of MS Assisted mode for location attempt at Event generally provides for a fast means of returning a network based location determination. While the network based location determination may not be as accurate as a satellite based location determination that is subsequently returned by the routine the network based location determination may be relied on and used by the requesting application if the subsequent satellite based modes fail to return a location determination. At Event the wireless device will store the location fix associated with the QoS adjustable location determination mode if the attempt was successful. It should be noted that while not depicted in it may be possible to implement further QoS adjustable location determination modes at any point throughout the sequence of the multiple location determination trials if for example the initial attempt of the QoS adjustable location determination mode fails.

Additionally as noted in relation to in alternate aspects the mode routine may include a single QoS adjustable location determination mode or a single QoS adjustable location determination mode and a first location determination mode. In the first instance steps of would not be required and in the later instance steps of would not be required.

Referring to a flow diagram is depicted of a specific method aspect for location determination in which the mode routine implements a QoS adjustable location determination mode in an attempt to obtain a network based location fix during the trails related to a first location determination mode. In this regard the QoS adjustable location determination mode may be attempted after at least one other mode has been attempted and failed. Once the QoS adjustable location determination mode is attempted the routine follows by attempting any further trials related to the first location determination mode and sequencing through various other trials that each are associated with a separate location determination mode. It should be noted that in some aspects the QoS adjustable location determination mode may be attempted after initiating the first location determination mode but prior to receiving the result i.e. in sequence such as during a time period when the wireless device is waiting for the first location determination mode fix. The flow presented in is identical to the flow presented in with the exception of Events and . Therefore the discussion of the flow of will be limited to a discussion of the additional Events and .

If the attempt of the first location determination mode is unsuccessful Event then at Event a determination is made as whether the attempt was the first attempt for the first location determination mode. If is determined that it was the first attempt of the first satellite based location determination mode then at Event the mode routine attempts a QoS adjustable location determination mode such such as MS Assisted Mode or the like in which the QoS is lowered such as to a minimum level to insure that searching time only provides for recording of network parameters and a network based location determination fix is returned. If the QoS adjustable location determination mode attempt is successful the related location fix is stored in device memory. It should be noted that while not depicted in it may be possible to implement further QoS adjustable location determination modes after or during any other trials in the sequence of trials related to the first second or nth satellite based location determination if the initial attempt for a QoS adjusted location determination fails. In the illustrated aspect the QoS adjustable location determination mode attempt is attempted the closest in time to the initial first location determination mode attempt to insure the timeliness of the network parameters used to determine the QoS adjusted location determination fix.

Similar to the flow of also illustrates that in some aspects after the QoS adjustable location determination mode attempt Event the flow may continue regardless of whether the QoS adjusted location determination is successful or unsuccessful. In this instance the flow continues to Event and a determination is made as to whether further first location determination mode trails are available or if no further trials are available the mode routine attempts a second location determination mode. Thus while a successful location determination while implementing the first second or nth location determination mode will result in the completion of the location determination process a successful QoS adjusted location determination fix based on the QoS level being adjusted lower may not necessarily prohibit the need to conduct additional location determinations to render a more accurate satellite based location determination

Additionally as noted in relation to in alternate aspects the mode routine may include a single QoS adjustable location determination mode and a single first location determination mode. In this instance steps of would not be required

Referring to a flow diagram is depicted of a method for location determination in which the mode routine determines existing conditions that affect location determination and selects the mode based on the determined existing conditions and or adjusts QoS levels for one or more QoS adjustable modes in accordance with a specific aspect. At Event a request for location determination is received. As previously noted the request may be an internal request received from an application or the request may be an external requested received from a network device entity. At Event the wireless device determines one or more existing conditions affecting location determination. Examples of existing conditions include but are not limited to current wireless signal state such as Code Division Multiple Access CDMA signal state or Global System for Mobile GSM communications signal state Universal Mobile Telecommunications System UMTS signal state Wireless Fidelity Wi Fi signal state Worldwide Interoperability for Microwave Access WiMAX signal state current state of information communicated from the PDE such as ephemeris data almanac data and the like current communications state such as voice call state data session state or the like current battery power state current environmental condition s state such as visibility or received signal strength of the satellites and any other existing conditions which may affect location determination.

At Event a location determination mode is identified and or a QoS adjustment is determined based on the one or more existing conditions. For example if the existing condition is defined as the current state of the wireless signal the routine may choose to apply the MS Based mode if no wireless signal is currently available and choose the MS Assisted mode if a wireless signal is available. If the MS Assisted mode is selected based on existing conditions the routine may further determine to adjust the QoS based on existing conditions such as the current ability to receive satellite signals. In instances in which more than one existing condition is determined and used in the selection of a mode each of the conditions may be considered in a prioritized series of selection of the mode determinations each of the plurality of conditions may be weighted based on significance of the condition and an appropriate weighted algorithm applied to select a mode or any other logical decision making routine may be implemented based on the plurality of conditions used to determine a mode. In addition to selecting a mode based on existing conditions and determining QoS adjustment based on existing conditions the method may also provide for suspending or delaying the implementation of a mode based on an existing condition. For example if the condition is defined as the current state of a voice or data call the routine may be configured to delay or otherwise suspend the execution of the location determination mode and or the routine.

In one specific aspect in which the wireless device has only one available location determination mode the mode routine may determine existing conditions and based on the existing conditions a determination may be made as to whether to attempt the available mode. In addition if the determination is made to attempt the mode a further determination of QoS adjustment for the mode may be made based on the existing conditions. In other aspects the mode routine may determine existing conditions and based on the existing conditions determine the best mode from among a plurality of available location determination modes or determine a best sequence for the modes.

Additionally in one specific aspect the mode routine may select one or more location determination modes based on existing conditions and implement one or more QoS adjustable location determination modes. The QoS adjustable location determination modes may have the QoS adjusted based on any suitable adjustment criteria for example preconfiguration of the routine existing conditions and or historical condition data. For example in one specific aspect the mode routine may sequence through multiple trails that implement various location determination modes one or more of the sequence of trials may rely on existing conditions to select the location determination mode for the trail. In addition the specific aspect may include attempting a QoS adjustable location determination mode either prior to the trials or during a pause in one of the trial attempts such as during pause after the initial attempt in the first or primary trial.

At Event the identified mode attempts to obtain the location of the wireless communication device and in some aspects the attempt is based on an adjusted QoS value dictated by the existing conditions. As previously noted in some instances execution of the selected mode or selected modes may result in a failure to determine a location. As previously noted in those aspects in which the mode routine includes both QoS adjustable location determination mode and specifically a mode in which the QoS is lowered successful QoS adjusted location determination will generally not prohibit further attempts to obtain a location fix based on a another location determination mode.

At Event the result of the attempt to determine location of the wireless device is stored in memory. As previously noted storing the result of the attempt to determine location in memory may involve returning the location to the internal application that requested the location storing the location internally or storing the result of the attempt to determine location in memory may involve communicating the location to the network device entity that requested location determination and subsequently remotely storing the location in a network database. In those aspects in which both a QoS adjusted location fix and another location fix result the more accurate location fix may be the permanently stored and or the reported fix or the more accurate location fix may be stored or reported as the prioritized location fix.

It should be noted that the nth trial example of is by way of example only. The mode routine could be configured with a single first trial implementing one or more attempts and having one or more modes selected and or optionally adjust the QoS based on existing conditions. For example in a single first or primary trial aspect prescribed conditions may need to be met in order to proceed with the trial. In such aspects Events or Events and of may be omitted.

At Event an attempt is made to determine location using a first location determination mode. At Event a determination is made as to whether the attempt was successful in determining the location of the device. If the attempt to determine location was successful then at Event the location is stored either in an internal database or in an external database such as network database. If the attempt to determine location was not successful then at Event a determination is made as whether additional attempts are available for the first trial. In this regard the mode routine may be configured to provide for more than one attempt for a specified trial. If additional attempts are available for the first trial the routine will return to Event and an additional attempt is made using the first location determination mode.

If no further attempts are available for the first trial then at Event the routine will sequence to the second trial and a determination is made as to whether existing conditions that affect location determination are met. For example the defined existing condition may be the current state of the wireless signal or any other condition that affects location determination. If the conditions are not met at Event an attempt is made to determine location using the first location determination mode and optionally the QoS for the attempt is adjusted based on the existing conditions. It should be noted that the specific use of the first mode is not required any other available mode may be used if the existing conditions are not met. If the existing conditions are met then at Event an attempt is made to determine location using a second location determination mode and optionally the QoS for the attempt is adjusted based on the existing conditions.

At Event a determination is made as to whether the attempt was successful in determining the location of the device. If the attempt to determine location was successful then at Event the location is stored either in an internal database or in an external database such as a network database. If the attempt to determine location was not successful then at Event a determination is made as to whether additional attempts are available for the second trial. If additional attempts are available for the second trial the routine will return to Event and determine if existing conditions are met prior to choosing the mode that will be used to attempt to determine location and optionally determine if QoS adjustment is warranted and if so the level of adjustment.

If no further trials are available for the second trial then at Event the routine will sequence to the nth trial and an attempt is made to determine location using the a nth mode. At Event a determination is made as to whether the attempt was successful in determining the location of the device. If the attempt to determine location was successful then at Event the location is stored either in an internal database or in an external database such as network database. If the attempt to determine location was not successful then at Event the location determination process ends in this instance without having successfully determined a location. As previously noted the nth trial in the illustrated aspect of is configured to provide for one attempt of the nth location determination mode. Additionally while the illustrated nth trail does not select a mode based on existing conditions any nth trial can be configured to select a mode based on existing conditions and optionally adjust QoS based on the existing conditions.

Referring now to a flow diagram is depicted of a specific method aspect for location determination in which the mode routine implements a preliminary QoS adjustable location determination mode in an attempt to obtain a location fix. Once the QoS adjustable location determination mode is attempted the routine sequences through multiple trials may attempt location determination within a sequenced trial multiple times determines existing conditions which affect location determination and optionally QoS adjustment within a specified trial and selects the location determination mode and optionally QoS adjustment based on the determined existing conditions. The flow presented in is identical to the flow presented in with the exception of preliminary trial and Events and . Therefore the discussion of the flow of will be limited to a discussion of the preliminary trail and the additional Events and .

In addition to the first trial the second trial and the nth trial the illustrated method of includes a preliminary trial . The preliminary trial provides for a QoS adjustable location determination mode to be attempted prior to the first second and nth trials. At Event the mode routine will attempt a preliminary QoS adjustable location determination mode such such as a MS Assisted Mode configured to make a network based location determination in addition to a satellite based location determination. As previously noted the adjustment to the QoS may be based on preconfiguration of the location determination routine existing conditions and or historical conditions. At Event the wireless device will store the QoS adjusted location fix if the attempt was successful. It should be noted that while not depicted in it may be possible to implement further QoS adjustable location determination modes prior to the beginning of the first trial or at any point throughout the sequence of the multiple satellite based location determination trials and or if the initial attempt for a QoS adjusted location determination fails.

Additionally as noted in relation to in alternate aspects the mode routine may include a single first location determination mode or first trial. In which case Events or Events and of would not be required.

Referring to a flow diagram is depicted of a specific method aspect for location determination in which the mode routine implements a QoS adjustable location determination mode in an attempt to obtain a location fix after the first attempt of the first trail related to a first location determination mode. In this regard the QoS adjustable location determination mode is attempted after at least one other mode has been attempted and failed. Once the QoS adjustable location determination mode is attempted the routine continues to sequence through multiple trials may attempt location determination within a sequenced trial multiple times determines existing conditions which affect location determination within a specified trial and optionally may affect QoS adjustment and selects the location determination mode and optionally QoS adjustment based on the determined existing conditions. The flow presented in is identical to the flow presented in with the exception of Events and . Therefore the discussion of the flow of will be limited to a discussion of the additional Events and .

If the attempt of the first location determination mode is unsuccessful Event then at Event a determination is made as whether the attempt was the first attempt for the first location determination mode. If is determined that it was the first attempt of the first location determination mode then at Event the mode routine attempts a QoS adjustable location determination mode such such as MS Assisted mode configured to record the current network parameters and obtain a network based location fix in addition to a satellite based fix. If the QoS adjusted location determination is successful the location fix is stored in device memory. It should be noted that while not depicted in it may be possible to implement further QoS adjustable location determination modes after any other trials in the sequence of trials related to the first second or nth location determination if the initial attempt for a QoS adjusted location determination fails. In the illustrated aspect the QoS adjusted location determination attempt is attempted the closest in time to the initial first location determination mode attempt to insure the timeliness of the measurement data used to determine the QoS adjusted location fix.

Similar to the flow of also illustrates that after the QoS adjustable location determination mode attempt Event the flow will continue regardless of whether the QoS adjusted location determination is successful or unsuccessful. In this instance the flow continues to Event and a determination is made as to whether further first location determination mode trails are available or if no further trials are available the mode routine continues to the second trial and at Event determines if existing device conditions are met.

Additionally as noted in relation to in alternate aspects the mode routine may include a single first location determination mode. In which case Events or Events and of would not be required.

Referring now to and a flow diagram illustrating a specific method for location determination in which the mode routine conducts a preliminary single attempt QoS adjusted location determination trial and then sequences through three location determination trials attempting location determination within a sequenced trial one or more times determines existing conditions within the second trial and selects the satellite mode and optionally QoS adjustment based on the determined existing conditions in accordance with an aspect. Thus the illustrated aspect provides for a preliminary QoS adjustable location determination mode followed by three trials for subsequent mode selection. The preliminary QoS adjustable location determination mode is typically conducted once and may be the MS Assisted mode configured to provide both a network based fix and a satellite based fix. In such an aspect the QoS of the MS Assisted mode is generally lowered such as to a minimum value to limit the search time so that only network parameters can be recorded during the search interval and thus only a network based location determination is obtained. The first trial selects MS Based mode and may attempt more than one location determination attempts before moving to the second trial. The second satellite based trial selects either the MS Based or MS Assisted mode based on the current wireless service state and may attempt the more than one location determination attempt before moving to the third trial. The third satellite based trial selects the Standalone mode and attempts the mode a predetermined number of times if all attempts of the Standalone mode are not successful the routine is ended and no satellite based location determination results.

Referring first to at Event initial preliminary checks are conducted prior to initiating the location determination routine. Preliminary checks may include necessary checks to insure requisite device conditions or network setting exist to perform location determination such as proper device power state and the like. After completion of the initial preliminary checks a preliminary QoS adjustable location determination mode is conducted such as MS Assisted mode in which the QoS has been lowered such as to a minimum level. Lowering the QoS to a minimum level will generally insure that only a network based location determination is obtained in light of the minimal search time afforded by the lowering of the QoS. At Event the preliminary QoS adjustable location determination mode conducts a QoS adjusted location determination attempt implementing a predetermined QoS adjustable location determination mode such as MS Assisted mode having network based and satellite based location determination capability or the like. If the QoS adjusted location attempt is successful at Event the location fix is stored in local device memory and or otherwise communicated to the location requesting entity or application. It should be noted that regardless of whether the preliminary QoS adjustable location determination mode is successful the location determination routine proceeds to the first trial and attempt to determine satellite based location fix. This is because in the aspect depicted in the QoS of the QoS adjustable location determination mode is adjusted lower and in many aspects to a minimum. The lowering of the QoS corresponds to less search time and in many aspects this results in only enough time to record network parameters and obtain a network based fix i.e. insufficient time is provided to search for satellite signals . The network based fix is generally less accurate than satellite based location determinations and thus the location determination routine will proceed to further trials in an attempt to determine a satellite based fix.

The first trial begins at Event at which a determination is made as to whether this is a new request for a location determination. If it is determined that this is a new request for a location then at Event a determination is made as to whether MS Based mode location determination is supported by the wireless device. If MS Based mode location determination is not supported the routine will skip the first trial and immediately move to the second trial illustrated in by Block A. If MS Based mode location mode location determination is supported then at Event an attempt is made to determine location using the MS Based mode of location determination. At Event a determination is made as to whether the attempt was successful. If the attempt was successful in determining a location then at Event the location is stored in local or remote memory.

If the attempt was not successful in determining a location the routine will return to Event to determine whether the request for location is a new request. If the request is not a new request then at Event a determination is made as to whether the previous attempt was the last attempt as configured by the trial. The trial may be configured to allow for one or more attempts to determine location under the trial. If the determination is made that the previous attempt was not the last attempt as configured by the trial then at Event an additional attempt is made to determine location using the MS Based mode of location determination and at Event a subsequent determination is made to determine if the attempt was successful. If the attempt was successful at Event the location is stored or if the attempt was not successful the routine returns to Event where a determination is made as to whether the previous attempt was the last attempt as configured by the trial. Once the last attempt in the trial is unsuccessfully attempted the first trial is ended and the routine moves to the second trial illustrated in by Block A.

Referring to the second trial is illustrated. The second trial is initiated at Event at which a determination is made as to whether an attempt is available for the second trial. Similar to the first trial the second trial may be configured to allow for multiple attempts to obtain a location using the second trial. If an attempt is available then at Event a determination of an existing condition occurs. Specifically at Event a determination is made as to whether a wireless signal is currently available. If no wireless signal is available then at Event a determination is made as to whether MS Based mode location determination is supported by the wireless device. If MS Based mode location determination is supported then at Event an attempt is made to determine location using the MS Based mode of location determination. If MS Based mode location determination is not supported then at Event a determination is made as whether the QoS should be adjusted for the pending MS Assisted mode. The QoS may be adjusted based on the existing conditions the historical conditions and or the preconfiguration of the location determination routine. If a determination is made that adjustment of the QoS is warranted at Event the QoS is adjusted and at Event an attempt is made to determine location using the MS Assisted mode of location determination. If a determination is made that no adjustment of the QoS is warranted at Event an attempt is made to determine location using the MS Assisted mode of location determination.

As previously discussed MS Assisted mode requires a wireless signal in order to communicate with the PDE because in MS Assisted mode the location calculation is accomplished at the PDE. Thus in order for this attempt to succeed the wireless signal must have become available since the determination was made at Event . Once the attempt for location determination has occurred at either Event or at Event a determination is made as to whether the attempt was successful. If the attempt was unsuccessful in determining a location the routine returns to Event to determine if an additional attempt is available for the second trial. If the Attempt was successful then at Event a velocity check is made to determine if the location determination includes a velocity parameter. If the location determination includes a velocity parameter then at Event the location is stored in internal or external memory. If the velocity check determines that the location determination does not include a velocity parameter then the routine returns to Event to determine if an additional attempt is available for the second trial.

If at Event a determination is made that a wireless signal is available then at Event a determination is made as whether a Radio Frequency RF Transmit Receive Tx Rx chain is currently available. If a RF Tx Rx chain is available then at Event a determination is made as whether the QoS should be adjusted for the pending MS Assisted mode. If a determination is made that adjustment of the QoS is warranted at Event the QoS is adjusted and at Event an attempt is made to determine location using the MS Assisted mode of location determination. If a determination is made that no adjustment of the QoS is warranted at Event an attempt is made to determine location using MS Assisted mode location determination. If an RF Tx Rx chain is not available then at Event a determination is made as to whether a voice call is currently ongoing. If a voice call is ongoing then at Event location determination is suspended. Typically attempting location determination during a voice call will detrimentally affect the quality of the voice call and therefore the location determination process is suspended so as to not adversely affect the user s voice call experience.

If a determination is made that no voice call is currently ongoing the at Event a determination is made as to whether a data call session is currently ongoing. If no data session is ongoing then at Event a determination is made as whether the QoS should be adjusted for the pending MS Assisted mode. The QoS may be adjusted based on the existing conditions the historical conditions and or the preconfiguration of the location determination routine. If a determination is made that adjustment of the QoS is warranted at Event the QoS is adjusted and at Event an attempt is made to determine location using the MS Assisted mode of location determination. If a determination is made that no adjustment of the QoS is warranted at Event an attempt is made to determine location using MS Assisted mode location determination.

If a data call session is ongoing then at Event the routine idles for a predetermined time period in attempt to try and wait to attempt the location determination after the data session has ended. After the predetermined idle period and determination that the data call session is no longer ongoing at Event a determination is made as whether the QoS should be adjusted for the pending MS Assisted mode. The QoS may be adjusted based on the existing conditions the historical conditions and or the preconfiguration of the location determination routine. If a determination is made that adjustment of the QoS is warranted at Event the QoS is adjusted and at Event an attempt is made to determine location using the MS Assisted mode of location determination. If a determination is made that no adjustment of the QoS is warranted at Event an attempt is made to determine location using MS Assisted mode location determination. Once the MS Assisted mode is attempted at Event a determination is made as to whether the attempt was successful. If the attempt was successful then at Event the location is stored in internal or external memory. If the attempt was unsuccessful in determining a location the routine returns to Event to determine if an additional attempt is available for the second trial. If no further attempts are available for the second trial the second trial is ended and the routine moves to the third trial illustrated in as Block B.

Referring to the third trial is illustrated. At Event a determination is made as to whether Standalone mode is supported by the wireless device. If Standalone mode is not supported at Event the routine is ended without having successfully determined a location. If Standalone mode is supported then at Event a determination is made as to whether a standalone trial attempt is available. If no standalone trail attempt is available at Event the routine is ended without having successfully determined a location. If a Standalone mode attempt is available then at Event an attempt is made to determine location using Standalone mode location determination. Once the Standalone mode is attempted at Event a determination is made as to whether the attempt was successful. If the attempt is unsuccessful the routine returns to Event and a determination is made as to whether an additional Standalone mode attempt is available. If the attempt was successful then at Event the location is stored in internal or external memory.

Referring to a flow diagram is presented of a specific alternative aspect in which that mode routine attempts a QoS adjustable location determination mode after the first attempt of the first trial. After completing all configured attempts in the first trail the method proceeds through the sequence of second and third mode trials which are identical to the second and third satellite based mode trials discussed in relation to . For the purpose of brevity only will be discussed in relation to the aforementioned specific alternative method however it should be assumed that the discussion of is equally applicable to the second and third mode trails of the aforementioned specific alternative method.

At Event location determination is initiated by conducting requisite preliminary checks. Preliminary checks may include necessary checks to insure requisite device conditions or network setting exist to perform location determination such as proper device power state and the like. After the completion of preliminary checks the first trial begins at Event at which a determination is made as to whether this is a new request for a location determination. If it is determined that this is a new request for a location then at Event a determination is made as to whether MS Based mode location determination is supported by the wireless device. If MS Based mode location determination is not supported the routine will skip the first trial and immediately move to the second trial illustrated in by Block A. If MS Based mode location mode location determination is supported then at Event an attempt is made to determine location using the MS Based mode of location determination. At Event a determination is made as to whether the attempt was successful in determining a location. If the attempt was successful in determining a location then at Event the location is stored in local or remote memory.

If the attempt was not successful in determining a location then at Event a determination is made as to whether the previous attempt was the first attempt of the first trial. If it is determined that the previous attempt was the first attempt of the first trial then at Event a QoS adjustable location determination mode is attempted. For example the QoS adjustable location determination mode may comprise MS Assisted mode having both network based and satellite based location determination capability and the QoS may be adjusted to a lower or minimum value. As previously discussed a location fix in which the QoS has been adjusted lower or to minimum level provides for a fallback location fix if all of the remaining mode attempts during all of trials fail or otherwise due not result in a valid location fix. Once the QoS adjusted mode is attempted at Event a determination is made as to whether the attempt was successful. If the QoS adjusted mode attempt was successful at Event the result of the QoS adjusted mode location determination is stored either locally or a related network database. If the QoS adjusted mode attempt was unsuccessful or after the result of the QoS adjusted mode result is stored the flow returns to Event to determine whether the request for a location is new request and if the request is not a new request then at Event a determination is made as to whether the previous attempt was the last attempt as configured by the trial. It should be noted that regardless of whether the QoS adjusted mode attempt was successful or not the remaining flow will generally continue in an attempt to determine a location fix.

If at Event a determination is made that the previous attempt was not the first attempt of the first trial then the flow returns to Event to determine whether the request for a location is new request and if the request is not a new request then at Event a determination is made as to whether the previous attempt was the last attempt as configured by the trial. It should be noted that as configured the QoS adjusted mode attempt is a single attempt at determining a QoS adjusted fix conducted after the first attempt of the first trial. Generally only one attempt is needed because of the high success rate of the QoS adjusted mode returning at least a network based location determination. However in other aspects the routine may be configured to attempt more than one QoS adjusted mode location fix. The attempt is conducted after the first attempt of the first trial to limit the QoS adjusted mode attempts and to insure that the network parameters used to calculate the QoS adjusted mode fix are closest in time to the initiation of the overall location determination process.

Similar to the flow described in relation to the first trial of may be configured to allow for one or more attempts to determine location under the trial. If the determination is made that the previous attempt was not the last attempt as configured by the trial then at Event an additional attempt is made to determine location using the MS Based mode of location determination and at Event a subsequent determination is made to determine if the attempt was successful. If the attempt was successful at Event the location is stored or if the attempt was not successful the routine returns to Event where a determination is made as to whether the previous attempt was the last attempt as configured by the trial. Once the last attempt in the trial is unsuccessfully attempted the first trial is ended and the routine moves to the second trial illustrated in by Block A.

If the two primary trail attempts are unsuccessful the routine will sequence to the secondary trials and secondary trial attempts are attempted. It is noted that a pause period may occur between the last primary trial attempt and the first secondary trial attempt . In one aspect the secondary trial attempts may include determining existing conditions affecting location determination and selecting a satellite based location determination mode and optionally QoS adjustment based on the conditions. For example the secondary trial attempts may chose between MS Based mode and MS Assisted mode based on existing conditions and determine a QoS adjustment if the MS Assisted mode is selected In general the secondary trial may include any number of attempts for example three to eight attempts may be made before proceeding to the standalone trial. In the illustrated example the secondary trial attempts and the pause periods are approximately one minute in length.

If all of the preconfigured secondary trial attempts are unsuccessful the routine will sequence to the standalone trial and a standalone trail attempt is attempted. The standalone trial is generally limited to a single standalone trail attempt of the Standalone mode. It is noted that a pause period may occur between the last secondary trial attempt and the standalone trial attempt . In the illustrated example the standalone attempt is approximately two three minutes in length.

It should be noted that while the example of depicts and describes the QoS adjusted mode occurring sequentially after the first satellite based location attempt of the first trial it may also be possible to configure the routine such that the QoS adjusted mode occurs simultaneously at any point in time during any one of the other mode attempts.

The various illustrative logics logical blocks modules and circuits described in connection with the aspects disclosed herein may be implemented or performed with a general purpose processor a digital signal processor DSP an application specific integrated circuit ASIC a field programmable gate array FPGA or other programmable logic device discrete gate or transistor logic discrete hardware components or any combination thereof designed to perform the functions described herein. A general purpose processor may be a microprocessor but in the alternative the processor may be any conventional processor controller microcontroller or state machine. A processor may also be implemented as a combination of computing devices e.g. a combination of a DSP and a microprocessor a plurality of microprocessors one or more microprocessors in conjunction with a DSP core or any other such configuration.

Further the steps and or actions of a method or algorithm described in connection with the aspects disclosed herein may be embodied directly in hardware in a software module executed by a processor or in a combination of the two. A software module may reside in RAM memory flash memory ROM memory EPROM memory EEPROM memory registers a hard disk a removable disk a CD ROM or any other form of storage medium known in the art. An exemplary storage medium may be coupled to the processor such that the processor can read information from and write information to the storage medium. In the alternative the storage medium may be integral to the processor. Further in some aspects the processor and the storage medium may reside in an ASIC. Additionally the ASIC may reside in a user terminal. In the alternative the processor and the storage medium may reside as discrete components in a user terminal. Additionally in some aspects the steps and or actions of a method or algorithm may reside as one or any combination or set of codes or instructions on a machine readable medium and or computer readable medium such as may be provided by a computer program product.

While the foregoing disclosure shows illustrative aspects and or embodiments it should be noted that various changes and modifications could be made herein without departing from the scope of the described aspects and or embodiments as defined by the appended claims. Furthermore although elements of the described embodiments may be described or claimed in the singular the plural is contemplated unless limitation to the singular is explicitly stated. Additionally all or a portion of any aspect and or embodiment may be utilized with all or a portion of any other aspect and or embodiment unless stated otherwise.

Thus present aspects provide for methods devices systems and computer program products that improve the ability of the wireless device to determine location. Present aspects provide for identifying a location determination mode based on a predetermined routine for each location determination that is requested. In certain aspects the predetermined routine may be configured to adjust the Quality of Service QoS for one or more of the location determination modes implemented in the routine. Based on the pre configuration of the routine adjustment of the QoS of one or more location determination modes may occur as a matter of course or the routine may be configured to dynamically adjust the QoS based on conditions such as network conditions environmental conditions and the like existing at the point in time in which the location determination mode is executed or adaptively adjust the QoS based on historical conditions that affect location determination.

Many modifications and other aspects will come to mind to one skilled in the art to which this invention pertains having the benefit of the teachings presented in the foregoing descriptions and the associated drawings. Therefore it is to be understood that the aspect is not to be limited to the specific aspects disclosed and that modifications and other aspects are intended to be included within the scope of the appended claims. Although specific terms are employed herein they are used in a generic and descriptive sense only and not for purposes of limitation. Accordingly the described aspects are intended to embrace all such alterations modifications and variations that fall within the spirit and scope of the appended claims. Furthermore to the extent that the term includes is used in either the detailed description or the claims such term is intended to be inclusive in a manner similar to the term comprising as comprising is interpreted when employed as a transitional word in a claim.

