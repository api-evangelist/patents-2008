---

title: System and method for controlling a digital video recorder in response to a telephone state transition
abstract: A system and method for controlling a digital video recorder on a cable network. Signaling associated with the answering or initiation of a digital telephone call by a digital telephone subscriber is used to issue commands to a digital video recorder (DVR). A signal is generated by an MTA when the telephone is enters an “off-hook” state and sent to the DVR to initiate recording of a program being viewed by the called party. When the phone goes “on-hook”, the called party resumes watching the program from exactly where it was interrupted. The MTA may be connected directly to the VTD/DVR and the telephone state is determined by the DVR from information provided by the MTA. Alternatively, a soft switch monitors signaling from the MTA indicative of the state of the called telephone. A telephone state message comprising the telephone state information is then sent over an out-of-band channel/path to a DVR client within the VTD. The DVR client uses the telephone state information to control a DVR.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08204354&OS=08204354&RS=08204354
owner: Time Warner Cable, Inc.
number: 08204354
owner_city: New York
owner_country: US
publication_date: 20081112
---
This application is a continuation of U.S. application Ser. No. 11 001 513 filed Dec. 1 2004 now U.S. Pat. No. 7 486 869 which application is incorporated herein by reference for all purposes and from which priority is claimed.

Embodiments of the present invention relate generally to signaling in a voice over IP VoIP network. More particularly embodiments of the present invention relate to using VoIP signaling to control a digital video recorder DVR in a cable network.

The increasing availability of high speed data services and broadband connections has accelerated the integration of telecommunications services offered to consumers and businesses alike. Hybrid fiber cable HFC systems now offer a wide range of services from digital video to Internet to voice over IP VoIP services. The boundaries between these services continue to erode with video terminating equipment the set top box or STB providing subscribers access to data and voice services.

A digital telephone subscriber receives telephone calls via a data connection that terminates on the subscriber s premises a multimedia terminal adapter MTA . The data stream to the MTA and carries both a control signal and an information signal voice .

While access to telephone communications services is generally considered a necessity receiving unwanted or untimely calls has become a major source of irritation to telephone service subscribers. Caller ID caller ID screening and answering services are available to filter out undesired calls. However even calls that a subscriber may want to answer may come at an inopportune time. Specifically an important call that comes during the viewing of a television program presents the subscriber with several sub optimal choices. The subscriber may attempt to watch the program while talking on the telephone thereby providing distracted attention to both the program and the caller. The subscriber may attempt to manually record the program either before answering the call or while talking thereby risking missing the call or some or the entire program. Or the subscriber may simply elect to miss the program altogether.

Similarly a subscriber may want to make a phone call during a program for any number of reasons. For example the subscriber may want to order an advertised product order food or call a friend to discuss a program.

What would be useful is a system and method for automatically recording a program from a point where a call is answered or initiated by a digital telephone subscriber thereby allowing the subscriber to resume watching the program from answering or initiation point through the end of the program.

In an embodiment of the present invention the signaling associated with the answering or initiation of a digital telephone call by a digital telephone subscriber is used to instruct a video termination device VTD comprising a digital video recorder DVR to record a program that is being viewed by the digital telephone subscriber. In this embodiment a signal is generated by an MTA when the telephone is enters an off hook state and sent to the DVR to initiate recording of a program being viewed by a subscriber. When the phone goes on hook the subscriber resumes watching the program from exactly where it was interrupted. In one embodiment of the present invention the MTA is connected directly to the VTD DVR and the telephone state is determined by the DVR from information provided by the MTA.

In yet another embodiment of the present invention a soft switch monitors signaling from the MTA indicative of the state of a subscriber telephone. A telephone state message comprising the telephone state information is then sent over the out of band channel path to a DVR client within the VTD. The VTD uses the telephone state information to control a DVR. In another embodiment of the present invention the telephone state information is provided to the DVR via an infrared control module.

It is therefore an aspect of the present invention to detect when a telephone state transitions from on hook to off hook and from off hook to on hook and to control a device based on a transition of state of the telephone.

It is another aspect of the present invention to detect state transitions of a telephone configured to provide VoIP telephone service over a cable network using the off hook and on hook signals produced by a media terminal adapter.

It is still another aspect of the present invention to use the state transitions of a VoIP telephone operating over a cable network to control a device connected to the cable network.

It is yet another aspect of the present invention to detect the state transitions of a telephone from the position of the hook switch of the telephone.

It is an aspect of the present invention to control a device connected to the cable network via control signals sent to the device using a remote control responsive to the state transitions of a telephone.

It is another aspect of the present invention to initiate the recording of a television program on a digital video recorder DVR when a telephone transitions to an off hook state.

It yet another aspect of the present invention to end the recording of a television program on a DVR when a telephone transitions to an on hook state.

It is an aspect of the present invention to associate a cable subscriber s telephone number with the MAC and or IP address of the subscriber s VTD and with the MAC and or IP address of the subscriber s VTD.

It is another aspect of the present invention to send telephone state information to a DVR by addressing a message to the IP address of a DOCSIS compliant VTD.

These and other aspects of the present invention will be apparent from a review of the general and detailed descriptions that follow.

An embodiment of the present invention provides a method for controlling a digital video recorder DVR in response to a telephone state transition. A telephone state transition is detected. In an embodiment of the present invention a telephone state transition comprises a change of the telephone state from an on hook state to an off hook state. In another embodiment of the present invention the telephone state transition comprises a change of the telephone state from an off hook state to an on hook state.

In an embodiment of the present invention the telephone state transition is detected at a media terminal adapter MTA connected to a telephone. At boot up of the MTA a configuration file comprising a fully qualified domain name of a video termination device VTD is received. The message to the VTD is addressed using the fully qualified domain name of the VTD.

In an embodiment of the present invention the VTD comprises a set top box. In another embodiment of the present invention the VTD comprises a cable ready video display device.

The telephone state transition is sent to the DVR. In an embodiment of the present invention sending the telephone state transition to the DVR is accomplished by creating a message comprising data indicative of the telephone state transition. The message is sent via an out of band channel to the VTD in which the DVR resides. In an embodiment of the present invention the out of band channel is an RF channel. In another embodiment of the present invention the VTD is DOCSIS compliant and the out of band channel is a DOCSIS channel.

A command responsive to the telephone state transition is issued to the DVR. In an embodiment of the present invention issuing the command to the DVR responsive to the telephone state transition comprises issuing a PAUSE command if the telephone state transition information is a change from an on hook state to an off hook state. In another embodiment of the present invention issuing the command to the DVR responsive the telephone state transition comprises issuing a PLAY command if the telephone state transition information is a change from an off hook state to an on hook state.

In an embodiment of the present invention a system for controlling a digital video recorder DVR in response to a telephone state transition in a cable network comprises a telephone a media terminal adapter MTA and a DVR. The telephone is connected to the cable network via the MTA. The MTA detects a telephone state transition and sends a telephone state message comprising data indicative of the telephone state transition to the DVR via an out of band channel.

In another embodiment of the present invention the telephone state message further comprises the address of a video termination device VTD in which the DVR resides. In an embodiment of the present invention the VTD comprises a set top box. In another embodiment of the present invention the VTD comprises a cable ready video display device. In an embodiment of the present invention the out of band channel is an RF channel. In another embodiment of the present invention the VTD is DOCSIS compliant and the out of band channel is a DOCSIS channel.

In still another embodiment of the present invention the MTA is associated with a subscriber and the MTA is further adapted to receive a configuration file comprising a list of fully qualified domain names of VTDs associated with the subscriber and wherein the address of the VTD is the fully qualified domain name of the VTD.

The DVR obtains the data indicative of the telephone state transition from the telephone state message generates a DVR command from the telephone state transition and issues the DVR command to the DVR thereby controlling the DVR in response to the telephone state transition.

In an embodiment of the present invention the telephone state transition comprises a change of the telephone from an on hook state to an off hook state. In this embodiment the DVR command comprises a PAUSE command. In another embodiment of the present invention the telephone state transition comprises a change of the telephone from an off hook state to an on hook state. In this embodiment the DVR command comprises a PLAY command.

An embodiment of the present invention provides a method for controlling a digital video recorder DVR of a subscriber in response to a telephone state transition. An invitation message is received from a soft switch wherein the invitation message comprises data indicative of a telephone state transition. The invitation message is forwarded to video termination device VTD servers. A determination is made at a VTD server whether to process the invitation message. If the invitation message is processed then a telephone state message comprising the data indicative of the telephone state transition is created. The telephone state message is addressed to a VTD in which the DVR resides. The telephone state message is sent via an out of band channel to the VTD.

In an embodiment of the present invention the invitation message further comprises a user value. In this embodiment the user value in the invitation message is determined and the invitation message forwarded to the VTD servers registered to the user value.

In another embodiment of the present invention a proxy server forwards the invitation message. In this embodiment if the called party is registered with the VTD server the proxy server is sent an OK response message comprising an acknowledgement of the invitation message. The proxy server sends a cancellation message to the VTD servers from which the OK response is not received.

In an embodiment of the present invention an invitation message further comprises identifying information of the subscriber. In this embodiment a first tuple comprising a subscriber telephone number and an assigned VTD MAC address is received from a central datastore. A second tuple comprising a read VTD MAC address and a VTD IP address is received from the VTD. A determination is made whether the assigned VTD MAC address matches the read VTD MAC address. If the assigned VTD MAC address matches the read VTD MAC address a third tuple comprising the subscriber telephone number and the VTD IP address is created. A determination is made whether the identifying information of the subscriber matches the subscriber telephone number of the third tuple. In an embodiment of the present invention the third tuple comprises the subscriber telephone number the read VTD MAC address and the VTD IP address. If the identifying information of the called party matches the subscriber telephone number of the third tuple then the invitation request is processed.

In an embodiment of the present invention the out of band channel is an RF channel. In another embodiment of the present invention the VTD is DOCSIS compliant and the out of band channel is a DOCSIS channel.

In an embodiment of the present invention the telephone state message is received at a DVR client associated within the VTD. A determination is made whether the telephone state message is intended for the VTD. If the telephone state message is intended for the VTD the telephone state transition is obtained from the telephone state message. A DVR command is generated from the telephone state transition the DVR command is issued to the DVR thereby controlling the DVR in response to the telephone state transition.

In an embodiment of the present invention the telephone state message further comprises a destination IP address. Determining if the telephone state message is intended for the VTD comprises determining if the destination IP address matches the IP address of the VTD.

In another embodiment of the present invention the telephone state message further comprises a destination MAC address. Determining if the telephone state message is intended for the VTD comprises determining if the destination MAC address matches the MAC address of the VTD.

In another embodiment of the present invention the telephone state message further comprises a destination IP address and a destination MAC address and determining if the telephone state message is intended for the VTD comprises determining if the destination MAC address and destination IP address match the IP and MAC address of the VTD. In another embodiment of the present invention if the telephone state message is not intended for the VTD an error message is sent from the VTD to the VTD server.

In an embodiment of the present invention a system for controlling a digital video recorder DVR in response to a telephone state transition in a cable network comprises a regional data center a headend and a video termination device VTD . The headend provides video services to subscribers and comprises a VTD server. The regional data center provides digital services to a subscriber of the cable network and comprises a softswitch and a proxy server. The proxy server receives an invitation message from the soft switch. The invitation message comprises an active telephone number of the subscriber and data indicative of a telephone state transition of a telephone using the active telephone number. The proxy server forwards the invitation message to the VTD server. The VTD server parses the invitation message to obtain data indicative of a telephone state transition and the active telephone number of the subscriber. The VTD server creates a telephone state message comprising the data indicative of a telephone state transition. The VTD server addresses the telephone state message to a VTD in which the DVR resides and associated with the active telephone number and sends the telephone state message via an out of band channel to the VTD to control the operation of the DVR.

In an embodiment of the present invention a telephone state transition comprises a change of a telephone from an on hook state to an off hook state. In another embodiment of the present invention the telephone state transition comprises a change of a telephone from an off hook state to an on hook state.

In an embodiment of the present invention the out of band channel is an RF channel. In still another embodiment of the present invention the VTD is DOCSIS compliant and the out of band channel is a DOCSIS channel.

In an embodiment of the present invention the system further comprises a central datastore comprising a first tuple comprising a subscriber telephone number and an assigned VTD MAC address. In this embodiment the VTD server receives the first tuple from the central datastore and receives a second tuple comprising a read VTD MAC address and a VTD IP address from the VTD. A determination is made whether the assigned VTD MAC address matches the read VTD MAC address. If the assigned VTD MAC address matches the read VTD MAC address the VTD server creates a third tuple comprising the subscriber telephone number and the VTD IP address and determines whether the active telephone number matches the subscriber telephone number of the third tuple. If the active telephone number matches the subscriber telephone number of the third tuple then the VTD server addresses the telephone state message to the VTD IP address.

In an embodiment of the present invention the third tuple further comprises the read VTD MAC address.

In an embodiment of the present invention the VTD comprises a DVR client. The DVR client receives the telephone state message and determines if the telephone state message is intended for the VTD. If the telephone state message is intended for the VTD the DVR client obtains the data indicative of the telephone state transition from the telephone state message and generates a DVR command from the telephone state transition. The DVR client issues the DVR command to the DVR thereby controlling the DVR in response to the telephone state transition.

In another embodiment of the present invention if the telephone state message is not intended for the VTD the DVR client sends an error message to the VTD server.

In an embodiment of the present invention a telephone state transition comprises a change of a telephone from an on hook state to an off hook state and the DVR command comprises a PAUSE command. In yet another embodiment of the present invention the telephone state transition comprises a change of a telephone from an off hook state to an on hook state and the DVR command comprises a PLAY command.

In an embodiment of the present invention the VTD comprises a set top box. In another embodiment of the present invention the VTD comprises a cable ready video display device.

In an embodiment of the present invention a system for controlling a digital video recorder DVR in response to a telephone state transition comprises a telephone a DVR responsive to infrared commands and an infrared signaling monitor connected to the telephone. In this embodiment the infrared signaling monitor detects a telephone state transition from an on hook state to an off hook state and sends an infrared PAUSE command to the DVR. The infrared signaling monitor detects a telephone state transition from an off hook state to an on hook state and sends an infrared PLAY command to the DVR.

In an embodiment of the present invention the telephone and infrared signaling monitor are standalone devices. In another embodiment of the present invention the telephone is a wired telephone. In yet another embodiment of the present invention the telephone is a cordless telephone.

An embodiment of the present invention provides a method for controlling a digital video recorder DVR in response to a telephone state transition. In this embodiment a telephone state transition from an on hook state to an off hook state is detected. An infrared PAUSE command is sent to the DVR. A telephone state transition from an off hook state to an on hook state is detected. An infrared PLAY command is sent to the DVR.

In an embodiment of the present invention the telephone and infrared signaling monitor are standalone devices. In another embodiment of the present invention the telephone is a wired telephone. In yet another embodiment of the present invention the telephone is a cordless telephone.

The following terms are used in the description that follows. The definitions are provided for clarity of understanding 

As will be appreciated by those skilled in the art references to discrete components such as MTA set top box cable modem telephone television video display device and DVR are directed to the functionality such devices provide. Devices in which any of these components are integrated are also within the scope of the present invention. By way of illustration and not as a limitation the MTA may be integrated in the VTD. Alternatively the functions of the DVR and set top box may be incorporated into a cable ready television with the security and access functions performed by an external PCMCIA type card. See OpenCable Multistream CableCARD Interface Specification OC SP MC IF 102 040831.

In an embodiment of the present invention the signaling associated with the answering or initiation of a digital telephone call by a digital telephone subscriber is used to instruct a video termination device VTD comprising a digital video recorder DVR to record a program that is being viewed by the digital telephone subscriber. In this embodiment a signal is generated by an MTA when the telephone is enters an off hook state and sent to the DVR to initiate recording of a program being viewed by a subscriber. When the phone goes on hook the subscriber resumes watching the program from exactly where it was interrupted. In one embodiment of the present invention the MTA is connected directly to the VTD DVR and the telephone state is determined by the DVR from information provided by the MTA.

In yet another embodiment of the present invention a soft switch monitors signaling from the MTA indicative of the state of a telephone. A telephone state message comprising the telephone state information is then over the out of band channel path to a DVR client within the VTD. The VTD uses the telephone state information to control a DVR.

Subscriber is connected to hub node via subscriber drop . Inside cable distribution module provides a path to cable modem CM and video terminal device VTD . CM is connected to telephone via MTA . VTD comprises a digital video recorder DVR and a DVR client . DVR comprises a DVR application programming interface API . MTA comprises a return path to the inside cable distribution module so as permit communication between the MTA and DVR client . DVR client is adapted to receive messages from MTA over an out of band channel.

A telephone call follows a path from soft switch to CMTS to QAM modem to cable modem to MTA to telephone . In an embodiment of the present invention MTA provides DVR client change of state information of telephone . In an embodiment of the present invention change of state information comprises a transition from an on hook state to an off hook state indicating the initiation or answering of a call and a transition from an off hook state to an on hook state indicating the termination of a call .

DVR API is adapted to enable an application to schedule and record a program in a time shift buffer or in real time. Applications create recordings by calling the RECORD method of the a RECORDING MGR object of the DVR . DVR client interprets change of state information from MTA and to uses the change of state information to issue calls to DVR API to control the DVR s functions.

In an embodiment of the present invention a change of state of telephone from on hook to off hook causes the DVR client to issue a PAUSE call to DVR API . The DVR is adapted to respond to the PAUSE command according to the mode in which the DVR is being used. If the DVR is being used to watch a program from the memory of the DVR the DVR pauses the playback of the program. If the DVR is being used to watch a program from another source the PAUSE command causes the DVR to pause the program and begin or continue as the case may be for various commercial DVR embodiments recording the program in the DVR memory not illustrated .

A change of state of telephone from off hook to on hook causes the DVR client to issue a PLAY call to DVR API . The DVR is further adapted to respond to the PLAY command according to the mode in which the DVR is being used. If prior to the sending of the PAUSE command the DVR was being used to watch a program from the memory of the DVR then the PLAY command causes the DVR to resume playback of the program. If prior to the sending of the PAUSE command the DVR was being used to watch a program from another source the PAUSE command causes the DVR to playback the program from the memory of the DVR while recording of the program continues.

In another embodiment of the present invention the MTA additionally provides the DVR client with caller identifying CID information. CID information comprises the telephone number of the calling party. In another embodiment of the present invention the CID information further comprises a label associated with the telephone number of the calling party. By way of illustration and not as a limitation the label comprises a calling party name The DVR client provides the CID information to the VTD for display on a display device not illustrated .

In an alternate embodiment of the present invention MTA is integrated with VTD . In this embodiment the MTA communicates with DVR client via a bus or other pathway internal to VTD .

In an embodiment of the present invention telephone state information is relayed from a subscriber s MTA see to the soft switch . Soft switch then creates a telephone state message comprising the telephone state information and sends it to VTD servers A C using SIP Session Initiation Protocol via SIP proxy server . In an embodiment of the present invention the VTD servers A C push telephone state information to the video termination devices via a QPSK modem see within the hub node that serves the head end where a particular VTD server resides. However this is not meant as a limitation. As will be described below other transmission paths may be used to convey the telephone state information to a VTD.

In another embodiment of the present invention the telephone state message created by soft switch further comprises caller identifying CID information. CID information comprises the telephone number of the calling party. In another embodiment of the present invention the CID information further comprises a label associated with the telephone number of the calling party. By way of illustration and not as a limitation the label comprises a calling party name.

The proxy server is interposed between these elements and is responsible for distributing the SIP INVITE messages generated by the softswitch to the VTD servers A C that communicate with to the VTDs not illustrated of subscribers A H. Central datastore comprises information relating telephone number s of a digital telephone subscriber to the MAC address es of the VTDs assigned to that subscriber. The information in central datastore is used by VTD servers A C to send the telephone state messages to the proper VTD.

Regional data center comprises softswitch and SIP proxy server . Hub node comprises CMTS a QAM modem and a QPSK modem . VTD server A is connected to hub node which is connected to subscriber A. Regional data center services multiple headends A B and C. Central datastore comprises information relating telephone number s of a digital telephone subscriber to the MAC address es of the VTDs assigned to that subscriber.

In an embodiment of the present invention central datastore generates a file of digital telephone subscribers and writes the file to a VTD file server . In this embodiment the file comprises a tuple binding a subscriber s phone number s and a set of assigned VTD MAC addresses.

Soft switch receives incoming and outgoing calls for CMTS . SIP proxy server serves to forward bridge SIP traffic from soft switch to VTD servers A C within headends A C. This bridging function allows soft switch to serve additional head ends for which the specific routing information is not known by soft switch . Soft switch is adapted to fork SIP INVITE message traffic to a plurality of SIP proxy servers. In an embodiment of the present invention soft switch is a Cisco BTS series soft switch and SIP proxy server is a Cisco CSPS series proxy server. However this is not meant as a limitation.

Head end A comprises VTD server A which performs the translation of SIP traffic into a UDP telephone state message. In an embodiment of the present invention the format of the telephone state message is selected to efficiently use an out of band IP network to send the telephone state message to VTD client .

Subscriber comprises cable modem CM MTA video termination device VTD and telephone . VTD comprises a DVR client that is adapted to parse the information in the telephone state message to acquire the change of state information from soft switch . DVR client uses the change of state information to issue calls to DVR API to control the operation of DVR .

In an embodiment of the present invention a change of state of telephone from on hook to off hook causes the DVR client to issue a PAUSE call to DVR API to record a program being viewed by digital telephone subscriber. A change of state of telephone from off hook to on hook causes the DVR client to issue a PLAY call to DVR API .

The DVR is adapted to respond to the PAUSE command according to the mode in which the DVR is being used. If the DVR is being used to watch a program from the memory of the DVR the DVR pauses the playback of the program. If the DVR is being used to watch a program from another source the PAUSE command causes the DVR to pause the program and begin or continue as the case may be for various commercial DVR embodiments recording the program in the DVR memory not illustrated .

A change of state of telephone from off hook to on hook causes the DVR client to issue a PLAY call to DVR API . The DVR is further adapted to respond to the PLAY command according to the mode in which the DVR is being used. If prior to the sending of the PAUSE command the DVR was being used to watch a program from the memory of the DVR then the PLAY command causes the DVR to resume playback of the program. If prior to the sending of the PAUSE command the DVR was being used to watch a program from another source then the PAUSE command causes the DVR to playback the program from the memory of the DVR while recording of the program continues.

In another embodiment of the present invention the telephone state message further comprises caller identifying CID information. CID information comprises the telephone number of the calling party. In another embodiment of the present invention the CID information further comprises a label associated with the telephone number of the calling party. By way of illustration and not as a limitation the label comprises a calling party name. The DVR client parses the telephone state message to obtain the CID information. The CID information is then provided to VTD for display on a display device not illustrated .

A telephone call follows a path from soft switch to CMTS to QAM modem to cable modem to MTA to telephone . In an embodiment of the present invention when a call is initiated or received by telephone soft switch monitors telephone state information of telephone as sent by MTA . When the state changes software switch creates a telephone state message comprising the state information of telephone . The telephone state message is directed to the VTD associated with the telephone number for which telephone state information is being monitored through VTD server A.

Telephone state messages follow a path from the soft switch to SIP proxy server to VTD server A to QPSK modem to DVR client . However this is not meant as a limitation. In an alternate embodiment of the present invention a telephone state message may be directed to CMTS . In this embodiment DVR client is DOCSIS compliant and receives the telephone state message via QAM modulator . This path is discussed below in the context of .

In an embodiment of the present invention VTD server A within headend A obtains a list from VTD file server of the digital telephone subscribers that receive video services from multi region cable network . The digital telephone subscriber list correlates a subscriber s telephone number s and a set of VTD MAC addresses assigned to that subscriber.

DVR client registers with VTD server A by providing the VTD server A a read MAC address and an IP address of the VTD . The VTD server matches an assigned VTD MAC address to the read VTD MAC address then creates a tuple associating the subscriber telephone number s read MAC address and IP address of the VTD . The VTD server uses the MAC address es to form a tuple that associates the subscriber telephone number s obtained from the VTD file server with read MAC address and IP addresses of the VTD s managed by that VTD server received from the DVR client during registration.

The VTD server maps the IP address of the VTD to the telephone number associated with the telephone state information. The telephone state message is addressed to the VTD IP address. In an embodiment of the present invention the telephone state message further comprises the MAC address of the VTD. The VTD MAC and or the VTD IP address is used by the DVR client to confirm that telephone state message is directed to the correct VTD.

A determination is made whether the DVR client has received an acknowledgement from the VTD server with a fixed period of time . If the acknowledgement is received the DVR client is deemed registered with the VTD server . If the acknowledgement is not received within the time specified the DVR client again sends a registration message as previously described .

In an embodiment of the present invention a Global Register Request message is broadcast on a specific subnet to request DVR clients to re register with the VTD server identified in the DVR client configuration file. In yet another embodiment of the present invention to prevent sign on storms a DVR client uses MAC address of the VTD on which it resides to delay sending its registration message. By way of illustration and not as a limitation a DVR client uses the fifth byte of the VTD MAC address as the number of seconds and three times the sixth byte as the number of milliseconds that the DVR client would wait before sending a registration message. For example a DVR client residing on an VTD with a MAC address of 01 02 03 04 05 06 would wait 5 sec 18 ms 5018 ms before sending its registration message.

Referring again to the soft switch comprises a feature set specifically for providing telephone state information to VTDs. When a subscriber has the feature enabled the soft switch generates a SIP INVITE message comprising telephone state information and the subscriber telephone number associated with the telephone state information and sends the message to a SIP proxy server. In an embodiment of the present invention the SIP INVITE message sent by the soft switch comprises a feature control protocol FCP message body. However this is not meant as a limitation. Other protocols may be used to convey the telephone state information and the subscriber telephone number in the SIP message body.

Each proxy server has static registrations provisioned for each VTD server that it services. When the proxy receives the INVITE message from the soft switch it relays the INVITE message to the VTD servers within the headends A C served by the regional data center in which the soft switch resides. In UNIX terminology the proxy forks the INVITE message request across all VTD servers A C.

Each VTD server that receives the INVITE message determines whether the subscriber associated with the telephone number for which telephone state information being monitored is registered with that VTD server. A VTD server that actually manages the subscriber that belongs to the number for which telephone state information is being monitored responds with a 200 OK message. On reception of the 200 OK message the proxy server issues a CANCEL message to cancel any other forked requests that went to other VTD servers and relays the 200 OK message back to the soft switch . The soft switch sends an ACK message acknowledging the 200 OK followed by a BYE message terminating the session.

The soft switch generates two additional types of INVITE messages. The first is the INVITE message generated on a periodic basis as a keep alive message between the soft switch and the SIP proxy server . The keep alive allows the soft switch to insure that the SIP proxy server is accessible and that the SIP application is active. As explained below the SIP proxy server responds to a keep alive message with a 404 NOT FOUND RESPONSE CODE. The soft switch interprets the 404 response as an indication that the feature server is accessible and active. A second type of INVITE message is generated when the soft switch is restarted for any reason. Like the keep alive INVITE message SIP proxy server responds to this INVITE message with a 404 NOT FOUND RESPONSE.

The three types of INVITE messages are differentiated by the SIP proxy server using the Request URI in the INVITE message. For the INVITE message destined for a VTD server the Request URI user field comprises a user value of fs . However this is not meant as a limitation. The SIP proxy server responds to this user value by forwarding forking the INVITE message in a parallel manner to all the VTD servers registered to that user . The other two INVITE messages have different RequestURI user values. A SIP proxy server is not be populated with any routing rules for these users resulting in the 404 responses being generated by the SIP proxy server and returned to the soft switch .

In an embodiment of the present invention the message body for the INVITE message uses FCP. The FCP body comprises telephone state information. In another embodiment of the present invention the INVITE message further comprises CID information. In this embodiment the CID information comprises a called party phone number CalledPN a calling party phone number CallingPN and SubName SubId and Privacy parameters. The CalledPN indicates the subscriber to whom the call is destined. The CallingPN is the calling party number while the SubName and SubId fields comprise other calling party identifying information. The Privacy parameter indicates whether and how the Telephone state information is restricted for this number as follows 

A subscriber may register multiple VTDs and associate each VTD with the same or a different telephone number. The telephone state message is sent to the IP address of the DVR client residing in each VTD associated with the telephone number to which the telephone state information pertains.

In an embodiment of the present invention the MAC address of VTD is also carried in the telephone state message. The DVR client compares the MAC address in the telephone state message to the MAC address of the VTD in which the DVR client resides. If the MAC addresses do not match then the DVR client does not issue commands to the DVR API. Rather the DVR client sends a Wrong MAC message to the VTD server advising the VTD server of the incorrect mapping. The DVR client sends a Register message to associate its IP address with the MAC address of the VTD in which the DVR client resides.

Referring again to in an embodiment of the present invention the VTD server adheres to the standard Mystro Application Component MAS design architecture. This architecture provides conductor interactions database connectivity and CORBA messaging for relatively little development cost. This architecture further allows the VTD server to reside on its own hardware allowing the VTD server to be scaled independently of other network components.

In an exemplary embodiment of the present invention the VTD server is a Java application run on a Linux platform using JacORB as its communication protocol. The MAS database is Oracle 9i. The VTD server hardware a Sun V65 with dual 2.4 GHz Intel Pentium processors with 2 GB of RAM. As will be appreciated by those skilled in the art other languages platforms databases and hardware may used to implement embodiments of the present invention without departing from its scope.

In yet another embodiment of the present invention the security is provided using IPSEC or IP level Security. This means that that traffic is physically secure between the routers and is transparent to VTD server . Transfers of files from VTD file server require the standard user password authentication. In an alternate embodiment of the present invention SecureCopy is used to encrypt file data retrieved from the VTD file server prior to transport.

In an embodiment of the present invention VTD is DOCSIS compliant. As a consequence VTD comprises an IP address that permits messages to be directed to the VTD from the CMTS.

Subscriber is connected to hub node via subscriber drop . Inside cable distribution module provides a path to cable modem CM and video terminal device VTD . CM is connected to telephone via MTA . VTD comprises a cable modem a digital video recorder DVR and a DVR client . DVR client is adapted to receive messages from MTA addressed to CM . DVR comprises a DVR application programming interface API .

A telephone call follows a path from soft switch to CMTS to QAM modem to cable modem to MTA to telephone . In an embodiment of the present invention MTA provides DVR client change of state information of telephone by addressing a telephone state message to cable modem . In an embodiment of the present invention change of state information comprises a transition from an on hook state to an off hook state indicating the initiation or answering of a call and a transition from an off hook state to an on hook state indicating the termination of a call .

DVR API is adapted to enable an application to schedule and record a program in a time shift buffer or in real time. Applications create recordings by calling the RECORD method of the a RECORDING MGR object of the DVR. In an embodiment of the present invention DVR client interprets change of state information from MTA and to uses the change of state information to issue calls to DVR API to control the DVR s functions. In an embodiment of the present invention a change of state of telephone from on hook to off hook causes the DVR client to issue a PAUSE call to DVR API . The DVR is adapted to respond to the PAUSE command according to the mode in which the DVR is being used. If the DVR is being used to watch a program from the memory of the DVR the DVR pauses the playback of the program. If the DVR is being used to watch a program from another source the PAUSE command causes the DVR to pause the program and begin or continue as the case may be for various commercial DVR embodiments recording the program in the DVR memory not illustrated .

A change of state of telephone from off hook to on hook causes the DVR client to issue a PLAY call to DVR API . The DVR is further adapted to respond to the PLAY command according to the mode in which the DVR is being used. If prior to the sending of the PAUSE command the DVR was being used to watch a program from the memory of the DVR then the PLAY command causes the DVR to resume playback of the program. If prior to the sending of the PAUSE command the DVR was being used to watch a program from another source then the PAUSE command causes the DVR to playback the program from the memory of the DVR while recording of the program continues.

In another embodiment of the present invention the telephone state message created by MTA additionally provides the DVR client with caller identifying CID information. CID information comprises the telephone number of the calling party. In another embodiment of the present invention the CID information further comprises a label associated with the telephone number of the calling party. By way of illustration and not as a limitation the label comprises a calling party name. The DVR client parses the telephone state message to obtain the CID information and then provides the CID information to the VTD for display on an display device not illustrated .

In an embodiment of the present invention when MTA boots it receives its MTA configuration file comprising a fully qualified domain name FQDN for the VTD of the subscriber to whom the MTA is assigned. When the MTA detects a change of state of telephone the MTA sends an IP based messaged to the VTD via the CMTS that commands the DVR to start stop recording the currently viewed channel.

As will be appreciated by those skilled in the art other means of sending commands to DVR in response to a change of state of telephone may be used without departing from the scope of the present invention. illustrates a block diagram of an infrared signaling module used to convey commands to a DVR in response to a change of state of telephone according to an embodiment of the present invention. In this embodiment of the present invention telephone is connected to a standalone infrared IR signaling module . Telephone may be a wired or cordless telephone. IR signaling module comprises an IR command set of DVR and IR command transmitter . The IR signaling module is adapted to detect a change of state of telephone and to issue an IR command to DVR via IR command transmitter in response thereto. IR command receiver within DVR receives the IR command.

In this embodiment a change of state of telephone from on hook to off hook causes the infrared signaling module to issue a PAUSE IR command to DVR . The DVR is adapted to respond to the PAUSE command according to the mode in which the DVR is being used. If the DVR is being used to watch a program from the memory of the DVR the DVR pauses the playback of the program. If the DVR is being used to watch a program from another source the PAUSE command causes the DVR to pause the program and begin recording the program in the DVR memory not illustrated .

A change of state of telephone from off hook to on hook causes the infrared signaling module to issue a PLAY IR command to DVR . The DVR is further adapted to respond to the PLAY command according to the mode in which the DVR is being used. If prior to the sending of the PAUSE command the DVR was being used to watch a program from the memory of the DVR then the PLAY command causes the DVR to resume playback of the program. If prior to the sending of the PAUSE command the DVR was being used to watch a program from another source then the PAUSE command causes the DVR to playback the program from the memory of the DVR while recording of the program continues.

A system and method for controlling a DVR on a cable network has been described. It will be understood by those skilled in the art that the present invention may be embodied in other specific forms without departing from the scope of the invention disclosed and that the examples and embodiments described herein are in all respects illustrative and not restrictive. Those skilled in the art of the present invention will recognize that other embodiments using the concepts described herein are also possible. Further any reference to claim elements in the singular for example using the articles a an or the is not to be construed as limiting the element to the singular.

