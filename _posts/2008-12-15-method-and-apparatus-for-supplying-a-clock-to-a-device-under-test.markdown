---

title: Method and apparatus for supplying a clock to a device under test
abstract: A method and apparatus involves operating a circuit having a test circuit interrupt input terminal (INTERRUPT), having a test circuit clock output terminal (DUT_CLK), and having first and second operational modes. In the first operational mode the circuit supplies a test circuit clock signal to the test circuit clock output terminal. The circuit responds to receipt of an occurrence of a test circuit interrupt at the test circuit interrupt input terminal by then operating in the second operational mode. In the second operational mode the circuit refrains from supplying the test circuit clock signal to the test circuit clock output terminal.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07852109&OS=07852109&RS=07852109
owner: Xilinx, Inc.
number: 07852109
owner_city: San Jose
owner_country: US
publication_date: 20081215
---
The invention relates to integrated circuit devices ICs . More particularly the invention relates to testing of circuitry in an IC.

Programmable logic devices PLDs are a well known type of integrated circuit that can be programmed to perform specified logic functions. One type of PLD the field programmable gate array FPGA typically includes an array of programmable tiles. These programmable tiles can include for example input output blocks IOBs configurable logic blocks CLBs dedicated random access memory blocks BRAM multipliers digital signal processing blocks DSPs processors clock managers delay lock loops DLLs and so forth.

Each programmable tile typically includes both programmable interconnect and programmable logic. The programmable interconnect typically includes a large number of interconnect lines of varying lengths interconnected by programmable interconnect points PIPs . The programmable logic implements the logic of a user design using programmable elements that can include for example function generators registers arithmetic logic and so forth.

The programmable interconnect and programmable logic are typically programmed by loading a stream of configuration data into internal configuration memory cells that define how the programmable elements are configured. The configuration data can be read from memory e.g. from an external PROM or written into the FPGA by an external device. The collective states of the individual memory cells then determine the function of the FPGA.

Another type of PLD is the Complex Programmable Logic Device or CPLD. A CPLD includes two or more function blocks connected together and to input output I O resources by an interconnect switch matrix. Each function block of the CPLD includes a two level AND OR structure similar to those used in Programmable Logic Arrays PLAs and Programmable Array Logic PAL devices. In CPLDs configuration data is typically stored on chip in non volatile memory. In some CPLDs configuration data is stored on chip in non volatile memory then downloaded to volatile memory as part of an initial configuration programming sequence.

For all of these programmable logic devices PLDs the functionality of the device is controlled by data bits provided to the device for that purpose. The data bits can be stored in volatile memory e.g. static memory cells as in FPGAs and some CPLDs in non volatile memory e.g. FLASH memory as in some CPLDs or in any other type of memory cell.

Other PLDs are programmed by applying a processing layer such as a metal layer that programmably interconnects the various elements on the device. These PLDs are known as mask programmable devices. PLDs can also be implemented in other ways e.g. using fuse or antifuse technology. The terms PLD and programmable logic device include but are not limited to these exemplary devices as well as encompassing devices that are only partially programmable. For example one type of PLD includes a combination of hard coded transistor logic and a programmable switch fabric that programmably interconnects the hard coded transistor logic.

Designers using PLDs frequently find it necessary to test various aspects of their design to determine whether the circuit operates in a manner different than what is desired. One approach for testing a design includes providing a free running clock to the design under test. However since the clock is free running the design under test continually receives clock signals even after the circuit starts to deviate from its intended operation. This makes it difficult for a designer to see the states of various signals in the design during a period of time when the deviations occur. Another approach includes providing single clock pulses one at a time so that a designer can step through the operation of the circuit. In this manner after each clock pulse a designer can look at the states of various signals in the design. However this approach means that a designer may need to step through many clock pulses before identifying the time when the design starts to deviate from the intended operation. Although these pre existing approaches have been generally adequate for their intended purposes they have not been entirely satisfactory in all respects.

A circuit may have a test circuit interrupt input terminal a test circuit clock output terminal and first and second operational modes. In the first operational mode the circuit supplies a test circuit clock signal to the test circuit clock output terminal. In the second operational mode the test circuit clock output terminal is free of the test circuit clock signal. In response to receipt of an occurrence of a test circuit interrupt at the test circuit interrupt input terminal the circuit then operates in the second operational mode.

A method of operating a circuit having a test circuit interrupt input terminal and a test circuit clock output terminal includes supplying a test circuit clock signal to the test circuit clock output terminal in a first operational mode responding to receipt of an occurrence of a test circuit interrupt at the test circuit interrupt input terminal by then operating in a second operational mode and refraining from supplying the test circuit clock signal to the test circuit clock output terminal in the second operational mode.

In the FPGA each programmable tile includes a programmable interconnect element INT having standardized connections to and from a corresponding interconnect element in each adjacent tile. Therefore the programmable interconnect elements taken together implement the programmable interconnect structure for the illustrated FPGA. The programmable interconnect element INT also includes the connections to and from the programmable logic element within the same tile as shown by the examples included at the top of .

For example a CLB can include a configurable logic element CLE that can be programmed to implement user logic plus a single programmable interconnect element INT . A BRAM can include a BRAM logic element BRL in addition to one or more programmable interconnect elements. Typically the number of interconnect elements included in a tile depends on the height of the tile. In the pictured embodiment a BRAM tile has the same height as five CLBs but other numbers e.g. four can also be used. A DSP tile can include a DSP logic element DSPL in addition to an appropriate number of programmable interconnect elements. An IOB can include for example two instances of an input output logic element IOL in addition to one instance of the programmable interconnect element INT . As will be clear to those of skill in the art the actual I O pads connected for example to the I O logic element typically are not confined to the area of the input output logic element .

In the pictured embodiment a columnar area near the center of the die shown shaded in is used for configuration clock and other control logic. Horizontal areas extending from this column are used to distribute the clocks and configuration signals across the breadth of the FPGA. In other embodiments the configuration logic may be located in different areas of the FPGA die such as in the corners of the die.

Some FPGAs utilizing the architecture illustrated in include additional logic blocks that disrupt the regular columnar structure making up a large part of the FPGA. The additional logic blocks can be programmable blocks and or dedicated logic. For example the processor block PROC shown in spans several columns of CLBs and BRAMs.

In the FPGA of an exemplary CLB includes a single programmable interconnect element INT and two different slices slice L SL and slice M SM . In some embodiments the two slices are the same e.g. two copies of slice L or two copies of slice M . In other embodiments the two slices have different capabilities. In some embodiments some CLBs include two different slices and some CLBs include two similar slices. For example in some embodiments some CLB columns include only CLBs with two different slices while other CLB columns include only CLBs with two similar slices.

When a circuit designer is designing the DUT the designer can optionally include some test circuitry that is configured to actuate the interrupt signal INTERRUPT in response to one or more specified conditions. For example the INTERRUPT signal could be actuated any time that a particular not illustrated register within the DUT happens to contain a specified value.

The circuit has a buffer gate that serves as a clock gate with an input coupled to the clock input terminal CLK and an output that is coupled to the output terminal DUT CLK of the circuit and thus to the clock input terminal C of the DUT . The gate also has a control input. Moreover the circuit has a buffer with an input that is coupled to the clock input terminal CLK and an output. The circuit further includes a D flip flop that is a clock mode storage element. The D flip flop has an input D coupled to one line of the input BUS an output Q that carries a signal MODE SELECT and a clock input C that is coupled to the output of the buffer . In addition the circuit has a D flip flop that is an interrupt mode storage element. The D flip flop has an input D that is coupled to one line of the input BUS an output Q that carries a signal INTERRUPT MASK and a clock input C that is coupled to the output terminal of the buffer .

The circuit has a counter portion . The counter portion includes a multi bit register that is a current count storage element for storing and outputting a value CURRENT COUNT. The register has a multi bit data input DI a clock enable input CE a clock input C that is coupled to the output of the buffer and a synchronous reset input R that is coupled to the input terminal RESTART. In addition the register has a multi bit output DO that carries the value CURRENT COUNT. Further the counter portion includes a multi bit adder with a multi bit input that is coupled to the multi bit output DO of the register and a multi bit input that is hardwired to receive a predetermined value of 1 . In addition the adder has a multi bit output that is coupled to the multi bit data input DI of the register .

The circuit further includes a multi bit register that is a terminal count storage element for storing and outputting a value TERMINAL COUNT. The register has a multi bit input DI that is coupled to the input BUS and a multi bit output DO. The register further includes a clock enable input CE that is coupled to the input terminal RESTART for receiving the signal RESTART and a clock input C that is coupled to the output of the buffer .

In addition the circuit includes a multi bit comparator with a multi bit input A that is coupled to the output DO of the register a multi bit input B that is coupled to the output DO of the register and an output that carries a signal COMP OUT. The signal COMP OUT is a logic high when CURRENT COUNT and TERMINAL COUNT are the same and is a logic low when CURRENT COUNT and TERMINAL COUNT are different. The register the adder the register and the comparator collectively constitute a counter portion. The circuit further has a D flip flop that is a clock pulse stop portion. The D flip flop has an input D that is coupled to the output of the comparator a clock enable input CE that is coupled to the output Q of the D flip flop a clock input C that is coupled to the output of the buffer a synchronous reset input R that is coupled to the input terminal RESTART and an output Q that carries a signal DUT STOP.

The circuit has a 16 by 1 read only memory serving as a look up table LUT with a resume input r that is coupled to the input terminal RESUME a stop input s that is coupled to the output Q of the D flip flop an interrupt mask input m that is coupled to the output Q of the D flip flop and an interrupt input i that is coupled to the input terminal INTERRUPT. The LUT further has an output that carries a signal LUT OUT. The state of the output signal LUT OUT depends on the state of the signals RESUME DUT STOP INTERRUPT MASK and INTERRUPT that appear at the input terminals r s m and i respectively. In particular the state of the output signal LUT OUT can be expressed by the Boolean equation LUT OUT r i m 5 where represents inversion. The truth table for the LUT is provided below as Table 1.

The circuit further has a D flip flop that has an input D that is coupled to the output of the LUT a clock input C that is coupled to the output of the buffer and an output Q that is coupled to the control input of the gate . The LUT and the D flip flop together serve as a clock enable portion of the circuit .

Referring to the circuit has a clock enabled mode and a clock disabled mode. In the clock enabled mode the gate is enabled causing the clock signal CLK to pass therethrough to the output terminal DUT CLK. Thus the signal DUT CLK mirrors the clock signal CLK when the circuit operates in the clock enabled mode. In the clock disabled mode the gate is disabled inhibiting the clock signal CLK from passing therethrough to the output terminal DUT CLK. Therefore the signal DUT CLK is low when the circuit operates in the clock disabled mode.

The circuit has a count enabled mode and a count disabled mode. In the count enabled mode and as explained in more detail later the circuit produces a specified number of clock pulses at the output terminal DUT CLK and then disables the gate . In the count disabled mode the circuit ignores the number of clock pulses that appear at the output terminal DUT CLK. The output Q of the D flip flop determines which one of the count enabled and disabled modes the circuit is in. When the output Q of the D flip flop is high the circuit is in the count enabled mode. When the output Q of the D flip flop is low the circuit is in the count disabled mode.

In addition the circuit has an interrupt enabled mode and an interrupt disabled mode. In the interrupt enabled mode and as explained in more detail later the circuit responds to an occurrence of the signal INTERRUPT at the input terminal INTERRUPT by disabling the gate . In the interrupt disabled mode the circuit ignores any occurrence of the signal INTERRUPT at the input terminal INTERRUPT. The output Q of the D flip flop determines which one of the interrupt enabled and disabled modes the circuit is in. When the output Q of the D flip flop is in a low state the circuit is in the interrupt enabled mode. When the output Q of the D flip flop is in a high state the circuit is in the interrupt disabled mode.

To facilitate an understanding of the operation of the circuit for now assume that the signal RESUME that appears at the input terminal RESUME of the LUT is low so the state of the resume input r of the LUT is low.

Taking into account the various possible states of the D flip flops and the operation of the circuit can be discussed in the context of four different scenarios. First consider the operation of the circuit when the state of the D flip flop is low and the state of the D flip flop is high. In this first scenario the circuit is in the count disabled mode and interrupt disabled mode.

First focus on the effect that the count disabled mode has on the operation of the circuit . The low state at the output Q of the D flip flop appears at the clock enable input CE of the D flip flop . In turn the D flip flop is disabled and the output Q of the D flip flop will be low because the D flip flop has been reset in a manner discussed later. The low state at the output Q of the D flip flop appears at the input s of the LUT . Now focus on the effect that the interrupt disabled mode has on the operation of the circuit . In the interrupt disabled mode the output Q of the D flip flop is high and carries the signal INTERRUPT MASK that appears at the input m of the LUT . When r 0 s 0 and m 1 the output LUT OUT of the LUT is high without regard to the input i. The signal LUT OUT is high and appears at the input D of the D flip flop . This is clocked into the D flip flop with each pulse of the clock signal CLK so that the output Q of the D flip flop is high. As a result the signal DUT ENABLE is high and appears at the control input of the gate . In turn the gate is continuously enabled causing the clock signal CLK to pass therethrough to the output DUT CLK.

Now turn to an explanation of the operation of the circuit when the state of the output Q of the D flip flop is low and the state of the output Q of the D flip flop is low. In this second scenario the circuit is in the count disabled mode and the interrupt enabled mode. The effect that the count disabled mode has on the circuit has been previously discussed. In the interrupt enabled mode the signal INTERRUPT MASK is low and appears at the interrupt mask input m of the LUT . The states of the inputs r and s are also low as previously explained. In the absence of an occurrence of the signal INTERRUPT the state of the input i of the LUT is low. As a result the output LUT OUT is high. The high signal LUT OUT appears at the input D of the D flip flop . Each pulse of the clock signal CLK clocks this high into the D flip flop so that the output Q of the D flip flop is high. The signal DUT ENABLE is thus high and appears at the control input of the gate . In turn the gate is enabled and passes the clock signal CLK therethrough to the output terminal DUT CLK.

When there is an occurrence of the signal INTERRUPT the state of the input i of the LUT changes from low to high. As a result the output LUT OUT goes low and appears at the input D of the D flip flop . At the next leading edge of the clock signal CLK the output Q of the D flip flop is set to low. The signal DUT ENABLE is thus low and appears at the control input of the gate . In turn the gate is disabled and inhibits the clock signal CLK from passing therethrough to the output terminal DUT CLK. Thus the circuit then operates in the clock disabled mode.

In due course a pulse is applied to the input terminal RESUME and the input r of the LUT goes high. This causes the output LUT OUT of the LUT to go high and the high signal LUT OUT appears at the input D of the D flip flop . At the next leading edge of the clock signal CLK the output Q of the D flip flop goes high. In turn the signal DUT ENABLE goes high and appears at the control input of the gate . This enables the gate so that the clock signal CLK passes therethrough to the output terminal DUT CLK. In this manner the circuit resumes operation in the clock enabled mode.

Now turn to an explanation of the operation of the circuit when the output Q of the D flip flop is high and the output Q of the D flip flop is high. In this third scenario the circuit is in the count enabled mode and the interrupt disabled mode. The effect that the interrupt disabled mode has on the circuit has been previously discussed. Therefore now focus on the effect that the count enabled mode has on the circuit .

In the count enabled mode the counter portion maintains a CURRENT COUNT value that corresponds to a specified number of pulses being supplied to the output terminal DUT CLK from a specified point in time. First the signal RESTART is actuated for a period of time so that a pulse appears at the clock enable input CE of the register the synchronous reset input R of the register and the synchronous reset input R of the D flip flop . Also before the next leading edge of the clock signal CLK a value that is one less than the specified number of clock pulses is supplied to the BUS. Therefore at the next leading edge of the clock signal CLK the value on the BUS is clocked into the register as the TERMINAL COUNT value and that value then appears at the output DO of the register . Also the register and the D flip flop are both reset at that same leading edge of the clock signal CLK because of the pulse in the signal RESTART. Thus the CURRENT COUNT value at the output DO of the register is zero and the signal DUT STOP is low.

After that leading edge of the clock signal CLK and before the next leading edge of the clock signal CLK the adder takes the CURRENT COUNT value from the output DO of the register and increments it. The adder then supplies the incremented value to the input DI of the register . This happens between each pair of successive leading edges of the clock signal CLK. At each successive leading edge of the clock signal CLK the incremented value at the input DI of the register is clocked into the register and appears at the output DO of the register as the new CURRENT COUNT value. The register thus counts up from zero.

The comparator takes the CURRENT COUNT value from the output DO of the register and compares it to the TERMINAL COUNT value from the output DO of the register . When the CURRENT COUNT and TERMINAL COUNT values are different the output of the comparator and the signal COMP OUT are low. In the count enabled mode the signal MODE SELECT is high which enables the D flip flop to pass the state of the signal COMP OUT to the output Q of the D flip flop on each leading edge of the clock signal CLK. Therefore at the next leading edge of the clock signal CLK the output Q of the D flip flop goes low. The signal DUT STOP at the input s is also low. In that situation the state of the inputs r s and m are respectively low low and high. Therefore in accordance with the Boolean equation that expresses the state of the output signal LUT OUT of the LUT the output signal LUT OUT is high. The high signal LUT OUT enables the register which causes the counter portion to continue counting up. The high state of the output signal LUT OUT appears at the D input of the D flip flop causing the output thereof and the signal DUT ENABLE to be high at the next leading edge of the clock signal CLK. Since the signal DUT ENABLE goes high the gate is enabled and passes the clock signal CLK to the output terminal DUT CLK.

When an increment of CURRENT COUNT causes CURRENT COUNT and TERMINAL COUNT to be equal the output of the comparator and the signal COMP OUT go high. As explained above the D flip flop is enabled in the count enabled mode and thus the output Q thereof goes high at the next leading edge of the clock signal CLK. When the output Q of the D flip flop is high the state of the input s of the LUT is also high. In that situation the states of the inputs r s and m are respectively low high and high. Therefore in accordance with the Boolean equation that expresses the state of the output signal LUT OUT of the LUT the output signal LUT OUT goes low. The low state of the output signal LUT OUT appears at the clock enable input CE of the register . Thus the register is disabled causing the counter portion to halt incrementing the CURRENT COUNT value. Instead the counter portion maintains most recent CURRENT COUNT value at the output DO of the register . The low state of the output signal LUT OUT appears at the D input of the D flip flop . At the next leading edge of the clock signal CLK the signal DUT ENABLE goes low inhibiting the gate from passing the clock signal CLK to the output terminal DUT CLK.

A pulse in the signal RESTART is provided to reset the CURRENT COUNT value in register load the TERMINAL COUNT value into register and also reset the D flip flop that outputs the signal DUT STOP. Here the register is loaded with the value 1 which is one less than the specified number two of clock pulses of the signal DUT CLK to be produced by the circuit . As shown in the pulse causes the circuit to generate two pulses of the signal DUT CLK. Later another pulse in the signal RESTART is provided. Here the register is loaded with the value of 0 and the circuit generates a single pulse of the signal DUT CLK.

Referring back to now turn to an explanation of the operation of the circuit when the state of the D flip flop is high and the state of the D flip flop is low. In this fourth scenario the circuit is in the count enabled mode and interrupt enabled mode. The effects that the count and interrupt enabled modes each have separately on the circuit have been previously discussed. In the absence of an occurrence of the signal INTERRUPT the circuit performs as previously discussed above. Assume that the counter portion is in the process of counting a specified number of pulses that are to be produced at the output terminal DUT CLK. Now focus on the operation of the circuit when there is an occurrence of a signal INTERRUPT before the specified number of clock pulses has been supplied to the output terminal DUT CLK.

Upon an occurrence of the signal INTERRUPT the input i of the LUT goes high the signal LUT OUT immediately goes low and is applied to the clock enable input CE of the register to disable clocking of the register . As a result the states of the input DI and the output DO of the register remain the same as just before the occurrence of the signal INTERRUPT. In this manner the circuit maintains the CURRENT COUNT value without change following the occurrence of the signal INTERRUPT. The low signal LUT OUT is also clocked into the D flip flop so that DUT ENABLE goes low and disables the gate to stop the DUT CLK signal in the manner discussed earlier.

In due course a pulse is applied to the input terminal RESUME and the input r of the LUT goes high. This causes the output LUT OUT of the LUT to go high. The high signal LUT OUT appears at the clock enable input CE of the register and causes it to resume counting from the value of CURRENT COUNT that existed when the interrupt occurred. Moreover as previously discussed at the next leading edge of the clock signal CLK LUT OUT is clocked into the D flip flop . The signal DUT ENABLE goes high and appears at the control terminal of the gate causing the clock signal to pass therethrough to the output terminal DUT CLK and to the clock input C of the DUT . The counter portion counts up until CURRENT COUNT equals TERMINAL COUNT causing the output of the comparator and the signal COMP OUT to go high. As a result the circuit then enters the clock disabled mode again in the manner discussed earlier.

The circuit in is compact in size and can be efficiently implemented on a PLD such as the FPGAs shown in using standard logic components typically available on a PLD. The circuit may be similarly efficiently implemented in other circuits and integrated circuits. Further the circuit permits the DUT to generate an interrupt that stops the DUT clock signal DUT CLK thereby providing the DUT with the capability to stop its own execution in order to facilitate test and debugging. The circuit permits the DUT to be tested in any of several different modes including a mode where the DUT clock signal DUT CLK is single stepped a mode where DUT CLK is free running a mode where the free running DUT CLK can be halted by an interrupt from the DUT and then restarted and a mode where a specified number of pulses of DUT CLK are supplied to the DUT including the capability to interrupt and then restart DUT CLK while the specified number of pulses is being supplied to the DUT.

