---

title: Controlling the charging of a composite service
abstract: Methods and devices for controlling a charging of a composite service in a telecommunications network are described. The composite service comprises an invocation of a constituent service. The telecommunications network comprises a control node for controlling the composite service, a service node for providing the constituent service, and a charging system for performing the charging. The method comprises the steps of receiving from the service node a first usage report comprising charging indicators related to the invocation of the constituent service, receiving from the control node control information related to the composite service, the control information indicating that the invocation of the constituent service is associated to the invocation of the composite service, generating a further usage report by changing the charging indicators according to the control information, and sending the further usage report to the charging system to instruct the charging system to perform the charging according to the further usage report.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08472601&OS=08472601&RS=08472601
owner: Telefonaktiebolaget L M Ericcson (Publ)
number: 08472601
owner_city: Stockholm
owner_country: SE
publication_date: 20080814
---
The present invention relates to handling of charging of composite services within telecommunications networks.

Service composition refers to a technology where end user services to be provided to user terminals e.g. to personal computers laptop computers or mobile phones of a telecommunications network are dynamically built by combining constituent services. The selection of the constituent services as components of the composite service may be performed just in time at user request. The needed constituent services are described in terms of required generic properties. Any service that provides the needed properties can be used as part of the composite service. Rather than fixed binding of a particular service any suitable service within a pool of available services can be selected. The pool of available constituent services can change dynamically by adding new services or by removing them. A composite service can therefore consist of different constituent services at each invocation. Thus the set of component services that are actually included into a composite service may not be static but depending on runtime conditions. The constituent services do not need to be specifically designed for service composition. They can be integrated into a composite service but they can also work as a single service.

From the end user point of view a telecommunication network is substantially defined by the services it provides. The end user selects desired services from a portfolio of available services. For billing of services provided to the end user a charging system is provided that is informed by the nodes providing services and applications about user activities. The charging system determines the amount to be charged for the service usage and deducts from the user s account online charging or it logs the activity in detail records for later billing offline charging . Important information used by the charging system is the identification of the user and the details of the provided service so called usage information. Various protocols exist to transfer this information from the service nodes to the charging system. Examples are for online charging protocols are RADIUS standardized for example by the Internet Engineering Task Force IETF in the Request For Comments RFC 2866 or its successor DIAMETER standardized by IETF RFC 3588 and in the 3Generation Partnership Project 3GPP Technical Specification TS 32.299. The roles in charging of the charging system and service nodes are well standardized for example in 3GPP TS 32.240.

In existing telecommunications networks the charging system independently evaluates usage information of each service provided to the end user terminal. Such approach of separate service processing is reasonable as long as the service tariff does not depend on the other services provided to the user or on the context of a service usage.

In a service environment that is based on service composition a service request that starts a composite service triggers the invocation of a number of constituent services each of which being reported to and handled separately by the charging system. However it may be desirable that the charging of a composite service involves a more flexible charging than the separate charging of the constituent services.

It is therefore an object of the invention to provide methods devices and computer programs that improve charging of composite services.

This object is achieved by the method device computer program and a non transitory computer readable medium product as described and claimed herein. Advantageous embodiments are also described and claimed herein.

In an embodiment a method for controlling a charging of a composite service in a telecommunications network is disclosed. The composite service comprises an invocation of a constituent service. The telecommunications network comprises a control node for controlling the composite service a service node for providing the constituent service and a charging system for performing the charging. The method comprises the steps of receiving from the service node a first usage report comprising charging indicators related to the invocation of the constituent service receiving from the control node control information related to the composite service the control information indicating that the invocation of the constituent service is associated to the invocation of the composite service generating a further usage report by changing the charging indicators according to the control information and sending the further usage report to the charging system to instruct the charging system to perform the charging according to the further usage report.

The embodiments of the invention provide for a control of a charging of a composite service effecting a flexible charging of the composite service. According to the embodiments the charging indicators related to the invocation of the constituent service are changed according to the control information. The changed charging indicators are sent in a further usage report to the charging system instructing the charging system to perform the charging of the composite service according to the changed charging indicators. This has the effect that the charging of the composite service is controlled based on the control information and does not depend on the charging of the constituent service. Hence the end user is being charged for the composite service and is not exposed to a separate charging of a constituent service.

In a further embodiment an interface node is disclosed. The interface node comprises a receiving unit for receiving messages a transmitting unit for transmitting messages a processing unit for controlling further units and for processing messages and information the processing unit comprising a charging information handling unit. The receiving unit is adapted to receive from the service node a first usage report comprising charging indicators related to the invocation of the constituent service. The processing unit is adapted to process the first usage report. The receiving unit is further adapted to receive from the control unit control information indicating that the invocation of the constituent service is associated to the invocation of the composite service. The processing unit is further adapted to process the control information. The charging information handling unit is adapted to change the charging indicators comprised in the first usage report according to the control information and to generate a further usage report based on the changed charging indicators. The processing unit is further adapted to initiate a transmission via the transmission unit of the further usage report to the charging system to instruct the charging system to perform the charging according to the further usage report.

The invention furthermore concerns a computer program loadable into a processing unit of an interface node to perform any of the steps of the aforementioned methods when operated at the interface node. The computer program can be stored on a computer readable medium. The computer readable medium can be a permanent or rewritable memory within the interface node or located externally. The computer program can be also transferred to the interface node for example via a cable or a wireless link as a sequence of signals.

In the following detailed embodiments of the present invention shall be described in order to give the skilled person a full and complete understanding. However these embodiments are illustrative and are not intended to be limiting.

The service nodes and can be any nodes of the telecommunications network that deliver services to end users or user terminals respectively for example application servers. An application server is a server that hosts an API Application Programming Interface to expose services for use by other applications. During or after the execution of a service the service nodes and may generate a usage report related to the service invocation of the service. The usage report may comprise charging indicators which are indications of the service invocation for example a service identifier identification of the end user date and time of the service invocation duration of the service invocation amount of exchanged data between the user terminal and the network during the service invocation provided quality of service for the service invocation. The usage report forms the base for charging the end user for the service. Further details and examples of the usage report are described with reference to and

The control node is preferably a service composition entity and as such can be regarded as a service node that provides a service by combining other services. The constituent services forming such a composite service might be services provided by the control node itself or they could be services provided by other service nodes such as service nodes and . In the latter case the control node controls the selection and invocation of services at other service nodes according to the definition of the composite service.

The charging system can be any arrangement that is responsible for the actual charging of the end users according to the provided services. The charging system is able to receive and analyse usage reports generated by the service nodes and . Based on the usage report related to the invocation of a service the charging system determines an appropriate tariff and calculates the costs for the end user. The charging system is able to send a reply back towards the service nodes and in order to inform the service nodes and about the result of the charging. For example the charging system may inform the service nodes and that the balance of the user account of the end user requesting a service is sufficient or not in view of the costs of the usage of the service. The service nodes and may in response decide to continue respectively stop the execution of the invoked service.

The interface node can be any node of the telecommunications system capable of communicating with the service nodes control nodes and the charging system. Its task is to control and influence the charging of services provided by the service nodes and and the charging of composite services provided by the control node . In an embodiment the interface node intercepts evaluates and changes the communication i.e. the usage reports and the corresponding replies between the service nodes and and the charging system . The communication may be changed according to logic for controlling the charging. Detailed embodiments are provided with reference to and

In an embodiment the interface node comprises a mapping table which stores and executes the logic for controlling the charging. Detailed examples of a mapping table are provided in Tables 1 and 2 in connection to the embodiments described with reference to and

In step user terminal UT starting a session sends a message to the control node CN thereby requesting a service within the session. The message sent by the user terminal UT may be a Session Initiation Protocol SIP Invite message. The control node CN initiates in response an invocation of the requested service by way of example a composite service named service C consisting of a constituent service named service A. According to this exemplary embodiment service A resides in the service node SN. In step the control node CN invokes as part of composite service C an instance of service A on the service node SN for example by sending a SIP Invite message to the service node SN. In step the service node SN sends a message to acknowledge the invocation of an instance of service A to the control node CN. The message comprises a service identifier of the instance of service A. The message may be an appropriate SIP message. In step the control node CN informs the interface node IN of the invocation of service A in the context of composite service C by sending control information related to the service invocation of service A. The control information indicates to the interface node IN that the service invocation of the constituent service A is associated to the invocation of the composite service C. The control information comprises the service identifier of the instance of service A as sent in step from the service node SN to the control node CN.

The control information indicating that a service for example service A is invoked as part of a composite service for example service C may have the following format 

The interface node IN receives the control information from the control node CN preferably over a dedicated control interface between the control node CN and the interface node IN using XML Extensible Markup Language .

During or after the execution of service A the service node SN generates a usage report related to the service invocation of service A. As explained above the usage report may comprise charging indicators which are indications of the service invocation for example a service identifier and other particulars of the service invocation. In step the service node SN sends the usage report related to service A towards the charging system CS either in one message or distributed over a plurality of messages. The interface node IN intercepts the usage report before it arrives at the charging system CS. The interface node IN analyses the usage report and then determines if the service invocation of service A occurred in the context of a composite service or as a single service invocation. If a service invocation relates to a composite service the charging of the service invocation may be treated differently.

The determination whether the service invocation of service A is related to a composite service or not is based on the control information related to the composite service that was received by the interface node IN in step . According to the control information of this exemplary embodiment service A is indeed invoked as part of a composite service C. In step the interface node requests the control node CN for further control information providing instructions as to how to modify the charging indicators in the usage report generated by the service node SN in order to influence the charging of the service invocation performed by the charging system CS. In step the control node CN sends the further control information. Alternatively the control information sent in step may already comprise the instructions in which case steps and are obsolete. According to a further embodiment the control information sent in step may be sent in combination with the control information in step making step obsolete.

The control information indicating the instructions for changing the charging indicators in the usage report may be implemented in the interface node IN as a mapping table . The mapping table provides a translation from an incoming message or event e.g. a usage report corning from the service node or control information received from the control node CN to the application of a procedure or action e.g. modifying the incoming message and sending it to the charging system CS or logging of events or incoming messages. An example of entries of a mapping table is given in Table 1 

According to the example of Table 1 the interface node IN obtains control information indicating that the service invocation of service A relates to a composite service C and that in the context of the composite service C service A should be charged as service X. The charging system CS comprises data and logic for the charging of service X. In step the interface node IN adapts the usage report received from the service node SN such that it reflects that the service invocation relates to service X e.g. by modifying the name of the invoked service and the service identifier of the invoked service as is specified in the first row of Table 1 i.e. replace the service name Service A by Service X and replace the service identifier of service A by a service identifier of service X. In addition but not depicted in Table 1 the interface node IN may log an indication that service A has been invoked in the context of a composite service C for future reference.

In step the adapted usage report is sent to the charging system CS effecting that charging is applied by the charging system CS for service X. Hence the interface node IN has taken control of the charging of the service invocation of service A as part of composite service C and thereby effected that a different charging tariff is applied for service A in this context without necessitating modifications to the logic and data of the charging system CS. Optionally the charging system CS sends in response a reply message comprising instructions related to the charging in step . For example the charging system CS may indicate in its reply message that the service is allowed to be continued or alternatively that the service should be denied in view of the balance of the account of the end user. In step the interface node IN processes the reply message according to a corresponding instruction indicated by the control information for example as indicated by the entry of the mapping table depicted in the second row of Table 1. As a result the interface node IN restores the service name and service identifier of service A replaces the service name and the service identifier of service X in the reply message with the service identifier of service A and sends the modified reply message to the service node SN in step . This has the effect that the interface node IN controls the messages coming from the charging system CS and that the service node SN receives information which is in accordance with its own knowledge of the invoked services.

In alternative embodiment and not depicted in the interface node IN may inform the control node CN about the usage report received from the service node SN and the applied instructions in response by sending a report to the control node CN comprising an indication of the usage report received from the service node SN and an indication of the adapted usage report sent to the charging system CS.

Referring to an alternative sequence diagram of messages exchanged in an arrangement of nodes in telecommunications network is provided. The arrangement is similar to the arrangement shown under but additionally comprises a second service node. Depicted are a user terminal UT a first service node SN a second service node SN a control node SN an interface node IN and a charging system CS. According to this exemplary embodiment a composite service named service C is invoked comprising a first constituent service named service A and a second constituent service named service B. Service A resides on the first service node SN and service B resides on the second service node SN.

In step a user terminal UT starting a session sends a message to the control node CN thereby requesting a service within the session. The message sent by the user terminal UT may be a Session Initiation Protocol SIP Invite message. The control node CN initiates in response an invocation of the requested service which is the composite service named service C consisting of the constituent services service A and service B. In step the control node CN invokes as part of composite service C an instance of service A on the service node SN for example by sending a SIP Invite message to the service node SN. In step the service node SN sends a message to acknowledge the invocation of an instance of service A to the control node CN. The message comprises a service identifier of the instance of service A. The message may be any appropriate SIP message. In step the control node CN sends control information related to the service invocation to the interface node IN. The control information indicates to the interface node IN that the service invocation of service A is related to a composite service C. The control information may have the following format 

Furthermore the control information sent in step comprises an indication of instructions for processing the usage report generated by the service node SN in relation to the invocation of service A. The instructions are stored in the mapping table of the interface node IN and are similar to the exemplary entries in the mapping table depicted in Table 1 with reference to

The information in the first row in Table 1 indicates to the interface node IN that the service invocation of service A with the specified service identifier relates to a composite service C and that in the context of a composite service service A should be charged as service X. The charging system CS comprises data and logic for the charging of service X.

In step the service node SN sends a usage report comprising charging indicators related to the invocation of service A towards the charging system CS. The usage report is intercepted by the interface node IN. In step the interface node IN processes the usage report in accordance with the control information received from the control node CN. In this example the interface node IN adapts the usage report received from the service node SN in step such that it reflects that the service invocation relates to service X. The interface node IN may do this by modifying the name of the invoked service and the service identifier of the invoked service as is specified in the first row of Table 2 i.e. replace the service name Service A by Service X and replace the service identifier of service A by a service identifier of service X. In step the adapted usage report is sent to the charging system CS effecting that charging is applied by the charging system CS for service X.

Optionally and not depicted in the charging system CS may send in response a reply message which may be processed by the interface node IN as explained with reference to the example of and in accordance with the instructions specified by the second row of Table 1.

In step the control node CN invokes as a further part of composite service C an instance of service B on the service node SN for example by sending a SIP Invite message to the service node SN. In step the service node SN sends a message to acknowledge the invocation of an instance of service B to the control node CN. The message comprises a service identifier of the instance of service B. The message may be an appropriate SIP message. In step the control node CN sends control information related to the service invocation to the interface node IN. The control information indicates to the interface node IN that the service invocation of service B is related to the composite service C. The control information includes the service identifier of the instance of service B as sent by the service node SN in steps . The control information may have the following format 

The mapping table of the interface node IN is updated accordingly. Furthermore the control information sent in step comprises an indication of instructions for changing the charging indicators in the usage report generated by the service node SN in relation to the invocation of service B. The instructions are stored in the mapping table of the interface node IN. Exemplary entries are depicted in Table 2.

The service node SN generates a usage report related to the service invocation of service B and in step the service node SN send the usage report towards the charging system CS. The usage report is intercepted by the interface node IN. In step the interface node processes the usage report in accordance with the control information received from the control node CN.

In this example and as specified in the second row of Table 2 the interface node IN forwards in step the usage report related to the service invocation of service B unchanged to the charging system. Additionally the interface node IN issues a further usage report for a service Y and sends it to the charging system CS in step . The charging system CS comprises data and logic for the charging of service Y. The purpose of service Y is to apply additional charges or refunds to the charging of service B effecting a different charging for the use of service B as part of a composite service C compared to the use of service B as a single service.

The fourth and fifth rows in Table 2 specify examples for processing by the interface node IN of the reply messages sent by the charging system CS for service B and service Y in steps and respectively. The specified action is to apply policies in order to co ordinate the separate reply messages. For example the charging system CS may indicate in its reply message for service B that service B is denied for the end user whereas it may indicate in its reply message for service Y that it is allowed to be provided.

The policies of above example entail that the reply regarding service B from the charging system CS is ignored and only the reply of the charging system CS for service Y is considered. When preparing the reply for service B to be sent to the service node SN the decision related to service Y is copied into the message for service B. This implies that the sending of the message to the service node SN needs to wait until both replies are available.

In step the interface node IN processes the reply messages according to above exemplary policies and sends the resulting modified reply message to the service node SN in step .

In a first step the interface node receives from a service node a first usage report comprising charging indicators related to the invocation of the constituent service.

In a second step the interface node receives control information related to the composite service. The control information indicates that the invocation of the constituent service is associated to the invocation of the composite service. The control information may be received from a control node.

In a third step the interface node generates a further usage report by changing the charging indicators according to the control information.

In a fourth step the interface node sends the further usage report to a charging system to instruct the charging system to perform the charging according to the further usage report.

In an embodiment the control information further indicates instructions for changing the charging indicators.

In an embodiment the charging indicators comprise a service identifier identifying the constituent service.

In an embodiment the instructions for changing the charging indicators comprise replacing the service identifier identifying the constituent service by a service identifier identifying a further constituent service. This has the effect that a further constituent service is reported to the charging system instead of or in addition to the originally invoked constituent service. The charging system processes the charging indicators related to the further constituent service and hence performs a charging according to this further constituent service effecting a different charging.

Advantageously the interface node is now enabled to synchronize the information about the invoked constituent service as known to the charging system indicated by the further usage report with the information about the invoked constituent service as known to the service node and indicated in the first usage report. The interface node may for example restore service identifiers from the first usage report and include them in the reply from the charging system before sending the reply to the service node. Any errors based on a mismatch of information communicated between the service node and the charging system such as a service identifier or a service name when processing the reply message from the charging system by the service node are avoided.

In a further embodiment the reply message instructs the service node to stop or to continue the constituent service depending on the control information.

In an embodiment the interface node sends a report to the control node comprising an indication of the first usage report received from the service node and an indication of the further usage report. This has the advantage that the control node is enabled to keep a log of exchanged usage reports for optimizing future control information.

An interface node may be a stand alone device. However it is also conceivable that an interface node is operating at a control node e.g. as a hardware and or software sub unit of the control node. The interface node may be installed and operated at the control node sharing none of the units RU TU PU SU with the control node or sharing at least one of the units RU TU PU SU with units of the control node.

The processing unit PU may be adapted to process a first usage report comprising charging indicators related to the invocation of the constituent service received via the receiving unit RU from the service node. Furthermore the processing unit PU may be adapted to process control information indicating that the invocation of the constituent service is associated to the invocation of the composite service received via the receiving unit RU from the control node. The charging information handling unit CU may be adapted to change the charging indicators comprised in the first usage report according to the control information and to generate a further usage report based on the changed charging indicators. The processing unit PU may be adapted to initiate a transmission via the transmission unit TU of the further usage report to the charging system to instruct the charging system to perform the charging according to the further usage report.

In an embodiment the control information further indicates instructions for changing the charging indicators. The processing unit PU may be adapted to process the instructions for changing the charging indicators. In particular the processing unit PU may be adapted to extract the instructions for changing the charging indicators from the usage report. In addition the charging information handling unit CU may be adapted to change the charging indicators based on the instructions.

In an embodiment the charging indicators comprise a service identifier identifying the constituent service. The processing unit PU may be adapted to process the service identifier. In particular the processing unit PU may be adapted to extract the service identifier from the usage report.

In an embodiment the instructions for changing the charging indicators comprise replacing the service identifier identifying the constituent service by a service identifier identifying a further constituent service.

In an embodiment the processing unit PU may be adapted to process a reply message based on the charging according to the further usage report received via the receiving unit RU from the charging system. In an even further embodiment the control information indicates instructions for changing the reply message. The charging information handling unit CU may be adapted to adapt the reply message based on the instructions for changing the reply message indicated by the control information. Furthermore the processing unit PU may be adapted to initiate a transmission via the transmission unit TU of the adapted reply message to the service node.

In an embodiment the reply message instructs the service node to stop or to continue the constituent service depending on the control information.

In an embodiment the processing unit PU may be adapted to initiate a transmission via the transmission unit TU of a report to the control node comprising an indication of the first usage report received from the service node and an indication of the further usage report.

In an embodiment the processing unit PU comprises a mapping table for storing the instructions indicated by the control information.

The invention may be implemented in any telecommunication network like a GSM Code Division Multiple Access CDMA Time Division Multiple Access TDMA Universal Mobile Telecommunication System UMTS or a 4Generation 4G network.

