---

title: Method of processing waveform data from one or more channels using a test and measurement instrument
abstract: The method of processing waveform data from one or more channels using a test and measurement instrument, such as an oscilloscope, is described in which waveform data is collected from a DUT; defining a context is defined by instructing the instrument to obtain the focus of each waveform datum having a first user-defined attribute; defining a selection criteria by instructing the instrument to obtain the focus of each waveform datum having both a first user-defined attribute and a second user-defined attribute; and defining an action by instructing the instrument to perform an operation responsive to finding at least one waveform datum having both the first user-defined attribute and the second user-defined attribute.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08055464&OS=08055464&RS=08055464
owner: Tektronix, Inc.
number: 08055464
owner_city: Beaverton
owner_country: US
publication_date: 20080908
---
The present invention relates to a method of processing waveform data from one or more channels using a test and measurement instrument for use in connection with analyzing waveforms. The method of processing waveform data from one or more channels using a test and measurement instrument has particular utility in connection with providing a query language to facilitate analysis and display of large quantities of waveform data as well as complex waveforms.

Methods of processing waveform data from one or more channels using a test and measurement instrument are desirable for providing a query language to facilitate analysis and display of large quantities of waveform data as well as complex waveforms. Currently in order to perform analysis on a test and measurement instrument users have to work with an entire record. Records consist of a series of measurements made over time typically of voltage. Record lengths are increasing because many serial digital signals are in use such as those utilized by the Serial Advanced Technology Attachment SATA computer bus. The SATA computer bus is designed for transferring data between a computer and mass storage devices.

To prevent noise from causing significant interference with the data signal at the high transmission speeds of SATA systems differential signaling is used to make it easy to filter out the noise from the data signal at the receiving end. However the waveforms of such systems are difficult to analyze because jitter in the signal is present to reduce the noise interference. In order to remove the jitter from the signal a large amount of data must be collected so that linear regression can be performed to obtain start and stop points and then a low pass filter can be used to eliminate the jitter. Although these operations eliminate the jitter the long record makes it very difficult for users to sort through the captured data to find areas of interest. With longer waveforms it is more difficult for users to see cause and effect in serial data.

Although analyzing serial digital signals is increasingly important current test and measurement instruments do not make it easy for users to analyze such signals. Currently available test and measurement instruments provide either a very limited math subsystem that can work only on an entire record or require users to write code in a programming language running on an existing math engine to perform complex analyses. Neither of these approaches makes it easy to find abnormalities because users cannot evaluate only a portion of the waveform. Furthermore math is not a very expressive way to interact with long waveforms and general purpose programming languages introduce a large barrier for many users of test and measurement instruments.

Existing high end oscilloscopes such as those currently manufactured by Tektronix Inc. already incorporate a search mark capability to mark foci automatically on a waveform matching a user defined event. A user can subsequently navigate through these marks to inspect the waveform in identified foci. However the types of events users can specify are very limited.

The use of query languages is known in the prior art. For example Structured Query Language SQL is the predominant approach used to interact with databases. SQL is a standard interactive and programming language for querying and modifying data and managing databases. SQL is designed for a specific purpose to query data contained in a relational database. Although SQL is not as powerful as directly manipulating the database with a native programming Application Programming Interface API it is nonetheless very useful and easy to learn. Data analysis in a test and measurement instrument could be greatly simplified and generalized by using a query language. However the underlying data type in most oscilloscopes is some form of digitized waveform. This data type does not lend itself to being manipulated using the same access model as SQL. Therefore a novel method of modeling waveforms so that an expressive query language can be defined for generalized analysis is required.

Therefore a need exists for a new and improved method of processing waveform data from one or more channels using a test and measurement instrument that can be used for providing a query language to facilitate analysis and display of large quantities of waveform data as well as complex waveforms. In this regard the various embodiments of the present invention substantially fulfill at least some of these needs. In this respect the method of processing waveform data from one or more channels using a test and measurement instrument according to the present invention substantially departs from the conventional concepts and designs of the prior art and in doing so provides an apparatus primarily developed for the purpose of providing a query language to facilitate analysis and display of large quantities of waveform data as well as complex waveforms.

The present invention provides an improved method of processing waveform data from one or more channels using a test and measurement instrument and overcomes the above mentioned disadvantages and drawbacks of the prior art. As such the general purpose of the present invention which will be described subsequently in greater detail is to provide an improved method of processing waveform data from one or more channels using a test and measurement instrument that has all the advantages of the prior art mentioned above.

To attain this the preferred embodiment of the present invention essentially comprises the steps of providing a test and measurement instrument attaching the test and measurement instrument to a Device Under Test DUT to be measured collecting waveform data comprising at least one waveform datum from the DUT each waveform datum having an amplitude and a position in horizontal units defining its focus defining a context by instructing the test and measurement instrument to obtain the focus of each waveform datum having a first user defined attribute wherein the attribute is a characteristic of the waveform datum s focus and or amplitude defining a selection criteria by instructing the test and measurement instrument to obtain the focus of each waveform datum having both a first user defined attribute and a second user defined attribute wherein the attributes are a characteristic of the waveform datum s focus and or amplitude and defining an action by instructing the test and measurement instrument to perform an operation responsive to finding at least one waveform datum having both the first user defined attribute and the second user defined attribute. The test and measurement instrument may be an oscilloscope. Contexts selection criteria and actions may be defined by providing the test and measurement instrument with a command written in any waveform query language. There are of course additional features of the invention that will be described hereinafter and which will form the subject matter of the claims attached.

There has thus been outlined rather broadly the more important features of the invention in order that the detailed description thereof that follows may be better understood and in order that the present contribution to the art may be better appreciated.

A preferred embodiment of the method of processing waveform data from one or more channels using a test and measurement instrument is shown and generally designated by the reference numeral .

The principles of the present invention are applicable to a variety of computer hardware and software configurations. The term computer hardware or hardware as used herein refers to any machine or apparatus that is capable of accepting performing logic operations on storing or displaying data and includes without limitation processors and memory the term computer software or software refers to any set of instructions operable to cause computer hardware to perform an operation. A computer as that term is used herein includes without limitation any useful combination of hardware and software and a computer program or program includes without limitation any software operable to cause computer hardware to accept perform logic operations on store or display data. A computer program may and often is comprised of a plurality of smaller programming units including without limitation subroutines modules functions methods and procedures. Thus the functions of the present invention may be distributed among a plurality of computers and computer programs. The invention is described best though as a single computer program that configures and enables one or more general purpose computers to implement the novel aspects of the invention.

The present invention provides a method of decomposing a larger waveform into smaller pieces and then qualifying which pieces are used in further analysis. A context is used to allow the user to specify a set of regions in a larger waveform that are of interest. A context is simply a set of rules that allow the waveforms be divided into sets. The context must have some meaning to the user. For example Period could be the high level name for a context that defined a region between a rising edge and the next rising edge of a waveform.

Once a set of regions is identified that meets the context s criteria those areas can be subjected to further analysis. Examples of further analysis that could be directed by the query language could include 

The query language relies upon a syntax consisting of an Action a Context and a Selection Criteria. For example to mark all of the rising edges less than 200 ns on a waveform collected by Channel the user would create the query mark CH.Edge when CH.Rise

The Context and the Selection Criteria together define a selection list that the Action is performed on. Using this style of syntax queries that are more complex can be expressed. For example the following query selects only Periods where both of the specified criteria are met mark CH.Period When CH.Rise210 ns.

This technique can also be used with protocol decoding the specified context. For example the selection list in the following returns only the TCP IP packets where Channel to Channel crosstalk is greater than 2.5 dB mark CH.TCPIP.Packet when CH CH .Crosstalk 2.5 dB.

Contexts are simply a set of foci and widths on a waveform. Contexts are defined either programmatically as part of the underlying waveform query engine or as part of the query language. For example consider which illustrates some common features of a waveform. In a Period is defined as a context from one rising midpoint to the next rising midpoint. The small number of context definitions in can easily be defined programmatically in the underlying query engine.

Several possible contexts are easily identified in . For example a waveform segment between 10 and 90 or 90 and 10 is an Edge. Each Edge has a crossing that is the focus of interest. An Edge that is moving up as a Rising Edge and one that is moving down as a Falling Edge. A Period is a context from the crossing of one Rising Edge to the crossing on the next Rising Edge. This implies that besides having a Start and End focus a context can have additional properties.

Some contexts will want to define their own properties. For example an Edge context will probably want to define a property for direction.

Contexts can also be defined in the query language itself It is possible to define a small number of built in contexts programmatically. From those built in contexts it is possible to build more complicated contexts using the query language. For example 

This example of a Period context definition works because a context is defined by moving through the waveform in ascending order on the horizontal axis. As referenced contexts Edge in this example are encountered it is given an occurrence value. The first Edge has a value of 1 the second of 2 and so on. Each time the Period context definition is evaluated the occurrence variable is set. By default referring to x.Edge is equivalent to x.Edge occurrence . This example could be rewritten as 

This definition says that a period starts with a rising Edge and ends at the next rising Edge. Note that the to language construct defines the Start and End foci. If no additional focus is provided then Start is used. By default the Start point is included in the context but the End point is excluded for selection purposes. This means that a query such as Mark CH.Period when CH.Rise 200 ns will only include the first Rise in the selection criterion. This can be overridden in the definition of a context by saying 

A waveform may have zero or more contexts that match a specific context definition. For example the Period context for the waveform depicted in would have three occurrences of contexts that match the Period definition.

Specifying a context in a waveform query implicitly returns a list of all contexts foci and widths that match the context definition. For example the following query would return all periods and mark them on the screen mark Ch.Period.

A selection criterion refines that set into a smaller set that contains specific information that the user is interested in. For example the query mark CH.Period when CH.Fall 200 ns would consider only CH period contexts. It would then check the fall time within those contexts for values greater than 200 ns. In this example the selection list will only have one period in it that is a Period occurrence 2 see .

Compound selection criteria using the And Boolean expression imply that all context selections must be met for a context to be selected. For example mark CH.Period when CH.Rise212 ns would only return a set of Periods where both conditions are met.

A compound selection using the Or Boolean expression returns a set of contexts where either is true. For example mark CH.Period when CH.Rise212 ns.

A compound selection containing a Not Boolean operation performs a logical inversion. For example mark CH.Period when Not CH.Rise212 ns returns the set of all Periods that are do not meet the selection criterion.

Many selection criteria expressions are built using context definitions. For example the query mark CH.Period when CH.Rise212 ns uses the context definition of CH.Rise and CH.Fall. For the selection to be return true the following must be true 

As mentioned earlier by default a context returns its Width if no specific property is referenced. This means the selection criterion CH.Rise212 ns is equivalent to CH.Rise.Width212 ns.

Not all selection criteria will include just contexts. It is also desirable to include measurements. For example a user might want to find all periods whose Root Mean Square RMS is greater than 17.8. This could be defined in the following query mark CH.Period when CH.RMS 17.8.

Since RMS is a measurement rather than a query there is an implied gate for the measurement. This gate is simply the Start and End positions for the context which is CH.Period in this case. This allows for some very expressive queries. For example a user might want to perform the following query mark CH.Edge when CH CH .Crosstalk is 2.5 db. . shows how the measurements are gated and applied to the context defined in this query.

Math is referred to as types of computations where one or more waveforms are input and one more waveforms are output. For example Math CH CH. Any math operation built into the test and measurement instrument could be used in a query. For example Mark CH.Period when CH CH .Rise 200 ns. The actions performed on the result of a math operation are equivalent to the result if the same waveform was available as a channel.

In addition to a mark action the query language defines a number of additional actions that can be performed on a set of selected contexts. These include 

Oscilloscopes are excellent for helping to seeing physical layer behavior in parallel or serial buses. In the past oscilloscopes have not been good at relating with data at a protocol level. Currently available oscilloscopes now support decoding several slow speed serial buses. Using protocol decoding to add context and data information to the query language is very useful. For example Mark CH.TCPIP.Packet when CH.TCPIP.Destination.Port 80 And CH CH .Crosstalk 2.5 db.

This query retrieves all contexts that are a TCP IP packet and where the destination port is 80 and the crosstalk between CH and CH is greater than 2.5 db. This query implies that just like in previous examples decoded protocols can be defined as contexts. It also implies that a decoded protocol may also include Fields that can be used to extract the underlying value in the decoded protocol. The fields can be used in the selection criterion expression to help reduce the packets to ones that the user cares about. Notice in this example that both protocol specific fields and physical layer measurements can be mixed to return a meaningful result.

Configuring custom measurements is an essential feature of any analysis done on test and measurement signals. The query engine allows the configuration of key calculation elements using a generalized extension. For example consider the following query 

However without changing the query it is possible to change different aspects of the underlying calculations. For example the query 

It is useful to be able to use the query language with decoded protocols. This is handled by specifying the supported protocol as part of the name of the operation to be handled. For example here are 8b10b protocol support examples 

Protocol decoded queries can use protocol regular expressions. For example Match source.8b10b.symbols pattern K28.5 D10.2 D10.2 D27.3

Waveform Databases are a way to visualize issues with large waveforms. Typically these are thought of as Real Time Eye diagrams. However Real Time Eye diagrams are simply a Waveform Database of bits. There are many other useful ways to visualize data rather than just using bits.

There are several setting items that may need to be controlled when creating a Waveform Database. These items are 

There are many useful operations that can be made on a waveform database. This includes mask testing histogram operations and visualization.

The following in an example DisplayPort preemphasis test made using waveform database results followed by multiple histogram operations 

Qualifier windows are useful for filtering using analog information. For example it is often necessary in protocol analysis to filter bit patterns such that the first bit in the bit pattern is a transition bit. This is easy to do with a qualifier window. Here s an example 

Masks are used in test and measurement instruments to look for violations of a specification. Masks enable users to evaluate the analog quality of their digital signals. Unlike Qualifier windows masks are not just rectangles but define polygons as inclusive or exclusive regions. Masks can be applied to waveform databases to return pass fail or hit counts.

If an instrument User Interface displays a Waveform Database that is the result of a query and the user selects a region of that waveform database to explore see it is possible to construct a query automatically that will find all of the elements that intersect with the user box.

To create an expression that will find all of these occurrences in the waveform a user does the following 

Simultaneous and synchronized evaluation of multiple data presentations is becoming more important so that users can see the same data from different perspectives in order to troubleshoot more quickly and effectively. Consequently an alternative implementation of masks has also been developed as part of the current invention. This consists of the simultaneous and synchronized presentation of both an eye diagram mask test and its constituent non overlaid Y T waveform with corresponding unwrapped mask . A Y T waveform where Y is amplitude and T is time enables a user to analyze the time relationship between multiple input signals. The invention s alternative implementation of masks makes it possible for a user to view a problem area on the eye diagram mask test e.g. eye closure which indicates interference amplitude irregularities or timing problems such as jitters depending on the signal that is measured and immediately correlate it to a point in the same data set as a traditional Y T waveform. The user can do this today using a conventional test and measurement instrument but the mask cannot be seen simultaneously in both views of the data.

For example the mask might show a violation in the eye diagram . The user can choose to view the violating section of the record in Y T format . This will allow the user to see the shape of the waveform in Y T format including the same mask that the user was looking at with the eye diagram in . This makes it possible for the user to locate the mask violation easily shown in detail in .

To create a waveform database WaveformDB for the display to overlay the mask a user does the following 

The display renders the WaveformDB and then overlays the Mask using the WfmDBVScale WfmDBHScale values embedded in the WaveformDB.

Mask.Hits . . . this takes in a histogram created by the preceding query overlays the polygons of the mask and sums the number of hits in the histogram for elements contained in the polygon regions of the mask. The mask orients itself on the WaveformDB based on the WfmDBVScale and WfmDBHScale values embedded in the WaveformDB.

The when operation executes the conditional on the right side of the operation for each item on the left side. If the conditional returns true the left side item is retained otherwise it is discarded. In this example the query builds a WaveformDB for each individual time window defined by the keyword current . If there is a mask hit in that time window then that value is retained. This simple example unwraps the mask and returns only the time windows with hits in the mask. Subsequently the query language can be used to place marks that can be navigated through to observe the mask hits.

Unwrapping the mask on the display is accomplished by overlaying the mask with the equivalent information to WfmDBFocus WfmDBOffset at the foci defined using the result from a query such as the one below that was used to create the original overlaid mask. To show mask hits it would also need a WaveformDB for each time window range. This can be calculated in a manner similar to that used to create the original overlaid mask but for the individual time window.

The invention also includes a method of processing waveform data from one or more channels using a test and measurement instrument which is depicted in . The method of processing waveform data from one or more channels using a test and measurement instrument consists of the following steps providing the test and measurement instrument attaching the test and measurement instrument to a device under test collecting waveform data comprising at least one waveform datum from the DUT each waveform datum having an amplitude and a position in horizontal units defining its focus defining a context by providing the test and measurement instrument with a command written in the waveform query language to obtain the focus of each waveform datum having a first user defined attribute wherein the attribute is a characteristic of the waveform datum s focus and or amplitude defining a selection criteria by providing the test and measurement instrument with a command written in the waveform query language to obtain the focus of each waveform datum having both a first user defined attribute and a second user defined attribute wherein the attributes are a characteristic of the waveform datum s focus and or amplitude and defining an action by providing the test and measurement instrument with a command written in the waveform query language to perform an operation responsive to finding at least one waveform datum having both the first user defined attribute and the second user defined attribute .

While current embodiments of the method of processing waveform data from one or more channels using a test and measurement instrument have been described in detail it should be apparent that modifications and variations thereto are possible all of which fall within the true spirit and scope of the invention. With respect to the above description then it is to be realized that the optimum dimensional relationships for the parts of the invention to include variations in size materials shape form function and manner of operation assembly and use are deemed readily apparent and obvious to one skilled in the art and all equivalent relationships to those illustrated in the drawings and described in the specification are intended to be encompassed by the present invention. For example any suitable test and measurement instrument may be used instead of the oscilloscope described.

Therefore the foregoing is considered as illustrative only of the principles of the invention. Further since numerous modifications and changes will readily occur to those skilled in the art it is not desired to limit the invention to the exact construction and operation shown and described and accordingly all suitable modifications and equivalents may be resorted to falling within the scope of the invention.

