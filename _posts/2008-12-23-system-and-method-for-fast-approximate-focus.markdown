---

title: System and method for fast approximate focus
abstract: Fast approximate focus operations providing an approximately focused image that is sufficiently focused to support certain subsequent inspection operations. The operations are particularly advantageous when used to provide images for successive inspection operations that predominate when inspecting planar workpieces. Improved inspection throughput is provided because, in contrast to conventional autofocus operations, the fast approximate focus operations do not acquire an image stack during a run mode as a basis for determining a best focused image. Rather, during learn mode, a representative feature-specific focus curve and a focus threshold value are determined and used during run mode to provide an approximately focused image that reliably supports certain inspection operations. In one embodiment, an acceptable approximately focused inspection image is provided within a limit of two focus adjustment moves that provide two corresponding images. The adjustment moves are based on the representative feature-specific focus curve provided in learn mode.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08111938&OS=08111938&RS=08111938
owner: Mitutoyo Corporation
number: 08111938
owner_city: Kawasaki-shi
owner_country: JP
publication_date: 20081223
---
The invention relates generally to machine vision inspection systems and more particularly to systems and methods for automatically focusing a machine vision inspection system.

Precision machine vision inspection systems or vision systems for short can be utilized to obtain precise dimensional measurements of inspected objects and to inspect various other object characteristics. Such systems may include a computer a camera and optical system and a precision stage that is movable in multiple directions to allow workpiece inspection. One exemplary prior art system that can be characterized as a general purpose off line precision vision system is the commercially available QUICK VISION series of PC based vision systems and QVPAK software available from Mitutoyo America Corporation MAC located in Aurora Ill. The features and operation of the QUICK VISION series of vision systems and the QVPAK software are generally described for example in the 3 published January 2003 and the 3 published September 1996 each of which is hereby incorporated by reference in their entirety. This type of system is able to use a microscope type optical system and move the stage so as to provide inspection images either small or relatively large workpieces at various magnifications.

General purpose precision machine vision inspection systems such as the QUICK VISION system are also generally programmable to provide automated video inspection. Such systems typically include GUI features and predefined image analysis video tools such that operation and programming can be performed by non expert operators. For example U.S. Pat. No. 6 542 180 hereinafter the 180 patent which is incorporated herein by reference in its entirety teaches a vision system that uses automated video inspection.

As taught in the 180 patent automated video inspection metrology instruments generally have a programming capability that allows an automatic inspection event sequence to be defined by the user for each particular workpiece configuration. Such programming can be implemented as text based programming or through a recording mode that progressively learns the inspection event sequence by storing a sequence of machine control instructions corresponding to a sequence of inspection operations performed by a user or through a combination of both methods. Such a recording mode is often referred to as learn mode or training mode. In either technique the machine control instructions are generally stored as a part program that is specific to the particular workpiece configuration and automatically performs a predetermined sequence of inspection operations during a run mode of operation.

In general during a known sequence of autofocus operations the camera moves through a range of positions along a Z axis and captures an image at each position. For each captured image a focus metric is calculated and related to the corresponding position of the camera along the Z axis at the time that the image was captured. One known method of autofocusing is discussed in Robust Autofocusing in Microscopy by Jan Mark Geusebroek and Arnold Smeulders in ISIS Technical Report Series Vol. 17 November 2000 which is incorporated herein by reference in its entirety. In order to determine a Z axis position of the camera that corresponds to an autofocus image the discussed method estimates a position of the camera along a Z axis based on a measured amount of time during which the camera moves from a known original position on the Z axis at a constant velocity along the Z axis until the image is acquired. During the constant velocity motion the autofocus images are captured at 40 ms intervals video rate . The disclosed method teaches that the video hardware captures frames at a fixed rate and that the sampling density of the focusing curve can be influenced by adjusting the stage velocity. Another known autofocus method and apparatus is described in U.S. Pat. No. 5 790 710 hereinafter the 710 patent which is incorporated herein by reference in its entirety. In the 710 patent a piezoelectric positioner is utilized in conjunction with a conventional motor driven motion control system to control the Z axis position motion while acquiring autofocus images. Another improved autofocus system and method is described in U.S. Pat. No. 7 030 351 which is commonly assigned and hereby incorporated by reference in its entirety. In all these cases a relatively large number of images are acquired during run mode as a basis for autofocusing prior to acquiring inspection images. Due to increasing computation speeds computation speeds are becoming less relevant to inspection throughput while the physical movements required for the systems and methods referred to above generally remain as a primary factor limiting inspection throughput. An autofocus system and method that can further improve throughput is desirable.

The present invention is directed to a system and method for providing inspection images at an improved rate. More specifically a system and method are provided for quickly adjusting to acceptable approximate focus positions using a limited amount of physical movement.

This summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This summary is not intended to identify key features of the claimed subject matter nor is it intended to be used as an aid in determining the scope of the claimed subject matter.

In contrast to each of the previously described known systems and methods for performing autofocus operations the present invention provides improved inspection throughput by using fast approximate autofocusing suitable for certain operations in a general purpose precision machine vision inspection system. The terms fast approximate autofocusing and fast approximate focusing are generally used interchangeably herein and may be taken to mean the same thing unless otherwise indicated. Some advantageous features of the methods include that they may be implemented to improve throughput for machines already in the field and that they do not require a special focus sensor. According to one aspect of the invention a general method is provided for implementing fast approximate autofocus operations during learn mode e.g. in one embodiment by training a fast approximate autofocus video tool . In general a set of learn mode operations are provided for determining a representative focus curve and a related focus threshold value given an image of a representative region of interest ROI . In one embodiment learn mode fast approximate autofocus learning or tool training operations include acquiring a representative image of the representative region of interest. The region of interest may be defined using a video tool user interface for example and generally includes a representative feature to be inspected. For the purposes of creating a part program the representative feature represents corresponding features on other workpieces. Then a representative feature specific focus curve is determined for the region of interest ROI . The feature specific focus curve which characterizes image focus for the ROI as a function of the Z coordinate used for imaging may be determined by conventional methods during learn mode. Then a focus threshold value corresponding to a level of approximate focus that is sufficient for supporting the desired feature inspection operations is determined and or learned. In this context learned may mean determined and recorded in some form in a part program e.g. as a video tool parameter as a basis for later automatic inspection of corresponding features. More generally the determined and or learned representative feature specific focus curve data and or the focus threshold value data may be characterized and recorded in any convenient form. In one embodiment the curve data may correspond to a conventional form of a focus curve and the value data may correspond to a standard threshold value. In other embodiments the curve data may correspond to other types of data such as a dense focus curve F Z lookup table coefficients that customize a nominal analytical curve shape a pruned lookup table etc. Similarly in other embodiments the threshold data may correspond to other types of data such as depth of field DOF units that are used cooperatively with the curve data to compute the numerical value at run mode a numerical value computed and stored at learn time a multiplication factor e.g. a fraction for the focus curve peak height etc.

In accordance with another aspect of the invention a general method for implementing fast approximate autofocus operations during run mode e.g. by executing the operations of a fast approximate autofocus video tool is provided. In general a set of run mode operations are provided for employing representative focus curve data and focus threshold value data to confirm or provide a fast approximate focus for an image to be used for inspecting a workpiece feature. In general the representative focus curve data and focus threshold value data will have been previously established for a corresponding feature in a corresponding workpiece such as during a learn mode. Such use of a fast approximate focus provides an acceptable level of accuracy in many applications where the inspection operation does not require accurate Z coordinate data. For example using appropriate image processing various XY edge location measurements may remain relatively accurate and repeatable even when they are determined from an inspection image which includes image blur e.g. an image that is only approximately in focus .

In one embodiment run mode fast approximate autofocus operations include acquiring a first image of the region of interest including the feature to be inspected. Then previously learned representative feature specific focus curve data and focus threshold value data corresponding to the current region of interest and feature to be inspected are accessed. A first image focus value is then determined for the current region of interest and a determination is made as to whether the first image focus value is greater than the focus threshold value. If the first image focus value is greater than the focus threshold value then feature inspection operations are performed in the current image and if not then a Z axis movement is made in a primary adjustment direction for an estimated primary adjustment distance to a peak focus Z height wherein the primary adjustment distance is estimated based on the representative feature specific focus curve data and the first image focus value. At the estimated primary adjustment distance a second image is acquired and a second image focus value is determined for the region of interest. In one embodiment a determination is then made as to whether the second image focus value is worse than the first image focus value. If it is determined that the second image focus value is not worse than the first image focus value then in one embodiment feature inspection operations are performed in the current image. If the second image focus value is worse than the first then a Z axis movement is made in a direction that is opposite to the primary adjustment direction for an estimated secondary adjustment distance to a peak focus Z height wherein the secondary adjustment distance is estimated based on at least one of the primary adjustment distance and the representative feature specific focus curve data. At the estimated secondary adjustment distance a third image is acquired and feature inspection operations are then performed in the current image the third image . In one embodiment the secondary adjustment distance is approximately 2 the primary adjustment distance.

In accordance with another aspect of the invention an augmented implementation of the fast approximate focus learn mode may be utilized. In the augmented implementation a representative workpiece is provided in an operable position for inspection and a first next representative feature to be inspected is positioned in the field of view wherein the representative feature represents corresponding features on other workpieces and an image is acquired. A determination is then made as to whether fast approximate focus will be used e.g. based on user input . If it is determined that fast approximate focus will not be used then other feature inspection operations are defined. If fast approximate focus will be used then a fast approximate autofocus tool is selected e.g. by a user using a graphical user interface . Once the tool is selected it may be used to define a region of interest ROI including the representative feature and a representative feature specific focus curve may be determined for the region of interest ROI as outlined above. Then a focus threshold value corresponding to a level of approximate focus that is sufficient for supporting the desired feature inspection operations is determined. In one embodiment the user may operate the vision machine to provide an image that is defocused to a level they judge to be the worst focus they find acceptable. In one embodiment they determine this subjectively by viewing the image. In another embodiment they determine this by performing inspection operations at varied focus levels and evaluating the accuracy and or repeatability of the results compared to the results from a well focused image. The focus threshold value may alternatively be determined automatically. For example in some embodiments this may be done by determining the focus value that corresponds to a predetermined number of increments of the depth of focus of the current optical system away from the focus peak location on the representative feature specific focus curve. Fast approximate autofocus tool data and or parameters are then recorded including the representative feature specific focus curve data and the focus threshold value data in association with a part program. Next the feature inspection operations which are to be performed in the region of interest are defined. If there are more features to be inspected then the routine is repeated for the next feature. However in an alternative embodiment of the routine operations are included such that if the additional features are substantially similar to the current feature then the operations at block that determine the representative feature specific focus curve and representative focus threshold value are replaced by operations that determine the substantial similarity e.g. based on user input or feature recognition etc. and then reuse the previously determined representative feature specific focus curve and representative focus threshold value that were determined for the substantially similar feature.

In accordance with another aspect of the invention an augmented implementation of fast approximate focus may be used in run mode for example as follows. At the start of run mode a part program is provided along with a workpiece in position for inspection. The part program is started and the first next tool is determined and the first next feature to be inspected is positioned in the field of view. If the fast approximate autofocus tool is being used then representative feature specific focus curve data and focus threshold value data are accessed corresponding to the current feature. A first image is then acquired and a first image focus value is determined in the region of interest defined by the tool and a determination is made as to whether the first image focus value is greater than the focus threshold value. If the first image focus value is greater than the focus threshold value then feature inspection operations are begun. If the first image focus value isn t greater then a primary adjustment distance is estimated to a peak focus Z height based on the representative feature specific focus curve data and the first image focus value. The vision machine is then moved to adjust the Z height by the primary adjustment distance in a primary adjustment direction e.g. to increase Z and thereafter a second image is acquired and a second image focus value is determined for the region of interest. A determination is then made as to whether the second image focus value is greater than the focus threshold value. If the second image focus value is greater than the focus threshold value then feature inspection operations are begun and if it isn t greater then a determination is further made as to whether the second image focus value is greater than the first image focus value. If the second image focus value is greater than the first image focus value then this indicates that the primary adjustment direction was proper but the primary adjustment distance was not. Therefore in one embodiment the fast approximate focus operations call or execute default autofocus operations e.g. conventional operations such as acquiring additional images determining a new focus curve finding its peak etc . Such operations are slower but more robust. In another embodiment the autofocus operations may be terminated and an error indication may be output. In another embodiment one or more additional pre computed adjustments may be performed depending on the shape of the contrast curve. If the second image focus value is not greater than the first image focus value then a secondary adjustment distance is determined and the vision machine is moved in an opposite adjustment direction that is opposite to the primary adjustment direction to adjust the Z height by the secondary adjustment distance. The secondary adjustment distance is determined based on at least one of the primary adjustment distance and the representative feature specific focus curve data. For example in one embodiment the secondary adjustment distance is determined as approximately two times the primary adjustment distance. In another embodiment the secondary adjustment distance is determined independently of the primary adjustment distance but in the same manner. A third image is then acquired and a third image focus value is determined in the region of interest and a determination is made as to whether the third image focus value is greater than the focus threshold value. If the third image focus value is not greater than the focus threshold value then the fast approximate focus operations call or execute default autofocus operations e.g. as described above and if it is greater then feature inspection operations are performed in the current image. In one embodiment the fast approximate focus operations may optionally have an additional aspect wherein under some circumstances the last successful plus or minus Z adjustment direction may be recorded and or used as the primary adjustment direction in a subsequent next instance of performing the fast approximate autofocus operations for a next feature to be inspected. If there are more features to inspect then the routine starts again with the next feature or else the inspection results are stored output and or the part program is ended.

It should be appreciated that performing a subsequent adjustment or search in the same direction as the last previous successful adjustment direction is advantageous when a part that is being inspected is nominally flat or nearly so but is tilted or warped on the stage of the machine vision system. When inspecting an array of features on such parts e.g. printed circuit board holes the slope is likely to be consistent or at least slowly changing such that an a focus adjustment direction that was successful during the inspection of the previous workpiece feature will likely be the correct focus adjustment direction for the next workpiece feature. Therefore this method is likely to improve or maximize throughput when inspecting such workpieces.

The vision measuring machine includes a moveable workpiece stage and an optical imaging system which may include a zoom lens or interchangeable lenses. The zoom lens or interchangeable lenses generally provide various magnifications for the images provided by the optical imaging system . The machine vision inspection system is generally comparable to the QUICK VISION series of vision systems and the QVPAK software discussed above and similar state of the art commercially available precision machine vision inspection systems. The machine vision inspection system is also described in commonly assigned U.S. Pat. No. 7 454 053 which is hereby incorporated herein by reference in its entirety. Various aspects of vision measuring machines and control systems are also described in more detail in copending and commonly assigned U.S. patent application Ser. No. 10 632 823 filed Aug. 4 2003 and U.S. Pat. No. 7 324 682 filed Mar. 25 2004 which are also hereby incorporated herein by reference in their entirety. The fast approximate focus operations disclosed herein can dramatically increase throughput for some applications of machine vision inspection systems. Furthermore the methods may be implemented as an easy to use video tool and or autofocus mode of operation.

A workpiece that is to be imaged using the machine vision inspection system is placed on the workpiece stage . One or more of a stage light a coaxial light and a surface light may emit source light or respectively to illuminate the workpiece . The source light is reflected or transmitted as workpiece light which passes through the interchangeable objective lens and the turret lens assembly and is gathered by the camera system . The image of the workpiece captured by the camera system is output on a signal line to the control system portion . The light sources and may be connected to the control system portion through signal lines or busses and respectively. To alter the image magnification the control system portion may rotate the turret lens assembly along axis to select a turret lens through a signal line or bus .

In various exemplary embodiments the optical assembly portion is movable in the vertical Z axis direction relative to the workpiece stage using a controllable motor that drives an actuator a connecting cable or the like to move the optical assembly portion along the Z axis to change the focus of the image of the workpiece captured by the camera system . The term Z axis as used herein refers to the axis that is intended to be used for focusing the image obtained by the optical assembly portion . The controllable motor when used is connected to the input output interface via a signal line .

As shown in in various exemplary embodiments the control system portion includes a controller an input output interface a memory a workpiece program generator and executor and a power supply portion . Each of these components as well as the additional components described below may be interconnected by one or more data control buses and or application programming interfaces or by direct connections between the various elements.

The input output interface includes an imaging control interface a motion control interface a lighting control interface and a lens control interface . The motion control interface may include a position control element and a speed acceleration control element . However it should be appreciated that in various exemplary embodiments such elements may be merged and or indistinguishable. The lighting control interface includes lighting control elements which control for example the selection power on off switch and strobe pulse timing if applicable for the various corresponding light sources of the machine vision inspection system .

The memory includes an image file memory portion a workpiece program memory portion that may include one or more part programs or the like and a video tool portion . The video tool portion includes tool portion and other similar tool portions not shown which determine the GUI image processing operation etc. for each of the corresponding tools. The video tool portion also includes a region of interest generator that supports automatic semi automatic and or manual operations that define various ROIs that are operable in various video tools included in the video tool portion .

In particular in various embodiments according to this invention the video tool portion includes the autofocus tools portion which provides various operations and features related to autofocus operations as described in greater detail below. In one embodiment the autofocus tools portion may include an autofocus mode control high accuracy autofocus tools and a fast approximate autofocus tool . Briefly the high accuracy autofocus tools may operate similarly to known autofocus tools for example performing operations in learn mode and run mode such as acquiring a current image stack at various Z heights generating all or part of a focus curve and finding its peak as a best focus position that is always customized to the current workpiece feature and operating conditions. The fast approximate autofocus tool operates based on the fast approximate focus methods of the present invention. In contrast to the high accuracy autofocus tools the fast approximate autofocus tool determines a representative focus curve for a particular feature in learn mode and refers that same focus curve data when inspecting a similar particular feature during run mode to avoid the time consuming process of acquiring and analyzing a new image stack in run mode. The autofocus mode control may perform operations as disclosed herein to configure the autofocus tools that is the high accuracy autofocus tools or the fast approximate autofocus tool or tool modes depending on which tool or mode is activated.

The descriptor high accuracy of the autofocus tools is not intended to be limiting it is simply chosen in contrast to the lower focus accuracy of the fast approximate autofocus tool intended to accept somewhat degraded image focus in exchange for higher throughput. The high accuracy autofocus tools generally provide the best focus position which indicate the corresponding surface Z height rather accurately. In contrast the fast approximate autofocus tool utilizes the methods of the present invention to quickly provide an approximately focused image which may reliably support sufficiently accurate X Y edge measurements but is most often not suitable for determining an accurate Z height measurement.

Alternative configurations are possible for the autofocus tools portion . For example the high accuracy autofocus tool and the fast approximate autofocus tool may include partitioned mode control functions such that a separate mode control portion may be omitted. Alternatively the autofocus tools portion may provide one or more generic autofocus tool elements and the mode control portion may provide operations that govern the user interface and interrelationships of the generic autofocus tool elements in a manner that depends on whether high accuracy autofocus tool behavior or fast approximate autofocus tool behavior is desired. In such a case the circuits routines or applications that provide the operations of the high accuracy autofocus tools and or the fast approximate autofocus tool may be merged and or indistinguishable. In certain implementations the autofocus mode control may be utilized to implement a fast approximate autofocus mode as opposed to a separate tool . More generally this invention may be implemented in any now known or later developed form that is operable in conjunction with the machine vision inspection system to provide the features disclosed herein in relation to the fast approximate autofocus operations.

In general the memory portion stores data usable to operate the vision system components portion to capture or acquire an image of the workpiece such that the acquired image of the workpiece has desired image characteristics. The memory portion may also store inspection result data further may store data usable to operate the machine vision inspection system to perform various inspection and measurement operations on the acquired images e.g. implemented in part as video tools either manually or automatically and to output the results through the input output interface . The memory portion may also contain data defining a graphical user interface operable through the input output interface .

The signal lines or busses and of the stage light the coaxial light and the surface light respectively are all connected to the input output interface . The signal line from the camera system and the signal line from the controllable motor are connected to the input output interface . In addition to carrying image data the signal line may carry a signal from the controller that initiates image acquisition.

One or more display devices and one or more input devices can also be connected to the input output interface . The display devices and input devices can be used to display a user interface which may include various graphical user interface GUI features that are usable to perform inspection operations and or to create and or modify part programs to view the images captured by the camera system and or to directly control the vision system components portion . In a fully automated system having a predefined part program or workpiece program the display devices and or the input devices may be omitted.

In various exemplary embodiments when a user utilizes the machine vision inspection system to create a part program for the workpiece the user generates part program instructions either by explicitly coding the instructions automatically semi automatically or manually using a workpiece programming language or by generating the instructions by operating the machine vision inspection system in learn mode to provide a desired image acquisition training sequence. For example a training sequence may comprise positioning a workpiece feature in the field of view FOV setting light levels focusing or autofocusing acquiring an image and providing an inspection training sequence applied to the image e.g. using video tools . Learn mode operates such that the sequence s are the captured and converted to corresponding part program instructions. These instructions when the part program is executed will cause the machine vision inspection system to reproduce the trained image acquisition and inspection operation to automatically inspect a workpiece or workpieces matching the workpiece used when creating the part program.

These analysis and inspection methods that are used to inspected features in a workpiece image are typically embodied in various video tools included in the video tool portion of the memory including the autofocus tools and . Many known video tools or tools for short are included in commercially available machine vision inspection systems such as the QUICK VISION series of vision systems and the associated QVPAK software discussed above.

In the part program inspection sequence flows from left to right as indicated by the arrows starting with the inspection of the workpiece feature A and proceeding subsequently to each of the workpiece features B C and D. For purposes of explanation one may think of a camera moving from left to right across the workpiece and successively acquiring images of the regions of interest of each of the video tools A D as outlined below. The fast autofocus video tools A D govern the focusing operations that are performed in order to acquire acceptable inspection images of the corresponding regions of interest.

As shown in the side view in this example the workpiece is warped relative to a horizontal dashed line that represents a flat and level surface plane of a workpiece that was utilized for creating the part program during learn mode as will be described in more detail below. In general it will be appreciated that certain nominally flat and thin workpiece parts may be relatively easy to deform and or inadvertently tilt on the stage e.g. printed circuit boards large flat panel displays etc . Thus the run mode workpieces may not conform to the shape of the representative workpieces used for training in learn mode. The deformation of the workpiece in is exaggerated in the Z direction for purposes of illustration. In addition a purely schematic representation of the camera has been utilized to emphasize the focusing movements that are described in more detail below.

As shown in the side view for the workpiece feature A the camera is initially set at a nominal Z height A that corresponds to a learned initial focusing position a Z position relative to the flat plane as established during learn mode. It will be appreciated that because the workpiece feature A on the warped surface of the workpiece falls significantly below the flat plane that the nominal Z height A of the camera does not result in an acceptable focus metric value also referred to as a focus value in the ROI as will be described in more detail below. A default primary adjustment direction was initially programmed or established which in this case causes the camera to move upwards by an initial adjustment distance from the Z height A to a Z height A . The initial adjustment distance is an estimated distance from Z height A to a best focus position based on focus curve data determined during learn mode and the current focus value as will be described in more detail below. At the Z height A a new image is acquired and the focus value is again evaluated and is again determined to be not acceptable and further determined to be worse than the first focus value. As a result of this outcome the routine then moves the camera in the opposite direction by an adjustment distance that as before is estimated as the distance to a best focus position e.g. by 2 the distance moved in the initial adjustment direction and a new image is acquired. This adjustment results in the camera being at the Z height A . At the Z height A the camera is below the initially learned and programmed position A just as the workpiece feature A is below the position of its corresponding feature during learn mode. As a result a focus value determined for the ROI in the new current image is determined to be at an acceptable level e.g. as outlined below with reference to and inspection operations e.g. X Y edge location measurement operations are performed in the current image. The part program then moves the camera to the programmed X Y location of the next workpiece feature B. In the fast approximate focus video tool operations embodiment shown in the camera is moved and positioned at the last successful camera Z height that produced an acceptable inspection image i.e. at Z height A overruling any Z height of the feature B that may have been observed or recorded in learn mode. It is advantageous to include this feature in various embodiments of the fast approximate focus video tool operations however it is not strictly required. An image is acquired at the initial Z height B which equals A and the focus value determined in the ROI happens to be acceptable due to the warp of the workpiece which positions the workpiece feature B at approximately at the same height as the workpiece feature A. Inspection operations are performed in the image.

The part program then moves the camera to the programmed X Y location of the next workpiece feature C. As before the camera is moved and positioned at the last successful camera Z height that produced an acceptable inspection image i.e. at Z height B . An image is acquired at the initial Z height C which equals B . Because the workpiece feature C is at a significantly different height than the workpiece feature B and the camera is initially at the same Z height the acquired image is significantly out of focus and does not provide an acceptable focus value in the ROI. In the fast approximate focus video tool operations embodiment shown in if a previous fast approximate focus tool moved to a successful image height the direction of that move is stored and used as the primary adjustment direction for a subsequent instance of fast approximate focus tool. In this example this causes the camera to move downwards by an initial adjustment distance from the Z height C to a Z height C . As with all adjustment distances the initial adjustment distance is an estimated distance from the current Z height A to a best focus position based on focus curve data determined during learn mode and the current focus value as will be described in more detail below. At the Z height C a new image is acquired and the focus value is again evaluated and is again determined to be not acceptable and further determined to be worse than the first focus value. As a result of this outcome the routine then moves the camera in the opposite direction by an adjustment distance that as before is estimated as the distance to a best focus position e.g. by 2 the distance moved in the initial adjustment direction and a new image is acquired. The adjustment results in the camera being positioned at the Z height C . At the Z height C the camera is above the last successful Z height B just as the workpiece feature C is above the position of the previous workpiece feature B. The camera has now followed the local deformation or tilt of the part. As a result a focus value determined for the ROI in the new current image is determined to be at an acceptable level and inspection operations are performed in the current image.

The part program then moves the camera to the programmed X Y location of the next workpiece feature D and at the last successful camera Z height that produced an acceptable inspection image i.e. at Z height C . An image is acquired at the initial Z height D which equals C . Because the workpiece feature D is at a significantly different height than the workpiece feature C the acquired image is significantly out of focus and does not provide an acceptable focus value in the ROI. As previously noted in the fast approximate focus video tool operations embodiment shown in if a previous fast approximate focus tool moved to a successful image height the direction of that move is stored and used as the initial search direction for a subsequent fast approximate focus tool. This is a good strategy for gently warped or tilted surfaces which will generally maintain a consistent slope direction for large portions of the surface which is the case for the current feature . Thus in this example the camera then moves upwards by an initial adjustment distance from the Z height D to a Z height D . The initial adjustment distance is estimated as outlined above. At the Z height D a new image is acquired and the focus value is again evaluated and is determined to be acceptable. At the Z height D the camera is above the last successful Z height C just as the workpiece feature D is above the position of the previous workpiece feature C. The camera has continued to follow the local deformation or tilt of the part. As a result a focus value determined for the ROI in the new current image is determined to be at an acceptable level and inspection operations are performed in the current image.

As is generally known the shape of a focus curve depends on a number of factors such as the type of surface e.g. shape texture etc. the depth of field the size of the region of interest e.g. a larger region of interest may correspond to less noise lighting conditions etc. The focus metric values e.g. normalized contrast values on the Y axis of generally correspond to the quality of the focus of a feature included in the region of interest of a corresponding image. A focus value higher on the Y axis corresponds to better focus. Thus a best focus position corresponds to the peak of the focus curve e.g. the peak focus Z height as will be described in more detail below. A focus curve is often approximately symmetric and resembles a bell curve. In the embodiment reflected in the focus values for the curves and have been ideally normalized i.e. their maxima have been made equal although in practice they would normally differ slightly even after normalization such that they may be compared properly. It will be appreciated that normalization of the full focus curve would not be performed in an actual embodiment because the data of focus curve is not actually acquired in practice it is shown only for purposes of explanation in . However normalizing the first image focus value and other solitary image focus values determined during run mode e.g. by the average grayscale value or average squared grayscale value of the region of interest may generally be done in various embodiments in order to compensate for the effects of factors such as variable lighting conditions surface finish and the like.

As outlined above the learned representative focus curve may be a curve fit to a set of focus value data points determined when training an instance of a fast approximate focus tool during learn mode. In contrast the run mode focus curve is not determined by fast approximate focus operations. However if high accuracy autofocus operations are performed during the run mode the focus curve would result. As will be described in more detail below one important advantage of the fast approximate focus operations of the present invention is that the focus curve is generally not determined which eliminates the time consuming image acquisition operations associated with generating a focus curve. Rather the learned representative focus curve represents or substitutes for the underlying run mode focus curve for the purposes of determining an acceptable approximate focus position.

For purposes of explanation we may consider to depict the basis for certain operations previously described with respect to . For example the learned representative focus curve may correspond to a feature on the flat plane of during learn mode operations. The discrepant e.g. wider run mode focus curve may correspond to the same feature on the warped workpiece during run mode operations feature A in this explanation . Both curves are normalized as previously outlined. The run mode focus curve may be discrepant relative to the learned representative focus curve because the warped workpiece has a slightly different configuration than the flat plane of the learn mode workpiece. Due to such discrepancies the estimated adjustment distances previously described with respect to which are based on the learned representative focus curve will be somewhat incorrect. The estimated adjustment distances will therefore not position the camera precisely at the peak focus Z height . However in embodiments reflected in if the estimated adjustment distance provides an approximately focused Z height that falls between the Z height boundaries the fast approximate focus operations accept this as a sufficient focus level to support the subsequent inspection operations which are to be performed in the corresponding image. Applying the fast approximate focus operations may be particularly advantageous when the subsequent inspection operations are X Y edge detection and related X Y measurement operations. This is because such X Y measurement operations are relatively insensitive to a reasonable amount of image blurring which tends to broaden an edge profile without significantly displacing a central location e.g. a maximum gradient point of the edge profile. Therefore in such cases a fast approximate focus tool or mode may be used to increase inspection throughput without significantly affecting inspection accuracy.

The approximately focused Z height boundaries may be established according to a predetermined value or algorithm included in a fast approximate focus tool or mode and subsequently applied in the part program. In this regard when the approximately focused Z height boundaries are applied to the representative focus curve they can be seen to define a representative focus threshold value at their intersection. As will be described in more detail below the focus threshold value may be utilized to help quickly achieve an acceptable approximate focus while avoiding the time consuming task of determining a run mode focus curve . In various embodiments the Z height boundaries are advantageously set away from the peak focus Z height between 1 and 7 times the known depth of field DOF of the current optical system and more advantageously between 2 7 times the DOF. Z height boundaries set in this way typically define a low enough threshold for the fast approximate focus operations outlined above to identify sufficiently focused images despite the discrepancies between the learn mode and run mode focus curves. At the same time such settings have been shown to define a normalized focus threshold value on a learn mode focus curve that provides a desirable level of X Y measurement accuracy and repeatability for a wide variety of workpieces. However more generally the Z height boundaries may be set at any number of DOFs that reliably provides sufficiently focused images yet allows enough image defocus such that the fast approximate focus operations typically are able to provide an acceptable image that has a focus value above the focus threshold value that corresponds to the Z height boundaries .

The foregoing embodiments are not limiting. For example in some embodiments the corresponding focus threshold value is applied in the part program rather than explicitly using the approximately focused Z height boundaries . In other embodiments other threshold determining methods and or values may be utilized and in certain implementations the focus threshold value may be variable. In certain implementations the focus threshold value may be adjusted slightly based on information gained at run mode.

The following description essentially repeats the previous description of the operations surrounding the feature A of while adding additional explanation in terms of . As shown in in the side view for the workpiece feature A the camera is initially set at a nominal Z height A that corresponds to a learned initial focusing position a Z position relative to the flat plane as established during learn mode. A first image is acquired and a first image focus value is determined for the ROI in that image as represented by the line in . As shown in it will be appreciated that because the configuration of the run mode workpiece is not known the location of the best focus Z height is generally not known and the first image focus value might correspond to either of two candidate Z heights represented by the points A and D. The fast approximate focus methods of the present invention are designed to automatically address both of these cases with very few motions. The description of focus operations in corresponds to the case where the Z height A actually corresponds to the candidate point A. In that case because the workpiece feature A on the warped surface of the workpiece falls significantly below its presumed Z height the height of the flat plane during learn mode as shown in the image at the first Z height A results in the relatively low focus value shown in . Since the focus value is below the representative focus threshold value the focus value is unacceptable and the first image is determined to be an unacceptable inspection image. Therefore the fast approximate focus operations adjust the Z height by moving along an initial or primary adjustment direction that was initially programmed or established for an estimated primary adjustment distance which in this case causes the camera to move upwards by an initial adjustment distance shown in from the Z height A to a Z height A . The estimated primary adjustment distance is an estimated distance from the Z height A to a peak focus Z height based on the representative focus curve determined during learn mode and the current focus value . At the Z height A a second image is acquired and a second focus value A is determined for the ROI.

In this case because the primary adjustment direction was the wrong direction the second focus value A is below the representative focus threshold value and is even worse than the first focus value and the second image is determined to be an unacceptable inspection image. As a result the fast approximate focus operations adjust the Z height by moving from the Z height A along the direction that is opposite to the primary adjustment direction by a secondary adjustment distance to arrive at the Z height A . As before the secondary adjustment distance is an estimated distance to the peak focus Z height from the current Z height. In one embodiment the secondary adjustment distance is estimated simply as two times the distance moved in the primary adjustment direction which should arrive at the peak focus Z height if the focus curve is not discrepant relative to the focus curve and the focus curve is approximately symmetrical. In another embodiment the secondary adjustment distance is based on the representative focus curve as determined during learn mode and the current focus value A which may be advantageous if the focus curve is asymmetrical. In any case at the Z height A a third image is acquired and a third image focus value A is determined for the ROI. In this case because the secondary adjustment direction was the correct direction despite the effects of the discrepant focus curve the third image focus value A is above the representative focus threshold value and the third image is determined to be approximately focused such that it is an acceptable inspection image. It will be appreciated that following the first image acquisition at the current feature to be inspected the fast approximate autofocus operations outlined above require at most two moves along the Z direction in order to provide an acceptable approximately focused inspection image. In comparison to conventional autofocus methods and tools e.g. based on actually determining the run mode focus curve and it peak focus Z height this allows the fast approximate focus operations outlined to increase the inspection throughput significantly e.g. doubling the throughput when repetitively performing compatible inspection operations for a series of features e.g. when measuring the X Y dimensions and locations of printed circuit board or IC elements such as holes feedthroughs connection traces or the like .

The following description may generally be understood to follow the initial sequence of operations outlined above. However the following description corresponds to a hypothetical case where the run mode workpiece does not have the configuration shown in . Rather it has a configuration such that current workpiece feature is positioned significantly above its presumed Z height e.g. due to a warping that is the mirror image of that shown in . As shown in the presumed Z height A is used for the first image acquisition that is the representative feature height during learn mode . This corresponds to the case where the initial Z height A actually corresponds to the candidate point D. As shown in the image at the first Z height A results in the relatively low focus value . Since the focus value is below the representative focus threshold value the focus value is unacceptable and the first image is determined to be an unacceptable inspection image. Therefore the fast approximate focus operations adjust the Z height by moving along the initial or primary adjustment direction that was initially programmed or established for an estimated primary adjustment distance which in this case again causes the camera to move upwards by an initial adjustment distance shown in from the Z height A to a Z height A . The estimated primary adjustment distance is again an estimated distance from the Z height A to the peak focus Z height based on the representative focus curve determined during learn mode and the current focus value . At the Z height A a second image is acquired and a second image focus value D is determined for the ROI. In this case because the primary adjustment direction was the correct direction despite the effects of the discrepant focus curve the second image focus value D is above the representative focus threshold value and the second image is determined to be approximately focused such that it is an acceptable inspection image.

At a block the determined and or learned representative feature specific focus curve data and the focus threshold value data are stored for later use when inspecting corresponding features on other workpieces. In one embodiment the curve data may correspond to a conventional form of a focus curve and the value data may correspond to a standard threshold value as will be described in more detail below. In other embodiments the curve data may correspond to other types of data such as a dense focus curve focus value to Z lookup table coefficients that customize a nominal analytical curve shape a pruned lookup table etc. Similarly in other embodiments the focus threshold value data may correspond to other types of data such as depth of field DOF units that are used cooperatively with the curve data to compute a numerical focus value at run mode a numerical value computed and stored at learn time a multiplication factor e.g. a fraction for the focus curve peak height etc.

As shown in at a block a first image is acquired of the region of interest including the feature to be inspected. At a block previously learned representative feature specific focus curve data and focus threshold value data corresponding to the current region of interest are accessed. At a block a first image focus value in the current region of interest is determined. At a decision block a determination is made as to whether the first image focus value is greater than the focus threshold value. If the first image focus value is not greater than the focus threshold value then the routine continues to a block as will be described in more detail below. If at decision block it is determined that the first image focus value is greater than the focus threshold value then the routine continues to a block where feature inspection operations are performed in the current image.

At the block a movement is made in a primary adjustment direction for an estimated primary adjustment distance to a peak focus Z height wherein the primary adjustment distance is estimated based on the representative feature specific focus curve data and the first image focus value. At a block a second image is acquired and a second image focus value is determined in the region of interest. At a decision block a determination is made as to whether the second image focus value is worse than the first image focus value. If the second image focus value is worse than the first image focus value then the routine continues to a block as will be described in more detail below. If at decision block it is determined that the second image focus value is not worse than the first image focus value then the routine continues to the block where feature inspection operations are performed in the current image. As will be described in more detail below with respect to in other embodiments a fast approximate focus run mode routine may additionally verify that the second image focus value is greater than the focus threshold value before performing the feature inspections in the current image. In other words the routine may be advantageous in a desirable case wherein well controlled workpieces provide a run mode focus curves that are predictably similar to the learned representative focus curve e.g. see examples of such that if a focus value improvement is recognized at decision block since the estimated primary adjustment distance was based on the learned representative focus curve which is assumed to be similar to the run mode focus curve it is further assumed that the resulting Z height is near enough to the peak of the focus curve to be above the focus threshold value.

At the block since the second image focus value was previously determined to be worse than the first image focus value a movement is made in a direction that is opposite to the initial or primary adjustment direction for an estimated secondary adjustment distance to a peak focus Z height wherein the secondary adjustment distance is estimated based on at least one of the primary adjustment distance and the representative feature specific focus curve data in combination with the second image focus value. In one embodiment the estimated secondary adjustment distance may be approximately two times the primary adjustment distance although in the opposite direction. At a block a third image is acquired. At the block feature inspection operations are performed in the current image. As will be described in more detail below with respect to in other embodiments a fast approximate focus run mode routine may additionally verify that the third image focus value is greater than the focus threshold value before performing the feature inspection operations in the third image.

At a block a fast approximate autofocus tool or mode is selected. At a block a region of interest ROI for the representative feature is defined e.g. by configuring a fast approximate autofocus tool widget in a GUI . At a block a representative feature specific focus curve for the region of interest ROI is determined and or learned. The representative feature specific focus curve corresponds to a plurality of images at respective Z height steps between the camera and the representative feature. A focus threshold value defining a sufficient level of focus for inspection operations is also determined and or learned. At a block fast approximate autofocus tool data is stored in association with a part program the tool data including the representative feature specific focus curve data and the focus threshold value data. At a block feature inspection operations are defined. It will be appreciated that when the routine continues from the block to the block that in certain implementations the operation of the block may be used to teach learn inspection operations that would be performed in the approximately focused image that will be provided by the fast approximate autofocus tool during the run mode. In contrast during the learn mode the fast approximate autofocus tool may automatically provide a focused image for the user to use for block operations in that it will have just recently performed operations to characterize the full focus curve such that when it is complete it can make a movement to provide the best focused image. It will be appreciated that more complex versions of the fast approximate autofocus tool with additional potential learn mode operations may also be provided.

Returning to at a decision block a determination is made as to whether there are more features to be inspected. If there are more features to be inspected then the routine returns to the block . If at decision block it is determined that there are no more features to be inspected then the routine continues to a block where the part program is stored which may optionally end the learn mode. It will be appreciated that certain of the steps of the routine may be considered to expand the generic operations of the more general routine of . More specifically the routine may in certain embodiments be considered to implement and or expand the generic operations of the routine in the context of training a fast approximate focus video tool in learn mode and places it in the context of training repeated instances of the tool which in certain instances may be interspersed in learn mode with the training of other types of tools e.g. as illustrated by the user decision required at the decision block the user s selection of a fast approximate focus tool at the block and the potential user operations at the block .

At a decision block a determination is made as to whether the fast approximate autofocus tool is being used. If the fast approximate autofocus tool is being used then the routine continues to a block as will be described in more detail below. If at decision block it is determined that the fast approximate autofocus tool is not being used then the routine continues to a point A which continues at a block in as will be described in more detail below.

At a block representative feature specific focus curve data and focus threshold value data are accessed corresponding to the current feature. At a block a first image is acquired and a first image focus value is determined in the region of interest. At a decision block a determination is made as to whether the first image focus value is greater than the focus threshold value. If the first image focus value is not greater than the focus threshold value then the routine continues to a block as will be described in more detail below. If at decision block it is determined that the first image focus value is greater than the focus threshold value then the routine continues to a point B which continues at a block in as will be described in more detail below.

At a block a primary adjustment distance is estimated to a peak focus Z height based on the representative feature specific focus curve data and the first image focus value. At a block the Z height is adjusted by moving the estimated primary adjustment distance in a primary adjustment direction. At a block a second image is acquired and a second image focus value is determined in the region of interest.

At a decision block a determination is made as to whether the second image focus value is greater than the focus threshold value. If the second image focus value is not greater than the focus threshold value then the routine continues to a decision block as will be described in more detail below. If at decision block it is determined that the second image focus value is greater than the focus threshold value then the routine continues to the point B which continues at the block in as will be described in more detail below.

At a decision block a determination is made as to whether the second image focus value is greater than the first image focus value. If the second image focus value is not greater than the first image focus value then the routine continues to a point C which continues at a block in as will be described in more detail below. If at decision block it is determined that the second image focus value is greater than the first image focus value then the routine continues to the point A which continues at the block in as will be described in more detail below.

As shown in at a block which continues from point C of the Z height is adjusted by moving an estimated secondary adjustment distance in a direction that is opposite to the primary adjustment direction wherein the estimated secondary adjustment distance is determined based on at least one of the primary adjustment distance and the representative feature specific focus curve data in combination with the second image focus value. At a block a third image is acquired and a third image focus value is determined in the region of interest.

At a decision block a determination is made as to whether the third image focus value is greater than the focus threshold value. If the third image focus value is not greater than the focus threshold value then the routine continues to a block as will be described in more detail below. If at decision block it is determined that the third image focus value is greater than the focus threshold value then the routine continues to a block as will be described in more detail below. At a block default focus operations e.g. autofocus operations that determine a new focus curve during run mode are performed. It will be appreciated that arrival at block indicates that the preceding fast approximate focus operations failed to provide a sufficiently focused image. If the block is reached repeatedly when determining a workpiece part program in learn mode it may indicate that workpiece surface or features generally produce a poorly behaved focus curve e.g. a significantly asymmetric focus curve or a focus curve with a plurality of significant focus peaks throughout its Z range . In such cases use of the fast approximate focus operations may not be appropriate. At a block feature inspection operations are performed in the current image. At an optional block the most recent successful adjustment direction from the most recent successful fast approximate focus video tool is used stored as the primary adjustment direction e.g. for a next instance of the fast approximate autofocus tool .

At a decision block a determination is made as to whether there are more features to inspect. If there are not more features to inspect then the routine continues to a block as will be described in more detail below. If at decision block it is determined that there are more feature to inspect then the routine continues to a point D which continues at the block in as described above. At a block the inspection results are stored output and or the part program is ended.

It will be appreciated that the routine of may in one embodiment be considered to be an augmented implementation of the routine of . For example in comparing block of with blocks and and the subsequent operations of it will be appreciated that the block assumes ideal conditions under which the run time focus curve and the representative focus curve e.g. see are substantially similar. In the ideal circumstance where the run time focus curve and representative focus curve are presumed to be substantially similar the decision block of is sufficient in that there is little discrepancy between the two such that there will typically not be a need to switch to default autofocus operations e.g. such as those utilized by the high accuracy autofocus tools of . Such ideal circumstances may occur for example under conditions utilizing highly reproducible parts consistent lighting etc. In contrast the decision blocks and and subsequent operations of illustrate a more robust augmented implementation suitable for potentially non ideal conditions in which the focus curve and representative focus curve may be dissimilar. Thus as described above at the decision block a determination is made as to whether the second image focus value is greater than the threshold focus value which if it is not then at the block a determination is made as to whether the second image focus value is greater than the first image focus value. This is a combination of steps that may provide the best overall throughput in that if the second image focus value is greater than the first image focus value then it may be inferred that the Z height adjustment was made in the correct direction but failed to provide the expected amount of improvement in the resulting image focus. From this it may be inferred that the run mode conditions do not sufficient match the learn mode conditions such that the learn mode and run mode focus curves are significantly different and the fast approximate focus operations are not likely to provide a sufficiently focused image in which case the routine proceeds to block where default focus operations are performed e.g. such as those of the high accuracy autofocus tools of . Conversely if at decision block it is determined that the second image focus value is not greater than the first image focus value then it may be inferred that the Z height adjustment was made in the direction. This is one of the possible intermediate outcomes that is expected in the fast approximate focus operations therefore operation continues with a normal fast approximate focus adjustment performed at the block .

When the manual selection is made for Z initial this may implement a procedure wherein during run mode the initial Z height used for the first image of a current instance of a fast approximate focus tool is the Z height that was used when training that tool during learn mode. In certain embodiments this type of manual operation may be considered to be most effective in circumstances where there are relatively few isolated features to be inspected or where the types of workpieces being inspected tend to have features distributed on a plurality of surfaces of different heights such that it may be best to have the initial Z heights follow the Z heights that were established during the learn mode. Typically the Z heights in such instances may be established during the learn mode by the user setting the Z height or by setting it based on CAD data etc.

The tabbed portion also allows the user to select a desired method for determining the primary adjustment direction used during the run mode fast approximate focus tool operations either manual or automatic. In one embodiment as described above with respect to for an automatic selection the last previous successful move direction from a previous instance of a fast approximate focus tool may be utilized as the primary adjustment direction for a subsequent instance of a fast approximate focus tool. In contrast for a manual selection the primary adjustment direction is whatever the user enters as the primary adjustment direction during learn mode. For example if a user selects manual in one embodiment another pop up box may be provided which allows a user to select a direction such as search up or search down. These types of options may be useful in circumstances where the machine vision system is operating very close to an irregular surface such that it may be desirable to avoid searching toward the surface initially lest the camera crash into the workpiece.

It should be appreciated the various user interface features and selectable operation features outlined above are exemplary only and not limiting. For example in various embodiments the representative focus curve data and the representative focus threshold value data may be stored directly in a part program and the tabbed portion would be omitted. More generally various optional features may be omitted from the video tool and their corresponding user interface features may therefore also be omitted. Furthermore it is apparent that the graphical form and menu hierarchy related to the user interface of a fast approximate autofocus tool may take different forms in other embodiments.

The tabbed portion also allows the user to review or enter the data for the representative focus threshold value data name or location that corresponds to the representative focus curve data identified on the same tab and the same corresponding instance of a fast approximate focus tool. As described above with respect to and elsewhere the focus threshold value or data that defines the focus threshold value is typically established during learn mode and is used during run mode to determine whether an image focus value indicates that the corresponding image provides sufficient focus to support workpiece feature inspection operations. Similar to the representative focus curve data or name or location in various embodiments the representative focus threshold value data name or location may define the representative focus threshold value data in any of several formats e.g. a numerical value a file name a file name for a subroutine that computes the desired values based on the focus group data etc . In one embodiment the data may be automatically entered in the box during learn mode and a user may review the data in the box e.g. to make a decision as to whether to use the existing data or to override it with another value or to rename the data storage location or the like.

For all of the tabbed portions the Defaults button at the bottom restores the entries e.g. the manual or automatic selections on the tabbed portion to their default values the OK button accepts the current parameters and closes the autofocus parameter dialog box and the Cancel button returns all parameters to their state before the current editing sequence began and closes the dialog box .

Another type of mode or routine included in or related to learn mode fast approximate focus operations may provide an ease of use feature that is useful for inexperienced users and could have parameters indicated on a tabbed portion not shown . The mode or subroutine involves some automatic evaluation of certain sequences of inspection operations using fast approximate focus tools during learn mode. In one embodiment tool mode or subroutine may evaluate a plurality of previously trained fast approximate focus tools to determine whether it is likely that the workpiece surface where feature inspection operations are currently being defined is nominally planar e.g. by evaluating whether the previously trained fast approximate focus tools all include initial Z heights that fall within a relatively narrow range or some other appropriate method . If so then the tool mode or subroutine may notify the user that in effect it may be appropriate to implement one or both of the automatic settings previously described with reference to the Basic tab if the setting are not already appropriate. Conversely if the evaluation of previously trained Z initial heights indicates significant height variations then the tool mode or subroutine may notify the user that in effect it may be appropriate to implement one or both of the manual settings previously described with reference to the Basic tab if the settings are not already appropriate. Such a mode or routine included in learn mode fast approximate focus operations may help users that are only familiar with conventional autofocus operations create more robust and or faster part programs by using the fast approximate focus tool appropriately.

The field of view window includes an exemplary fast approximate autofocus widget and region of interest superimposed upon a current workpiece feature to be inspected. In various embodiments when the user selects a fast approximate autofocus tool or mode e.g. from a selection bar that displays various alternative tool and or mode selection buttons the user interface may automatically display an autofocus parameter dialog box such as the previously described parameter dialog box as shown in . In one embodiment the widget may be automatically displayed in the user interface to allow a user to graphically define the region of interest for that instance of the fast approximate focus tool e.g. by dragging the square handles located on the border of the widget using a computer mouse and screen cursor . It will be appreciated that in certain embodiments the workpiece feature and the fast approximate autofocus region of interest widget and region of interest appear and operate similarly to the fast approximate autofocus regions of interest A D of .

It will be appreciated that by utilizing the methods of the present invention significant throughput improvement for autofocusing operations may be achieved. In certain embodiments and applications the fast approximate focusing operations of the present invention increase throughput by approximately 2.5 to 15 times compared to more conventional autofocusing procedures that determine focus curves in run mode. In general the improvement in throughput depends on which conventional autofocusing modes of operation are being used for comparison e.g. whether a low medium or high density of focus curve points used for determining the conventional run mode focus curves and on sequences of successive focus operations that are used in the part program and that can appropriately use fast approximate autofocus operations are long sequences or short sequences. The throughput increase is greater for longer sequences which occur on a wide variety of relatively planar or flat parts.

While the preferred embodiment of the invention has been illustrated and described numerous variations in the illustrated and described arrangements of features and sequences of operations will be apparent to one skilled in the art based on this disclosure. Thus it will be appreciated that various changes can be made therein without departing from the spirit and scope of the invention.

