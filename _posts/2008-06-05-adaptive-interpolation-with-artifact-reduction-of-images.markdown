---

title: Adaptive interpolation with artifact reduction of images
abstract: An adaptive interpolation technique with artifact reduction is described that technique generates digital images with full-color RGB (red, green, blue) information, from raw pictures (e.g., Bayer-mosaiced single-color images) created by single-CCD digital cameras. The technique employs an improved criterion for choosing the interpolation criterion, which takes into account an output interpolated value. It employs small changes to filter coefficients, for better results and accommodation of “correction attenuation”. In one embodiment, the technique further employs a “correction attenuation” step, which reduces “color sprinkling” artifacts for certain kinds of diagonal edges. The technique makes only a single pass over the image; all colors are interpolated during that pass, vice the multiple passes required by other better performing algorithms (in some cases over ten).
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08165389&OS=08165389&RS=08165389
owner: Microsoft Corp.
number: 08165389
owner_city: Redmond
owner_country: US
publication_date: 20080605
---
This is a continuation in part of application Ser. No. 11 046 324 filed Jan. 29 2005 and entitled A SYSTEM AND METHOD FOR ADAPTIVE INTERPOLATION OF IMAGES FROM PATTERNED SENSORS which is a continuation in part of application Ser. No. 10 801 450 filed Mar. 15 2004 entitled HIGH QUALITY GRADIENT CORRECTED LINEAR INTERPOLATION FOR DEMOSAICING OF COLOR IMAGES .

Digital cameras are steadily increasing in popularity due to their declining costs which make them well within the reach of the average consumer. In order to keep costs low many color digital cameras are single sensor digital cameras in which only a single image sensor is used to capture color information for each picture element pixel in a color image. Each image sensing element in a single sensor digital camera which is typically a charge coupled device CCD or a complementary metal oxide semiconductor CMOS chip is part of a sensor array that represents the pixels of a color image. In view of the color filter array that is superimposed on the sensor each image sensing element can only generate information about a single color at a given pixel. A color image however is represented by combining three separate monochromatic images. In order to display a color image all of the red blue and green RGB color values are needed at each pixel. In an ideal and expensive camera system each pixel in the sensor array would be provided with three image sensors each one measuring a red green or blue pixel color. In a single sensor digital camera however only a single red blue or green color value can be determined at a given pixel. In order to obtain the other two missing colors a technique must be used to estimate or interpolate the missing colors from surrounding pixels in the image. For each CCD or CMOS pixel only one color is captured either R G or B. Therefore it is necessary to interpolate the data to generate the other two colors at every pixel. For example the pixel marked with a x in is a red pixel that is at that location only the red color value is produced by the corresponding image sensing element. To obtain the green G and blue B values for that pixel one needs to interpolate the green and blue data available from neighboring pixels. For example to obtain the green value for the x pixel in one could perform a bilinear interpolation based on the values of the green pixels marked o .

Estimating or interpolating missing colors as discussed above is called demosaicing . The demosaicing term is derived from the fact that a color filter array CFA is used in front of the image sensors with the CFA being arranged in a mosaic pattern. This mosaic pattern has only one color value for each of the pixels in the image. In order to obtain the full color image the mosaic pattern must be demosaiced . Thus demosaicing is the technique of interpolating back from the image captured with a mosaic pattern CFA so that a full RGB value can be associated with every pixel. More specifically a single sensor digital camera captures the image using an image sensor array that is preceded in the optical path by a CFA. A highly common mosaic CFA is called the Bayer mosaic pattern. The Bayer mosaic pattern or Bayer filter is shown in . In this figure the boxes with an R represent red pixels the boxes with a G represent green pixels and the pixels with a B represent blue pixels. The boxes with 0 markings are also green pixels while the box marked X is also a red pixel. For each 2 2 set of pixels two diagonally opposed pixels have green filters and the other two pixels have red and blue filters. Since the color green G carries most of the luminance information for humans its sampling rate is twice that of the color red R and the color blue B .

This Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used to limit the scope of the claimed subject matter.

The adaptive interpolation with artifact reduction technique described herein generates digital pictures with full color RGB red green blue information from raw pictures e.g. Bayer mosaiced single color images created by a single CCD or CMOS digital camera. This technique efficiently performs high quality demosaicing using a set of linear filters. The coefficients of these filters approximate statistically optimal Wiener filters and allow fast implementation that preferably use no multiplication operations just additions and shifts although multiplications can be used if the processing hardware supports fast multiplications .

The technique employs an improved criterion for choosing the interpolation criterion which takes into account an output interpolated value. It employs small changes to filter coefficients for better results and accommodation of correction attenuation . In one embodiment the technique further employs a correction attenuation step which reduces color sprinkling artifacts for certain kinds of diagonal edges. The technique makes only a single pass over the image all colors are interpolated during that pass vice the multiple passes required by other better performing algorithms in some cases over ten .

In one embodiment following a regular raster scanning order from left to right and top to bottom for each pixel location the adaptive interpolation with artifact reduction technique first determines horizontal and vertical gradients whose computation depends on the available color for that pixel . It also computes an activity metric for each of the horizontal and vertical directions that takes into account candidate output interpolated pixel values. The technique chooses the best interpolation direction from one of three options horizontal vertical or non directed based on the values of the horizontal and vertical gradients and the horizontal and vertical activity metrics. In the case of a non directed filter there is a higher risk of the presence of artifacts in the output values especially of the color sprinkling kind where a pixel has a significantly different color from its immediate neighbors . In this case in one embodiment the technique applies an additional step of attenuating a term that contributes to high frequency components in the interpolated output.

In the following description of embodiments of the disclosure reference is made to the accompanying drawings which form a part hereof and in which are shown by way of illustration specific embodiments in which the technique may be practiced. It is understood that other embodiments may be utilized and structural changes may be made without departing from the scope of the disclosure.

In the following description of the adaptive interpolation with artifact reduction technique reference is made to the accompanying drawings which form a part thereof and which is shown by way of illustration examples by which the adaptive interpolation with artifact reduction technique described herein may be practiced. It is to be understood that other embodiments may be utilized and structural changes may be made without departing from the scope of the claimed subject matter.

The adaptive interpolation with artifact reduction technique described herein generates digital pictures with full color RGB red green blue information from raw pictures created by single CCD or single CMOS digital cameras. This process is generically called demosaicing because it converts a Bayer mosaiced single color image into a full color RGB image. This technique efficiently performs high quality demosaicing using a set of linear filters. The coefficients of these filters approximate statistically optimal Wiener filters and allow fast implementations that preferably use no multiplication operations just additions and shifts although multiplications can be used if the processing hardware supports fast multiplications .

In general several basic ideas underlying the adaptive interpolation with artifact reduction technique are 

1 The technique employs an improved criterion for choosing the interpolation direction which takes into account an output interpolated value.

2 The technique employs small changes to filter coefficients for better results and accommodation of correction attenuation .

3 The technique in one embodiment further employs a correction attenuation step which reduces color sprinkling artifacts for certain kinds of diagonal edges.

4 The technique makes only a single pass over the image all colors are interpolated during that pass vice the multiple passes required by other better performing demosaicing algorithms in some cases over ten .

The adaptive interpolation with artifact reduction technique performs better than the well known state of the art for commercial in camera applications with removal of zipper and color sprinkling artifacts at reduced complexity. It has a performance comparable to the current state of the art algorithms but with a reduced computational complexity and much reduced memory footprint.

The following sections provide a brief background description useful in understanding the concept of demosaicing a brief description of previous work described in the co pending patent applications an exemplary architecture wherein the adaptive interpolation with artifact reduction technique can be practiced exemplary processes employing the technique and details of various implementations of the technique.

There are multitudes of demosaicing techniques available. One of the simplest approaches to demosaicing is bilinear interpolation. In general bilinear interpolation uses three color planes that are independently interpolated using symmetric bilinear interpolation. This interpolation uses a pixel s nearest neighbors having the same color as the color that is being interpolated. In particular referring again to in bilinear interpolation the green value g i j at a pixel position i j that falls in a red or blue pixel is computed by the average of the neighboring green values in a cross pattern as follows 

Bilinear techniques typically use a small region of support. The region of support is the size of a pixel neighborhood whose values are considered for the interpolation of any given pixel. The region of support for most bilinear interpolation techniques typically is a 3 3 pixel region of support. Using this small of a region of support keeps memory usage and computational complexity to a minimum.

However many bilinear interpolation techniques generate significant artifacts in the resultant color image. This is especially true across edges and other high frequency content in the image because bilinear interpolation does not consider the statistical correlation among RGB values and also because it does not make use of the known value of the known color value at the current pixel location because it s a different color . Thus while bilinear interpolation techniques are fast computationally non intensive and easy to implement they are also notorious for producing low quality images due to the significant artifacts mainly blurriness and color fringing that they generate.

Better though more complex interpolation techniques take the correlation among RGB values into account. One group of interpolation techniques considers such correlation by using improved nonlinear filters such as median operators. These nonlinear filters essentially adapt interpolation smoothness to a measure of image activity or edginess.

Exploiting correlation among RGB channels is the main idea behind improving demosaicing performance in nonlinear interpolation techniques. Specifically it can be assumed that in a luminance chrominance decomposition the chrominance components do not vary much across pixels. In a constant hue approach the green channel is bilinearly interpolated and then the red and blue channels are interpolated so as to maintain a constant hue defined as the R G and B G ratios. However one problem with this technique is that even at the expense of computing these ratios the technique still produces visible artifacts. Moreover using complex operations such as division and multiplication in the computing of interpolations greatly increases the computational complexity processing overhead and implementation cost.

Improved results for nonlinear interpolation techniques can be obtained by starting with bilinearly interpolated green pixels and then applying median filters to the interpolated values of the color differences R G and B G. Improved performance can be obtained by using gradient based nonlinear techniques which typically estimate edge directions and adjust the interpolation formulas so that filtering is performed preferentially along edge directions and not across them. However most other nonlinear interpolation methods interpolate the green pixel values first and then use these green values to interpolate the blue and red values. This requires two passes of the image in order to interpolate all red green and blue color values which greatly increases the time necessary to interpolate the missing colors in an image.

Iterative methods can lead to further improvement by using results from blue and red interpolations to correct the green interpolation and vice versa. In such techniques more than one pass across the image is required to interpolate the red green and blue pixel values making these techniques slow and computationally inefficient. Additionally these techniques have a very high complexity e.g. as many as 480 operations per input pixel for techniques using alternating projections .

The above described nonlinear interpolation techniques typically use a larger region of support that is used in bilinear interpolation techniques. For example a 5 5 pixel region of support is typical for these nonlinear techniques. A 5 5 region of support allows more opportunities for exploiting correlation between RGB values and produce high quality images. A smaller region of support greatly reduces the image quality while larger regions of support require more memory and increase computational complexity.

In a co pending patent application entitled HIGH QUALITY GRADIENT CORRECTED LINEAR INTERPOLATION FOR DEMOSAICING OF COLOR IMAGES filed on Mar. 15 2004 and assigned Ser. No. 10 801 450 incorporated herein by reference by H. S. Malvar L. W. He and R. Cutler an interpolation approach was defined that linearly combines a correction term with an interpolation to obtain a high quality estimate of a missing pixel color at a pixel within the image. This interpolation technique for demosaicing color images is simple and has a speed similar to that of bilinear interpolation while producing the high quality images of more complex techniques. However the interpolated image quality sometimes suffers when interpolation takes place across horizontal and vertical edges and resulting interpolated images are still subject to artifacts at these points. The artifacts are much attenuated when compared to straight bilinear interpolation but they can still be noticed in some cases. This previous linear demosaicing technique aims at fast computation. It employs a set a near optimal fixed linear filters in the sense of approximating closely optimal linear Bayesian estimators based on a pre computed set of image statistics i.e. Wiener filters . While performing better than most nonlinear algorithms in terms of mean square error MSE measured with respect to the reference 3 CCD image this linear demosaicer may still lead to noticeable color fringing artifacts zipper or color sprinkling effects near edges. The main advantages of this linear technique are simplicity and low computational cost just a small set of fixed interpolation filters and also a minimal memory footprint no additional image buffering is needed beyond the buffer that stores the interpolated output image.

Another co pending patent application by H. S. Malvar entitled A SYSTEM AND METHOD FOR ADAPTIVE INTERPOLATION OF IMAGES FROM PATTERNED SENSORS filed on Jan. 29 2005 and assigned Ser. No. 11 046 324 also incorporated herein by reference provided a high quality interpolation technique that considers correlation among RGB values to improve performance and computational efficiency. This interpolation technique improved performance lower MSE reduced artifacts with respect to the linear algorithm described in the aforementioned co pending patent application entitled HIGH QUALITY GRADIENT CORRECTED LINEAR INTERPOLATION FOR DEMOSAICING OF COLOR IMAGES by making it adaptive at every pixel a decision is made on whether there is a significant edge in the horizontal or vertical direction. If so then interpolation filters are chosen that use pixels values only in the direction alongside the edge that is horizontal interpolation if there is a horizontal edge and vertical interpolation if there is a vertical edge . Otherwise old non directional filters are used. The horizontal and vertical filters are also defined as easily computable approximations to optimal Wiener filters under the directional constraint. That way one set of filters is replaced by three sets horizontal vertical and non directional filters. To make the decision at each pixel a simple rule is used for computing directional gradients. That kind of adaptation leads to improved results but some artifacts can still be presented especially for raw images that are not appropriately lowpass filtered by a camera lens before hitting the Bayer patterned CCD. The performance of this adaptive algorithm was re examined with other images with a relatively high level of aliasing e.g. if the optics are too sharp . Two important aspects were found 1 most of the artifacts were the results of incorrect decisions of the interpolation direction and 2 the quality of the horizontal and vertical interpolation filters could be improved.

The adaptive interpolation with artifact reduction technique builds on this previous work to create far superior interpolated images. The following paragraphs provide exemplary implementations and details of the technique.

One exemplary architecture in which the adaptive interpolation with artifact reduction technique can be practiced is shown in . This exemplary architecture is typically located on a computing device shown in which will be discussed in greater detail later . The adaptive interpolation with artifact reduction architecture includes a number of modules that allow it to produce a high quality interpolation of a missing color at a pixel in a quick simple and efficient manner.

In general referring to the adaptive filter interpolation architecture inputs color information including raw mosaic patterned pixel data produced by the image sensor array processes the information and outputs one or more missing color values for each pixel . More specifically in one embodiment the adaptive interpolation with artifact reduction architecture includes a current pixel selector that selects a current pixel having a current color from the raw pixel data e.g. an image array that represents a Bayer image . A gradient computation module computes a gradient for both the horizontal and vertical directions at the selected pixel. An activity computation module computes a horizontal activity metric for the horizontal direction and a vertical activity metric for the vertical direction that take into account candidate output interpolated pixels. A filter selection module then selects horizontal vertical or non directional filters from a pre determined set of filters using the computed gradients and the vertical and horizontal activity metrics . In one embodiment of the architecture filters are selected by subtracting the vertical pixel activity metric from the horizontal activity metric and if the result is less than the negative of a given threshold the horizontal interpolation filters are used. If the result is greater than the given threshold then the vertical interpolation filters are used. Otherwise the non directional filters are used. In another embodiment of the architecture filters are selected by comparing the vertical activity metric to the horizontal activity metric and if the vertical activity is greater than the horizontal activity metric horizontal interpolation filters are used to interpolate the missing color values at the current selected pixel. Otherwise vertical interpolation filters are used. Once the filters are selected an interpolation module computes an interpolation of the missing color values at the current pixel. In one embodiment of the architecture an attenuation module is also employed to significantly reduce color sprinkling effects by attenuating high frequency components for non directed interpolation filters.

An exemplary process employing the adaptive interpolation with artifact reduction technique is shown in . As shown in box a current pixel having a current color and location is selected from a mosaiced color image. For the given pixel location and color gradients in the horizontal and vertical directions are computed as shown in box . This computation depends on the available color for that pixel. Activity metrics for the horizontal direction and for the vertical direction that take into account candidate output interpolated pixels are computed as shown in box . Using the computed gradients in the horizontal and vertical directions and the activity metrics in the horizontal and vertical directions the best interpolation filters are chosen from a small set of predetermined interpolation filters box . From those the technique chooses the best interpolation direction in one embodiment from one of three options horizontal vertical or non directed. The interpolation of the missing color values at the current pixel is then computed with the selected interpolation filters box . The process then adjusts the memory pointers to the next pixel in the image box and then proceeds to repeat the adaptive interpolation for the next pixel unless all pixels have been processed if so then the process terminates. No additional passes over the image are needed. This single pass approach is a significant advantage of the adaptive interpolation technique when compared with previous methods.

Another exemplary process of the adaptive interpolation with artifact reduction is shown in . As shown in box a current pixel having a current color and location is selected from a mosaiced color image. For the given pixel location and color gradients in the horizontal and vertical directions are computed as shown in box . This computation depends on the available color for that pixel. An activity metric that takes into account candidate output interpolated pixels is computed for both the horizontal and the vertical directions as shown in box . Using the computed gradients in the horizontal and vertical directions and the activity metrics in the horizontal and vertical directions the best interpolation filters are chosen from a small set of predetermined interpolation filters box . From those the technique chooses the best interpolation direction from one of three options horizontal vertical or non directed. In one embodiment this is done by using the activity metric in the horizontal direction and the activity metric in the vertical direction and comparing these to a threshold in order to determine which direction to use. In the non directed interpolation case there is a higher risk of the presence of artifacts in the output values especially of the color sprinkling kind where a pixel has a significantly different color from its immediate neighbors . In this case in one embodiment the technique applies an additional step of attenuating a term that contributes to high frequency components in the interpolated output box . The interpolation of the missing color values at the current pixel is then computed with the selected interpolation filters box . As in the previous exemplary process the process then adjusts the memory pointers to the next pixel in the image box and then proceeds to repeat the adaptive interpolation for the next pixel unless all pixels have been processed if so then the process terminates. No additional passes over the image are needed.

It should be noted that many alternative embodiments to the discussed embodiments are possible and that steps and elements discussed herein may be changed added or eliminated depending on the particular embodiment. These alternative embodiments include alternative steps and alternative elements that may be used and structural changes that may be made without departing from the scope of the disclosure.

Various alternate embodiments of the adaptive interpolation with artifact reduction technique can be implemented. The following paragraphs provide details and alternate embodiments of the exemplary architecture and processes presented above.

The adaptive interpolation with artifact reduction technique described herein is an improvement over previous algorithms described in the paragraphs above. The main improvements are 1 Improved filters for horizontal and vertical interpolation keeping the same filters for non directional interpolation 2 A much improved rule for selecting the interpolation direction. Instead of measuring only deltas in pixel values in the raw input image the technique measures a set of these deltas as well as deltas that take into account an output pixel value more particularly the horizontal and vertical activity metrics seek to reduce sharp variations in that output pixel value and thus address directly the reduction of artifacts in the output image . The simplified criterion leads to a single pass procedure and thus a much lower complexity and 3 A new rule for reduction of artifacts on certain kinds of diagonal edges.

The adaptive interpolation with artifact reduction technique described herein has higher computational complexity than the previous technique described in the co pending patent applications because it has more arithmetic operations to be performed at every pixel to be interpolated. However the fact that the technique is a single pass technique does not change and that with a simple internal buffering of a few scan lines the technique only needs to visit each input and output pixel once. Additionally the technique does not need to apply any filter to the output image. That leads to great cache consistency and thus fast execution because in modern processors memory access is typically slower than performing several arithmetic operations . Other techniques require additional computations for color space mapping and homogeneity evaluation plus they require either multiple passes or a much more complex internal buffering structure because lowpass filtering and color space transformation operators must be applied to the output pixels.

Regarding box box and box each pixel of a raw Bayer image having a specific color and location is selected for processing in order to interpolate the missing color values at each pixels. In one embodiment pixel selection follows a regular raster scanning order from left to right and top to bottom in order to process the pixels of the entire image.

As previously discussed and shown for example in blocks the adaptive interpolation with artifact reduction technique described herein introduces new interpolation filters for the processing of raw Bayer images. For each pixel in the output image the technique first examines a selected pixel s position relative to the Bayer grid in . More specifically there are four possibilities red pixels blue pixels green pixels in a red row and blue column or green pixels in blue row and red column. The filters for the first two cases and are shown in where the X determines the pixel for which the technique wants to compute interpolated values of the two missing colors G and B for R locations or G and R for B locations . Note that in one embodiment the technique first computes the interpolated green value and then computes the final missing color value. In the following discussion the notation x i j means the pixel value at row i and column j. For example for the horizontal filter in the equation for G eb below all terms are in the same row i but different columns j 3 j 1 j 1 j 3 . For the term B G est the indices for row i 1 and i 1 are also being used. This is because the technique combines horizontal filters for row i with horizontal filters for rows i 1 and i 1 that is a kind of averaging process of horizontal filters for each of the three rows . The filter coefficients for the interpolation filters are identified in and . These figures are annotated so that R indicates a red pixel G indicates a green pixel and B indicates a blue pixel. Note that the computation for a green interpolated value G est is obtained by summing G eb and G ec where G eb is the bilinearly interpolated component and G ec is a high frequency correction component. For example referring to for red locations and the current pixel X at position i j one has the following estimates for the missing green and blue values 

From one also sees that the same formulas hold for the interpolated G est and R est values at blue pixels in one embodiment of the adaptive interpolation with artifact reduction technique this fact is used to simplify writing a computer program to implement the technique.

The formulas above require only integer arithmetic. For example v 1 16 u can be implemented as v u 8 4 and v 3 u can be implemented as v u u

The structure of the filters shown in leads to two important observations. First one computes the green interpolated value as a sum of two components 1 a directional lowpass filtered value in case of horizontal or vertical interpolation or a bilinearly interpolated value in case of non directional interpolation 2 a correction factor which is computed by applying a short kernel highpass filter directional as per the interpolation direction to pixels color of the current pixel. The motivation behind this correction is that if a sharp transition is seen in the current color a transition of the same amplitude is likely to exist in green as well because sharp variations in luminance are much more likely than sharp variations in chrominance. Secondly the second missing color blue for red pixels or red for blue pixels is computed by adding to the interpolated green value an estimate of the color difference B G for R locations or R G for B locations . One computes that estimate via a possibly directional lowpass filter applied to neighboring B and G values for R locations or R and G values for B locations .

For the green G locations and the technique uses only horizontally oriented or vertically oriented filters as shown in . One notes that given the current green pixel X at position i j the filter patterns are the same as in the previous two cases and thus one can use the same formulas. This simplifies implementation of the technique.

A key point for the reduction of demosaicing artifacts is choosing well in which direction to interpolate. This is where the technique described herein brings a significant improvement over the previous one described in the aforementioned co pending patent application entitled A SYSTEM AND METHOD FOR ADAPTIVE INTERPOLATION OF IMAGES FROM PATTERNED SENSORS . A key idea in the adaptive interpolation with artifact reduction technique is to measure high frequency activity or simply activity as a metric of how fast pixel values are changing. The previous technique uses a simple gradient like metric such as horizontal activity abs2 x i j x i j 2 x i j 2 in which it is important to measure the difference two pixels away so that changes in pixel values of the same color were compared. However measuring the jump of two positions leads to aliasing problems at high frequencies for example if the image has vertical stripes that change rapidly in intensity from a column to another that is with significant signal energy at the highest possible horizontal spatial frequency the horizontal activity metric above may end up having a small value as if it were in a nearly flat background region. Thus in one embodiment the adaptive interpolation with artifact reduction technique described herein includes an important variation the technique first computes the horizontal and vertical estimates for the missing colors at the current pixel. Then it includes in the activity estimate a measure the absolute difference between that interpolated value and its immediate neighbors. Including deltas with only one pixel difference reduces the aliasing problems just discussed. Additionally seeking to interpolate in the direction of lower activity favors choosing the output interpolated value from H or V directions that leads to a smoother output image thus directly addressing the reduction of artifacts in the output image.

The technique computes horizontal and vertical activity measures AH and AV respectively using pixel values from the positions marked Og and Gy in . For pixels in a red or blue i j location the technique computes the horizontal and vertical activity metrics AH and AV by 2 1 1 3 1 3 1 12 1 12 1 12 1 12 1 2 1 1 3 1 3 1 21 1 21 1 21 1 21 1 where G est H and G est V denote the interpolated G values in the horizontal and vertical directions respectively as discussed above.

Then in one embodiment the technique uses the following rule to determine the interpolation direction 

Th is a threshold parameter whose value determines the width of the deadzone for which the difference between horizontal and vertical activities is not large enough to justify directional interpolation. For 8 bit pixel component values in the range 0.255 it was found that a good choice for the threshold is Th 20 but the choice is not critical any value in the range 10

For pixels in the G1 locations of green pixels at red rows and blue columns the technique computes the activity estimators by 2 1 1 3 1 3 1 12 1 12 1 12 1 12 1 2 1 1 3 1 3 1 21 1 21 1 21 1 21 1 and for pixels in the G2 locations of green pixels at blue rows and red columns the technique computes the activity estimators by 2 1 1 3 1 3 1 12 1 12 1 12 1 12 1 2 1 1 3 1 3 1 21 1 21 1 21 1 21 1 

It was found experimentally that the former non directional filters do not perform as well for interpolation at green locations where R and B are missing thus in one embodiment the decision rule was changed to consider only horizontal or vertical interpolation 

With the use of directional filters and correction of bilinear interpolation estimates via high frequency components as discussed above the adaptive interpolation with artifact reduction technique basically eliminates zipper artifacts. Most color sprinkling artifacts are also eliminated by the new interpolation direction decision rule employed by the adaptive interpolation with artifact reduction technique because the sprinkling artifacts were mostly generated by incorrect interpolation direction decisions.

There is still a case where the adaptive interpolation with artifact reduction technique may generate sprinkling artifacts diagonal edges close to 45 degrees in which only one of the R or B colors change significantly. That would be the case for example of an object with a diagonal edge in front of a light gray background with the object color being close to blue yellow red or cyan that is with only R or B values changing significantly across the edge . In such cases the direction decision rule will see significant activity in both vertical and horizontal directions and will then select non directional interpolation. Recall that in that case the G interpolation filters have the shape for R locations shown in .

The interpolated green value is obtained by G est G eb G ec where G eb is the bilinearly interpolated component from the green pixels in and G ec the high frequency correction from the red pixels in . In the case of a diagonal edge where R changes significantly and the filter above is at the edge then the pixels with 1 gain to the right and below the center pixel have very different values from those in the center and to the left and above or vice versa . Thus G ec will have a large magnitude leading to an estimated green value G est that is either too high or too low. The neighboring pixels will be interpolated with different filters and will likely not suffer the same effect. Thus the result is an isolated pixel with an interpolation error leading to either a bright or dark color sprinkling artifact.

The adaptive interpolation with artifact reduction technique can reduce such artifacts by limiting the amount of correction that can be applied to bilinear interpolation in the case of non directed interpolation. In other words the technique applies an attenuation factor to the G ec component. In the previous adaptive demosaicing algorithm described in application Ser. No. 11 046 324 filed Jan. 29 2005 and entitled A SYSTEM AND METHOD FOR ADAPTIVE INTERPOLATION OF IMAGES FROM PATTERNED SENSORS G ec was changed depending on the values of the activity indicators but here the adaptive interpolation with artifact reduction technique uses an improved rule based on the value of G ec. Additionally the technique only applies this nonlinear operator for non directed interpolation.

The adaptive interpolation with artifact reduction technique uses a simple rule if G ec Mx where Mx is a parameter the technique does not alter its value. If G ec Mx then the technique attenuates the correction for example in one working embodiment by a factor of four while preserving continuity of the transfer function. That can be achieved for example for G ec Mx by the transfer function G ec new Mx G ec old Mx C where C is a gain factor typically set to b a positive number less than one for example C .

For one exemplary working embodiment of the adaptive interpolation with artifact reduction technique for 8 bit pixel values Mx 6 and C lead to the best compromise with a significant reduction of color sprinkling for diagonal chrominance edges and only a small penalty 

Note that by attenuating the correction for the estimated green component the technique automatically attenuates the correction for the second interpolated color as well because its value depends on the interpolated green value as per the formulas above. This is important because if the technique corrected the green and the second color red or blue differently that would lead to a color change for that pixel.

From the discussion above a succinct description for an exemplary pseudo code implementation of one embodiment of the adaptive interpolation with artifact reduction technique is as follows 

In an actual implementation the best loop structure and data structures depend on the best way to architect the Application Programming Interface API depending on memory considerations and similar factors. For an efficient implementation with minimum code duplication the technique can avoid a big switch statement that process each of the four cases separately. Rather the technique can use the same filtering code for all cases with a few if statements to control key parameters.

It is relatively easy to implement the technique in a streaming API for that the technique needs just enough memory to hold seven scan lines. Also in practice in one embodiment of the technique padding is applied e.g. 3 pixels to all borders of the image with symmetric data reflection so that no testing needs to be performed to detect whether the current pixel i j is too close to a border for the filters to be changed.

The adaptive interpolation with artifact reduction technique is suitable for practical applications but this technique has a reduced complexity over present state of the art interpolation techniques because it can be implemented in a single pass over an image with no additional buffers needed. The technique uses not only horizontal and vertical interpolations but also non directed interpolation with the extra step of a nonlinear curve being applied to the high frequency correction term. Thus the adaptive interpolation with artifact reduction technique described herein leads to reduced color sprinkling artifacts.

The adaptive interpolation with artifact reduction technique is designed to operate in a computing environment. The following description is intended to provide a brief general description of a suitable computing environment in which the adaptive interpolation with artifact reduction technique can be implemented. The technique is operational with numerous general purpose or special purpose computing system environments or configurations. Examples of well known computing systems environments and or configurations that may be suitable include but are not limited to personal computers server computers hand held or laptop devices for example digital cameras media players notebook computers cellular phones personal data assistants voice recorders multiprocessor systems microprocessor based systems set top boxes programmable consumer electronics network PCs minicomputers mainframe computers distributed computing environments that include any of the above systems or devices and the like.

Device may also contain communications connection s that allow the device to communicate with other devices. Communications connection s is an example of communication media. Communication media typically embodies computer readable instructions data structures program modules or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term modulated data signal means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal thereby changing the configuration or state of the receiving device of the signal. By way of example and not limitation communication media includes wired media such as a wired network or direct wired connection and wireless media such as acoustic RF infrared and other wireless media. The term computer readable media as used herein includes both storage media and communication media.

Device may have various input device s such as a display a keyboard mouse pen camera touch input device and so on. Output device s such as speakers a printer and so on may also be included. All of these devices are well known in the art and need not be discussed at length here.

The adaptive interpolation with artifact reduction technique may be described in the general context of computer executable instructions such as program modules being executed by a computing device. Generally program modules include routines programs objects components data structures and so on that perform particular tasks or implement particular abstract data types. The adaptive interpolation with artifact reduction technique may be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment program modules may be located in both local and remote computer storage media including memory storage devices.

It should also be noted that any or all of the aforementioned alternate embodiments described herein may be used in any combination desired to form additional hybrid embodiments. Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. The specific features and acts described above are disclosed as example forms of implementing the claims.

