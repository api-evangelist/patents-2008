---

title: Battery charging method
abstract: A charging and equalizing method for a battery having a control computer in a charging system in communication with a plurality of module processors. Charging and equalization pauses periodically for voltage measurement by the module processors. The control computer determines when to equalize battery cells in the modules based on their open circuit voltages transmitted by the module processors. A selected group of cells in each module can be equalized. Equalization is carried out in the modules until all of the module processors indicate that equalization has been completed. Charging can then resume until charging is complete or cells reach a maximum voltage given by the control computer. In an alternative embodiment, a selected group of cells may be partially bypassed while charging to reduce the charge rate of the cell.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08044637&OS=08044637&RS=08044637
owner: The United States of America as represented by the Secretary of the Navy
number: 08044637
owner_city: Washington
owner_country: US
publication_date: 20080929
---
The invention described herein may be manufactured and used by or for the Government of the United States of America for Governmental purposes without the payment of any royalties thereon or therefore.

High power level rechargeable batteries are often necessary for specific applications. These batteries are made up of a plurality of series connected cells grouped in modules. In electric vehicle applications batteries such as this are often capable of delivering in excess of 100 KW at a voltage of 400 VDC or above. A battery of this nature can have in excess of one hundred cells divided into individual modules or banks of cells.

A battery of this power level must be handled very carefully and monitored very closely during charge and discharge. This is particularly true of lithium ion batteries. The voltage of each cell must be monitored during discharge to ensure that no cell voltage is allowed to drop below approximately 2.1 VDC. Allowing a cell voltage below this level may cause irreversible damage to the cell. More importantly the voltage of each cell must be carefully monitored and controlled while charging overcharging a cell beyond approximately 4.3 VDC can result in catastrophic failure of the cell.

It is also desirable that all cells remain at the same voltage level charge at the same rate and reach the desired final voltage level at the same time. In practice however this is not the case cell charge and discharge characteristics vary. All cells must be monitored very closely during charging. If any cell or group of cells reaches a predefined upper voltage limit prior to the rest of the cells charging is suspended and the rogue cells must be discharged to the voltage level of the other cells. This process is referred to as cell equalizing or cell equalization .

Monitoring battery temperature during charge and discharge is also very important. Cell temperatures should not be allowed to exceed a predetermined temperature. If this temperature is reached corrective action must be taken immediately. This corrective action can include shutting down the charge or discharge process or activating a cooling system.

These problems are specifically acute when using lithium ion batteries however other battery chemistries have similar problems. In view of the prior art there is a need for a battery monitoring and charging system that allows full monitoring and control of the battery.

A charging and equalizing method for a battery having a control computer in a charging system in communication with a plurality of module processors. Charging and equalization pauses periodically to determine corrections for voltage measurement by the module processors. Cell voltages are continuously sampled and data is sent to the control computer periodically. The control computer determines when to equalize battery cells in the modules based on their open circuit voltages transmitted by the module processors. A selected group of cells in each module can be equalized. Equalization is carried out in the modules until all of the module processors indicate that equalization has been completed. Charging can then resume until charging is complete or cells reach a maximum voltage given by the control computer. In an alternative embodiment a selected group of cells may be partially bypassed while charging to reduce the charge rate of the cell. This bypassing will reduce the amount of time spent equalizing and will significantly reduce the overall charge time.

This embodiment provides a method for controlling a battery charging system. One possible battery monitoring and charging system is provided in and . This embodiment is disclosed in U.S. patent application Ser. No. 11 831 197 filed on 31 Jul. 2007 which is incorporated by reference herein. The battery is subdivided into a plurality of battery modules each having a plurality of cells . Each module has a battery control board associated with that module . Each battery control board has multiple temperature monitoring connections multiple cell connections used for cell voltage monitoring and cell equalization and a power relay connection . Internal connections within module and battery control board will be shown hereinafter. Module is only defined by its connection to a single battery control board and module can have as many cells as battery control board can monitor. The battery control boards are joined to a control computer by a network . For identifying the separate control boards to the control computer each board has a dip switch memory or other means for giving it a unique network address. This network can be Ethernet wi fi or any other networking technology. The charge control computer provides coordination and control of the modules during discharge and charging. In order to charge battery there is a charging power supply joined to network and control computer . Charging power supply is further joined to power relay connection as discussed with relation to . Charging cables and are connected to the low and high side of battery respectively.

Voltage monitoring connection is required to monitor the voltage in each cell as well as the overall voltage of the module . Ground for these purposes is the lowest voltage in module . This is the voltage identified at . In view of the series arrangement of battery and modules ground for the specific module could be well above the base voltage of battery . Components of the embodiment must be capable of operating with these voltage differentials. The overall voltage of the module is measured by a voltage divider utilizing resistors and set up between the highest voltage in the module and the ground . The highest voltage for module is that at point . The voltage divider is connected to the input of an op amp configured as a low pass filter for reducing noise in the overall voltage measurement. The filter output is connected to a voltage analog to digital converter .

Cell voltages are measured by joining voltage monitoring connection on both sides of each cell . The voltage between the high voltage and low voltage of each side of cell is measured by a differential amplifier . Differential amplifier can be any differential amplifier having a common mode voltage rating capable of handling the highest voltage in the module . The output of the differential amplifier is connected to voltage analog to digital converter through a low pass filter . Differential amplifiers convert the various differential measurement common mode cell voltage levels present in the module and reference them all to a common ground preventing these voltages from adversely affecting analog to digital converter . Low pass filters eliminate high frequency noise that may be present on the cell voltage signals. Low pass filters can be implemented as two pole active low pass filters or as a passive low pass filters. Cutoff frequency of these filters should be chosen as is necessary to eliminate high frequency noise.

As described above filtered voltage measurements from the cells and the overall module voltage divider output are provided to one or more voltage analog to digital converters . The number of converters is dictated by the number of cells in module and the number of channels in each analog to digital converter . The digital output of voltage analog to digital converters is serialized by a parallel to serial interface . Temperature analog to digital converter are serialized by a separate parallel to serial interface because analog to digital converter operates at the same ground level as the processor and does not require isolation. Interfaces and which may be integral to the analog to digital converter convert signals from the analog to digital converters into a serial form that can be interfaced to the serial interface of processor . The function of processor can be implemented using a wide range of digital signal processors microcontrollers or microprocessors. The serial output of interface is isolated from processor by an isolator . Isolator allows the processor to operate at a common system wide ground rather than the module specific ground discussed above. This allows the processors from all control boards to be powered from a single power supply.

On each board board relay is connected to processor through a driver . Driver is provided merely for giving the required control power for relay and may not be necessary in some embodiments. Processor is further connected to a network driver in communication with network . Processor can control board relay when it receives a command from control computer or when it detects a fault through the sensors provided in relation to .

Adjustable output power supply has a network driver installed to communicate with network . This allows control computer to disable the adjustable output power supply in case of fault or equalization. Network is joined to a network hub . Control computer is joined to network hub through network .

This embodiment features multiple layers of redundant fault sensing and control that are designed into the device. When charging control computer can be an external computer in constant communications with battery control boards and with power supply which has its own network interface . Control computer commands the power supply voltage to 0 VDC and disables power supply s output if it receives cell voltage or temperature data from one of the battery control boards that is out of acceptable range specified by the user. Control computer also disables power supply if it loses communication with any of the battery control boards or receives a fault message from one of the boards.

The processor on each battery control board is programmed to sample cell voltages and temperatures several times a second. Processor compares these cell voltages to high and low voltage limits defined by the user and communicated to the processor through a graphical user interface on control computer . The graphical user interface can display cell voltage module voltage module temperatures and board temperatures. The graphical user interface can also provide user control for charging and equalization. Each processor controls board relay that controls the coil of main relay . The voltage controlling main relay and passing serially through board relays on boards is supplied from an external fixed output power source . All processors must close their respective board relays in order for power to be applied to the main relay that electrically connects the charge power supply to the battery . If any of the processors senses a fault condition or loses communication with the control computer that processor will command its board relay to open which will also open the main relay disconnecting the charge power supply from the battery .

Battery charging and or equalizing is globally controlled by the control computer and is based on information received from all battery control boards in the system. The host control computer synchronizes the battery control boards so that they will all start charging and equalizing simultaneously. Equalizing has a higher priority than charging. If any cell in any module reaches the final charge voltage dictated by the control computer the battery control board monitoring that cell tells the control computer that it is ready to equalize. The battery control board then waits for an equalization command from the control computer . Control computer then commands all battery control boards to stop charging and start equalizing. Control computer synchronizes this transition from charging to equalizing on all battery control boards so that a given board will not start equalizing while other boards think the system is charging.

The control computer also dictates the absolute maximum number of cells each battery control board should equalize at any one time to limit the amount of heat being generated by resistors on the battery control boards . Once every minute processors suspend equalization for several seconds by opening the equalize relays and take an open circuit cell voltage measurement. This open circuit cell voltage measurement is used to calculate an equalization voltage offset that is applied to the cell voltage measurements taken while equalizing. Processor then sorts the open circuit cell voltage data in order from highest voltage to lowest voltage and determines which cells exceed the desired end equalization voltage level dictated by the control computer . The battery control board then resumes equalizing as many of the highest voltage cells as it can based on the maximum number of cells to equalize command received from the control computer .

After one of the battery control boards indicates that it is time to equalize the control computer determines which cell from the all the modules is at the lowest voltage. The control computer then adds a user defined offset to this lowest cell voltage reading and communicates this voltage value to all module processors as being the end equalization voltage level. During equalization a cell whose voltage is below the end equalization voltage level is masked out and will not be allowed to equalize again until after the next charge cycle. Equalization continues until all cells of all modules have fallen below the end equalization voltage level and been masked out.

The charge and equalize functions are implemented in a software state machine. The software state machine has states that include Not Yet Charging or Equalizing Waiting for Host Command to Charge Wait After Closing Charge Relay Charging Waiting for Host Command To Equalize Waiting for All Modules Ready to Equalize Wait After Opening Charge Relay Deciding Which Cells to Equalize Wait After Closing Equalize Relays Equalizing Wait After Opening Equalize Relays and Holding Voltages After Disabling. Each state also provides an indication of the next state for the routine. Each of these states will be described in the following text.

Concerning the state Not Yet Charging or Equalizing this is the first state after processor has received a charge enable command from control computer . All control boards will receive this command at the same time. In this state processor decides whether the associated module should be charged or equalized. As part of this state the processor reads cell voltages and stores the last cell voltage measurement as the open circuit voltage for the cell. This state will be followed by either the Waiting for Host Command to Equalize state or the Waiting for Host Command to Charge state. The Waiting for Host Command to Equalize state will follow if any cell voltage exceeds the cell upper charge limit provided by the control computer .

The Waiting for Host Command to Charge state instructs processor to wait for permission from control computer to charge. This state allows the control computer to synchronize all control boards and prepare them for charging or override the request to charge with a command to equalize. Again the last cell voltage measurement is stored as the open circuit voltage for the cell prior to closing the main power relay . In the embodiment allowing partial bypass the control computer also dictates the absolute maximum number of cells each battery control board should bypass at any one time to limit the amount of heat being generated by resistors on the battery control boards . Processor then sorts the open circuit cell voltage data in order from highest voltage to lowest voltage and determines which cells exceed the desired partial bypass threshold voltage level dictated by the control computer . The battery control board then resumes charging as many of the highest voltage cells as possible based on the maximum number of cells to bypass command received from the control computer . This state will be followed by the Wait After Closing Charge Relay state or the Waiting for Host Command to Equalize state depending on the control computer command. If control computer issues a charge command processor will close its charge relay .

The Wait After Closing Charge Relay state waits for the power supply to reach its charging voltage and current and for cells to settle out at their higher charge voltage. In the current embodiment the time for waiting is three seconds. During this state the same battery cell voltages as those obtained in the prior state are sent to control computer . The next state is Charging after processor has spent the predetermined time in the Wait After Closing Charge Relay state.

In the Charging state processor monitors cell voltages to insure that they do not exceed a maximum voltage value provided by control computer . While in this state the control computer periodically disables charging for several seconds which opens the charge relays allowing processors to take an open circuit cell voltage measurement. After several seconds have elapsed the control computer re enables charging and the processor will return to the charging state after passing through the Waiting for Host Command to Charge and Wait After Closing Charge Relay states. The open circuit cell voltage measurement is used to calculate a charge voltage offset that is applied to the cell voltage measurements taken while charging to determine the actual cell voltage. This adjusted or actual cell voltage is then used to determine if any cell voltage in the associated module has exceeded the maximum voltage value. If a cell voltage has exceeded this value processor notifies control computer charging is stopped the charge relay is opened and the processors wait 3 seconds for the cell voltages to stabilize in the Holding Voltages after disabled location prior to proceeding to the Not Yet Charging or Equalizing and then Waiting for Host Command to Equalize states.

In the embodiment allowing partial bypassing of the cells control computer can send a partial bypass command to battery control board indicating the cell or cells for partial bypassing. Processor associated with battery control board closes relay thereby shunting current around cell . This slows the charge rate for the cell being subjected to the shunting.

During the Waiting for Host Command to Equalize state processor waits for permission from control computer to equalize. This state tells control computer that the associated module is ready to equalize and that control computer needs to synchronize all other control boards for equalization of their modules . During this state battery cell voltages are not updated and previous values are sent to the control computer .

The Waiting for All Modules Ready to Equalize state is a waiting state for control board to wait for an indication from control computer that all modules are ready to equalize. This state is needed for synchronization of the control boards . During this state battery cell voltages are not updated and previous values are sent to control computer . This state is followed by the Wait After Opening Charge Relay state or additional waiting periods.

The Wait After Opening Charge Relay state waits for a preset period for cell voltages to settle out after removing the charging power supply from the module by opening board relay . In the current embodiment this preset period is ten seconds. After the first three seconds processor starts sending actual battery cell voltages to control computer . This optional step allows monitoring of the settling process by control computer . This state is followed by the state of Deciding Which Cells to Equalize .

In the Deciding Which Cells to Equalize state processor stores the last cell voltages as the open circuit voltages of the cells . These voltages are then sorted to determine which cells should be equalized. Cells having a voltage below an equalization target voltage set by control computer are prevented from equalizing. All of the remaining cells may not be able to equalize at once because of thermal dissipation issues so a maximum number of cells for equalization is provided by control computer . Processor selects the maximum number of cells requiring equalization with preference given to the cells having the greatest voltage. If no cells require equalization the next state is Wait for Host Command to Charge .

The Wait After Closing Equalize Relays state waits for a preset period or time for cell voltage readings to stabilize at their new equalize values. In the current embodiment this preset period has been found to be 3 seconds. The cell voltages were determined in the Deciding Which Cells to Equalize state. The Equalize state occurs after this state.

In the Equalizing state equalize offsets are calculated by subtracting the open circuit voltage obtained in the Deciding Which Cells to Equalize state from the current cell voltage measurement taken the first time through the Equalizing state. These equalize offsets are applied to all measured cell voltages for the remainder of the Equalizing state. During this state cells are equalized by reducing energy in the cells . In the current embodiment this is done by placing equalizing resistor in circuit with the equalizing cell by closing equalization relay . Processor obtains new equalize offsets every minute in the current embodiment. After the required time equalizing the equalization relay is opened and the next state is Wait After Opening Equalize Relays. 

The Wait After Opening Equalize Relays state waits for cell voltage readings to settle out at their open circuit values. Waiting time is three seconds in the current embodiment. After accomplishing this the open circuit cell voltages are sent to control computer . The next state is Deciding Which Cells to Equalize as preparation for another round of equalizing.

The state Holding Voltages After Disabling is entered into after termination of charging or equalizing. This state is executed during the master interrupt procedure. Battery voltages are not updated during this state so that they can return to their open circuit values. The state Not Yet Charging or Equalizing follows this state.

In view of this step considers actions to be taken if the battery control board is enabled by the processor. and allowed to equalize or charge. In the physical embodiment shown in enablement is embodied by control line and enacted by board relays and main relay . Step considers coordinating signals from control computer indicating if the control system is not in the Holding Voltages After Disabling state. If both steps and are positive then in block the master interrupt returns to the location in the state machine before the master interrupt routine was called. At the next master interrupt call the state machine returns to the wait 200 mSec step at . Control then returns to master interrupt start at step . If either step or step is negative the software state machine tests to determine if the state machine is charging or equalizing in step . If the machine is not yet charging or equalizing it waits for a predetermined period in step 200 mSec in the current embodiment and then returns to step . If the machine is charging or equalizing when the disable command is received from the control computer then the state is changed to Holding Voltages after Disabling in step and the machine waits for 3 seconds in step . This state allows cell voltages to stabilize to their open circuit values after opening the charge relay. After waiting in step the machine changes state to Not Yet Charging or Equalizing in step and control passes to step .

In step the processor closes the charge relay and waits for cell voltages to stabilize. If no charge command is received in step control proceeds to step for determining if the system is ready to equalize. If the system is not ready to equalize after executing a master interrupt it returns to the beginning of the charge procedure and executes step wait for charge command. If the system is ready to equalize it executes a master interrupt and proceeds to step waiting for all modules to equalize.

The specification shows the battery charging method with respect to one specific type of battery. It should be understood that this method allows many different kinds of apparatus. For example the battery can have only one module. Equalization can be performed by a different method such as by reusing the discharged energy. The battery can have any number of cells. Times given above are tied to the specific equipment. Different equipment will require different times. Communication between modules and control computer can be by any means known in the art.

It is to be understood that the foregoing description and specific embodiments are merely illustrative of the best mode of the invention and the principles thereof and that various modifications and additions may be made to the invention by those skilled in the art without departing from the spirit and scope of this invention which is therefore understood to be limited only by the scope of the appended claims.

