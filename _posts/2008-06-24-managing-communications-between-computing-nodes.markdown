---

title: Managing communications between computing nodes
abstract: Techniques are described for managing communications sent to and/or from multiple computing nodes, such as for a group of computing nodes that are part of one or more private networks. In at least some situations, the techniques are used in conjunction with providing network address translation (“NAT”) functionality to a group of computing nodes that share one or more networks, such as to provide NAT functionality in a distributed and asymmetric manner using multiple computing devices that perform different types of operations at different locations within the private network.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09369302&OS=09369302&RS=09369302
owner: Amazon Technologies, Inc.
number: 09369302
owner_city: Reno
owner_country: US
publication_date: 20080624
---
Many companies and other organizations operate computer networks that interconnect numerous computing systems to support their operations such as with the computing systems being co located e.g. as part of a local network or instead located in multiple distinct geographical locations e.g. connected via one or more private or public intermediate networks . For example data centers housing significant numbers of interconnected computing systems have become commonplace such as private data centers that are operated by and on behalf of a single organization and public data centers that are operated by entities as businesses. Some public data center operators provide network access power and secure installation facilities for hardware owned by various customers while other public data center operators provide full service facilities that also include hardware resources made available for use by their customers. However as the scale and scope of typical data centers and computer networks has increased the task of provisioning administering and managing the associated physical computing resources has become increasingly complicated.

The advent of virtualization technologies for commodity hardware has provided some benefits with respect to managing large scale computing resources for many customers with diverse needs allowing various computing resources to be efficiently and securely shared between multiple customers. For example virtualization technologies such as those provided by VMWare XEN or User Mode Linux may allow a single physical computing machine to be shared among multiple users by providing each user with one or more virtual machines hosted by the single physical computing machine with each such virtual machine being a software simulation acting as a distinct logical computing system that provides users with the illusion that they are the sole operators and administrators of a given hardware computing resource while also providing application isolation and security among the various virtual machines. Furthermore some virtualization technologies are capable of providing virtual resources that span one or more physical resources such as a single virtual machine with multiple virtual processors that actually spans multiple distinct physical computing systems.

Techniques are described for managing communications sent to and or from multiple computing nodes such as for a group of computing nodes that are part of one or more private networks. In at least some embodiments the techniques may be used in conjunction with providing network address translation NAT functionality to a group of computing nodes that share one or more networks such as to allow the computing nodes of the group to use a first group of internal network addresses to inter communicate with each other over the shared network s and to use a second group of one or more other external network addresses for communications between computing nodes of the group and other computing systems that are external to the group. In particular in at least some embodiments the described techniques include providing NAT related functionality in a distributed and asymmetric manner using multiple computing devices that perform different types of operations as discussed in greater detail below. Furthermore in at least some embodiments some or all of the described techniques are automatically performed by embodiments of a Communication Manager module.

In addition to the physical computing systems and of the private network this example data center further includes multiple networking devices such as switches edge routers and core routers . Switch connects physical computing systems to the intermediate interconnection network via edge router while switch similarly connects physical computing systems to the interconnection network via edge router . The interconnection network connects the local computing systems and to each other as part of the private network as well as to other external networks e.g. the global internet and includes the core routers in addition to the edge routers . The core routers manage communications within the interconnection network such as by forwarding packets or other data transmissions or communications as appropriate based on characteristics of such communications e.g. header information including source and or destination addresses protocol identifiers etc. and or the characteristics of the interconnection network itself e.g. routes based on network topology etc. . It will be appreciated that for the sake of simplicity various aspects of the computing systems and other devices of this example are illustrated without showing various conventional details that much larger numbers of computing systems and other devices may be inter connected in similar manners in other embodiments and that computing systems and other devices may be inter connected in other manners in other embodiments.

In this example the computing systems and of the data center are part of a private network and each may be assigned a private network address not shown in accordance with the private network such as with the private network addresses being unique with respect to the private network but not guaranteed to be unique with respect to other computing systems that are not part of the private network. As one example Internet Protocol IP and other networking protocols may reserve groups or blocks of network addresses for use with private networks with such reserved private network addresses not being routable over public networks external to the private network e.g. IP network addresses 192.168.0.0 192.168.255.255 also referred to as 192.168 16 in such situations different private networks may each use the same private network addresses within their private networks as the private network addresses are locally unique to each private network but those private network addresses may not be used for communications between a computing system of a private network and another computing system external to the private network. Additional details related to examples of some types of private networks and private network addresses with respect to the Internet Protocol IP networking protocol are available at Request For Comments 1918 Address Allocation for Private Internets February 1996 at toolsietforghtmlrfc1918 where and are replaced by the corresponding characters with those names which is hereby incorporated by reference in its entirety at Request For Comments 3330 Special Use IPv4 Addresses September 2002 at wwwiefforgrfcrfc3330.txt at Request For Comments 2544 Benchmarking Methodology for Network Interconnect Devices March 1999 at wwwietforgrfcrfc2544.txt and at Request For Comments 5156 Special Use IPv6 Addresses April 2008 at wwwiefforgrfcrfc5156.txt. In other embodiments the computing systems and of the data center may instead be part of a common network that internally uses a group of public network addresses or other non private network addresses with some or all of those network addresses also being independently used internally by one or more other networks between which communications may occur.

In this example to facilitate communications between the internal computing systems and of the private network and other external computing systems that are not part of the private network e.g. computing systems computing systems and or other computing systems that are part of the data centers one or more NAT router computing devices are further provided as well as an optional load balancer device . In particular one or more representative public network addresses not shown may have previously been assigned for use in representing the private network of the data center such as by the Internet Assigned Numbers Authority IANA or one of multiple Regional Internet Registries RIRs . Such public network addresses are routable over the global internet and other networks such that a communication that is sent by external computing system and that has one of the private network s representative public network addresses as the destination network address for the communication will be routed over the global internet to one of the NAT router devices . Depending on the volume of communications passing in and out of the private network one or more NAT router computing devices may be used such as with the optional load balancer device used to randomly or otherwise assign an incoming communication directed to any of the private network s representative public network addresses to any of multiple NAT router computing devices for handling.

In the illustrated NAT router devices operate in a symmetric manner to manage both incoming communications to the private network from external computing systems and outgoing communications from the private network to external computing systems. For example if internal computing system wants to send a communication not shown to external computing system internal computing system creates an outgoing communication that includes external computing system s public network address as the destination network address for the communication and that includes internal computing system s private network address as the source network address for the communication. The interconnection network then uses the destination network address of the outgoing communication to direct it to one of the NAT router devices for handling. In particular in order to allow external computing system to reply to the outgoing communication one of the NAT router devices temporarily maps one of the representative public network addresses for the private network to internal computing system and rewrites or otherwise modifies the outgoing communication to replace the private network address for the source network address with the mapped representative public network address. The NAT router device that handled the outgoing communication will then update mapping information for all of the other NAT router devices with the new mapping and forward the modified outgoing communication to the destination external computing system over the global internet .

Such temporary mappings may be made in different ways in different situations such as only for the purposes of communications between internal computing system and external computing system for the purposes of communications between computing system and any external computing system etc. Thus in some embodiments internal computing system s private network address may be mapped to a first representative public network address for the purpose of communications with a first external computing system and may be simultaneously mapped to a second representative public network address for the purpose of communications with a distinct second external computing system. In addition in some embodiments a mapping may further specify one or more port numbers e.g. Transmission Control Protocol or TCP port numbers such that a given representative public network address and first port number are mapped to internal computing system e.g. to the internal computing system s private network address and to a third port number that may be the same as or different from the first port number and such that the same representative public network address and a distinct second port number may be mapped to a different internal computing system e.g. internal computing system .

If external computing system later responds to the modified outgoing communication by sending a response incoming communication not shown that uses internal computing system s mapped representative public network address as the destination network address for the response incoming communication the response incoming communication will be directed over the global internet to one of the NAT router devices . That NAT router device then performs similar processing in reverse to that previously described for the outgoing communication. In particular the NAT router device uses the mapping information to translate the mapped representative public network address into the private network address of internal computing system modifies the destination network address of the response incoming communication from the mapped representative public network address to the private network address of internal computing system and forwards the modified incoming communication to internal computing system via the interconnection network . In this manner at least some of the internal computing systems of the private network may inter communicate with external computing systems via temporary use of the representative public network addresses. Furthermore in some situations one or more of the internal computing systems of the private network may each be permanently or otherwise exclusively mapped to use one of the representative public network addresses e.g. to a unique combination of representative public network address and port number such that external computing systems may initiate new incoming communications to such an internal computing system by directing those new incoming communications to that mapped representative public network address and port if applicable as the destination network address of those new incoming communications.

While the use of NAT functionality in the manner of that described in provides some benefits it also may have drawbacks in some situations. As one example the NAT router devices may act as a bottleneck that slows or blocks at least some communications since all incoming communications to the private network and all outgoing communications from the private network may need to pass through and be handled by one of the NAT router devices . Furthermore as the number of representative public network addresses and internal computing systems of the private network grows the mapping information used by the NAT router devices may grow in a rapid manner since multiple distinct mapping rules may be needed for each representative public network address and for each internal computing system. If each NAT router device maintains an independent local copy of all of the mapping information for the private network the size of the mapping information may quickly exceed the storage and or processing capabilities of the NAT router devices.

In particular in a manner similar to illustrates a data center that includes an interconnection network and external to the data center are the global internet one or more computing systems accessible via private network one or more other globally accessible data centers that each have multiple computing systems and one or more other computing systems . In addition the example private network within the data center of includes a number of computing nodes including computing systems similar to those of although not including computing systems of in this example. Furthermore the example data center of includes additional host computing systems and which in this example each host multiple virtual machines and respectively with each of the virtual machines acting as a distinct computing node of the private network in this example. Thus each of the virtual machine computing nodes and computing system nodes may be assigned a unique private network address for the private network.

In the example of a variety of Communication Manager modules are further provided to assist in managing communications for the private network such as to provide NAT related functionality for the private network in conjunction with one or more NAT router devices . In particular in this example each of the host computing systems executes a Virtual Machine VM Communication Manager module such as part of a hypervisor or other virtual machine monitor for the host computing system with each of the Communication Manager modules being used to manage at least some communications for the associated virtual machines hosted on the physical computing system on which the Communication Manager module executes. For example in some embodiments the VM Communication Manager modules each manage outgoing communications sent from their associated virtual machine computing nodes to external computing systems while the NAT router devices manage incoming communications to the private network from external computing systems e.g. in a manner similar to that previously described with respect to .

In some embodiments some or all of the computing nodes of the private network may be standalone computing systems that do not host any virtual machines e.g. computing systems of and in some embodiments some or all of the computing nodes of the private network may be virtual machine computing nodes. When non host standalone computing system nodes such as computing systems are present outgoing communications from such computing nodes may similarly be managed by an associated Communication Manager module proximate to the managed computing nodes. For example with respect to a computing device has access to communications to and from the computing systems e.g. by acting as a proxy device or firewall and in this example executes a Communication Manager module not shown to manage outgoing communications from the computing systems in a manner similar to that of the VM Communication Manager modules . A computing system or device or that executes a Communication Manager module is referred to as a Communication Manager device herein and may perform at least some functionality of a network address translation device.

As one illustrative example of use of a Communication Manager module consider a situation in which internal virtual machine computing node wants to send an outgoing communication not shown to external computing system . If so computing node creates an outgoing communication that includes external computing system s public network address as the destination network address for the communication and that includes computing node s private network address as the source network address for the communication. The computing node then initiates sending of the communication to external computing system but before the communication leaves the computing system the Communication Manager module intercepts the communication e.g. in at least some embodiments without computing node being aware of the interception or even of the existence of the Communication Manager module . The Communication Manager module then performs NAT related functionality for the outgoing communication in a manner similar to that described for the NAT router device of for the example outgoing communication sent by internal computing system . In particular the Communication Manager module temporarily maps one of the representative public network addresses for the private network to computing node and rewrites or otherwise modifies the outgoing communication to replace the private network address for the source network address with the mapped representative public network address. The Communication Manager module then send the modified outgoing communication to the destination external computing system by first forwarding the modified outgoing communication over the interconnection network via the switch . In this example embodiment the interconnection network uses the public destination network address to route the outgoing communication to the global internet as one of the communications without the outgoing communication being handled by any of the NAT router devices .

In addition in at least some embodiments the Communication Manager module may update mapping information not shown that is locally maintained to reflect the temporary mapping and may further in some such embodiments update one or more of the NAT router devices in a similar manner as discussed in greater detail below. Thus if virtual machine computing node later sends one or more additional outgoing communications to external computing system e.g. such as part of an ongoing communication session and or such as within a time period during which the temporary mapping remains in effect the Communication Manager module may similarly use the temporary mapping information to translate the private network address of computing node to that same mapped representative public network address. In addition if external computing system later responds to the modified outgoing communication by sending a response incoming communication not shown that uses computing node s mapped representative public network address as the destination network address for the response incoming communication the response incoming communication will be directed over the global internet to one of the NAT router devices as an incoming communication . That NAT router device may then perform processing similar to that described with respect to for the response incoming communication from external computing system including to use the mapping information to translate the mapped representative public network address into the private network address of computing node modify the destination network address of the response incoming communication from the mapped representative public network address to that private network address and forward the modified incoming communication to computing node via the interconnection network . In some such embodiments the modified response incoming communication will be provided to the computing node without any handling of the modified response incoming communication by the Communication Manager module or with the Communication Manager module merely receiving and forwarding the modified response incoming communication to computing node without taking any further action. In other embodiments the Communication Manager module may take additional actions of one or more types with respect to such incoming communications to virtual machine computing nodes such as after the NAT router devices forward such incoming communications to the Communication Manager module

In addition in some embodiments multiple NAT router devices may be used to manage multiple representative public network addresses for the private network such as with each NAT router device being associated with a subset of one or more of the multiple representative public network addresses. In such embodiments an incoming communication to one of the representative public network addresses is forwarded to and handled by the NAT router device to which that representative public network address is associated. If so one or more optional load balancer devices may not be used since incoming communications will automatically be distributed among the multiple NAT router devices based on the representative public network addresses used for the communications. In addition in such embodiments if a Communication Manager module maps an outgoing communication to one of the multiple representative public network addresses only the one or more NAT router devices to which that representative public network address is associated may be updated with the mapping information resulting in less coordination between Communication Manager devices and NAT router devices.

In such embodiments each Communication Manager module may operate independently of other Communication Manager modules such as to not store mapping information generated by other Communication Manager modules unless such information is used by the Communication Manager modules to maintain a unique current mapping for each representative public network address and optionally port number by not reusing information that is part of an existing mapping. In other embodiments such coordination between Communication Manager modules may not be used such as if different Communication Manager modules use different representative public network addresses and or port numbers thus preventing possible overlap between mappings generated by multiple Communication Manager modules. Furthermore since each NAT router device supports fewer representative public network addresses in such embodiments with an associated subset of one or more representative public network addresses the amount of mapping information used by a NAT router device may be less. In addition as described with respect to in at least some such embodiments one or more of the internal computing nodes of the private network may each be permanently or otherwise exclusively mapped to use one of the representative public network addresses.

As previously noted in at least some embodiments the computing nodes for which communications are managed may be physical computing systems and or may be virtual machines that are each hosted on one or more physical computing systems and the communications may include transmissions of data e.g. messages packets frames streams etc. in various formats. Furthermore in at least some embodiments at least some of the computing nodes may be part of a program execution service or PES that executes multiple programs on behalf of multiple customers or other users of the service such as a program execution service that uses multiple computing systems on one or more private or public physical networks e.g. multiple physical computing systems within a data center . For example in at least some such embodiments customers may provide programs to be executed to the execution service and may reserve execution time and other resources on physical or virtual hardware facilities provided by the execution service. In at least some such embodiments one or more system manager modules for the program execution service may track and or manage which computing nodes execute programs on behalf of a customer or other entity such as optional system manager module of e.g. with each such system manager module executed as part of the private network such as via a hosted virtual machine or a standalone physical computing system or instead externally to the private network . Additional details related to program execution services are included below. In addition in at least some embodiments one or more such system manager modules may optionally be used for other purposes such as to facilitate a variety of types of configuration of the Communication Manager modules and or NAT router devices e.g. particular private network computing nodes to be associated with particular Communication Manager modules particular representative public network addresses to be associated with particular NAT router devices etc. . In other embodiments the described techniques may be used in situations other than with a program execution service such as with any other use of a private network on behalf of one or more entities e.g. to support one or more private networks for different parts of a business or other organization .

The illustrated group includes a system manager computing system a host computing system capable of executing one or more virtual machines other computing systems e.g. host computing systems that execute virtual machines in a manner similar to host computing system and or standalone computing systems that do not host virtual machines and an optional Communication Manager device that manages communications from some or all of the computing systems . The system manager computing system and computing systems and are connected to one another via an internal network which includes a networking device and other networking devices not shown . The network may further provide access to external networks not shown and or external systems such as computing systems . In the illustrated example the networking device provides a gateway between the network and host computing systems and and may be for example a router or a bridge.

In particular in this illustrated example at least some incoming communications from the computing systems pass through one or more network address translation devices such as to translate public network addresses for the incoming communications to corresponding private network addresses of computing nodes internal to the group In addition in this illustrated example at least some outgoing communications from the computing nodes internal to the group are forwarded to the computing system without passing through the network address translation devices such as after being handled by a Communication Manager module that translates private network addresses of the sending computing nodes internal to the group to corresponding public network addresses e.g. representative public network addresses used to represent the internal computing nodes of the group .

In the illustrated example the system manager computing system functions to manage the configuration of Communication Manager modules and or network address translation devices within the group as well as to optionally provide other functions related to the provisioning initialization and execution of programs on computing nodes. The illustrated system manager computing system includes a CPU various I O components storage and memory . The I O components include a display network connection computer readable media drive and other I O devices e.g. a mouse keyboard etc. .

The host computing system functions to host one or more virtual machines such as to operate as computing nodes that are part of a private network. The host computing system includes a CPU various I O components storage and memory . A virtual machine Communication Manager module and one or more virtual machines are executing in the memory with the module managing at least some outgoing communications for the associated virtual machine computing nodes as described in greater detail elsewhere. The Communication Manager module maintains various network address translation mapping information on storage related to the computing nodes such as NAT translation rules. The structure of the other host computing systems may be similar to that of host computing system or instead some or all of the host computing systems and may act directly as computing nodes by executing programs without using hosted virtual machines. In a typical arrangement the group may include hundreds or thousands of host computing systems such as those illustrated here optionally organized into a large number of distinct physical networks.

In the illustrated embodiment a system manager module is executing in memory of the computing system although in other embodiments may not be used. In some embodiments the system manager may receive an indication of one or more programs to be executed as part of one or more virtual machine computing nodes on host computing system or otherwise as one or more computing nodes using one of the host computing systems and in some situations may select the computing node s that will execute the program s . In some cases information about the various computing nodes and their executing programs may be provided by the provisioning database which the module maintains to store information related to the physical and virtual resources e.g. networking hardware etc. associated with various customers and or executing programs and computing nodes. The system manager module then initiates execution of the program s on the computing node s and optionally provides information to the Communication Manager modules associated with those computing nodes regarding private network addresses of the computing nodes and or information about representative public network addresses to which those private network addresses may be mapped. In other embodiments the execution of programs on computing nodes may be initiated in other manners and the system manager module may instead merely receive and maintain information about those computing nodes programs associated entities and private networks.

As discussed in greater detail elsewhere the Communication Manager modules and and other Communication Manager modules not shown that manage other associated computing nodes not shown and the network address translation devices may interact in various ways to manage communications for computing nodes. Such interactions may for example enable the computing nodes and or other computing nodes to inter communicate over one or more internal networks for the group such as by assigning private network addresses to the computing nodes and sharing information about mapped representative public network addresses that correspond to private network addresses.

It will be appreciated that computing systems and and networking device and network address translation devices are merely illustrative and are not intended to limit the scope of the present invention. For example computing systems and or may be connected to other devices that are not illustrated including through one or more networks external to the group such as the Internet or via the World Wide Web Web . More generally a computing node or other computing system may comprise any combination of hardware or software that can interact and perform the described types of functionality including without limitation desktop or other computers database servers network storage devices and other network devices PDAs cellphones wireless phones pagers electronic organizers Internet appliances television based systems e.g. using set top boxes and or personal digital video recorders and various other consumer products that include appropriate communication capabilities. In addition the functionality provided by the illustrated modules may in some embodiments be combined in fewer modules or distributed in additional modules. Similarly in some embodiments the functionality of some of the illustrated modules may not be provided and or other additional functionality may be available.

It will also be appreciated that while various items are illustrated as being stored in memory or on storage while being used these items or portions of them may be transferred between memory and other storage devices for purposes of memory management and data integrity. Alternatively in other embodiments some or all of the software modules and or systems may execute in memory on another device and communicate with the illustrated computing systems via inter computer communication. Furthermore in some embodiments some or all of the systems and or modules may be implemented or provided in other manners such as at least partially in firmware and or hardware including but not limited to one or more application specific integrated circuits ASICs standard integrated circuits controllers e.g. by executing appropriate instructions and including microcontrollers and or embedded controllers field programmable gate arrays FPGAs complex programmable logic devices CPLDs etc. Some or all of the modules systems and data structures may also be stored e.g. as software instructions or structured data on a computer readable medium such as a hard disk a memory a network or a portable media article to be read by an appropriate drive or via an appropriate connection. The systems modules and data structures may also be transmitted as generated data signals e.g. as part of a carrier wave or other analog or digital propagated signal on a variety of computer readable transmission mediums including wireless based and wired cable based mediums and may take a variety of forms e.g. as part of a single or multiplexed analog signal or as multiple discrete digital packets or frames . Such computer program products may also take other forms in other embodiments. Accordingly the present invention may be practiced with other computer system configurations.

In the illustrated embodiment the routine begins at block where a request is received. The routine continues to block to determine the type of request. If it is determined that the type of request is to configure network address translation devices and or communication manager devices such as to initialize the providing of NAT related functionality for a private network the routine continues to block . In block the routine configures each of one or more NAT devices for the private network to enable the NAT devices to manage incoming communications for at least a subset of representative public network addresses for the private network. In block the routine then configures each of multiple communication manager devices to manage outgoing communications for one or more computing nodes of the private network that are associated with the communication manager device. In other embodiments the configuration of such network address translation devices and or communication manager devices may be performed in other manners or at other times such as to periodically update or otherwise maintain NAT devices and or communication manager devices over time e.g. to reflect changes in which private network addresses and or representative public network addresses are assigned to particular computing nodes or groups of computing nodes .

If it is instead determined in block that the type of received request is a request to configure a computing node of the private network the routine continues instead to block to configure network address and other information for the computing node such as to assign a private network address to the computing node to associate the computing node with a particular communication manager device to associate the computing node with a particular indicated entity e.g. if that computing node is executing or is to execute one or more programs on behalf of that entity etc. The routine then continues to block to optionally initiate execution of one or more software programs on the indicated computing node such as for a limited time and or on behalf of a customer of a program execution service. As discussed in greater detail elsewhere in some embodiments one or more of the computing nodes may each be a virtual machine that is hosted by one or more physical computing systems.

If it is instead determined in block that the received request is of another type the routine continues instead to block to perform another indicated operation as appropriate. For example in some embodiments the routine may receive requests to update stored information about particular computing nodes such as if a particular computing node was previously associated with a particular entity and or private network address but that association ends e.g. if one or more programs being executed for that entity on that computing node are terminated if the private network address and or representative public network address associated with a particular computing node is modified etc. such updating may include for example discarding network address translation rules or other mapping information associated with a computing node after information for the computing node changes and or initiating similar actions by communication manager modules by sending corresponding instructions or other information to those communication manager modules. Instructions and other information e.g. updates regarding a private network address and or representative public network address associated with a particular computing node may be provided between a system manager module and a communication manager module in various manners such as by the system manager module pushing the information to the communication manager module e.g. periodically when initiated by changes to relevant information etc. and or by the communication manager module pulling or otherwise accessing the information from the system manager module e.g. periodically when initiated by possible use of the information etc. . The routine may also perform a variety of other actions related to managing a system of multiple computing nodes as discussed in greater detail elsewhere. In addition while not illustrated here in other embodiments the routine may at times perform actions of other types such as to perform occasional housekeeping operations to review and update stored information as appropriate such as after predefined periods of time have expired.

After blocks and the routine continues to block to determine whether to continue. If so the routine returns to block and if not continues to block and ends.

The routine beings at block where an indication is received of a node communication or other message. The routine continues to block to determine the type of communication or other message and proceed accordingly. If it is determined in block that the message is an incoming communication intended for a computing node associated with the routine the routine continues to block in the illustrated embodiment to determine the destination computing node based on a private network address for the destination computing node that is indicated as the destination network address for the incoming communication and in block provides the incoming communication to the destination computing node. In other embodiments the routine may not receive such incoming communications or may handle such incoming communications in other manners e.g. if so directed by a network address translation device that forwarded the incoming communication to the routine . For example in other embodiments various additional types of processing may be performed for incoming node communications such as to verify that the communications are valid or otherwise authorized in various ways e.g. to verify that the sending computing node is authorized to and or interested in receiving communications to the destination computing node such as based on being associated with the same entity based on the sending and destination computing nodes being associated with different entities that are authorized to inter communicate based on the type of communication or other information specific to the communication etc. .

If it is instead determined in block that the message is an outgoing communication from a computing node associated with the routine the routine continues to block to determine whether the outgoing communication is intended for an internal computing node of the private network e.g. based on the destination network address specified for the outgoing communication being an internal private network address for the private network . If so the routine continues to block to forward the outgoing communication to the destination internal computing node such as without modifying the outgoing communication. Otherwise the routine continues instead to block to determine the private network address for the source computing node that sent the outgoing communication such as based on the source network address specified for the outgoing communication. In block the routine then translates the private network address to a corresponding representative public network address for the private network or otherwise determines the corresponding representative public network address e.g. by interacting with a NAT device and or a system manager module . In block the routine then modifies the header of the outgoing communication to use the corresponding representative public network address for the private network address and in block forwards the modified outgoing communication to the destination external computing system via one or more external networks such as without using any of the NAT devices for the private network.

In other embodiments and situations the routine may operate in other manners with respect to block and blocks such as if the intended destination of an outgoing communication is an internal computing node of the private network but that destination is indicated in the outgoing communication using a representative public network address for that destination internal computing node rather than the internal private network address for that destination internal computing node. If so the outgoing communication may be handled in various manners in various embodiments. For example in some embodiments the outgoing communication may be handled in a manner similar to that of other outgoing node communications as previously described with respect to blocks such as by forwarding the outgoing communication with the modified source public network address to an external network without using the NAT devices for the private network. Such forwarded communications may then be re directed back to one of the NAT devices of the private network as an incoming communication and handled in a manner similar to any other incoming communication to the private network as described in greater detail elsewhere. In other embodiments the outgoing communication may be handled in a manner similar to that of other outgoing node communications as previously described with respect to blocks but will be forwarded to one of the NAT devices for the private network rather than to the external network without using the NAT devices. In such embodiments the NAT device may re direct the outgoing communication back into the private network for delivery to the destination internal computing node without the outgoing communication reaching an external network such as after modifying the communication to use the internal private network address for the destination internal computing node as the destination address for the communication. In yet other embodiments the routine may perform processing in a manner similar to blocks to modify the outgoing communication to use the internal private network address for the destination internal computing node as the destination address for the communication e.g. in a manner similar to a NAT device and then forward the outgoing communication directly to the destination internal computing node over the private network without using any of the NAT devices and without the outgoing communication leaving the private network.

After block the routine then in block optionally updates stored mapping information to reflect the corresponding representative public network address for the private network address such as by updating one or more of the NAT devices with which the corresponding representative public network address is associated. Such updating may be performed in various manners in various embodiments as discussed in greater detail elsewhere including by coordinating with a system manager module or instead in a distributed peer to peer manner. While not illustrated here in other embodiments various additional types of processing may be performed for outgoing node communications such as to verify that the communications are valid or otherwise authorized in various ways e.g. to verify that the sending computing node is authorized to send communications to the destination computing node such as based on being associated with the same entity based on the sending and destination computing nodes being associated with different entities that are authorized to inter communicate based on the type of communication or other information specific to the communication etc. .

If it is instead determined in block that a message of another type is received the routine continues to block to perform another indicated operation as appropriate such as to store information about particular computing nodes associated with the routine to store information about representative public network addresses for the private network to update previously mapped or stored information to reflect changes with respect to computing nodes that are being managed or to remote computing nodes etc.

After blocks or the routine continues to block to determine whether to continue. If so the routine returns to block and if not continues to block and ends.

In addition various embodiments may provide mechanisms for customer users and other entities to interact with an embodiment of the system manager module for purpose of configuring computing nodes and their communications. For example some embodiments may provide an interactive console e.g. a client application program providing an interactive user interface a Web browser based interface etc. from which users can access functions related to the operation and management of hosted applications e.g. the creation or modification of user accounts the provision of new applications the initiation termination or monitoring of hosted applications the assignment of applications to groups the reservation of time or other system resources etc. . In addition some embodiments may provide an API application programming interface that allows other computing systems and programs to programmatically invoke at least some of the described functionality. Such APIs may be provided by libraries or class interfaces e.g. to be invoked by programs written in C C or Java and or network service protocols such as via Web services. Additional details related to the operation of example embodiments of a program execution service with which the described techniques may be used are available in U.S. application Ser. No. 11 394 595 filed Mar. 31 2006 and entitled Managing Communications Between Computing Nodes U.S. application Ser. No. 11 692 038 filed Mar. 27 2007 and entitled Configuring Intercommunications Between Computing Nodes and U.S. application Ser. No. 12 060 074 filed Mar. 31 2008 and entitled Configuring Communications Between Computing Nodes each of which is incorporated herein by reference in its entirety.

It will also be appreciated that although in some embodiments the described techniques are employed in the context of a data center housing multiple physical machines hosting virtual machines and or in the context of a program execution service other implementation scenarios are also possible. For example the described techniques may be employed in the context an organization wide network or networks operated by a business or other institution e.g. university for the benefit of its employees and or members. In addition example embodiments may be employed within a data center or other context for a variety of purposes.

It will also be appreciated that in some embodiments the functionality provided by the routines discussed above may be provided in alternative ways such as being split among more routines or consolidated into fewer routines. Similarly in some embodiments illustrated routines may provide more or less functionality than is described such as when other illustrated routines instead lack or include such functionality respectively or when the amount of functionality that is provided is altered. In addition while various operations may be illustrated as being performed in a particular manner e.g. in serial or in parallel and or in a particular order those skilled in the art will appreciate that in other embodiments the operations may be performed in other orders and in other manners. Those skilled in the art will also appreciate that the data structures discussed above may be structured in different manners such as by having a single data structure split into multiple data structures or by having multiple data structures consolidated into a single data structure. Similarly in some embodiments illustrated data structures may store more or less information than is described such as when other illustrated data structures instead lack or include such information respectively or when the amount or types of information that is stored is altered.

From the foregoing it will be appreciated that although specific embodiments have been described herein for purposes of illustration various modifications may be made without deviating from the spirit and scope of the invention. Accordingly the invention is not limited except as by the appended claims and the elements recited therein. In addition while certain aspects of the invention are presented below in certain claim forms the inventors contemplate the various aspects of the invention in any available claim form. For example while only some aspects of the invention may currently be recited as being embodied in a computer readable medium other aspects may likewise be so embodied.

