---

title: Multidimensional evidence grids and system and methods for applying same
abstract: Mapping, localization, and navigation systems for use with a mobile unit are provided that use a sensor model with adjustable parameters. The system includes range sensors configured to collect range data and a data storage system having stored therein an evidence grid representing an environment and a sensor model comprising adjustable parameters representing inaccuracies of the range sensors. A grid engine adjusts the adjustable parameters based on received range data from the range sensors. A navigation module can direct the mobile unit though the environment using the evidence grid, received range data, and adjustable parameters. The grid engine can also locate the mobile unit within the environment by using the adjusted sensor model parameters to compare the received range data against the evidence grid.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08427472&OS=08427472&RS=08427472
owner: Seegrid Corporation
number: 08427472
owner_city: Pittsburgh
owner_country: US
publication_date: 20081103
---
This application is a continuation in part application of co pending non provisional patent application Ser. No. 11 350 195 entitled Multidimensional Evidence Grids and System and Methods for Applying Same filed Feb. 8 2006 which claims the benefit of provisional application Ser. No. 60 650 904 filed on Feb. 8 2005 both of which are incorporated herein by reference in their entirety.

The present inventive concepts relate to systems and methods for generating and utilizing multidimensional representations of an environment.

As an example systems and methods for generating 2 dimensional 2 D or 3 dimensional 3 D representations of an environment can be useful in a variety of applications such as in automated navigation systems and methods. For example such automated systems and methods could be used to help guide a vehicle through the environment. As used herein a vehicle can be any platform capable of translation through the environment which may or may not be configured for carrying human passengers.

Previous attempts at providing automated navigation have been limited in their flexibility and also in their success. Most current commercial systems employ a guide path following technique. In this type of system a guide path is fixed to the floor for example and is followed by the vehicle. The guide path may be made from wire paint or tape or some combination thereof. In any case the guide path must be purposefully installed and maintained and if changes are to be made to the vehicles translation through the environment then the guide path must be manually i.e. physically modified. Breaks in the guide path can lead to system malfunction or stoppage.

Other systems use laser techniques that employ fixed targets in the facility and provide position data to the vehicle for use in geometric calculations used in navigation. Such systems require known positioning of the targets and mapping of the facility with respect to the targets. The use of lasers requires careful selection of the target locations and the need to maintain line of sight relationships to the vehicles. Therefore the usefulness of such a system is highly dependent on the stability and maintenance of the targets and the required line of sight relationships. Blocking a line of sight path between a target and the vehicle s laser or a corresponding receiver can cause system malfunction or stoppage.

Free ranging systems use odometry or inertial measurement units or both and provide navigation based on a priori knowledge of the facility layout. To navigate the system must know where within the facility it is as a reference and then tracks its way through according to the facility layout and its translation measurements with respect thereto. Such systems typically determine their location by measuring translation relative to at least one known position or reference point and navigate according to those measurements. These systems are extremely susceptible to error build up over time which limits their accuracy. Like the other systems these types of systems are unable to respond to changes in the workplace.

 Evidence grids have been suggested in some literature as a way to more effectively represent an area or volume. An evidence grid may take the form of a 2 D or 3 D pre defined pattern of cells or voxels representing the area or volume. Each voxel represents a point in space and may contain occupancy information about the point. Due to the sparsity of the data in 2 D evidence grids they tend to be unreliable and impractical in real world environments. Three dimensional evidence grids as known in the prior art are more promising due to the much richer data set they tend to include. However construction of such 3 D evidence grids has been computationally burdensome to the point of having limited real world application.

To alleviate such problems most systems and methods rely primarily on feature extraction to reduce the typically computational burdens by making relatively informed guesses from the voxel data collected within the environment based on patterns of voxel information presumed to represent one or more features of known objects. This can lead to unsatisfactory and potentially intolerable results when guesses are wrong or when the computational burden makes the system too slow for practical applications.

In accordance with one aspect of the present invention provided is a navigation system for use with a mobile unit. The system comprises range sensors configured to collect range data a data storage system having stored therein an evidence grid representing an environment and a sensor model comprising adjustable parameters representing inaccuracies of the range sensors a grid engine configured to adjust the adjustable parameters based on received range data from the range sensors and a navigation module configured to direct the mobile unit though the environment using the evidence grid received range data and adjustable parameters.

The grid engine can be configured to locate the mobile unit within the environment by using the adjusted sensor model parameters to compare the received range data against the evidence grid.

The system can further comprise an automated learning system configured to select a subset of the adjustable sensor model parameters.

In accordance with another aspect of the present invention provided is a mapping system for use with a mobile unit. The system comprises range sensors configured to collect range data a data storage system having stored therein a sensor model comprising adjustable parameters representing inaccuracies of the range sensors a grid engine configured to adjust the adjustable parameters based on received range data from the range sensors and a mapping module configured to generate map of the environment using the received range data and adjustable parameters.

The system can further comprise a navigation module configured to direct the mobile unit though the environment using the evidence grid received range data and adjustable parameters.

The grid engine can be configured to locate the mobile unit within the environment by using the adjusted sensor model parameters to compare the received range data against the evidence grid.

In accordance with yet another aspect of the invention provided is a method of generating a pixel mapping table comprising adjustable parameters of a sensor model. The method comprises activating range sensors imaging a calibration array with the range sensors generating a rectifying function from the calibration array and building a pixel mapping table from the rectifying function.

The pixel mapping table can comprise information for correcting images for distortions related to the range sensors.

In accordance with the present invention provided are a system and method for building improved multi dimensional evidence grids representing a space or volume also referred to as an environment which could be a facility. Stereo ranging is used to collect information and data related to occupation of the environment by objects e.g. walls furniture fixtures or other tangible objects as discussed in Related Information at the close of this description which provides further detail on evidence grids. Stereo ranging involves the collection of data using at least one set of sensors. A set of sensors includes at least two data collection sensors sometimes referred to herein as stereo sensors or stereo ranging sensors. Sensor models SMs characterize noise or other inaccuracies introduced by the stereo sensors and are applied to improve the quality of the collected stereo data and information by removing or compensating for such noise or inaccuracies. Probabilities of occupancy of points in space by for example an object part of an object or feature thereof may be determined from the stereo data. The points in space may be represented by voxels and the probability of occupancy may be represented by a voxel volume. Taking stereo data of points in space from multiple locations within the environment yields a set of probability data e.g. a plurality of probability values for each point in space. Maps may be constructed as combinations or derivations of the probability data of the points in space and a multidimensional evidence grid comprising voxels having resulting occupancy information for points in space within the environment may then be formed from the maps. The evidence grid may be constructed at least initially by translating the system or at least a set of stereo sensors through the environment one or more times sometimes referred to as training. 

Once the evidence grid is built highly accurate navigation through the environment is possible using subsequent evidence grid glimpses that are taken during the navigation i.e. in real or near real time. Each glimpse is a collection of stereo data taken from stereo sensors the stereo data may serve at least two functions. First for navigation purposes a glimpse may be used to determine where within the evidence grid the system is or was when the glimpse was taken. Here the evidence grid serves as a frame of reference for analyzing or processing the glimpse. A comparison of the probability information generated from the glimpse stereo data with the probability data of the evidence grid can yield with confidence a determination of location within the evidence grid and thus within the environment.

Unlike prior art systems the present invention allows for navigation through the environment without any modifications to the existing facility e.g. fiducial marks glide paths and so on nor does it require making static detailed offline maps of the facility that do not allow for automated and dynamic compensation to changes in the environment. A second utility of the glimpses is to provide real or near real time updates of the evidence grid. That is the probability data from the glimpse stereo data can be incorporated into the evidence grid which gives the system a dynamic updating capability. This allows the evidence grid to be automatically and dynamically updated to reflect changes in the environment such as a moved piece of furniture or equipment. Therefore for various reasons a system and method in accordance with the present invention has a robustness not found in other navigation systems.

In step one or more sensor models are applied to the stereo image data. This step may be optional but it does improve the ultimate quality of the resulting evidence grid. A sensor model can be a model that represents noise errors or both introduced by the stereo sensors collectively referred to as noise. Thus the sensor model is dependent on the type of sensors used and the overall system performance desired and may reflect not only the type of sensor or sensors used but the specific sensor or sensors used. For example assessments of the noise introduced by each sensor may be determined by analyzing images taken by the sensor and comparing them or data related to them to known or baseline values. Differences may be construed as an indication or measure of noise introduced by the sensors. Application of the sensor models can be used to remove noise from the image data or otherwise compensate for it. This can be done in a variety of manners. For example in one embodiment the sensor model can be applied as the stereo data is collected as real time adjustments to the sensed data. In other embodiments after initial storage of the sensor data sensor models may be applied to the stereo data to generate an improved set of stereo data. In yet other embodiments the sensor models could be applied during subsequent post processing steps. The sensor model is also used to improve or optimize the performance of the overall system. For example parameters within the sensor model can limit the number of features allowed to be processed during a single glimpse to balance accuracy with processing time. Depending on the performance characteristics desired speed accuracy range etc. there can be many parameters included in the sensor model.

In step the stereo data from each sensor in a stereo sensor e.g. one image from each camera in a stereo camera is processed to determine the presence of objects parts of objects or features referred to as occupancy within the field of view of the sensor. The processing comprises analyzing the pixels of the stereo images and determining a probability of occupancy of points in space within the FOV of the stereo cameras. A relationship exists between the two images produced by a stereo sensor e.g. two stereo cameras that allows data from both images to be used to determine when processed a probability of the presence of an object part of an object or feature at specific points in space or locations within the environment. The result of the processing of stereo data is therefore a probability of occupancy of points in space or locations within the environment.

Once the stereo data has been processed the images may optionally be discarded in step . This may be a function of the memory storage capabilities of the system since image data files tend to be relatively large and the preferred system acquires a large amount of images. In step the evidence grid is built from the probability data. The evidence grid comprises voxels that have associated voxel volumes. The value represented in the voxel volumes reflects the probability of the occupancy of a point in space within the environment thus it is location specific. An initial set of translations through the environment could be performed to train the system i.e. build an initial evidence grid that would support navigation through the environment. Navigation is shown in step and may be performed using glimpses taken by the stereo sensors used during navigation as discussed in more detail below.

In step of the flowchart of the stereo cameras are translated through the environment to collect stereo data relating to points in space within the environment. In step probability data is generated from pixels in the stereo data which take the form of images. In step maps are generated from the probabilities associated with each point in space. That is since multiple images are taken of each point in space there may be more than one probability of occupancy associated with each point in space. The maps in step may be generated from these multiple probabilities. In step the evidence grid is built from the maps. In step like step in the evidence grid may be used for navigation through the environment.

As is shown in in the illustrative embodiment a set of 4 stereo sensors is used each having a 90 FOV to achieve a combined FOV of substantially 360 . To achieve a 360 FOV as an example sets of stereo sensors could be chosen that each have the same FOV e.g. a set of 8 stereo sensors that each have a 450 FOV a set of 4 stereo sensors that each have a 90 FOV a set of 3 stereo sensors that each have a 120 FOV and so on. In other embodiments sets of stereo sensors having different FOVs could be used e.g. a set of 4 stereo sensors that each have a 45 FOV and a set of 2 stereo sensors that each have a 90 FOV. If oriented at 45 degrees with respect to the primary direction of translation all cameras get useful data short and long range . Other combinations could alternatively be used. In some embodiments the FOVs of the different sets of stereo sensors could overlap. And in some embodiments the combined FOV could be less than 360 . It should also be noted that the orientation of the stereo sensors could be coplanar but need not be. If the stereo sensors are not coplanar relating the data from the different sensors in different planes for each point in space is a matter of known mathematics and trigonometric approaches so not discussed in detail herein. Moving or translating a system equipped with stereo sensors providing a substantially 360 FOV through the environment allows each object in the environment to be imaged from several different perspectives which ultimately provides a richer representation of objects within the 3 D evidence grid.

In a first stereo sensor includes sensor and sensor and the FOV for stereo sensor i.e. FOV is about 90 . A second stereo sensor includes sensor and sensor and the FOV for stereo sensor i.e. FOV is about 90 . A third stereo sensor includes sensor and sensor and the FOV for stereo sensor i.e. FOV is about 90 . A fourth stereo sensor includes sensor and sensor and the FOV for stereo sensor i.e. FOV is about 90 . In a first embodiment the set of sensors is mounted to or integral with a system used for evidence grid building navigation or both and the first set of sensors is oriented to collect data in the direction of movement indicated by arrow A. In a different embodiment the first set of sensors is oriented to collected data at an angle of about 45 from the direction of movement indicated by arrow B although other angles could be used in other embodiments. Also in other embodiments the set of sensors need not be fixed relative to the direction of motion but in such embodiments if there were relative rotational movement of the set of sensors with respect to the direction of movement that relative rotational movement is preferably known or capable of being determined e.g. by measurement.

In this embodiment the stereo sensors are stereo cameras as a form of range sensors. Here each stereo camera includes 2 cameras which snap images simultaneously i.e. they are synchronized. Each snapshot is a 2 D image but the two synchronized images taken together yield a stereo image that is cubic having x y and z components. That is with two images a depth or z axis data can be determined. The images taken from the 2 cameras may be referred to as stereo images . In the preferred form a standard frame grabber approach is used to collect and store image data from each camera. The cameras could be black and white or color. As will be appreciated by those skilled in the art stereo ranging does not need to be accomplished using cameras. Other types of data collection means could be used e.g. ultrasonic sensors. Also in other embodiments rather than a set of stereo cameras a single camera could be used without synchronization but the movement of the system would need to be determinable so that the relative location of the camera at each image could be determined this approach is generally not preferred. Other types of ranging sensors such as laser scanners or Time of Flight 3 D cameras Laser Lidar i.e. light detection and ranging radar and or ultrasonic all could be used to provide the range data to be added into the grids. An uncertainty model is not required for stereo sensors and data but each of those other sensors still needs one albeit a different one depending on the sensor for example with sensor the beam spreads so much that while the z direction is well known the heading to the target is within a cone of uncertainty .

Also in the preferred form as between two cameras that comprise a stereo camera a single camera is chosen as a baseline camera e.g. camera of the first stereo camera of could be chosen. As such the image from camera is designated as a baseline image or first image and has a defined coordinate system. The image from camera is expected to be slightly different from the baseline image and may be referred to as the second image. As used herein image means the representation of the projection of light onto a sensor or imaging unit and is comprised of data corresponding to a matrix i.e. rows and columns of pixels as is shown in the representative image matrix of . The difference between the first image and second image is largely due to the fact that the second camera is physically displaced from the first camera as shown in and may also be due at least in part to differences in the cameras themselves.

In the preferred form the physical displacement between the cameras or between the lenses of the cameras is a known distance referred to here as D as shown in . As can be seen the physical displacement between the imagers of cameras and results in an angular difference in the perspective of each camera when imaging the same object . If the cameras are placed at the same height which in the preferred embodiment they are then there is only a need to analyze the viewing perspective differences in the horizontal and not in the vertical.

In the stereo ranging of the preferred embodiment the system looks for pixel disparity between the two images from the stereo cameras i.e. the baseline image and the second image. Therefore a relationship between the pixels of the baseline image and the pixels of the second image must be defined or determined. This is accomplished by knowing the line of separation between the 2 cameras e.g. the physical distance D between camera and camera in . Using that physical separation and distance calculations performed using the image data the line that connects the origin O of the baseline image and the origin O of the second image can determined. For the most part the same relationship is presumed to exist between all corresponding pixels of the baseline image and the second image. Thus knowing the line that connects the origins O and O allows the relationship between corresponding pixels of the stereo images to be determined as line . Therefore a pixel at the center of the pixel group in image from camera can be mapped to a corresponding pixel in the group of pixels in image from camera . Line represents the relationship between these pixels and is substantially the same as line .

When determining the presence of an object at a point in space represented by a pixel the system processes the data from each image produced by the stereo cameras which provide different sets of image data for the same points in space. In the preferred form the system looks for pixel disparity along the line that connect two pixels e.g. line of FIG. A 1 pixel from each image. Because there is no vertical displacement difference between the two cameras pixel disparity up and down is not checked. If there were vertical displacement then pixel disparity could be checked vertically as well. If the stereo cameras were offset in both the vertical and horizontal directions i.e. X and Y directions then pixel disparity could be checked in both. If there was relative displacement in the third dimension i.e. the Z direction then pixel disparity could be checked there as well.

The systems and methods described herein do not rely on feature extraction in processing the images as is done in many other systems nor do they rely on image enhancement. Although either could be used within the context of the described system. Rather the systems and methods look at each pixel to determine whether or not an object is present. Pixels are represented by for example either an 8 or 16 bit number or word. This allows the system to process on a grey scale rather than merely black and white. In other embodiments pixels could be represented by larger or small bit words. Generally a probabilistic mathematical metric is applied to a blob or cluster of pixels in each image. The system looks at each blob to determine if a minimum figure of merit FOM exists which is a function of a pixel to pixel contrast ratio within the blob. The system looks first at the baseline image and then for a corresponding blob in the second image along the line that relates the images e.g. lines and of .

In a pixel from object of is taken as a center pixel within a blob of pixels . Here as an example the blob is chosen as a circle of pixels having a radius of about 7 pixels. The system looks at the blob to determine if there is a contrast among the pixels within the blob . In the preferred form the determination of whether or not a contrast exists is accomplished by taking a sum of squares of the intensity i.e. the 8 or 16 bit word for each pixel in the blob. Other mathematical approaches known in the art may alternatively be used to process the blobs to find contrast i.e. such as any of a variety of known statistical analysis approaches. If the minimum FOM is found then the pixel there is a probability of an object in the environment at the location represented by the blob of pixels processed.

As is shown in for the pixel analyzed in the first image of the system looks along the line that separates the two cameras to find the corresponding pixel in the second image . The system looks 3 pixels to determine the corresponding center pixel in this embodiment which accounts for potential errors that would cause the second image to be slightly askew with respect to the first image. depicts a set of first image blobs related to second image blobs along line including the 3 pixel blobs. The blob from the set of 3 pixel blobs in the second image that has the best FOM match to blob is chosen as corresponding to blob . For example it could be the blob centered at the 1 pixel location. That is the system looks for blobs with same value e.g. sum of squares value in the second image and pick best one. Once that is done then the image data for a given pixel within those corresponding blobs can be further processed to determine whether or not an object exists at a corresponding voxel within the evidence grid. The system is not doing feature extraction or object identification just looking for characteristics of images and where they are similar.

As a separate issue and as briefly mentioned above different operators could be used for assessing the contrast within a blob of pixels e.g. Gaussian exponential parabolic sine distribution. Optionally the system could clip i.e. ignore values above or below threshold values such distributions to get rid of noise as a processing efficiency and accuracy improvement. All of these types of parameters can be included in the sensor model and can be optimized for sensor type or performance requirements.

Processing of the blobs generates a range map of the environment which says things of interest have some FOM and also determines the distance of the thing of interest i.e. object from the camera. The distance is proportional to pixel disparity right to left which can be calculated from the triangle shown in . Calculations are from the point where the image was snapped. Pixel disparity is disparity from one image to the other image i.e. from the baseline image to the second image. Thus the system determines 3 D location of points representing objects FOM for each point and the distance from the camera to each point. In this embodiment the sum of squares of the differences of the contrast of a group of pixels in a spherous thing a relatively unique identifier when only looking along a line.

The sensor model parameters can be used to manage inaccuracies of the sensors. The model therefore allows the system to eliminate or significantly reduce noise or other inherent system sensor introduced errors. As mentioned above with respect to the sensor models could be applied at any of a variety of points in the process of collecting or processing the stereo data. As is shown in the system looks into cubic space because points have x y and z values then applies sensor model 3 D shape that shows probability of their being an object in space to each point found above from the image data. The sensor model shape relates to the uncertainty or probability associated with the points. The shape also reflects that the understanding behind an object is typically very low but the understanding in front of the object is typically very good. shows one possible representation of the probability curve viewed from the side where for a given point represented by a voxel within the evidence grid 0 empty 1 occupied 0.5 unknown.

In the preferred embodiment a sensor model may be built i.e. including values for the curves in A and B offline as a one time event. This can be done by running the system with a set of images and letting it adjust the parameters like depth length width etc. as more and more images are taken and processed. One approach is to keep running learning models and as the learning system adjusts parameters we find when we are achieving the desired performance goals such as accuracy or speed. Learning models as used herein may be translations through the environment that include the collection and processing of image data along with image metadata providing the exact locations at which the images were taken used to determine the error introduced by the sensors. Sensor models could also be canned i.e. available in advance as a set of data for a given set of stereo sensors. If not canned building the sensor model using the learning system is generally a 1 time thing once built it does not need to be built again for the system. In other approaches the sensor model could initially be canned and then subsequently adjusted using learning models e.g. within the environment by measuring its performance against performance objectives. The more general the sensor model is the better the system typically works because some characteristics of facilities may be common but specific sets of characteristics for a given system if too greatly relied on could cause errors in the system if those characteristics are later altered. This description applies only to the parameters that are used for adjusting the performance of the various sensors and their interpretation of the image data. Other parameters may be set by the sensor model which cover other aspects of the overall system operation and are described below.

In this embodiment building the evidence grid is generated from maps generated by summing a set of point clouds i.e. clouds of points of interest as is shown in . Point clouds represent the probability of occupancy at points in space as determined from the stereo image data. In within a cubic volume there are several smaller cubic collections of point clouds e.g. cubic volume that includes a point cloud . Each point in the point cloud is comprised of points of interest that include the probability that there is an object at the corresponding point in the environment. The point cloud therefore is a set of points of interest related to points in space within a set of stereo image data. Many point clouds taken a various locations within the environment can include probability information for the same point in space or voxel.

The system tracks the translation of the system through the environment so it knows the relationships among the multiple images thus allowing corresponding voxels in each of the multiple images to be combined. In the preferred embodiment the system keeps track of translation through the environment using odometry but could use any other known tracking mechanism or could track translation using the image data or could use a combination of approaches and perhaps use an average or weighted average among those different approaches . So for example if one image shows a voxel as being occupied and three other images show that voxel as not being occupied then the one voxel was likely noise and that noise will fall out of the system. If for example all four images show the voxel as being occupied then there is a very high probability of occupancy corresponding to the voxel. Therefore the resulting evidence grid represents the probability of occupancy i.e. the presence of an object corresponding to the voxel as high or occupied .

The combination of the probabilities of point clouds related to each voxel may be used to create maps that represent the probabilities associated with the various points in space and may take the form of an extended local map ELM see . Since the stereo images were taken at different places the resulting cubic volumes of probability data do not completely overlap as seen with the overlapping cubic volumes . There is some small offset between the cubes that could be expected.

The system does not preferably store the raw image data once used the images can be discarded as discussed above with respect to . The system can however continue to update the probabilities using new image data. Every time the system takes images it adds image probabilities into cubic volume probability clouds. So if something was removed from the environment it would fall out over time. This process is continued until the evidence grid is built. In this embodiment every time new images are taken the evidence grid is updated. Updates can also be performed after the evidence grid is built during operational navigation through the environment.

In addition to or in combination with the odometry approach for determining the location of the system in the environment during translation discussed above the system could determine the location of the system from the images. To do this the system looks at a plane of pixels that is parallel to travel direction i.e. looking at the sides of system. The system knows the speed of the system and the physical relationship e.g. distance separation between the cameras. Given the foregoing information the system can find common features between stereo images and figure displacement and thus that would give system positioning. This approach requires less reliance on external sources.

As example the voxels include information that weight the evidence of different kinds of characteristics such as occupancy heat surface orientation. The type of weighted evidence depends on the types of sensors used to accumulate data e.g. camera radar etc. . Evidence grid calculations are preferably based on the application of Bayes Theorem to derive a probability model for each particular sensor. Bayes Theorem incorporates prior information into the probability that a given situation exists and is well known in the art. The probability data is accumulated for each voxel as described above. The evidence grid may be updated by subsequent translations through the facility. Updates allow for dynamic changes in the evidence grid e.g. to accommodate the introduction or removal of items within the facility. The facility map may then be used by a robot or other automated device or vehicle to navigate the facility. It should be noted that it is not necessarily essential that the facility map is highly accurate from a real world perspective to allow accurate navigation. It is more important that the facility map is accurate from the perspective of the robot.

An evidence grid building module or grid engine includes a stereo image data processing module that applies the sensor data from sensor database to the image data from sensor database for generating the associating occupancy probabilities with voxels in the evidence grid. The evidence grid build update module sums the probabilities for each voxel from multiple images to build or update the evidence grid which may be stored in evidence grid database . A navigation module may be included that is configured to use the evidence grid to translate through the environment.

Navigation using the evidence grid can be accomplished by a process of determining from image data where within the evidence grid the system is referred to herein as localization . That is for navigation the system is configured for computing its current position from current image data by comparing the current image data to the stored map data evidence grid . The evidence grid may be built as provided above or could be built by some other means.

As the system translates the stereo sensors take snapshots to perform stereo ranging. The sensor model is applied to the stereo range data as discussed above to create a glimpse . A glimpse is a small evidence grid a cloud of probabilities of objects being there see . Once the glimpse is obtained then look at evidence grid data and do another sum of squares and matching of blobs i.e. probabilities .

The system uses an approach for throwing or launching rays to determine where points of interest are in current glimpse. This is a guess based on last known position and where the system believes it is within evidence grid. Therefore there is an expectation of where the system believes it is and according to that the system throws rays out with an expectation of getting certain hits or a match in certain locations. To get a match empty or unoccupied spaces should match empty spaces and occupied spaces should match occupied spaces. If the pattern of hits is consistent with the pattern of voxels in the evidence grid then the system believes that it knows where it is located within the frame of reference of the evidence grid. This is done for some number of points where the rays are thrown outward from each point. For example minimum threshold number of points could be used e.g. at least 350 400 hits. For example within some expectation of error the system could test fit 400 points from current image with 400 points of existing evidence grid by throwing rays onto existing evidence grid from each of the 400 points.

Presently the system throws rays based on last known position so it knows roughly where it is. Therefore the system only searches in a certain range within evidence grid. If the system is lost the system can do a wider scale look coarser grid before it gives up. Once the evidence grid is made what happens if things moved There is still enough data that will match e.g. columns walls shelf posts etc. so the system should still be able to locate itself. The system will also update the evidence grid to account for the things moved.

In any of the various embodiments the system configured to navigate using the evidence grid may comprise a mobile body including an engagement mechanism movably coupled to the mobile body and configured to support or mobilize an object such as forklift stacker tugger order picker or the like.

In various embodiments 3 D evidence grids can be used as a mechanism to provide a reliable and precise Cartesian framework through which objects can be located identified grasped manipulated and assembled. 3 D evidence grids are particularly suited to this job because they provide a fast and efficient way to provide a self updating real time 3 D Cartesian coordinate occupancy mapping of a changing environment. 3 D evidence grids also provide a statistical framework to accumulate and weigh other types of object identification evidence and by their nature provide a smooth degradation function preventing catastrophic failure.

Because evidence grids subdivide accumulated data from repeated sensor measurements into a spatially organized regular array they allow very noisy sensor data to be statistically combined into reliable representations of a robot s environment. By accumulating a more specialized kind of high resolution sensor derived evidence we can construct an evidence grid with enough accuracy and precision to provide highly reliable recognition and autonomous manipulation of objects in the grid space.

An added benefit of the use of evidence grids is that the preprocessing of the sensory measurements provides a 3 D starting point with absolute viewpoint invariant scale and shape. This greatly simplifies the task of recognizing objects in the work area. Rigid objects that is fixed objects made of inflexible materials such as tools or metal assembly parts can be pre classified quickly by calculating and matching a simple moment vector then precisely identified and located with a statistical template fit. Objects made of flexible stretchy or yielding material such as rubber sheeting or fabric or objects with variable size and shape e.g. chairs tables can be identified using a feature based trainable statistical classifier similar to those used for optical character recognition.

Surface color can be incorporated into the grid and used to aid identification by projecting colors perceived by the cameras onto the occupied cells in previously constructed grid representations of the 3 D scene. Other measurements derived from contact or non contact sensors these may include temperature color surface orientation texture or surface hardness.

Evidence grids are an excellent way to fuse data from multiple sensors. Stereo cameras are just one way to define an environment for example lasers and heat sensors could be used alone or in concert with the stereo cameras to introduce evidence of temperature and surface orientation to the model. Any number of hardware configurations can be used to provide different kinds of evidence about an environment.

With various methods that may be implemented in accordance with the present invention it no longer matters that a significant percentage of the stereo data are incorrectly matched because the statistical analysis causes aberrant data i.e. mismatched pixels to drop out of the results. The grid approach allows ambiguities in individual measurements to be represented as a tuned probability profile that adds evidence whether weak or strong to an accumulating map. Multiple views gradually fill in gaps and reduce ambiguities until the desired model quality is achieved.

3 D Grid representation is better than hardware sensing for complex scenes with many overlapping surfaces because it handles errors and ambiguities gracefully. But grid representation can also improve data from the best sensing hardware. No matter how good or bad the data are they can be improved by using them as input to grid maps.

Below is described embodiments of possible implementation details of evidence grid building module or grid engine of . These implementations can be viewed as alternative embodiments to that described above or further detail expanding on the above described embodiments.

Grid engine stereoscopic vision mapping and localization behavior is shaped by several dozen parameters. The parameters are incrementally adjusted by a learning process that attempts to optimize performance of the grid engine as characterized by a numerical quantity. Trial settings of the parameters can be repeatedly tested against a body of calibrated test data. To optimize localization performance the optimized quantity can be a combination of localization accuracy and run speed. Some of these learned parameters are explicitly described below. A full set of parameters especially an optimized set is referred to as the sensor model.

Camera calibration and generation of a pixel mapping table used in image rectification can be done when the cameras are manufactured. is a flowchart of an embodiment of a method for generating a pixel mapping table in accordance with the present invention. Once the stereo cameras are activated in step a calibration array is imaged in step . A rectifying function is generated in step from the imaged calibration array and the pixel mapping table is generated using the rectifying function in step .

As an example incoming images from cameras as stereo sensors in stereoscopic arrangements are rectified into ideal projective geometry at specifiable image sizes quickly through pixel mapping tables. In this embodiment cameras with very wide angle lenses are used with large distortions. Such cameras are commercially available today.

A pixel mapping table is a 2 2 array corresponding to the number of pixels which contains information on how to correct the image for pixel lens distortions it contains for each pixel in the rectified image of a given size the location of the source pixel in the original image. The pixel mapping table is generated for a camera lens combination using a rectifying function when the camera is first activated. The pixel mapping table once generated is saved for processing subsequent images from that camera.

The rectifying function is created from an image of a calibration array of spots on a contrasting background taken by the camera lens combination placed in an accurately known position facing the calibration array. The rectifying function creates the pixel mapping table for the camera lens combination as a mechanism for relating pixels in the rectified image to pixels in the source image. Subsequently the rectifying function uses the pixel mapping table to rectify received source images.

The rectifying program assumes that the lens distortion is radially symmetric around some initially unknown center in the image. This is a reasonable assumption for good quality lenses mounted accurately in front of solid state imaging chips. However some robots use quite inexpensive lenses likely having slight local defects and there may be some inaccuracies in their mounting. Such errors violate the radial symmetry assumption and will result in rectification errors. In fact there is evidence of misalignments of up to several pixels in most of stereo images. It would be possible to correct these errors by augmenting the rectifying function with an additional local rubber sheet correction for each region of the image. Such a correction could optionally be added in other embodiments.

Alignment errors inevitably and significantly penalize stereo accuracy and thus localization performance. But the existing calibration has proven adequate for robots using the grid engine described above with respect to the prior embodiment. The grid engine described herein in this embodiment has a stereo search process that is even more tolerant of small image misalignments due to its coarse to fine strategy see below . In various embodiments advantages of using rubber sheet refinement for increased accuracy would be undermined by the calibration array stand used to obtain images for the rectification software which itself has inaccuracies amounting to several pixels in position and aim. Using a more precise calibration array stand could enable rubber sheet refinement to provide significant benefits in accuracy. But until then fine local corrections to the rectification are likely simply to emphasize calibration stand defects.

As mentioned an interest operator is determined from the signal image as a measure of features in the signal image. The signal image is rectified as discussed above and the result is filtered by a circular 2 D Gaussian operator applied over the entire signal image. Sharp spikes and ripples of the raw signal are smoothed into a landscape of rolling hills. Peaks of these very smooth hills indicate local regions with exceptionally high signal. They can be detected simply by examining all 3 3 windows of the filtered image choosing those whose center pixel is largest of the 9 in this embodiment. A subsequent process interpolates each of these discrete peaks to sub pixel resolution by fitting a continuous 2 D Gaussian peak to the discrete peak neighborhood s 9 pixels. The location of the peaks is referred to as image features .

The Gaussian smoothing is isotropic in the image area e.g. showing no preference for the pixel axis directions. Each peak represents a locally exceptionally strong signal. The peaks are separated by an average distance of several standard deviations in radii of the smoothing Gaussian. Strong peaks eliminate weaker potential nearby peaks but extended weak areas have peak density about as high as strong areas only the peaks are not as high. The overall effect is to scatter features very uniformly over the image. The number of features is controlled by changing the radius of the Gaussian filter the number varies inversely as the square of the filter radius i.e. inversely as the Gaussian variance . In practice a filter radius of a fixed number of pixels is used and instead the scale of the pixels is changed by scaling the image in the rectification step typically sampling up slightly then averaging down by an integral scale to achieve the desired size . To get only a few features the image is rectified to a small size to get many features the image is rectified to a large size.

Typically the number of features returned from similar images using a given Gaussian radius i.e. the interest operator varies by less than a factor of two. The number of features never grows much and drops only if the image happens to contain large very uniformly colored areas. When this interest operator is applied to different images of the same scene i.e. that part of the environment being imaged a large fraction of the same strong features are selected. This is also true as the number of requested features is increased as the Gaussian filter radius is reduced the strong features are left mostly unchanged but new weaker features begin to appear nestled between them.

For localization this stability allows strong features to function statistically as natural landmarks. The more stable they are the fewer are needed for a given localization reliability and accuracy and the faster the process can be.

The grid engine s knowledge of space is represented in cubical 3 D grid maps of occupancy probability. They are handled in concentric collections of increasing range and diminishing resolution called ELMs Extended Local Maps see for example discussed above.

ELMs are initialized to neutral probability representing lack of knowledge of occupancy. Features matched in multiple stereo scenes perhaps hundreds per image pair are translated into rays of evidence accumulated into ELMs.

A completed ELM represents a volume of 3 D space around a point. It can be used to localize a robot re entering the same region by comparing rays derived from new stereo images or glimpses from the robot with the ELM s contents.

The number of concentric cubes in an ELM the size of each cube in discrete cells and the physical scale of the innermost finest scale grid cell are all parameters that are components of the Sensor model . However in this embodiment the number of cells making the side of each cube is constrained for the sake of efficiency in the ray launching inner loop to be a power of two. Each doubling of the edge size multiplies the total number of cells and the memory used eightfold so for practical reasons all grids to date have been limited to 128 128 128 cells. However the present invention is not limited in this manner.

Stereo measurements also or measurements from other sensors are translated into rays of evidence projected into ELMs. For each grid of the ELM a stereo feature s disparity is looked up in the pre calculated occupancy evidence cross section tables of the proper grid scale filtering. The cross section is mapped to its proper position and orientation in the grid. For building an ELM the evidence is added to the ELM using a probabilistic formula referred to as Mapping Rays . For localization the ray s evidence is compared to the ELM s using a different probabilistic formula referred to as Comparison Rays returning a value representing the location within the ELM.

The present navigation system uses camera heads with four stereo camera pairs. A full set of images from a head is called a glimpse previously discussed herein. A path is a chain of overlapping ELMs which can be built from data on a e.g. human guided training walkthrough. Each ELM on a path is constructed using stereo results from about nine successive glimpses as an example.

Path following involves locating the robot in an ELM along a trained path. The technique used to localize the robot can be the same as described above. The most recent glimpse obtained from a robot automatically following a path is tested in various 2 D trial poses within the path ELM most likely to encompass the correct pose. A pose is the forward and lateral position and the heading angle. A volume of pose space in three dimensions forward and lateral position and heading angle proportional to an initial estimate of pose uncertainty is first coarsely surveyed the density of pose samples being set by a parameter e.g. another sensor model parameter arbitrary density number. The pose that best fits as measured by summing comparison rays from the glimpse in that pose is used as the center of a sampling distribution of poses shaped by more parameters . An interpolating function more parameters is fit to the comparison value at each of those poses and the peak of that function if any is reported as the pose that best fits or best pose . The location of the robot is therefore to correspond to the location indicated by the best pose.

In prior systems the localization process can be touchy and can fail to work except when its parameters are set within quite narrow ranges. But unlike prior systems using the grid engine of the present embodiment stereo search and ray shaping are very stable providing reasonable results for most parameter settings. Reasons for this improved stability include better probability models better use of search context and less reliance on sparse function fitting.

The localization search process is similar to the stereo search process but more computationally expensive comparing 3 D volumes rather than 2 D areas and searching in three degrees of freedom rather than just one . With the intent of making the localization also more stable in other embodiments a coarse to fine search can be used with poses selected at about the cell density of each ELM resolution level rather than an approach of best fitting a low degree function to a sparse sampling of a complex surface of poses at the highest resolution.

The parameters that tailor the grid engine for particular uses are set by a learning process. The program repeatedly tests a sensor model on a representative but calibrated collection of test data adjusting one randomly selected parameter after another in coarse and fine steps between tests attempting to maximize a scoring function. This is a measurement of the goodness of the outcome. When no further improvement occurs some parameters are randomized and the optimization begins again. For localization the quantity to be optimized is a combination of localization accuracy and run speed.

The program adjusts a separate set of stereo and ray shaping parameters for ELM building and localization.

The existing learning program described above is adequately fast for the present embodiment but the optimization could likely be sped up with techniques that consider more than one parameter at a time such as the simplex or conjugate gradient methods. There are likely tasks that would benefit in future from real time learning by robots as they do productive work.

While the foregoing has described what are considered to be the best mode and or other preferred embodiments it is understood that various modifications may be made therein and that the invention or inventions may be implemented in various forms and embodiments and that they may be applied in numerous applications only some of which have been described herein. As used herein the terms includes and including mean without limitation. It is intended by the following claims to claim any and all modifications and variations that fall within the true scope of the inventive concepts.

