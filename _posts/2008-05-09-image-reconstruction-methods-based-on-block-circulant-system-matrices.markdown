---

title: Image reconstruction methods based on block circulant system matrices
abstract: An iterative image reconstruction method used with an imaging system that generates projection data, the method comprises: collecting the projection data; choosing a polar or cylindrical image definition comprising a polar or cylindrical grid representation and a number of basis functions positioned according to the polar or cylindrical grid so that the number of basis functions at different radius positions of the polar or cylindrical image grid is a factor of a number of in-plane symmetries between lines of response along which the projection data are measured by the imaging system; obtaining a system probability matrix that relates each of the projection data to each basis function of the polar or cylindrical image definition; restructuring the system probability matrix into a block circulant matrix and converting the system probability matrix in the Fourier domain; storing the projection data into a measurement data vector; providing an initial polar or cylindrical image estimate; for each iteration; recalculating the polar or cylindrical image estimate according to an iterative solver based on forward and back projection operations with the system probability matrix in the Fourier domain; and converting the polar or cylindrical image estimate into a Cartesian image representation to thereby obtain a reconstructed image.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07983465&OS=07983465&RS=07983465
owner: Société  De Commercialisation Des Produits De La Recherche Appliquée - Socpra Sciences Santé  Et Humaines, S.E.C.
number: 07983465
owner_city: Sherbrooke, Quebec
owner_country: CA
publication_date: 20080509
---
This application claims the benefit of U.S. Provisional Patent Application Ser. No. 60 924 311 filed on May 9 2007 the specification of which is expressly incorporated herein in its entirety by reference.

The present invention relates to the reconstruction of images in particular but not exclusively tomographic images representing the distribution of some characteristic across a sectional plane 2D mode or a volume 3D mode of a body under investigation from measurements of an apparatus.

The present invention relates more particularly but not exclusively to iterative reconstruction methods and to direct reconstruction methods based on the singular value decomposition SVD used for Positron Emission Tomography PET and for Single Photon Emission Computed Tomography SPECT and for Computed Tomography CT .

Tomography refers to the cross sectional imaging of an object from either transmission emission or reflection data collected from many different directions. Tomographic imaging deals with reconstructing an image from such data commonly called projections. From a purely mathematical standpoint a projection at a given angle is the integral of the image in the direction specified by that angle. Most of the powerful new medical imaging modalities that have been introduced during the last four decades such as Computed Tomography CT Single Photon Emission Computed Tomography SPECT Positron Emission Tomography PET Magnetic Resonance Imaging MRI and 3D ultrasound US were the result of the application of tomographic principles.

The present invention relates to general tomographic reconstruction problems and therefore can be adapted to address all the aforementioned imaging modalities. However for convenience and simplicity the present specification is concerned with resolving PET image reconstruction problems keeping in mind that the present invention could be used to resolve general tomographic reconstruction problems.

Positron emission tomography is a non invasive imaging modality which is said to be metabolic or functional since it allows to measure and localize the biodistribution of a radio element injected inside the body under investigation. The fundamentals of PET imaging is based on the localization of a positron source within the tissues of the subject by the detection of two oppositely directed gamma rays emitted during the annihilation of the positron. An approximate localization of the site of disintegration along a line is possible by detecting simultaneously the two annihilation photons with opposed detector of the camera. This region where the disintegration could have taken place known as line of response LOR tube of response TOR or coincidence line is defined by the volume joining the two detectors that received the annihilation photons. The time of detection of both annihilation photons must be measured and compared to validate that the two photons where emitted at the same time and thus have a high probability of coming from the same disintegration. A PET scan consists of measuring and comparing the time of occurrence of every detected photon in the camera to record the coincident events that occur between all possible detector pairs which represent all the TORs of the camera. Using those measurements an image of the biodistribution of the tracer injected in the subject could be obtained with image reconstruction methods.

A PET imaging system is typically composed of many 511 keV gamma ray detectors disposed on at least one ring or on a stack of many rings of detectors. The system also include a signal processing unit used to extract information relevant to the PET measurements e.g. the time the energy and the position of the detected photon and a coincident sorter unit used to verify and count coincident events between all pairs of detectors in the camera. The imaging system can be used in two dimensional acquisition mode where coincidence measurements are performed only between detectors in the same ring. Some apparatus also allow three dimensional acquisition mode where coincidence measurements can be performed between detectors at different ring positions.

The geometries and the disposition of all sensing elements in a system is an important aspect when addressing the problem of reconstructing an object from a measure of its projections. A first solution to this problem date back to the paper by Radon in 1917 which proposed the inverse Radon transform. Those works lead to the development of analytical reconstruction algorithms which aim at solving the inverse Radon transform by considering every tubes of response TORs of the camera as an infinite thin line joining the two coincident detectors. One of the most common algorithm of this class is the filtered backprojection FBP algorithm which makes use of the projection slice theorem. Some drawbacks of the method is the presence of artifacts and the misplacements of some radioactive objects in the reconstructed image due to the over simplification of the TOR functions by an infinite thin line.

A solution to this problem consists of modeling more closely the function representing the detection sensibility along the TORs which depends on the geometries and on the position of the two coincident detectors. Such a function is commonly called a coincidence aperture function CAF and could be obtained analytically or from a Monte Carlo simulation. Using the CAF of every TOR of the camera a probability matrix relating the radioactive density of every pixel in the image to the measurements made on every TOR of the camera could be obtained. The problem could then be represented by the following relation y Af 1 where each coefficient aof the probability matrix A represents the probability that an event produced in the jpixel of the image vector f has been detected by the idetector pair of the measurement vector y. The resolution of this problem could be addressed by two broad class of image reconstruction methods direct methods which consist of inverting the probability matrix to obtain the image directly from a vector matrix multiplication between the inverted matrix and the camera measurements and iterative methods which consist of making some successive estimates of the density distribution of the image in respect to the probability matrix and to the measurements until the image converge to a solution that meet given criteria.

Direct and iterative methods both have some advantages and drawbacks. Irrespectively to the method used the main goal of reconstructing an image from its projections is to obtained an image that is as close as possible to the true density distribution of the object being imaged. In that respect characteristics like spatial resolution image contrast signal to noise S N ratio are aspects which can improve the detection accuracy but these should not be obtained at the expense of having some artifacts in the image which could lead to false detections. The computation time of the algorithm can also play a role in the selection of the most appropriate algorithm to use for a given scanner and in a given context of utilization like in clinical applications. A review of prior methods will be made in the light of those considerations.

A direct image reconstruction method based on pseudo inversion of matrices may be found in Llacer Tomographic image reconstruction by eigenvector decomposition Its limitations and areas of application . The idea was to multiply both side of equation 1 by the transpose of the probability matrix which result in Ay AAf 2 and to obtain the image by inverting the matrix AA which can be expressed as 3 

The matrix to inverse is now AA and the pseudo inversion operation is facilitated by the fact that AA is a symmetric matrix. In this form the matrix AA can be viewed as a two dimensional blurring matrix of the PET imaging system since it is obtained from the product of a backprojector Aand a projector A of the imaging system. One of the drawback of the method is the high condition number CN largest divided by smallest eigenvalue of the blurring matrix for tomographic reconstruction problems. The high CN leads to imprecision in the computation of eigenvectors corresponding to the smallest eigenvalues. Another drawback is the computational burden of the pseudo inversion operation. Moreover the measurement must be backprojected by Abefore being multiplied by the pseudo inverse of AA which however does not add much computation compared to the pseudo inversion operation.

A method to accelerate the blurring matrix AA pseudo inversion was proposed by Barber Barber Image reconstruction European patent specification 1992 . The method consists of taking advantage of the block circulant structure emanating from the blurring matrix AA when the projector A and the backprojector Aare strip functions defined in the continuous domain. The pseudo inversion of the block circulant blurring matrix can then be performed independently on smaller sub matrices by using the properties of the Fourier transform. The discretization of the image into square pixel elements is performed during the last step of backprojecting the result of the multiplication between the inverted blurring matrix and the measurements which lead to the following relation 4 

One can notice that equation 4 is equivalent to equation 3 but with a different operation ordering. Barber has also pointed out that the backprojector can be some other function than the transpose of the projector.

The coefficients of the block circulant AA matrix can be viewed as a natural pixel decomposition of a two dimensional image. Buonocore Buonocore A natural pixel decomposition for two dimensional image reconstruction 1980 was the first to propose the term natural pixel to define pixels arising naturally out of the geometry of the X ray beam paths used to measure the projections. One advantage of such an image decomposition is that it preserved the symmetries between the TORs of a camera leading to a block circulant structure of the AA matrix. The projector A and the backprojector Aused in this formulation of the problem are strip functions defined in the continuous domain. The discretization of the forward projection matrix A into square pixels in a Cartesian grid representation like the projector used in Llacer Tomographic image reconstruction by eigenvector decomposition Its limitations and areas of application would broke the symmetries between the TOR functions and will therefore not lead to a block circulant blurring matrix. This observation was pointed out by Baker who also proposed using natural pixel to facilitate the inversion problem in tomographic image reconstruction Baker Generalized approach to inverse problems in tomography Image reconstruction for spatially variant systems using natural pixels 1992 . In this work Baker proposed to accelerate pseudo inversion of the blurring matrix through the used of the singular value decomposition SVD on a Fourier transformed version of the block circulant blurring matrix. To obtain the final image the result of the multiplication between the pseudo inverse blurring matrix and the measurement vector is backprojected.

It was shown by Shim Shim SVD Pseudoinversion image reconstruction 1981 that the pseudo inverse of matrices by singular value decomposition techniques can be performed directly on the system probability matrix A as stated in equation 1. One advantage of performing the SVD directly on the system matrix A is that the CN for such problems will be lower then one obtained for the blurring matrix AA. When a lower CN is encountered the SVD algorithm will be less affected by computer precision limitations which will lead to better estimate of smaller singular values and of the corresponding singular vectors. Another advantage of the method is that the reconstructed image can be obtained directly from the multiplication of the inverted matrix with the measurement vector which avoids the used of a backprojection matrix. In other words the quality of the reconstructed image is not influenced by the modeling of the backprojection matrix. This is a significative improvement since it is easier and more precise to include all the physical aspects of the imaging process in the projection matrix than in the backprojection matrix. Vandenberghe Vandenberghe Reconstruction of 2D PET data with Monte Carlo generated natural pixels has shown that it is possible to include a more realistic modeling of the imaging process inside the natural pixels decomposition emanating from the blurring matrix AA by using a Monte Carlo simulation. However Vandenberghe fails to include the modeling of the system in the backprojection matrix.

A drawback of performing the SVD directly on the probability matrix A is the computational burden of decomposing such a large matrix for ill posed problems. Selivanov Selivanov Fast PET image reconstruction based on SVD decomposition of the system matrix proposed to perform the SVD step only once for a given PET scanner configuration. The resulting image reconstruction algorithm is really fast since it required only a matrix vector multiplication between the inverted probability matrix and the measurement vector. However due to limitations in computation power available memory size and floating point precision of current computer the SVD inversion can only be performed for modest size imaging problem.

Iterative image reconstruction methods consist of estimating the density distribution of the image in respect with the system probability matrix and the measurements made on all TORs of the imaging system. Two wide class of methods are based on this approach Algebraic reconstruction methods and statistical reconstruction methods. Algebraic reconstruction methods consist of resolving directly the system of equation by some iterative process. Instead of solving directly the system of equations statistical image reconstruction methods can include some probability distribution in the iterative process. Those methods thus have the advantage of taking into account the stochastic nature of the detection process. This could lead in a better estimate of the object density especially in the case of low projection statistics.

It has been shown that iterative reconstruction methods based on a probability matrix of the system could lead to images with higher spatial resolution and with a more uniform signal to noise SNR distribution than analytical methods like FBP. Nevertheless a drawback of iterative methods is the computational burden coming from the many iterations required before the image reach final convergence. Moreover the number of computation required at each iteration step become more important as the size of the probability matrix A increased equation 1 . The size of the probability matrix depends on the number of TORs measured by the camera and on the number of pixels in the reconstructed image and also on the accuracy of the acquisition model use to derive the matrix. For an imaging system composed of many detector rings and operating in full three dimensional 3D acquisition mode the events detected in millions of TORs can be recorded leading to a very huge system matrix and therefore required a lots of computations when true 3D iterative image reconstruction is performed. By true 3D iterative image reconstruction methods we mean a method that use all relevant information collected by the camera to estimate every pixels of the image.

In contrast some approximate 3D iterative image reconstruction methods use data rebinning of 2D reconstructed image to estimate the 3D image distribution. In such algorithm the 3D projection data is first sorts into smaller 2D data set containing the TOR measurements for each transaxial slice to be reconstructed. All the different slices are then reconstructed independently using a 2D iterative image reconstruction algorithm based on a smaller probability matrix which relates only the measurements and pixels belonging to the same 2D slice. All the 2D slices are then rebinned together to estimate the 3D image distribution. By decomposing the 3D image reconstruction problems into smaller independent 2D image reconstruction problems a significant reduction of the computation time is achieved. The use of a smaller 2D probability matrix also avoids the cumbersome handling of a huge 3D probability matrix. Nevertheless this oversimplification of the initial problems can lead to mispositioning and or to non optimal estimate of some source activity in the 3D image.

To accelerate true 3D iterative image reconstruction methods and make them fast enough for day to day use in clinical applications one can address one or more of the following problems 1 the number of iterations required by the algorithm to converge 2 the number of operations required in each iteration loop and 3 the size of the system matrix. The acceleration of 3D iterative methods can also be obtained by sharing the task of computation over many parallel processors and or by using a more powerful computation unit.

In the literature most effort in accelerating iterative image reconstruction methods have been concentrated in addressing the first aspect which consists of reducing the number of iterations required to converge to the optimal image. Probably the most known example of such an acceleration technique is the Ordered Subsets Expectation Minimization OSEM algorithm Hudson Accelerated image reconstruction using ordered subsets of projection data 1994 which leads to acceleration of the convergence of the well known Maximum Likelihood Expectation Minimization MLEM algorithm that was first proposed by Shepp and Vardi Shepp Maximum likelihood reconstruction for emission tomography 1982 . The OSEM algorithm consists in dividing the projection measurement into small subsets or blocks and updating the image estimate using only the data of one subset at a time. One complete iteration loop is completed when all the subsets have been used in the update of the image estimate. This strategy provides an order of magnitude acceleration over the MLEM algorithm which is proportional to the number of subsets used. Many other solutions to accelerate the convergence of iterative algorithms are proposed in the literature but will not be presented here since they have less to do with the present invention.

Another strategy for accelerating the speed of iterative algorithms consists of minimizing the number of operations involved in each iteration loop. For most iterative image reconstruction algorithms the main computational burden comes from the matrix vector operations involved in the forward and back projection steps that are performed at each iteration loop. The number of operations in the forward and back projection steps depends on the size and on the sparsity of the system matrix. In PET the matrix coefficients are non null only for pixels or voxels which have a non null probability of emitting a disintegration that is detected by a given TOR. Using a simplified geometrical model of the acquisition process many matrix coefficients are null and do not have to be stored. By storing the system matrix in a sparse format both the memory requirements and the computational burden are reduced by using only the non null values while performing computations in the forward and back projection steps. However for some complex 3D image reconstruction problems the sparse probability matrix could still be very huge.

The size of the probability matrix is really becoming a problem when it is too large to fit in the random access memory RAM of a given processor or dedicated hardware computational unit. A solution consists in storing the precomputed system matrix in a larger memory location usually a hard disk and to access only sub part of the precomputed system matrix during the forward and back projection steps. The overhead of reading large amount of information on a hard disk could lead to very long delay for the image reconstruction procedure. Another solution consists in recomputing on the flag all the system matrix coefficients at each iteration loop to avoid storing them. Some simplifications of the acquisition model should however be used while computing the system matrix coefficients to keep the computation time within acceptable delay. Those simplifications in the system matrix will affect the quality of the reconstructed image.

A strategy for reducing the memory requirements for storing the system matrix consists of taking advantage of the symmetries between the TORs of a camera to store only non redundant part of the system matrix. In plane symmetries come from the angular repetitions of blocks of detectors within the ring of an imaging system. In plane angular symmetries can also be obtained by performing successive measurements taken at different angle position using for example a rotating detector gantry. For camera operating in 3D acquisition mode one can also take advantage of the axial symmetries present between the different detector rings. Some mirror symmetries could also be retrieved for some camera configurations. Most image reconstruction methods presented in the literature are based on a Cartesian image representation which have the consequence of broking most of the system symmetries in the system matrix. A solution consists of using a basis function defined according to a polar or cylindrical coordinate grid that is specifically designed to preserve all symmetries of a given camera configuration in the system matrix. The idea of using a polar image was first proposed by Kearfott Kearfott K. J. Comment Practical considerations Journal of the American Statistical Association March 1985 pp. 26 28 . This solution was proposed to overcome the memory limitation of computer of that time according to the size of probability matrix used in two dimensional iterative image reconstruction techniques. One drawback of the polar image configuration used by Kearfott is that a fixed number of pixels are used at every radius position which has the consequence of dividing the image into very thin pixels at the center and into wide pixels at the border of the field of view. The important size disparities between the innermost and the outermost pixels of the image could result in over resolution in the center of the image and in degradation of the imaging system spatial resolution farther from the center. Moreover Kaufman argued that for statistical reasons pixels with similar area should be used by iterative algorithms.

To overcome the problem of size disparities between the polar pixels Kaufman Kaufman Implementing and accelerating the EM algorithm for positron emission tomography proposed to use a polar image with different number of pixels at each radius position and with variable distances between successive radius positions in such a manner that pixels of similar area are obtained. In this paper Kaufman showed that important memory saving can be obtained by using a polar image in replacement of a Cartesian image. However the proposed polar image reconstruction algorithm did not result in significant acceleration of the forward and back projection steps.

Hebert Hebert Fast MLE for SPECT using an intermediate polar representation and a stopping criterion also proposed the use of a polar image representation. In this work it was shown that the polar image based system matrix can be reordered into a matrix having a block circulant structure. The block circulant system matrix can then be converted in the Fourier domain in order to reduce the number of operations involved in the forward and back projection steps of iterative image reconstruction methods. One drawback of converting the probability matrix in the Fourier domain comes from the fact that a lot of null values in the matrix become non null during the Fourier transform which increase the matrix size. Another drawback of the method proposed by Hebert is that the polar image used has a constant number of pixels at every radius position which results in size disparities between innermost and outermost pixels. To avoid the potential problem of using pixels with size disparities in iterative algorithm Hebert converts the polar image representation into a Cartesian image representation before performing the image update. However this conversion from a polar to a Cartesian image representation and then from a Cartesian to a polar image representation can result in a loss of spatial resolution due to divergences between the pixels size and position of the polar and Cartesian images. Moreover since a dense system matrix in the Fourier domain is used in the computation the gain of speed compared to the traditional method based on a sparse system matrix in the spatial domain rapidly vanishes as the number of symmetries in the camera become small compared to the number of detectors within a ring.

An object of the present invention is to provide an imaging system and method to model the response functions of the apparatus which minimize the size of the system matrix that can be used by direct and or by iterative image reconstruction methods.

Another object of the present invention is to provide fast methods for computing the pseudo inverse of the said probability matrix using singular value decomposition and fast methods to compute the image using the pseudo inverse matrix.

Another object of the present invention is to provide accelerated methods for computing the forward and back projection steps in the iteration loops of iterative image reconstruction methods.

More specifically in accordance with a first aspect of the present invention there is provided an imaging system. The imaging system comprises a plurality of detectors each so configured as to generate a signal which is used to make measurements of an object along a respective projection a translating table so configured as to receive an object thereon and operable to translate in relation to the plurality of detectors a signal processor so coupled to the plurality of detectors as to receive and process the signals generated by the detectors the signal processor being so configured as to extract relevant information in accordance with an imaging modality of the imaging system an acquisition system so coupled to the signal processor as to collect the information extracted by the signal processor and information about an actual position of the translating table the acquisition system being so configured as to produce projection data and an image reconstructor so coupled to the acquisition system as to receive the projection data and reconstruct an image in response to the projection data. The image reconstructor is so configured as to reconstruct the image by choosing a polar or cylindrical image definition which comprises a polar or cylindrical grid representation and basis functions defined over the polar or cylindrical grid in order to preserve symmetries between lines of response of the imaging system computing a probability matrix that relates each of the projection data to each basis function of the polar or cylindrical grid representation restructuring the probability matrix into a block circulant matrix computing a polar or cylindrial image of the object using the block circulant matrix in Fourier domain and converting the computed polar or cylindrical image into a Cartesian image representation to thereby obtain a reconstructed image of the object.

According to a second aspect of the present invention there is provided an iterative image reconstruction method to be used in connection with an imaging system that generates projection data. The reconstruction method comprises the steps of a collecting the projection data generated by the imaging system b choosing a polar or cylindrical image definition which comprises a polar or cylindrical grid representation and a number of basis functions positioned according to the polar or cylindrical grid so that the number of basis functions at different radius positions of the polar or cylindrical image grid is a factor of a number of in plane symmetries between lines of response along which the projection data are measured by the imaging system c obtaining a probability matrix that relates each of the projection data to each basis function of the polar or cylindrical image definition d restructuring the probability matrix into a block circulant matrix and converting the probability matrix in Fourier domain to accelerate matrix vector operations using the probability matrix e storing and arranging in a suitable form the projection data into a measurement data vector f providing an initial polar or cylindrical image estimate g for each iteration recalculating the polar or cylindrical image estimate according to an iterative solver that is based on forward and back projection operations with the probability matrix in the Fourier domain and h converting the polar or cylindrical image estimate into a Cartesian image representation to thereby obtain a reconstructed image.

According to a third aspect of the present invention there is provided an iterative image reconstruction method to be used in connection with an imaging system that generates projection data. The reconstruction method comprises the steps of a collecting the projection data generated by the imaging system b choosing a polar or cylindrical image definition which comprises a polar or cylindrical grid representation and a number of basis functions positioned according to the polar or cylindrical grid so that the number of basis functions at different radius positions of the polar or cylindrical image grid is a factor of a number of in plane symmetries between lines of response along which the projection data are measured by the imaging system c obtaining a probability matrix that relates each of the projection data to each basis function of the polar or cylindrical image definition d restructuring the probability matrix into a block circulant matrix and converting the probability matrix in Fourier domain to accelerate matrix vector operations using the probability matrix e storing and arranging in a suitable form the projection data into a measurement data vector f providing an initial polar or cylindrical image estimate g for each iteration and using an iterative solver i converting the polar or cylindrical image estimate in the Fourier domain so that it can be forward projected with the probability matrix in the Fourier domain to obtain a measurement data estimate that is further converted back in space domain using the inverse Fourier transform ii computing a measurement correction vector using the measurement data estimate and the measurement data vector iii converting the measurement correction vector in the Fourier domain so that it can be back projected with the probability matrix in the Fourier domain to obtain a polar or cylindrical image correction vector that is further converted back in the space domain using the inverse Fourier transform and iv computing a new polar or cylindrical image estimate using a current polar or cylindrical image estimate and the polar or cylindrical image correction vector going back to step i for further iterations until the polar or cylindrical image estimate reaches convergence and h converting the polar or cylindrical image estimate into a Cartesian image representation to thereby obtain a reconstructed image.

According to a fourth aspect of the present invention there is provided a direct image reconstruction method to be used in connection with an imaging system that generates projection data. The method comprises the steps of a collecting the projection data generated by the imaging system b choosing a polar or cylindrical image definition which comprises a polar or cylindrical grid representation and a number of basis functions positioned according to the polar or cylindrical grid so that the number of basis functions at different radius positions of the polar or cylindrical image grid is a factor of a number of in plane symmetries between lines of response along which the projection data are measured by the imaging system c computing a probability matrix that relates each of the projection data to each basis function of the polar or cylindrical grid representation d restructuring the probability matrix into a block circulant matrix and converting the probability matrix in Fourier domain to accelerate matrix vector operations when using the probability matrix e storing and arranging in a suitable form the projection data into a measurement data vector f pseudo inverting the block circulant matrix using singular value decomposition SVD to produce a pseudo inverse of the circulant matrix g computing a polar or cylindrical image estimate by performing a matrix vector product in the Fourier domain between the pseudo inverse of the circulant matrix and the measurement data vector and k converting the polar or cylindrical image estimate into a Cartesian image representation to thereby obtain a reconstructed image.

It is to be noted that the expression lines of response may be used interchangeably with the expression tubes of response herein and in the appended claims.

It is also to be noted that the expression is a factor of is to be construed as meaning is equal is an integer fraction or is an integer multiple of herein an in the appended claims.

Furthermore it should be noted that the terms probability matrix may be used interchangeably with the terms system matrix .

The foregoing and other objects advantages and features of the present invention will become more apparent upon reading of the following non restrictive description of an illustrative embodiment thereof given by way of example only.

Generally stated a non restrictive illustrative embodiment of the present invention provides for an imaging system and methods of computing image reconstructions using a system matrix that relates the measurements of the imaging system to the pixels or voxels of the image wherein the pixels or voxels are positioned according to a polar or cylindrical coordinate grid. The imaging system can be measuring Positron Emission Tomography PET or can be other imaging modalities for example but not restricted to Computed Tomography CT Single Photon Emission Computed Tomography SPECT and ultrasound imaging US . The polar or cylindrical image is discretized according to basis functions defined over a polar coordinates image grid in such a way that the symmetries present between the tubes of responses TORs of the imaging system are preserved during the computation of the system matrix coefficients. Those symmetries allow to reorder the system matrix into a block circulant matrix. The non restrictive illustrative embodiment of the present invention also provides ultra fast image reconstruction methods based on the multiplication of a pseudo inverse of the block circulant probability matrix with the camera measurements in the Fourier domain. The non restrictive illustrative embodiment of the present invention also provides methods for accelerating iterative image reconstruction algorithms by performing the forward and backward matrix multiplication operations with block circulant matrices in the Fourier domain.

More specifically the imaging system includes detecting elements positioned in such a way that many symmetries arise from the lines of response of the imaging system which can be used to reduce the size of the system probability matrix and to accelerate the image reconstruction methods. The imaging system also includes a translating table or a bed which can be translated axially z axis and a system that can monitor the bed position and save this information in the data flow. For three dimensional image reconstruction the bed axial position can be used to add more axial symmetries in the imaging system and to increase the measurement statistics by combining the information coming from the acquisition frame performed at different bed positions.

An image discretized according to a polar or cylindrical coordinates grid is used to create a system probability matrix which has redundancies between the matrix coefficients related to the symmetric TORs of the imaging system. This allows to re use some parts of the system matrix for all the symmetric TORs. By storing only non redundant parts of the system matrix the memory requirement is reduced by a factor equal to the number of system symmetries. The probability matrix coefficients can be derived from analytical models Monte Carlo simulations or by some other methods. The polar or cylindrical image is designed in such a way that the symmetries between the TORs of the camera are preserved during the computation of the probability matrix coefficients. This condition is satisfied given that the number of pixels or voxels at every radius position of the polar or cylindrical image is a factor of the number of in plane symmetries such as is equal or is an integer fraction or an integer multiple of the number of in plane symmetries. The pixels used in the polar or cylindrical image can be overlapping and or can be of different shape as long as the computation of the coefficients of the matrix preserves the redundancies in the system probability matrix.

It is well known that the product operation between a circulant matrix and a vector results in less operations when performed in the Fourier domain. This property between circulant matrix and the Fourier transform can also be exploited for block circulant matrices. In the case of two dimensional image reconstruction problems the system matrix have a block circulant structure and can be converted in the Fourier domain by using Fourier transform or Fast Fourier Transform FFT applied on the first column of every small circulant sub matrices. The same technique also applies to three dimensional 3D image reconstruction problems. However the presence of axial symmetries in 3D problems can also be used in such a way that the system matrix can be reordered into a block circulant structure where each block includes block circulant matrices. In one example the three dimensional probability matrix can be converted in the Fourier domain only once which results in performing the Fourier transform only on small circulant sub matrices made from in plane system symmetries. In another example the three dimensional probability matrix can be converted in the Fourier domain twice which results in first performing the Fourier transform on circulant sub matrices made from in plane symmetries and then performing a second Fourier transform on circulant sub matrices made from axial symmetries.

Furthermore ultra fast image reconstruction methods based on the multiplication of a pseudo inverse of the block circulant system matrix with the camera measurements in the Fourier domain are provided. The matrix pseudo inverse is obtained using singular value decomposition SVD techniques. The block circulant system matrix can be obtained from two dimensional or three dimensional image reconstruction problems. The non restrictive illustrative embodiment of the present invention comprises the preliminary steps of computing the system probability matrix for the selected imaging system and polar or cylindrical image representation reordering the system matrix into a matrix having a block circulant structure and converting the block circulant matrix in the Fourier domain. The image reconstruction methods comprise the steps of 1 performing the SVD decomposition on the block circulant system matrix in the Fourier domain 2 using the SVD result to compute the pseudo inverse of the system matrix 3 performing the matrix vector multiplication between the pseudo inverse matrix and the measurement vector in the Fourier domain to obtain the image vector and 4 performing the inverse Fourier transform on the image vector and 5 performing a polar to Cartesian transformation on the image vector to obtain an image that can be visualized on a conventional display. Different variations in every step of this procedure are possible leading to different algorithms having some advantages and some inconveniences. A first image reconstruction algorithm consists in performing step 1 to step 5 each time a new measurement data set is to be reconstructed. This method is slow but also gives the maximum flexibility since the system matrix can be modified prior to the reconstruction procedure. A second image reconstruction algorithm consists in performing step 1 only once and performing step 2 to step 5 each time a new measurement data set is to be reconstructed. This method allows to modify the regularization parameter in step 2 to control the trade off between the spatial resolution and the noise amplification in the reconstructed image. A third image reconstruction algorithm consists in performing step 1 and step 2 once and performing step 3 to step 5 each time a new measurement data set is to be reconstructed. This method allows to update the image in a continuous fashion by reconstructing independently small groups of pixels or voxels .

Also methods for accelerating iterative image reconstruction techniques by performing the forward and back projection matrix vector multiplication operations with a block circulant matrix in the Fourier domain are provided. The block circulant matrix can be obtained from two dimensional or three dimensional image reconstruction problems. The iterative algorithm can be a version of the Maximum Likelihood Expectation Minimization MLEM or a version of another algorithm like for example but not restricted to Ordered Subset Expectation Minimization OSEM Rescaled Block Iterative RBI Block Iterative Simultaneous MART algorithm BI SMART or Penalized Weighted Least Squares PWLS algorithm.

Irrespectively to the iterative algorithm used the non restrictive illustrative embodiment of the present invention comprises the preliminary steps of computing the system probability matrix for the imaging system and the polar or cylindrical image representation reordering the system matrix into a matrix having a block circulant structure converting the block circulant matrix in the Fourier domain and saving the resulting Fourier matrix in a sparse matrix format. An advantage of the non restrictive illustrative embodiment of the present invention comes from the saving of the complex system matrix into a sparse matrix format which allows to access only a group of non null data when matrix vector operations are performed.

Irrespectively to the iterative algorithm used the non restrictive illustrative embodiment of the present invention comprises the steps of 0 providing a first image estimate 1 converting the image estimate in the Fourier domain 2 multiply completely or partly the image estimate with the direct system matrix in the Fourier domain to obtain an estimate of all or part of the apparatus measurements in the Fourier domain 3 convert the measurements estimate back in the time domain to apply a correction with the measurements acquired by the imaging system 4 transform the obtained measurement correction vector in the Fourier domain 5 multiply completely or partly the measurement correction vector with the transposed system matrix in the Fourier domain to obtain all or part of the image correction vector in the Fourier domain 6 convert the image correction vector back in the space domain to apply the correction to the current image estimate and 7 go back to step 1 until convergence is achieved. When the iteration loop is stopped the non restrictive illustrative embodiment of the present invention comprises one last step of converting the polar or cylindrical image into a square pixel Cartesian image so that the image can be shown on a conventional display. There are provided different methods for implementing the aforementioned steps of the iterative algorithm so that the time required to perform all operations included in one iteration loop is minimized for the image reconstruction problem and for the processor or hardware architecture used. In one embodiment the conversion of the sparse block circulant system matrix in the Fourier domain can be performed on the flag during the iteration loop to minimize the memory requirements for storing the system matrix. Memory requirements can be reduced even more by computing on the flag the system matrix coefficients at each iteration loop.

While the non restrictive illustrative embodiment of the present invention is described with respect to apparatus and methods of reconstructing an image using techniques for positron emission tomography PET imaging systems the following apparatus and methods are capable of being adapted for various purposes including but not limited to the following applications Computed Tomography CT systems X ray imaging systems Single Photon Emission Computed Tomography SPECT systems ultrasound systems and other applications known in the art.

Referring to a pictorial view of a PET imaging system utilizing methods of reconstructing an image of a subject is shown. A high spatial resolution PET Imaging system dedicated for small animal is illustrated as an example only the non restrictive illustrative embodiment of the present invention can also be applied to cameras dedicated to human subjects which can have a lower spatial resolution. The imaging system includes a gantry which contains one or many detector rings . Each detector emits a signal when it detects one of the two annihilation photons generated by a beta disintegration coming from tracers injected inside the subject . The gantry also includes electronic and or digital circuits which amplify and process the signal produced by the detectors in order to extract valuable information for the PET measurement. PET information is transmitted from the gantry to a mass storage unit through high speed communication links . The imaging system also includes an operator console which is used to send instructions to the main controller by some links to control the PET acquisition processes and the bed position. The bed position can be translated along the z axis direction inside the rings of detector by sending commands to a high precision step motor . The operator console can also retrieve valuable PET information from the mass storage unit through some links and process the data to reconstruct an image of the density distribution of the tracer injected in the subject . The image can be sent to a display for visualization.

A more detailed description of the acquisition process is illustrated in a block diagrammatic view of the imaging system in . The acquisition process is controlled from an operator console which is used to send commands to the main controller . The main controller can control the detectors the front end electronics the signal processor the coincidence sorter system the acquisition system and or the bed motor controller . The front end electronics are used to amplify and shape the signal coming from all the detectors within the rings . As soon as a photon is detected by a detector valuable PET information like for example but not limited to the time stamp the detector address and the signal energy are extracted by signal processors . Signal processors can be composed of analog and or digital circuits. All events detected by the signal processor are sent with all their information to the coincidence sorter system in order to retrieve the pair of photons that have been detected in a time nearby thus having a high probability of coming from the same disintegration. Valid coincidence events the ones that contribute to the count of a given tube of response TOR of the camera are sent to a mass storage unit through fast communication links to be saved. The flow of information being sent by the acquisition system to the mass storage unit includes information about the axial z axis bed position. This information is sent by the bed motor controller . An accurate axial positioning of the bed is a useful information according to some aspects of the present invention and therefore this information can be included by some means in the acquisition data flow. During the acquisition process the operator can ask for a real time image reconstruction of the subject through a command send from the operator console to the main controller . Coincidence measurements are then retrieved from the mass storage unit and sent to the real time image reconstructor that reconstructs a two dimensional or a three dimensional image of the subject in a very short time. The image is sent to a display unit and is continuously updated with new collected data as the acquisition progress. The reconstructed image will represent the density distribution of the tracer injected in the subject inside the region include in the camera useful field of view FOV . During or after the acquisition process the operator can ask for an iterative image reconstruction through a command sent from the operator console to the main controller . The coincidence measurements are then sent to the iterative image reconstructor for a two dimensional or a three dimensional image reconstruction. The iterative image reconstructor is slower than the real time image reconstructor but can lead to images of better quality. Although the real time image reconstructor and or the iterative image reconstructor are methods that can be performed by a conventional PC a more powerful computer or dedicated hardware computation unit can also be used to accelerate the image reconstruction at a higher cost.

An aspect of the non restrictive illustrative embodiment of the present invention is to provide a fast two dimensional and or three dimensional image reconstructor which allows for the instant visualization of the image estimate while the patient is being scanned. This would make early identification of problems related to data acquisition easier. For example subject positioning would be facilitated thus preventing tracer reinjection and retaking scans if the desired region of interest ROI is found to be partially outside the FOV. Having an image online one would also be able to stop scanning as soon as the data statistics is deemed sufficient which would allow to increase the patient throughput.

The fast image reconstructor can also be used to perform fast visual inspection of many 2D or 3D acquisition data frames previously saved into the mass storage unit or into some other storage unit in order to retrieved data sets which contain the most valuable information for answering a given question. A slower but by some means more accurate iterative image reconstructor can then be used to reconstruct the selected data set to provide an image of higher quality for the final diagnostic. In that respect it is very advantageous to use the image reconstructor for reconstructing the many acquisition frames obtained from gated and or dynamic acquisitions.

The real time image reconstructor forms a direct method based on the multiplication in the Fourier domain of an inverted block circulant system matrix with a vector containing the measurement collected by an imaging system. The inverted block circulant matrix is obtained by the pseudo inversion of a block circulant probability matrix with singular value decomposition SVD . The accelerated iterative image reconstructor solves by the use of different kind of iterative solvers an equation relating a vector containing the imaging system measurements to a vector containing the pixels or voxels value of an image through a block circulant probability matrix. The iterative methods are accelerated through the use of a block circulant system matrix in the Fourier domain for performing the forward and the back projection steps which are required by most iterative image reconstruction solvers. By considering for example that the real time image reconstructor and the iterative image reconstructor are optimized to reconstruct images for the same imaging system both reconstructors will be based on the same block circulant system probability matrix. To avoid redundancies the following description will be separated into three main sections. The first section will present the different aspects relating to the conception of the block circulant system probability matrix. The second section will present the different aspects relating to the real time image reconstructor based on the SVD pseudo inversion of the block circulant system matrix. The third section will present the different aspects relating to the iterative image reconstructor based on different solvers which use the block circulant system matrix to accelerate computation in the forward and back projection steps in the iterative loop.

Tomographic imaging involves a limited number of measurements of some physical property of interest taken along projections of an object having a continuous spatial distribution. The process of measuring data along projections is naturally represented by a discrete continuous model that relates the discrete measurements to some integral transformation of a function of continuous spatial variables. This could be stated by the following relation 1 . . . 5 where is one of the N discrete measurements f x y z is the spatial distribution of the object at x y z and h x y z represent the contribution of the imeasurement of a point of unit strength located at x y z . The parameter denotes the finite domain of the spatial distribution where the integration in the continuous domain is performed. For example in emission tomography the limit is due to the fact that the contribution of the image to a measurement taken along a given tube of response TOR of the apparatus are null or could be neglected for region of the image falling outside the TOR.

In order to solve tomographic image reconstruction problems with the methods of the present invention the discrete continuous model of equation 5 is converted into a discrete discrete model. The conversion of the continuous image representation into a discrete image representation can be performed by using a finite series expansion involving a chosen set of basis functions. The obtained discrete image representation x y z is now an approximation of the continuous image representation f x y z generated by the linear combination of a finite number B of basis functions 

According to equation 8 and equation 6 the system matrix A depends both on the nature of the apparatus leading to the measurement vector and on the basis function b x y z used to discretized the image into a vector of B source voxels. The imaging system will in turn depends on the physics relating to the imaging modality on the geometry and position of the detecting elements of the apparatus in some cases on the characteristics of an external source and on other considerations specific to the given imaging modality used.

Irrespectively to the imaging modality used a two dimensional 2D and or a three dimensional 3D system probability matrix A with a block circulant structure is provided in order to reduce the number of different coefficients athat are computed and or that are stored in memory to fully defined the system matrix A. Moreover the properties of the Fourier transform are used to reduce and or to accelerate the matrix vector operations between the block circulant system matrix A and the image vector and or the measurement vector . The block circulant system matrix can be obtained by taking advantage of the symmetries arising between the tube of responses TORs of a given imaging system through the use of a 2D or a 3D image with basis functions positioned according to a polar or cylindrical coordinate grid. As an example the block circulant system matrix A will be determined for the case of positron emission tomography. The method for obtaining the probability matrix can be adapted to other imaging modalities.

In the non restrictive illustrative embodiment of the present invention the geometry and the positioning of the detecting elements inside the rings of the imaging system should be designed in order to maximize the number of symmetries arising between the TORs of the camera. Some other considerations related to the design of the apparatus like for example but not limited to the use of a translating bed for which the axial z axis position can be retrieved and inserted into the flow of data can allow to add more symmetries in the system. The maximization of the number of symmetries in the apparatus will in turn provide a maximal reduction of the size of the system matrix and a maximal acceleration of the computational speed for methods related to the image reconstruction using the projection data and the system matrix.

A pictorial view of the detector rings of an imaging system with perfect in plane and axial symmetries between all the detecting elements is shown in . By the term perfect in plane symmetries it is inferred that any detector position within the ring could be obtained by a rotation relative to the ring center of an other detector from an angle equal to 2 k D where D is the number of detectors in the ring and k is an integer from 1 to D. By the term perfect axial symmetries it is inferred that a translation parallel to the axial direction z axis from a given distance d or d should lead to a perfect geometric match between all the detectors of two succeeding rings and this must be true for all the rings in the apparatus.

An example of a PET event detected within the detector rings is shown in in a 3D view a 2D in plane view and a 2D axial view . A positron disintegration emits two annihilation photons in opposite directions along a line falling inside the TOR formed by the detectors and of the camera. The probability of detecting a PET event occurring somewhere inside the TOR formed by the volume in between the coincident detectors and will depend on their relative position and orientation from each other and on the position of their respective neighbor detectors. The position of the neighbor detectors for example the detector having the neighbors and can have an impact on the probability of detecting an impinging photon at a given incidence angle since the photon could have traveled in a neighbor detector and before entering in the detector .

Referring to the 2D in plane view of it is shown that the TOR formed by the coincident detectors and will have the same response function than the TOR formed by the coincident detectors and because of the system in plane symmetries. For a camera with perfect in plane symmetries the total number of in plane rotation symmetries will be equal to the number of detectors within the ring. In this particular case a different response function will only be required for TORs passing at different distances bin position from the center of the ring. Here the term bin position is used to define TORs passing at different distance from the center of the ring. Accordingly the number of TORs having a different response function will be reduced by a factor equal to the number of in plane symmetries for TORs not passing through the ring center all bins except the first one and by a factor equal to half the number of in plane symmetries for the TORs passing exactly through the ring center first bin position .

Referring now to the 2D axial view in it is shown that the TOR formed by the coincident detectors and will have the same response function than the TOR formed by the coincident detectors and because of axial translation symmetries. For a scanner with perfect axial symmetries the maximum number of axial translation symmetries is equal to the number of detector rings. However for TORs formed by coincident detectors in different rings the number of parallel TORs currently measured by the apparatus will be less than the number of rings. This statement is illustrated in where all possible projection planes for a 4 ring scanner architecture are drawn. For direct projection planes which are TORs formed by detectors at the same ring position the number of measured TOR planes is equal to the number of rings in the apparatus. However for projection planes formed by detectors at different ring positions denoted here by the term cross X projection planes where X represents the ring position difference between the coincident detectors the number of parallel projections will depends on X. One should also notice the presence of a mirror symmetry between two projection planes at each parallel position. A mirror symmetry between two cross 3 projection planes TORs and is illustrated in . The mirror symmetries according to a reflection plane can be exploited to allow reusing of one TOR response function for the mirrored TORs and . Accordingly for an apparatus with perfect axial symmetries the parallel and the mirrored axial symmetries allow to fully define the system probability matrix by using only one TOR function for the direct projection planes and one additional TOR function for every cross X projection planes . This will lead to a reduction of the memory requirement by a factor equal to the number of rings.

In the non restrictive illustrative embodiment of the present invention the number of axial symmetries of an apparatus can be extended to a number higher than the number of detector rings by the use of bed translations in the axial direction. The method required that information about the bed position could be retrieved and included in the data flow during the acquisition process as illustrated in . The method consists of translating the bed position along the axial direction z axis by a distance that is equal to an integer factor of the distance d separating two symmetric projection planes. Since some of the TOR measurements acquired by the apparatus at different bed positions can partly recover the same scan region it could be advantageous to combine the measurements taken at different bed positions to improve the statistic collected on each projection plane. This strategy is illustrated in for a 4 ring camera with perfect axial symmetries between the rings. For reason of visibility only the TORs of the cross 3 projection planes in are illustrated. Nevertheless the method also applies for other projection planes. By moving the bed position by a distance d equal to the distance between two symmetric projection planes the data set or frames acquired at different bed positions can be recombined and summed together to form an extended data set. One should notice that for the direct cross 1 and cross 2 projections planes some TORs coming from two or more acquisition frames taken at different bed positions will be taking measurements of exactly the same region. For example considering that and both refer to the same 4 ring apparatus the TORs of the cross 2 projection planes and measured at the bed position will respectively be measuring the same scan region than the TORs of the cross 2 projection planes and taken at the bed position . This reasoning can be extended to all bed positions taken during the whole acquisition process and to all the different projection planes. For the example in this will lead respectively to four three and two times more statistics collected on direct cross 1 and cross 2 projection planes. Since there is only one cross 3 projection plane measured by a 4 ring scanner those projections will never overlap during bed translations except if the displacement is less than a detector height. This overlap of information which will be more or less important on certain projection planes should be considered during the normalization of the system probability matrix so that the true acquisition process is modeled correctly. Another solution would be to rescale directly the projection data.

One advantage of recombining measurements taken at different bed positions into one extended data set that can be inputted to the image reconstruction procedure is that the maximum information and thus the maximum statistics could be used to reconstruct every region of an object being scanned. Ultimately some region of the object will be crossed by all possible projection planes. One could also improve the axial spatial resolution of the apparatus by oversampling along the axial direction by translating the bed by a distance less than the height of a ring. A bed translation of an half or a quarter the height of a ring will allow to double or quadruple the number of axial translation symmetries in the apparatus.

Although the aspect of maximizing the number of system symmetries is advantageous according to some aspects of the present invention other aspects like for example the detection efficiency the packaging constraints the assembly constraints and the production cost should also be considered during the conception. In regards to those aspects a perfect symmetry imaging system may not be the most desirable system. Therefore in some embodiments the detector rings of the imaging system can be made from blocks of stacked detecting element usually crystals that are repeated around the rings and repeated in the axial direction z axis in order to cover the desired FOV. A pictorial view of an imaging system made of 4 2 crystal blocks repeated eight times around the ring and two times axially is illustrated in . An example of a PET event detected by the TOR formed by the coincident detectors and is shown in a 3D view a 2D in plane view and a 2D axial view . It is shown in the 2D in plane view that the TOR formed by detectors and will have the same response function that the TOR formed by detectors and because of in plane rotation symmetries between detector blocks. For an apparatus made of blocks of detectors the total number of in plane rotation symmetries will be equal to the number of blocks within the ring. The blocks of detectors repeated axially will also lead to some axial symmetries between the TORs of different projection planes. The 2D axial view shows that the TOR formed by the detectors and will have the same response function than the TOR formed by the detectors and . It this case the maximum number of axial translation symmetries will be equal to the number of blocks repeated in the axial direction. Accordingly in the non restrictive illustrative embodiment of the present invention many blocks made of few detectors should be used in order to preserve as many symmetries as possible in the imaging system.

When detector rings are composed of many blocks made of few detectors it is also possible to make some approximations in order to increase artificially the number of system symmetries. An example of such an approximation is illustrated in . In this figure the detector blocks are positioned uniformly around the ring in such a way that a gap of approximately one crystal width separates two detector blocks . A non negligible gap between detector blocks is often due to the thickness of a casing material protecting the detectors. In order to increase the number of in plane symmetries in the system one could assume that the detectors are positioned according to a detector ring with ideal in plane symmetries dotted grid . This approximation could in turn lead to a significant system matrix size reduction and to faster image reconstructions. Most important errors in the system matrix will come from the TORs made with crystals at position and which diverge more from the ideal detector grid .

A careful positioning of blocks of detector in the axial direction can also leads to an increase of the number of axial symmetries. As an example an 8 ring camera made from two detector blocks each having four crystals axially is shown in . By choosing a gap of one crystal height between the bottom crystal of the top block and the top crystal of the bottom block the camera can be viewed as a 9 ring camera with perfect axial symmetries. A non negligible gap is often required due to the presence of a casing material protecting the detectors. In order to preserve the axial symmetries during the computation of the system matrix the image grid should be selected carefully so that the height of a voxel is an integer fraction of the distance between two symmetric projection planes which is equal to the distance between two blocks unless the camera is approximated by a 9 ring configuration leading to one detector height or the gap . The approximation of an 8 ring camera by a 9 ring camera with perfect axial symmetries could lead to some error in the system matrix. In fact two photons and impinging respectively on crystals and at the same entrance point will not travel through the same quantity of matter and thus will not result in the same probability of being absorbed. In contrast using only axial symmetries between blocks it can be seen that the two photons and impinging respectively on crystals and will have the same probability of being absorbed.

According to one aspect of the non restrictive illustrative embodiment of the present invention an imaging system having many symmetries is built in order to optimize the performance of the image reconstruction methods. Nevertheless it is to be understood that the image reconstruction methods according to the non restrictive illustrative embodiment of the present invention could be adapted to any imaging system even if it has few symmetries.

Once the architecture and the geometries of the imaging system have been selected the next step consists in defining a two dimensional 2D or a three dimensional 3D image discretized with basis functions that are selected and positioned on a polar or cylindrical coordinate grid in order to preserve the system symmetries during the computation of the system matrix coefficients. To reach this goal the basis functions b x y z of equation 5 which were defined according to a Cartesian coordinate grid are replaced by a basis function b r z defined in a polar or cylindrical coordinate grid r z where r is the distance from the center of the image is the angle made with the x axis of the Cartesian image and z is the axial position being equivalent to the z axis of the Cartesian image. The relation between the cylindrical coordinate basis function b r z and the continuous image representation f x y z can be stated as 

The operation of converting a polar or cylindrical image into a Cartesian image is quite fast since the transformation matrix Tis really sparse and can be defined for only one 2D image slice. Only the few polar pixels that fall completely or partly inside the region delimitated by the square pixel will contribute to the square pixel estimate leading to 

The basis functions b r z used in the said polar or cylindrical image can be overlapping and or can be of different shape as long as the step of computing the system matrix coefficients preserved the symmetries or redundancies in the system matrix. For example in a two dimensional polar image representation the pixels can have a shape similar but not restricted to a pie shape a truncated pie shape a circle a blob a square or a rectangle. For a three dimensional cylindrical image representation the voxels can have a shape similar but not restricted to a pie shape volume a truncated pie shape volume a cylindrical volume a sphere a blob a cube or a rectangular volume.

The computation of the system matrix coefficients a equation 7 for a given imaging system and according to a polar or cylindrical image representation equation 9 could be performed using different methods. It is to be understood that the method should be adapted to the physical aspects of the imaging system modality to the geometry shape and properties of the detector ring elements of the imaging system and to the grid and basis functions used in the polar or cylindrical image representation. Moreover a more or less accurate model of the different aspects of the acquisition process can be included or not in the system matrix computation. For example in PET a system matrix can include or not a model of the positron range the attenuation the random events and or the scatter events. The computation of the system matrix coefficients can be based on an analytical model and or on Monte Carlo simulations. Some simpler and or faster methods can also be used and be more appropriate while using for example on the flag computation of the system matrix coefficients during the image reconstruction procedure. One should notice that the reduction of the system matrix size through the use of system symmetries according to some aspects of the non restrictive illustrative embodiment of the present invention would reduce the computation burden of computing the system matrix coefficients by a factor equivalent to the number of symmetries.

In order to preserve the maximum number of symmetries during the probability matrix computation the geometries of the polar or cylindrical image should correspond to the geometries of the imaging system. The total number of TORs measured by a three dimensional imaging system denoted by N can be decomposed in several parts 12 where N N are the total number of TORs in one projection plane and N N are the total number of projection planes measured by the apparatus. More precisely N and Nare respectively the number of symmetric and non symmetric TORs in one projection plane N and Nare respectively the number of symmetric and non symmetric projection planes and is a correction factor to take into account the fact that the cross X projection planes will have less symmetries than the direct projection planes. This fact was presented previously in which illustrates all the different projection planes of a 4 ring apparatus. In this example the number of axial symmetries is equal to the number of rings giving N 4 and the number of non symmetric projection planes is N 4 0 when mirror symmetry are used and N 7 12 when they are not.

The total number of voxels in a three dimensional image based on a polar coordinate grid can also be decomposed in several parts 13 where B B are the total number of voxels in one 2D image slice parallel to the r plane and B B are the total number of 2D image slices along the z axis. More precisely B is the number of angular symmetries in the 2D image slice and Bis the number of independent or non symmetric voxels which could not be obtained by an image rotation B and Bare respectively the number of voxels along the z axis which are symmetric and non symmetric according to the positioning of the detector rings along the z axis.

An example of a three dimensional image based on a cylindrical coordinate grid dedicated for a 4 ring camera with perfect symmetries is shown in . It can be seen in the 2D in plane view that the number of angular symmetries B in the polar image corresponds to the number of in plane angular symmetries N in the detector rings . In this example the number of voxels at each radius position is equal to B leading to a number of non symmetric voxels Bin one 2D image slice that is equal to the number of radius positions. Referring to the 2D axial view the height of the voxels is selected to be an integer fraction of the distance between two symmetric projection planes so that the number of symmetric voxels along the z axis B is equal to the number of axial symmetries N in the apparatus. The number of non symmetric voxels along the z axis Bwill correspond to the number of voxels comprised within the distance between two symmetric projection planes.

More generally in the non restrictive illustrative embodiment of the present invention the number of angular symmetries B in the polar or cylindrical image should be set equal or be a multiple of the number of in plane symmetries N in the imaging system giving B k N where k is an integer higher than zero. Under certain conditions where N is really high a number of angular symmetries B lower than N can be selected in order to avoid very small pixel area or voxel volume in the middle of the image. The quality of the image obtained with some image reconstruction methods can be affected somehow by the presence of very small pixel area or voxel volume .

Once the number of image angular symmetries B is set the number of voxels at each radius position will be equal or be an integer multiple of B. In the example of the same number of voxels equal to B were used at each radius position. However a better uniformity between the pixel area or voxel volume could be achieved by using more pixels at radius position farther from the image center. An example of such an image representation is illustrated in . In this case the number of non symmetric pixels Bwill be equal to the number of different pixels within one symmetric angular span leading to B 18.

In order to preserve the maximum number of axial symmetries in the imaging system the number of axial symmetries B in the cylindrical image should be set equal to the number of axial symmetries in the apparatus N. The optimal setting for B can also be higher than N in some cases where multiple acquisition frames taken at different bed positions are used to extend the axial FOV of the measurements. The number of non symmetric voxels Bin the axial direction depends on the distance between two symmetric image slices or projection planes and on the minimal voxel height required to preserve the spatial resolution of the apparatus.

Another broad aspect of the non restrictive illustrative embodiment of the present invention consists of restructuring the system matrix A into a block circulant matrix. A block circulant system matrix can be obtained given that the projection data and the image voxels are ordered in a particular order. This will first be demonstrated for two dimensional imaging problems. Additional considerations for three dimensional imaging problems will then be presented.

For two dimensional image reconstruction problems N N B and Bare useless since the third dimension which is parallel to the axial direction z axis is not considered. The number of symmetries or equivalently the number of blocks in the block circulant system matrix denotes here by S will be fixed by the smallest value between N and B. In other words the number of blocks will be equal to the number of in plane symmetries N in the imaging system unless the number of angular symmetries B in the polar image is less. Each block of the block circulant probability matrix will be a n m matrix where n is the number of rows being equal to the number of TORs divided by the number of blocks giving n N N S and m is the number of column being equal to the number of pixels divided by the number of blocks giving m B B S. To obtain a block circulant system matrix the measurement vector should be ordered according to i 1 . . . S j 1 . . . n and the image pixel vector according to i 1 . . . S j 1 . . . m where the subscript j vary faster then the subscript i. In other words the measurement and image vectors are ordered in S groups of respectively n and m data stored in contiguous memory locations.

As an example a pictorial view of a fairly simple imaging system with a polar image representation is shown in and the corresponding block circulant system matrix is shown in . Referring to it can be seen that the orientation of the pixel f according to the TOR ywill be the same as the orientation of the pixel f according to the TOR yand therefore both pixels will have the same probability of contributing to the number of counts of their respective TORs. The repetitions between the matrix coefficients of symmetric pixel TOR combination will lead to a block circulant matrix having S N B 16 block matrices of size n m . In this example the number of non symmetric TORs is equal to the number of bins leading to n N 5 and the number of non symmetric pixels is equal to the number of radius positions leading to m B 4.

When the image reconstruction problem is extended to three dimensions the size of the system matrix A can grow rapidly since both the number of measured TORs and the number of voxels are increased. The number of measurements is increased by the number of projection planes measured by the apparatus which is equal to N N equation 12 . The number of voxels in the image is increased by the number of 2D images slices voxels along the z axis required to cover the whole FOV which is equal to B B equation 13 . The size growth of the 3D probability matrix can however be minimized by taking advantage of the axial symmetries between the projection planes of the imaging system. This leads to two different strategies for restructuring the three dimensional probability matrix into a block circulant matrix.

The first strategy consists of using only the in plane symmetries of the 3D imaging system to obtain a block circulant system matrix with a similar structure than the one obtain for 2D problems. The number of circulant matrix blocks denoted by S will be fixed by the smallest value between N and B. The dimension n m of each block will however be larger than for 2D image reconstruction problems the total number of TORs being equal to N equation 12 leading to n N S and the total number of voxels being equal to B equation 13 leading to m B S. A block circulant matrix can then be obtained by ordering the measurement vector according to i 1 . . . S j 1 . . . n and the image voxel vector according to i 1 . . . S j 1 . . . m where the subscript j vary faster then the subscript i.

The second strategy consists of using both the in plane and the axial symmetries of the 3D imaging system in order to obtain a block circulant system matrix where the blocks are themselves made of block circulant matrices. This new system matrix formulation is called here a double block circulant matrix. The S S bigger circulant matrix blocks comes from the axial symmetries in the system and S will therefore be fixed by the smallest value between N and B. Each big block will be a S S block circulant matrix arising from the in plane symmetries where S is fixed by the smallest value between N and B. Each block of the S S block circulant matrix will be a n m matrix where n N N N N S S and m B S S . To obtain the double block circulant system matrix the camera measurement vector should be ordered according to i 1 . . . S j 1 . . . S k 1 . . . n and the image voxel vector according to i 1 . . . S j 1 . . . S k 1 . . . m where the subscript k vary faster then the subscript j and i. In other words the measurement and image vectors are ordered in S groups each containing S sub groups of respectively n and m data stored in contiguous memory locations.

An example of a double block circulant system matrix obtained for a 3D imaging system is represent in . The system matrix was defined for the system configuration shown in given that the camera is composed of two rings of detectors and that the 3D image is composed of 4 slices in the axial direction. This imaging system will lead to a double block circulant system matrix where the number of big blocks is equal to S N B 2 the number of small blocks is equal to S N B 16 and each small block is a n m matrix with n N N 5 3 15 and m B B 4 2 8.

An advantage of using only in plane symmetries to obtain a block circulant system matrix is that only the projection planes that were measured by the apparatus equation 12 have to be included in the matrix. In contrast when the axial symmetries are also used to obtain a double block circulant system matrix every different projection planes Nshould have the same number of axial symmetries N leading to N N N N N equal to equation 12 with 0 . Using as an example the 4 ring camera shown in a total of 16 projection planes are actually measured by the apparatus. However when using the double block circulant matrix formulation all the N 7 different projection planes not using mirror symmetries have the same number of axial symmetries N 4 giving a total of 28 projection planes instead of 16.

Another particular consideration when using a double block circulant system matrix is that the use of projection planes which partly fall outside the axial FOV of the reconstructed image can introduce errors in the modelization of the system matrix when those effects are not handle correctly. This phenomenon is illustrated in which show a 4 ring apparatus where all the measured projection planes are represented by solid lines and all the unmeasured or missing projection planes which result from the use of the same number of axial symmetries for all projection planes are shown by dotted lines. In this figure the 4 rings of the apparatus and are drawn with a solid line and the missing rings issue from missing projection planes are drawn with dotted lines. One should notice that missing projection planes could be obtained by taking measurements at different bed positions along the z axis. This method was illustrated in . In the state of the art most image reconstruction methods use only the projection planes measured by the apparatus at a given bed position to reconstruct the 3D image . In this case the height of the image can be set equal to the axial FOV of the imaging system. However one must also include the missing projection planes in the system matrix formulation in order to preserve the double block circulant structure of the system matrix. In such condition using only the image defined in between the axial FOV of the apparatus will result in some errors in the system matrix coming from a contamination of the portion of the missing projection planes that falls outside the image . In other words the double block circulant structure of the system matrix will relate the portion of the missing projection planes exiting the bottom image slice to the voxels at the top of the image . An example of a portion of a missing projection plane contaminating the reconstructed image is illustrated in the view of . A solution to this problem consists of extending the image in such a way that the axial FOV include all the measured projection planes and and all the missing projection planes and imposed by the use of the double block circulant matrix. Another solution to this problem consists of estimating those missing projections by some means to equilibrate the system matrix equation.

In the non restrictive illustrative embodiment of the present invention the 3D measurements coming from different acquisition frames taken at different bed positions along the z axis can lead to two broad strategies for reconstructing the whole volume of the object being imaged.

A pictorial view illustrating the main steps of the first strategy is shown in . The first step consists of combining the information coming from acquisition frames taken at different bed positions for obtaining a measurement vector that partly defines the whole 3D image to be reconstructed. A block circulant or a double block circulant system matrix which relates the measurement vector made from some merged acquisition frames to the image vector with a given axial height is then used by a 3D image reconstructor in order to reconstruct a partial volume of the whole 3D image to be reconstructed. The process of reconstructing partial volumes of the 3D image is repeated using acquisition frames taken at different bed positions. All the partial 3D images can then be added together or recombined by some means in order to obtain the whole 3D image volume .

A pictorial view of the second strategy for reconstructing an image using measurements taken at different bed positions is illustrated in . The first step consists of combining the information of all the acquisition frames taken at different bed positions in order to obtain a measurement vector that fully cover the whole 3D image FOV to be reconstructed. A block circulant or a double block circulant system matrix which relates the measurement vector of all the acquisition frames being merged to the image vector covering the whole FOV is then used by a 3D image reconstructor in order to reconstruct the whole 3D image volume.

Referring to the it is important to mention that the strategy of taking measurements at different bed positions to increase the number of axial system symmetries can still be used for cases where the axial gap between the detector blocks is not an integer fraction of the distance between two symmetric projection planes. For example by translating the bed in the axial direction by a distance tequal to an integer fraction of the distance d between two symmetric projection planes leading to t d k where k is an integer will also allow the overlap of some projection planes coming from acquisition frames taken at different bed positions. However since not all of the projection planes will overlap perfectly the number of different projection planes in the extended data set in or in will be increased by a factor equal to k and the system matrix size will also be increased by this factor. One should notice that measurements taken while performing a continuous bed motion can also be sorted into bed acquisition frames with k being high enough to prevent from loosing spatial resolution in the axial direction.

According to some aspects of the present invention other kinds of bed displacements like wobble bed motions or helical CT scans can also be used by the image reconstruction methods. When performing an acquisition with wobble bed motions the same system matrix A can be used to reconstruct the image corresponding to each wobble position. For direct image reconstruction methods the images can be reconstructed independently and then be merged together according to their respective wobble positions. For iterative methods the merging of the images can be performed at each iteration loop before the step of updating the image estimate so that the maximum information is used by the iterative algorithm. An independent image for each wobble bed position can then be obtained from the image estimate in order to perform the forward projection step of the next iteration loop. When performing an helical CT scan the z axis of the cylindrical image representation can be modified in order to preserve the symmetries in the system. For example instead of using a cylindrical image representation with all image slices being aligned together each successive 2D image slices can have a rotation phase difference which follows the helical movement of the CT scan.

In the non restrictive illustrative embodiment of the present invention a real time image reconstructor based on the pseudo inversion of a block circulant system matrix by the use of singular value decomposition SVD is provided to reconstruct a two dimensional or a three dimensional image. The method can be decomposed in five main steps 1 perform the SVD decomposition on the block circulant system matrix in the Fourier domain 2 use the SVD components which are the singular values and the singular vectors to compute the pseudo inverse A of the system matrix 3 perform in the Fourier domain a matrix vector product between the pseudo inverse matrix A and the measurement vector to obtain the image vector in the Fourier domain and 4 perform the inverse Fourier transform on the image vector and 5 apply a polar to Cartesian transformation on the polar or cylindrical image to obtain an image that can be displayed on a conventional display. Different variations in every step of this procedure are possible leading to new algorithms having some advantages and some drawbacks. It is to be understood that it is within the scope of the present invention to include all the possible variations present in every step of the image reconstruction procedure and not to be limited to the algorithms issued from some combination of options which are presented as example only.

The first step of the real time image reconstruction method of the non restrictive illustrative embodiment of the present invention consists of using the singular value decomposition to decompose the imaging system probability matrix A into its singular values D its left singular vectors U and its right singular vectors V leading to A UDV 14 where U u i 1 . . . N j 1 . . . B and V i j 1 . . . B are orthogonal matrices D diag . . . is a diagonal matrix containing the singular values which are usually ordered so that . . . 0. Performing the SVD decomposition directly on the system matrix A is equivalent to some methods of the prior art proposed by Shim Shim SVD Pseudoinversion image reconstruction 1981 and by Selivanov Selivanov Fast PET image reconstruction based on SVD decomposition of the system matrix . The main drawback of those methods is the computational burden associated to the SVD operation when applied to large system matrices. In the non restrictive illustrative embodiment of the present invention the block circulant system matrix is transformed in the Fourier domain in order to accelerate the SVD procedure. Accordingly the block circulant system matrix A can be expressed as 15 where is a normalized S S discrete Fourier transform operator matrix with w exp 

For two dimensional image reconstruction problems it has been shown that the system matrix A based on a polar image can be reordered into a block circulant matrix having S block matrices of dimension n m where n N N S and m B B S. A single block circulant system matrix A can also be obtained for three dimensional image reconstruction problems given that only the S in plane system symmetries are used. The dimension n m of each block matrices will be in this case equal to n N S and to m B S.

Once the block circulant system matrix A have been diagonalized into using equation 14 the singular values and the singular vectors of A can be obtained by performing S independent SVD decomposition on every n m block matrices of the complex block diagonal matrix . Performing S different SVD operations on n m complex matrices is many order faster than performing a single SVD operation on a bigger S n S m matrix. The SVD decomposition can be performed on the small n m complex matrices using the well known Golub Kalahan algorithm or with some other methods. Another solution consists of performing the SVD decomposition on the whole complex block diagonal matrix by using the Fourier transform to accelerate matrix vector and or matrix matrix operations required by many SVD procedures like for example but not limited to trace minimization methods subspace iteration methods and single or block Lanczos methods.

Acceleration of the SVD decomposition of a block circulant matrix have already been applied to tomographic image reconstruction problems Baker Generalized approach to inverse problems in tomography Image reconstruction for spatially variant systems using natural pixels 1992 . However the block circulant matrix was a blurring matrix AA that was obtained using a natural pixel decomposition of the image. It was shown previously equation 3 that the resolution of the system of equations using a blurring matrix leads to a different image reconstruction problem. The result of the matrix vector product between the inverted blurring matrix and the measurement vector must be backprojected to obtain the reconstructed image. Moreover the image reconstruction problem state with a blurring matrix is more ill conditioned.

Using the result of the SVD procedure which are the singular values D and the singular vectors U and V it is possible to find the system matrix A pseudo inverse by using 18 where A is the pseudo inverse of A and D is a diagonal matrix which contain the reverse of the singular values diag 1 1 . . . 1 19 

When the SVD operation is performed on the block matrices of the block diagonal matrix the pseudo inverse can be found by 

Moreover one can notice that the singular values of the block diagonal matrix which are D D i 1 . . . S with D diag . . . are real values that when ordered in increasing order are exactly the same as the singular values of the system matrix A which are D diag . . . . Thus performing truncation or some other operations on the singular values of D or of Dis equivalent.

The range of singular values for a real world system matrix A can be very wide. Some singular values they are presented as a nonincreasing sequence called singular value spectrum can be very small or even zeros . Thus the condition number 

Another regularization approach consists of reducing the influence of small singular values on the result by using individual weights w k 1 . . . B leading to 

More complex methods can also be used to set an independent weighting factor for each pixel in the image. As an example the equation 26 could be modified to include an independent regularizer for every pixel of the image vector i 1 . . . B leading to a weighting function which depends both on the pixel and on the singular value 

In the non restrictive illustrative embodiment of the present invention a regularization approach which allows to use different sets of weighting functions for every pixels of the image or at least for pixels at different radius positions in the polar or cylindrical image could be required for cases where the pixel area or voxel volume varies significantly between the innermost and the outermost pixels or voxels. The disparities between the pixel areas or volumes will lead to a pseudo inverse matrix A having variation of noise amplification and spatial resolution between the innermost and the outermost pixels. This effect can be corrected by truncating or by weighting more abruptly the singular values for the innermost pixels then for the outermost pixels.

The third step of the image reconstruction procedure consists of performing the matrix vector multiplications between the pseudo inverse system matrix and the measurement vector. The matrix vector operation is performed in the Fourier domain to reduce the number of operations. Accordingly the pseudo inverse matrix or the SVD components D V and U can be used leading to two broad class of image reconstruction procedures. For both procedures the measurement vector is transformed in the Fourier domain before it is multiplied by the pseudo inverse matrix and the result is transformed back in the spatial domain to obtain the reconstructed image leading to 28 or using the SVD components 29 A polar to Cartesian conversion matrix T stated in equation 10 can then be applied to the polar or cylindrical image to obtain a Cartesian image which can be shown on a conventional display.

It was stated in the previous section that for three dimensional image reconstruction problems it is also possible to use axial symmetries in order to obtain a S S block circulant matrix where each block are themselves S S block circulant matrices having blocks of dimension n m. The size of the small n m block matrices is set according to the number of projection data giving n N N N N S S and according to the number of voxels in the image giving m B S S . The image reconstruction methods based on the SVD decomposition is then essentially the same except that the system matrix is diagonalized by applying two Fourier transform operator matrices 30 where and are respectively the normalized S S and S S discrete Fourier transform operator matrix equation 16 is a S S n S S m complex block diagonal matrix where each of the S S blocks are n m equation 17 and I I Iand Iare respectively n S n S n S n S m S m S and m S m S identity matrices is the Kronocker product and the subscript H is the Hermitian transpose or conjugate transpose . One can also notice the presence of the permutation matrix P which is applied after or before the direct or inverse S S discrete Fourier transform operator to reorder the result into a block circulant matrix having S blocks of dimension S n S m.

Computing the pseudo inverse of the double block circulant matrix as stated in equation 30 will possibly lead to a valid solution for voxels at the center of the z axis FOV. However for 2D image slices at both extremum of the z axis the result will be perturbed by an incorrect modelization of the system matrix A coming from the use of the same number of axial symmetries S for all projection planes. This problem was illustrated in . A solution to this problem consists of extending the image in the axial direction z axis so that no projection planes are making a wrap around in the beginning of the image . This operation is equivalent to padding the double block circulant matrix with blocks of zeros leading to a S p S p block circulant matrix made of S S block circulant matrices where p is the number of padding blocks. Despite of the zero padding the double block circulant structure provides many order acceleration both for the SVD decomposition procedure equation 20 and for the matrix vector product between the pseudo inverse system matrix and the measurement vector. Another solution consists of estimating the value of those missing projection planes by some means.

Using the complex double block circulant system matrix equation 30 with p padded blocks an image vector extended with p S m zero data and a measurement vector extended with p S n zero data the image can be reconstructed using the matrix pseudo inverse 31 or using the SVD components D V and U 32 where is the a normalized S p S p Fourier transform operator Iand Iare respectively n S p n S p and m S p m S p identity matrices and where other variables are unchanged from the equation 30.

Another practical consideration when reconstructing a 3D image with a method based on a double block circulant system matrix equation 31 or 32 is that the voxels of the cylindrical image should be rescaled according to the sum of all matrix coefficients of TORs contributing to each voxel. The resealing step is performed only after the image reconstruction procedure since the application of the resealing factors directly on the system matrix A would have broke the double block circulant structure of the matrix. When the image reconstruction method is based on a single block circulant matrix equation 28 or 29 the resealing step can be performed directly on the system matrix A in a precomputation step.

Several approaches are possible for reconstructing two dimensional or three dimensional images using the pseudo inverse of the complex system matrix or the SVD components obtained with a SVD procedure. As examples three image reconstruction strategies are presented hereafter to illustrate how the method can be adapted to meet different requirements. It is to be understood that the non restrictive illustrative embodiment of the present invention is not limited to those examples.

The first image reconstruction strategy consists of performing the SVD decomposition of the system matrix A each time a new projection data set is to be reconstructed. A schematic view of the main computation steps of this method is illustrated in . This method allows the maximum flexibility since new information like an attenuation map a scatter model or some other information which could be selected according to the characteristics of the projection data can be used to modify the original system matrix A to improve the quality of the reconstructed image . The improved system matrix A can then be Fourier transformed to obtain a complex block diagonal matrix that is decomposed using an SVD algorithm . The singular value spectrum can then be regularized according to the statistics of the projection data and using some regularization methods equations 24 25 26 and 27 . The projection data is Fourier transformed and used with the regularized SVD components to reconstruct the polar or cylindrical image that is further inverse Fourier transformed . Those steps correspond to equation 29 for a single block circulant system matrix or to equation 32 for a double block circulant system matrix. The last steps consist in normalizing the polar or cylindrical image if required and in converting the polar or cylindrical image into a Cartesian image representation equation 10 to obtain an image that can be shown on a conventional display.

The second image reconstruction strategy is very similar to the first one with the difference that the system matrix SVD decomposition step is performed only once in a precomputation step. This is illustrated in where the direct Fourier transform and the SVD decomposition on the system matrix are both performed in a precomputation step. Once the SVD components are obtained D V and U the original system matrix in the space domain no longer needs to be stored in memory. By preserving the SVD components one can still regularize the singular values contained in D with different methods equations 24 25 26 and 27 to fit the statistics of the measurements and or to control the trade off between the noise amplification and the spatial resolution in the image. Moreover when the regularization procedure consists in truncating the number of singular values the computation of the image using the SVD components equation 29 or 32 can lead to less operations than the use of the matrix pseudo inverse equation 28 or 31 since one can use in the computation only the singular vectors in V and U that correspond to non null singular values in D. The resulting algorithm is really fast since each time new measurements are presented only the following steps are required direct Fourier transforming the measurements regularizing the singular values reconstructing the image using the SVD components equation 29 or 32 inverse Fourier transforming the image normalizing the polar image and converting the polar or cylindrical image into a Cartesian image representation .

The third image reconstruction strategy is based on a matrix vector multiplication in the Fourier domain between the complex measurement vector and the complex pseudo inverse system matrix . Referring to the direct Fourier transform of the system matrix A the SVD decomposition the regularization of the singular value and the computation of the complex pseudo inverse matrix 184 are all performed only once in a precomputation step. An advantage of reconstructing the image using the pseudo inverse matrix equation 28 or 31 is that each group of S symmetric pixels equation 28 or of S S symmetric voxels equation 31 can be updated independently. This could lead to an image reconstruction procedure that can update sequentially and continuously different parts of the polar or cylindrical image. This could be particularly useful for real time visualization of 2D image slices reconstructed from 3D projection data since one can update only the voxels that are visible on the screen. An inconvenient of the method is that the regularization step cannot be adapted to the properties of individual projection data since it is performed only once in a precomputation step.

In the non restrictive illustrative embodiment of the present invention an iterative image reconstructor using a block circulant system matrix in the Fourier domain for computations in the forward and back projection steps is provided for two dimensional and three dimensional image reconstruction problems. The iterative image reconstructor can be decomposed in four main steps 1 forward project an image estimate to obtain a measurement estimate 2 compute a measurement correction vector using the measurement estimate and the measurements acquired with the apparatus 3 back project the measurement correction vector to obtain an image correction vector and 4 update the image estimate using the image correction vector. The non restrictive illustrative embodiment of the present invention provides a general approach for accelerating the forward projection operation in step 1 and the back projection operation in step 3. The step 2 and the step 4 are more generally related to known procedures and will depend on the iterative solver and on some penalized or prior functions used in the iterative image reconstructor. However the non restrictive illustrative embodiment of the present invention comprises some modifications to the operation of updating the image estimate in step 4 in order to take into consideration the nature of the basis functions used in the polar or cylindrical image. The iterative solver used in the iterative image reconstructor can be of different kinds. For example it can be a version of the Maximum Likelihood Expectation Minimization MLEM or a version of another algorithm like for example but not restricted to the Ordered Subset Expectation Minimization OSEM the Rescaled Block Iterative RBI the Block Iterative Simultanous MART algorithm BI SMART or the Penalized Weighted Least Squares PWLS algorithm.

To illustrate the different steps of the iterative image reconstructor the theory will be presented for the well known Maximum Likelihood Expectation Minimization MLEM as an iterative solver. Shepp and Vardi were the first to propose the MLEM algorithm for tomographic image reconstruction problems Shepp Maximum likelihood reconstruction for emission tomography 1982 . The image update equation for each iteration of the EM algorithm proposed by Shepp and Vardi can be written as follows 

The system probability matrix A used in the forward projection equation 34 and back projection equation 35 steps may have a block circulant structure. Moreover for three dimensional problems the system probability matrix A can also be structured into a block circulant matrix where each blocks are themselves block circulant matrices. Methods for accelerating the forward and back projection computations will first be presented for two dimensional problems and some additional considerations for three dimensional problems will be explained thereafter.

For two dimensional image reconstruction problems it has been shown that the system matrix A based on a polar image can be reordered into a block circulant matrix having S blocks of dimension n m where n N N S and m B B S. A block circulant matrix can be diagonalized using the Fourier transform 38 where is a normalized S S discrete Fourier transform operator matrix with w exp 

Using the complex block diagonal matrix in replacement to the original system matrix A for the forward and back projection steps can result in a reduction of the number of operations required. In theory for a dense system matrix the computational reduction would be proportional to the number of blocks S in the block circulant matrix. However in practice the system matrix A is sparse 90 99 of null values and the matrix vector operations performed in the forward and back projection steps of iterative image reconstruction methods are usually performed only on non null coefficients of A to reduce the computation burden. When the system matrix A is diagonalized according to equation 38 a lot of null values become non null during the Fourier transform operation. In fact as soon as one matrix coefficient out of the S symmetric coefficients coefficients in one circulant sub matrix is non null in the system matrix A all the S coefficients will become non null after the Fourier transform operation. Nevertheless the complex block diagonal system matrix will still preserve some null values. For example symmetric TORs at a bin position that do not pass through the center of the polar image will never have contributions from pixels at the center of the image. Such a situation is illustrated in where two symmetric TORs and are at the same bin position q 2 but at different angles 3 4 . It can be seen that all the symmetric TORs at the bin position q 2 will never have contributions from the pixels at the innermost radius position r 0. Some other situations where all the S symmetric coefficients are zeros may also arise for imaging system with less in plane symmetries than the number of detectors in the ring.

In order to take advantage of the null values in the complex block diagonal system matrix it is advantageous to reorder the image vector and the measurement vector y in such a way that symmetric voxels and symmetric TORs are stored in contiguous memory locations. This reordering can be performed using a permutation matrix P which restructures the block circulant matrix A into n m small circulant sub matrices of dimension S S. Equation 38 then becomes 41 where is a S n S m complex matrix made of n m small diagonal matrices Dof dimension S S 

The complex matrix contains the same coefficients as the complex matrix but ordered differently. Replacing the system matrix A with the complex system matrix in the forward projection step denoted by equation 34 and in back projection step denoted by equation 36 will lead respectively to 

One should notice that the same complex system matrix can be used for the forward equation 43 and back equation 44 projection operations the only requirement being that one must use the conjugate transpose of the matrix for the back projection step.

It is more advantageous to use the complex matrix than the complex matrix for accelerating the inner loop forward and back projection operations. A first advantage of using the matrix over the matrix comes from the reordering of the image vector and the measurement vector y according to the permutation matrix P which allows to regroup the symmetric data together. In the algorithm implementation of equations 43 and 44 the permutation matrix P represents a reordering of the data that can be performed only once prior to entering in the iterative loop. All image vectors and and all measurement vectors y and used in the inner loop step 1 to step 4 of the iterative algorithm will therefore be reordered according to P leading respectively to the ordering i 1 . . . m j 1 . . . S for image vectors and to the ordering y y i 1 . . . n j 1 . . . S for measurements vectors. The subscript p denoting the permutation operation was used to avoid confusion with the original data ordering. By regrouping all the S symmetric pixels or symmetric TORs together the direct or inverse Fourier transform can be performed more efficiently since the data are accessed on contiguous memory locations. A maximum acceleration is achieved by using Fast Fourier Transform FFT algorithms. Moreover since the system matrix coefficients are real values an order S 2 FFT transform can be performed to transform a group of S real values.

A second advantage of using the matrix over the matrix comes from the fact that the matrix can be stored more efficiently in a sparse matrix format where only non null diagonal matrices Dare preserved in the system matrix. For example null diagonal matrices can arise for i being a group of TORs at a bin position not passing through the FOV center and j being a group of pixels at a radius position near the FOV center. To access only the diagonal matrices Dwhich have a non null contribution to the igroup of symmetric TORs during the forward and back projection operations an index vector is used to address the j 1 . . . t t m group of symmetric voxels reffered by the matrix D. Storing the matrix in sparse format allows to reduce the memory requirements and minimize the number of operations involved in the forward and back projection steps equations 43 and 44 .

A schematic view of the main computation steps of the iterative image reconstruction method of the non restrictive illustrative embodiment of the present invention is shown in . In this method projection data and the block circulant system matrix of a given imaging system are loaded before starting the computation. According to the availability of RAM memory in the processor where the algorithm is executed and depending on the size of the system matrix it may lead to a faster implementation to preserve the system matrix in the space domain and to Fourier transform the matrix coefficients of one or some group of symmetric TORs at a time to feed the forward and backward projectors. The diagrams and links in dotted lines represent this option. Given that the block circulant system matrix in the Fourier domain stored in sparse format can fit in the RAM memory it can save many operations to Fourier transform the complete system matrix only once in a precomputation step . Before entering in the iterative loop an initial image estimate is selected . Usually the total number of counts in all projection data is distributed uniformly between all the image voxels. Other initial image estimates may also be selected. The iteration loop of the method can be decomposed in several steps to . The image estimate vector is transformed in the Fourier domain to be forward projected using the block circulant matrix. The result of the forward projection is the measurement estimate vector that is inverse Fourier transformed in order to compute the measurement correction vector by some means which depend of the iterative solver used. The measurement correction vector is then Fourier transformed to be back projected in order to compute the image correction vector. An inner loop used to perform the forward and back projections of one or some group of symmetric TORs at a time is required only when the system matrix is transformed in the Fourier domain on one or some groups of symmetric LORs at a time . Nevertheless the inner loop can also be used when the complete system matrix is Fourier transformed . Once all TORs have been used in the forward and back projection steps the obtained image correction vector is inverse Fourier transformed to be used for the update of the current image estimate . The image estimate should also be normalized according to the sum of TOR matrix coefficients which contribute to every voxel first denominator in equation 33 . This is the last step of one iteration loop. If more iterations are required the new image estimate is used in the next iteration loop and is therefore Fourier transformed in step . If no more iterations are required the polar or cylindrical image is converted into a square pixel Cartesian image using a conversion table T equation 10 . The final image can be displayed on screen or saved in some memory storage.

According to some aspects the step of correcting the image estimate involves some modifications when a polar or cylindrical image representation is used. For statistical reasons the pixel area or voxel volume of the image should be the same when performing the update of the pixel value estimate in the iterative loop. Pixels size disparities are reduced by the use of a polar or cylindrical image representation having more pixels at radius position farther from the FOV center. An example of such a polar or cylindrical image is shown in . However for a system having an important number of in plane symmetries N the innermost pixel area can still be significantly smaller than the area of other pixels in the image. Hebert Hebert Fast MLE for SPECT using an intermediate polar representation and a stopping criterion proposed to convert the polar image into a Cartesian image before the correction is applied to the image estimate and then to convert the image back into a polar image representation. A first disadvantage of this method is the loss of spatial resolution or blurring effect caused by going back and forth into two different image representations having pixels with different shape size and position. To reduce the pixel area disparities between innermost pixels and other pixels of the image we proposed to combine the innermost pixel estimate values of two three or more pixels or voxels together before the image correction is applied. This is equivalent to double triple or multiply by some other factors the area or volume of the innermost pixels or voxels . For example referring to before updating the innermost pixel image estimates at the radius position r the pixel image estimates at the angle position and could be summed together to form a new pixel image estimate having twice the initial pixel area. The same operation is applied to the image correction vector so that the correction value for pixel r and pixel r are summed together before the correction is applied to the image estimate. Both pixels r and r will then be set to the same image estimate value. Alternatively given that the pixel area disparities in the polar or cylindrical image is in an acceptable range it can lead to a valid and faster implementation to use the original polar or cylindrical image representation for the image estimate correction operation

Hebert Hebert Fast MLE for SPECT using an intermediate polar representation and a stopping criterion proposed a method for accelerating the forward and the back projection operations for two dimensional SPECT image reconstruction problems through the use of a block circulant probability matrix in the Fourier domain. The method was proposed for a SPECT rotating detector gantry and was based on a polar image representation having the same number of pixels at each radius position. This configuration of the image lead to important size disparities between the innermost and the outermost pixels leading to lost of spatial resolution on outermost region of the image. The spatial resolution can be recovered by using twice the number of angles in the image but at the cost of doubling the computation requirement. Moreover all the coefficients of the block circulant system matrix were used in the matrix vector computations leading to sub optimal computational speed and to a rapid decrease of performance as the number of in plane symmetries in a camera is reduced. The decrease of performance and the limitations imposed by the polar image representation used by Hebert makes this image reconstruction method effective only for imaging system having perfect or near perfect in plane symmetries between all the detectors within the ring.

According to some aspects of the non restrictive illustrative embodiment of the present invention two main contributions are proposed to overcome the limitations of the method proposed by Hebert for two dimensional image reconstruction problems. The new iterative image reconstruction method of the non restrictive illustrative embodiment of the present invention leads to gain of speed in the forward and back projection operations even for imaging system with few symmetries. The first main contribution is the demonstration that a polar image having an unequal number of pixels at different radius position can also be structured into a block circulant probability matrix and be used to accelerate computation in the forward and back projection steps. Such a polar image definition were used in other works like in Kaufman Implementing and accelerating the EM algorithm for positron emission tomography and more recently in Mora Polar pixels for high resolution small animal PET but the aim in those works was only to reduce the system matrix size. In other words they did not restructure the system matrix into a block circulant matrix and they did not used the Fourier transform to accelerate the computation. Another contribution of the non restrictive illustrative embodiment of the present invention is the restructuration of the block circulant system matrix in the Fourier domain into a sparse matrix format. By using a sparse matrix format the size of the system matrix and the number of operations can be reduced significantly for camera with perfect symmetries and even more for camera having less symmetries than the number of detectors within the ring.

Another contribution of the non restrictive illustrative embodiment of the present invention is to extend the iterative image reconstruction method based on block circulant matrix to three dimensional image reconstruction problems and to demonstrate that further matrix size reduction and computational saving is possible through the use of the axial symmetries between the scanner projection planes. Accordingly it was shown in that a block circulant matrix where each block are themselves block circulant matrices can be obtained for three dimensional image reconstruction problems. In the non restrictive illustrative embodiment of the present invention two different methods are provided for accelerating the forward and back projection operations using block circulant matrix in three dimensional image reconstruction problems. Those methods are explained hereafter.

The first method consists of performing the Fourier transform only on the circulant sub matrices made from in plane symmetries of the camera. In this case the system matrix A can be structured in a simple block circulant matrix. The forward and back projection steps are then performed independently on each projection planes of a 3D camera using the equations 43 and 44 with being the block circulant matrix for the iprojection plane and for the jimage slice and with n N N S and m B B S as for two dimensional image reconstruction problems. Accordingly the forward and back projection steps of the iterative algorithm can be replaced by 

The second strategy for accelerating the forward and back projection operations for three dimensional image reconstruction problems consists of performing two successive Fourier transform operations on the double block circulant matrix in order to take advantage of both the in plane and the axial symmetries of the apparatus. In contrast to the first strategy the second strategy restructures the system matrix A into a double block circulant matrix which requires some unmeasured projection planes to be added in the system matrix equations. The obtention of the double block circulant matrix was discussed previously and an example was presented in . Accordingly the double block circulant system matrix A can be replaced by the following relation 47 or equivalently by 48 where and are respectively S S and S S discrete Fourier transform operators I I Iand Iare respectively n S n S n S n S m S m S and m S m S identity matrices P and P are permutation matrices which reorder the data so that respectively the Fourier operator and could be performed. In equation 47 is a S S n S S m complex block diagonal matrix with a structure similar to the matrix in equation 40 but having S S blocks of dimension n m. In equation 48 is a S S n S S m complex matrix with a structure similar to the matrix in equation 42 but having n m small diagonal matrices Dof dimension S S S S. Finally n and m will depend respectively on the geometry of the apparatus and of the image and will be set according to n N N N N S S and m B S S .

It is important to add some precisions concerning the permutation matrices P and P. A first concern is that the matrix P in equations 47 and 48 will not have the same structure due to a different ordering of the Fourier operator . The implementation of equation 48 usually leads to a faster algorithm than the implementation of equation 47. This is in part due to the more appropriate data ordering obtained with the permutation matrices P and P. Referring to equation 48 the permutation matrix P first reorder the data into m circulant sub matrices of size S S so that the Fourier operator can be applied on contiguous memory locations. The result of the first Fourier transform is then reordered into m circulant sub matrices to apply the Fourier operator . Another aspect that make the equation 48 more advantageous than the equation 47 is that the complex matrix can be stored more efficiently in a sparse matrix format than the complex matrix . However the reordering of the operations in equation 47 and 48 may lead to other possible implementations and all those different implementations are within the scope of the present invention.

Using for example the double block circulant system matrix restructuration of equation 47 the forward and back projection steps of the said iterative algorithm can be replaced by 

In the implementation of equations 49 and 50 the permutation matrix P can be performed only once prior entering in the iterative loop. All image vectors and and all measurement vectors y and used in the inner loop step 1 to step 4 of the iterative algorithm can therefore be reordered according to i 1 . . . m j 1 . . . S k 1 . . . S for image vectors and to y y i 1 . . . n j 1 . . . S k 1 . . . S for measurements vectors. After the first Fourier transform the permutation matrix P regroup all data having axial symmetries together for the second Fourier transform leading to i 1 . . . m j 1 . . . S k 1 . . . S for the image vectors and to y y i 1 . . . n j 1 . . . S k 1 . . . S for the measurement vectors.

The three dimensional iterative image reconstruction methods of the non restrictive illustrative embodiment of the present invention can be decomposed in several computational steps that are similar to the ones required for two dimensional problems. Referring to the forward and back projection operations are replaced respectively by equations 45 and 46 if the single block circulant matrix acceleration strategy is used or by equations 49 and 50 if the double block circulant matrix acceleration strategy is used. The second strategy requires however a special handling of the unmeasured projection planes during the measurement correction operation . As mentioned previously some unmeasured projection planes were inserted in the system matrix equation to obtain the double block circulant system matrix structure. Those unmeasured projection planes will not affect the result given that they are ignored during the measurement correction operation and that they are set to zero in the measurement correction vector so that they do not affect the result of the back projection operation

Another particularity of three dimensional image reconstruction problems compared to two dimensional problems is the important size increase of the system matrix A and consequently of the complex system matrix . Since the complex system matrix may not fit completely in RAM memory of a given workstation for some 3D image reconstruction problems it could be more advantageous to store only the system matrix A in the space domain and to Fourier transform only the matrix coefficients of one or some groups of symmetric TORs at a time. This option is illustrated in . When a double block circulant system matrix is used it is possible to perform only the first Fourier transform in a precomputation step to limit the memory requirement and to perform the second Fourier operation repeatedly at each iteration loop to feed the forward and back projector. If the system matrix A in the space domain is really huge one can also decide to compute the system matrix coefficients on the flag and thus to Fourier transform the matrix coefficients of one or some groups of symmetric TORs at a time. Moreover it is to be understood that all those methods can also be used for the other cases where the system matrix ordering is modified so that the forward and back projection operations used the matrix coefficients of one or some groups of symmetric voxels at a time.

In the non restrictive illustrative embodiment of the present invention the choice of performing the forward and back projection operations according to the first implementation strategy equations 45 and 46 or according to the double block circulant matrix implementation strategy equations 49 and 50 will depend on the ratio of null values in the system matrix A and on the number of symmetries in the imaging system. The architecture of the processor or of any computation unit where the image reconstruction algorithm is implemented may also influence the choice of strategy. An advantage of using only one Fourier transform operator instead of two is that the complex system matrix will preserve more null values in and therefore will require less memory to be stored. The inclusion of unmeasured projection planes in the system matrix for the double block circulant matrix strategy also increases the size of . Moreover the single block circulant matrix strategy involves less operations for the direct and inverse Fourier transform since only one Fourier operator is used compared to two Fourier operators and for the double block circulant matrix strategy. However once an image or a measurement vector has been Fourier transformed the double block circulant matrix strategy is the one that minimizes the number of complex matrix vector operations between the complex matrix and the image or measurement vectors. Making the sum of advantages and disadvantage of both methods the double block circulant matrix strategy can lead to better performance for imaging system with many axial symmetries and when the system matrix A is less sparse. For example in PET the system matrix can become less sparse if scatter coincidences are also modeled in the system matrix.

Another method that can make the double block circulant matrix strategy more advantageous than the single block circulant one is the increase of the number of axial symmetries in the system by performing successive acquisition taken at different bed positions along the z axis. Oversampling along the z axis is possible by performing bed displacement that are half a quarter or some other factors of the detector height. Different methods can then be used to recombine the acquisition frames taken at different bed positions as shown in and . Merging data coming from different acquisition frames is very favorable for iterative image reconstructions since it increases the statistics collected at each projection plane. Moreover the method of the non restrictive illustrative embodiment of the present invention will reconstruct really rapidly those extended projection data set by using the axial symmetries.

Another kind of iterative solver can be selected in replacement to the MLEM algorithm. For example the use of a block iterative algorithm like the OSEM algorithm can allow to increase even more the computational speed of the iterative image reconstruction methods. The adaptation to other iterative solvers is straightforward. Block iterative methods consist in dividing the measurement vector into different subsets that are used one after the other in the forward and back projection steps to update the image estimate vector. The subsets can also be made from groups of voxels. One iteration loop is completed when all the subsets have been used in the computation to update the image estimate. The only constraint when using a block iterative solver is that the number of data in a subset must be an integer factor of the number of blocks in the block circulant system matrix used in the forward and back projection steps. For two dimensional image reconstruction problems and three dimensional problems using one Fourier transform operators the number of data in a subset Mis a factor of the number of in plane symmetries in the camera leading to M k S where k is an integer. For three dimensional image reconstruction problems using two Fourier transform operators and to accelerate the forward and back projection steps the number of data in a subset Mis a factor of the number of in plane and axial symmetries leading to M k S S where k is an integer. Referring to when measurement subsets or image subsets are used the steps and in the iterative loop are performed using only one subset at a time. An inner loop inside the iterative loop is then used to loop through all the N Mmeasurement subsets or the B Mimage subsets .

Although the present invention has been described in the foregoing description in relation to a non restrictive illustrative embodiment thereof this embodiment can be modified without departing from the spirit and nature of the present invention.

