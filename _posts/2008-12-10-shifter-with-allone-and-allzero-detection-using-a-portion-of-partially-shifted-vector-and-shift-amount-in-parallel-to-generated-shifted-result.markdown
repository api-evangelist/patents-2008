---

title: Shifter with all-one and all-zero detection using a portion of partially shifted vector and shift amount in parallel to generated shifted result
abstract: A shifter that includes a plurality of shift stages positioned within the shifter, and receiving and shifting input data to generate a shifted result, and a detection circuit coupled at an input of a final shift stage of the plurality of shifters, in a final stage within the shifter. The detection circuit receives a partially shifted vector at the input of the final shift stage along with a predetermined shift amount, and performing an all-one or all-zero detection operation using a portion of the partially shifted vector and the predetermined shift amount, in parallel, to a shifting operation performed by the final shift stage to generate the shifted result.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08332453&OS=08332453&RS=08332453
owner: International Business Machines Corporation
number: 08332453
owner_city: Armonk
owner_country: US
publication_date: 20081210
---
This invention was made with Government support under Contract No. HR0011 07 9 0002 awarded by DARPA. The Government has certain rights to this invention.

The present invention relates to performing an all one check or all zero check on a vector being shifted in parallel to a final shifter stage of a shifter. For example the present invention is useful for carry signal computation for a floating point rounder within a floating point unit FPU of a microprocessor and more specifically to pre computing carry signals for a rounder in parallel to a final normalization stage for example of the FPU to thereby improve the performance of the rounder.

A fused multiply add type FPU of a microprocessor typically includes an aligner a multiplier an adder a normalizer and a rounder for example. Conventionally in a fused multiply add pipeline of an FPU after computing an intermediate result of a floating point operation the normalizer normalizes the intermediate result by shifting out leading zeros. The normalized result is rounded by the rounder. illustrates a conventional two stage normalizer within an FPU.

As shown in a normalizer includes a series of 8 1 multiplexers which perform shifts of different amounts to shift out the number of leading zeros. The series of multiplexers includes a first normalization shifter at a first stage and a second normalization shifter at a second stage. The number of leading zeros is computed outside of the data path for example using a Leading Zero Anticipation LZA circuit and a 6 bit normalizer shift amount nsha is applied to the first and second normalization shifters and via a plurality of 3 to 8 decoders and . Typically input data of a data width of 118 bits is input into the first normalization shifter and the first stage is addressed by the upper three bits of nsha i.e. nsha and the second stage is addressed by the lower three bits of nsha i.e. nsha as shown in . In the first stage coarse shift amounts are performed to reduce the width of the dataflow to 62 bits i.e. f . Then in the second stage fine shift amounts are performed to shift it into the final position resulting in a normalization fraction of 55 bits i.e. nrm frac . The results of the normalizer are forwarded to a normalizer result register and then input into a rounder . The rounder typically includes an incrementer and rounds between the two closest machine representable numbers to the actual value. The two closest numbers include either the truncated intermediate result or the truncated intermediate result incremented in the least significant bit LSB . The rounder may include two fraction incrementers having a high incrementer starting at a single precision LSB and a low incrementer starting at a double precision LSB. For double precision results the carry out of the low incrementer ripples into the high incrementer. The carry out of the high incrementer indicates that the exponent needs to be incremented.

The present invention provides a shifter and a method for performing an all one or all zero detection operation on a vector being shifted in parallel to a final shifter stage of the shifter.

According to one embodiment the present invention discloses pre computing carry signals for the rounder in parallel to a final normalization stage of a normalizer within an FPU. Therefore the incrementer does not need to compute these carry signals and the computation of the carry signals is no longer on a critical path.

According to one embodiment of the present invention a shifter for a floating point unit of a data processor is provided. The shifter includes a plurality of shift stages positioned within the shifter and receiving and shifting input data to generate a shifted result and a detection circuit coupled at an input of a final shift stage of the plurality of shift stages and receiving a partially shifted vector at the input of the final shift stage along with a predetermined shift amount and performing an all one or all zero detection operation using a portion of the partially shifted vector and the predetermined shift amount in parallel to a shifting operation performed by the final shift stage to generate the shifted result.

According to another embodiment a method of performing an all one or all zero detection operation within a shifter is provided. The method includes receiving and shifting input data via a plurality of shift stages positioned within the shifter to generate a shifted result and receiving via a detection circuit a partially shifted vector from an input of a final shift stage of the plurality of shift stages and a predetermined shift amount and performing an all one or all zero detection operation via the detection circuit using a portion of the partially shifted vector and the predetermined shift amount in parallel to a shifting operation performed by the final shift stage to generate the shifted result.

According to another embodiment a computer program product performing the above mentioned method is also provided.

Additional features and advantages are realized through the techniques of the present invention. Other embodiments and aspects of the invention are described in detail herein and are considered a part of the claimed invention. For a better understanding of the invention with the advantages and the features refer to the description and to the drawings.

With reference now to there is a shifter having a plurality of shift stages and receiving and shifting input data to generate a shifted result. The shifter further includes a detection circuit that can be implemented within embodiments of the present invention. According to the current embodiment of the present invention the shifter is a normalizer for example. However the present invention is not limited hereto and may vary accordingly. As shown in the shifter i.e. a normalizer including the detection circuit along with a normalizer result register and a rounder are provided. According to an embodiment of the present invention the normalizer and the detection circuit may be utilized in a floating point unit having a fused multiply add pipeline for example. However the present invention is not limited hereto and may vary as necessary.

According to one embodiment the normalizer is a two stage normalizer including a first shifter i.e. a first normalization shifter at a first stage within the normalizer and a final shift stage i.e. a second normalization shifter at a second stage in series with the first normalization shifter . The present invention is also not limited to a two stage normalizer and may vary as necessary. That is the normalizer may be a three stage normalizer or a four stage normalizer for example. According to an embodiment of the present invention the first and second normalization shifters and are 8 1 multiplexers which perform shifts of different amounts to shift out a number of leading zeros. Input data of a data width of 118 bits i.e. f may be input into the first normalization shifter in the first stage. The number of leading zeros is computed outside of the data path using a leading zero anticipator LZA circuit for example and a 6 bit normalization shift amount nsha is applied to the first and second normalization shifters and via a plurality of 3 to 8 decoders and a truth table corresponding to the plurality of 3 to 8 decoders and is shown in . The first stage of the normalizer is addressed by the upper three bits of nsha i.e. nsha via the 3 to 8 decoder and the second stage is addressed by the lower three bits of nsha i.e. nsha via the 3 to 8 decoder as shown in . In the first stage coarse shift amounts are performed to reduce the width of the dataflow to 62 bits for example thereby outputting a partially shifted vector e.g. a partially normalized fraction f .

According to an embodiment of the present invention the detection circuit is coupled to an input of the final shifter and receives a portion of the partially shifted vector f and a predetermined shift amount i.e. the lower three bits of nsha i.e. nsha and performs an all one or all zero detection operation. In this embodiment the detection circuit determines a carry signal for a normalized fraction result to be generated by the normalizer . According to another embodiment the detection circuit may perform an all zero detection operation for sticky bit computation needed by the rounder for example as discussed below with reference to .

According to an embodiment of the present invention the normalizer performs a normalization operation while the detection circuit performs an all one detection operation in parallel. As shown in the detection circuit is coupled at an input of the final shifter of the plurality of shifters in the final stage within the normalizer and receives the partially shifted vector f at the input of the final shifter to use for detecting a carry signal while the final shifter shifts the partially shifted vector f to produce a normalized fraction result for example and provides the normalized result to a normalizer result register and then to the rounder to generate a rounded result. Additional details concerning the detection circuit will now be described below with reference to .

According to an embodiment of the present invention as shown in the detection circuit receives a portion of the partially shifted vector e.g. a partially normalized fraction f where the portion of the partially shifted vector f is selected based on the requirements of the rounder for example. The detection circuit also receives a predetermined shift amount i.e. nsha and detects the carry signal using the portion of the partially shifted vector f and the predetermined nsha. According to an embodiment of the present invention the predetermined nsha utilized by the detection circuit is the same lower bits of a shift amount as that input into the final shifter .

The detection circuit includes a plurality of 3 to 7 decoders and which receive the predetermined nsha i.e. nsha a plurality of OR gate banks and each coupled to the outputs of the respective 3 to 7 decoders and and receiving most significant bits N . . . N 6 and least significant bits M 1 . . . M 7 of the portion of the partially shifted vector and being controlled by the plurality of 3 to 7 decoders and based on the predetermined nsha to select specified bits of the upper and lower bits to be included in the all one or all zero detection operation. The detection circuit further includes a plurality of AND reduction networks and coupled to the output of the respective OR gate banks and to receive the output bits of the OR gate banks and and an AND reduction network which receives remaining bits N 7 . . . M between the upper and lower bits of the portion of the partially shifted vector f. According to one embodiment these remaining bits N 7 . . . M are nsha independent and the data width of the remaining bits N 7 . . . M is based on the data width of the partially normalized fraction f. These remaining bits N 7 . . . M are all included in the all one or all zero detection operation performed by the detection circuit. The detection circuit further includes an AND reduction network which receives the outputs from the AND reduction networks and and combines the respective outputs to detect a carry signal. Other embodiments may implement parts of the OR AND functionality within dynamic register circuits for example.

According to an embodiment of the present invention each of the OR gate banks and includes 7 OR gates with 2 inputs and 1 output each and each AND reduction network and includes 7 inputs and one output depicted as AND7 . Further AND reduction network includes M N 7 1 inputs and one output. For the purposes of illustration only in the AND reduction networks and are shown having only one input and one output.

Details regarding the masking and selection operation performed by the 3 to 7 decoders and will now be described with reference to .

According to an embodiment the detection unit may be used to determine carry signals for both low and high incrementers in the case of a mixed precision rounder for example. As mentioned above the shifter according to an embodiment of the present invention may include a detection circuit which performs an all zero detection operation as described below with reference to .

According to an embodiment of the present invention each of the AND gate banks and includes 7 AND gates with 2 inputs and 1 output each and each OR reduction network and includes 7 inputs and one output depicted as OR7 . Further OR reduction network includes M N 7 1 inputs and one output. For the purposes of illustration only in the OR reduction networks and are shown having only one input and one output.

According to embodiments of the present invention the detection circuit utilizes a portion of the partially shifted vector at an input of a final shift stage of the shifter along with a predetermined shift amount from outside of the data path which are both available earlier than the resulting shifted vector from the final shift stage in stage to detect all ones or all zeros. In the case of a normalizer and rounder the detection circuit pre computes carry signals for the subsequent rounder. Therefore by providing a detection unit within the normalizer the present invention provides the advantage of determining carry signals early in the pipeline thereby enabling a shorter back to back latency for the floating point unit.

The terminology used herein is for the purpose of describing particular embodiments only and is not intended to be limiting of the invention. As used herein the singular forms a an and the are intended to include the plural forms as well unless the context clearly indicates otherwise. It will be further understood that the terms comprises and or comprising when used in this specification specify the presence of stated features integers steps operations elements and or components but do not preclude the presence or addition of one ore more other features integers steps operations element components and or groups thereof.

The corresponding structures materials acts and equivalents of all means or step plus function elements in the claims below are intended to include any structure material or act for performing the function in combination with other claimed elements as specifically claimed. The description of the present invention has been presented for purposes of illustration and description but is not intended to be exhaustive or limited to the invention in the form disclosed. Many modifications and variations will be apparent to those of ordinary skill in the art without departing from the scope and spirit of the invention. The embodiment was chosen and described in order to best explain the principles of the invention and the practical application and to enable others of ordinary skill in the art to understand the invention for various embodiments with various modifications as are suited to the particular use contemplated

The flow diagrams depicted herein are just one example. There may be many variations to this diagram or the steps or operations described therein without departing from the spirit of the invention. For instance the steps may be performed in a differing order or steps may be added deleted or modified. All of these variations are considered a part of the claimed invention.

While the preferred embodiment to the invention had been described it will be understood that those skilled in the art both now and in the future may make various improvements and enhancements which fall within the scope of the claims which follow. These claims should be construed to maintain the proper protection for the invention first described.

