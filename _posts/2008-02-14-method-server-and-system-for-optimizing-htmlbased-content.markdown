---

title: Method, server and system for optimizing HTML-based content
abstract: A method, server and system for optimizing and delivering HyperText Markup Language (HTML)-based content such as HTML-based email messages to mobile communication devices is provided. In accordance with one embodiment, the method comprises: receiving an email message comprising an HTML portion comprising an HTML header and an HTML body; determining if the HTML header includes a reference to a Cascading Style Sheet (CSS) document comprising one or more rules; if the HTML header includes a reference to a CSS document, replacing the reference with the CSS rules of the CSS document, and sending the transformed email message to a destination mobile communication device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08176205&OS=08176205&RS=08176205
owner: Research In Motion Limited
number: 08176205
owner_city: Waterloo
owner_country: CA
publication_date: 20080214
---
The present disclosure relates generally to communication systems and more particularly to a method server and system for optimizing HTML based content such as HTML based email messages.

Due at least in part to data charges associated with receiving data on mobile or wireless communication devices such as handheld communication devices data which is automatically pushed out to devices without any user input is often limited in size. This aids in limiting the data charges associated with the pushed data in the absence of user input to the contrary. For example email messages and web page loads pushed to a device may only be a portion of the full message or web page. A user may have to request extra data e.g. more of the message or web page for more data to be transmitted. It is possible that the additional data transmitted to the device may still not complete the full message or page load requiring yet a further request or requests. Message and page loads may also be handled in this manner due to technical constraints or limited resources of mobile communication devices.

Certain types of messages and other content contain additional information describing how to format or render for display or other use such content in ways that cannot be easily or efficiently represented using plain text. Examples include messages and other content in rich text format HTML format and the like. These types of messages require more data and more space as a result of the style formatting and other rich features of such messages. In order to keep data charges lower or to accommodate the resource processing constraints of mobile communication devices these messages and other content may benefit even more than plain text from an optimization of content in order to limit the amount of data occupied by the message pushed to mobile communication devices or to reduce the demands on the resources of such devices.

Thus there exists a need for methods servers and systems for optimizing HTML based content such as HTML based email messages.

Reference is first made to which shows in block diagram form a communication system in which example embodiments of the present disclosure can be applied. The communication system comprises a number of mobile communication devices described in greater detail in which may be connected to the remainder of system in any of several different ways. Accordingly several instances of mobile communication devices are depicted in employing different example ways of connecting to system . Mobile communication devices are connected to a wireless network which may comprise one or more of a Wireless Wide Area Network WWAN and a Wireless Local Area Network WLAN or other suitable network arrangements. In some embodiments the mobile communication devices are configured to communicate over both the WWAN and WLAN and to roam between these networks. In some embodiments the wireless network may comprise multiple WWANs and WLANs .

The WWAN comprises a wireless network gateway which connects the mobile communication devices to the Internet and through the Internet to a wireless connector system comprising a mobile data server . The mobile data server may be operated by an enterprise such as a corporation which allows access to a network such as an internal or enterprise network and its resources or the mobile data server may be operated by a mobile network provider. If the mobile data server is operated by a mobile network service provider the network may be the Internet rather than an internal or enterprise network.

The wireless network gateway provides translation and routing services between the mobile data server and the WWAN which facilitates communication between the mobile communication devices and other devices not shown connected directly or indirectly to the wireless network . Accordingly communications sent via the mobile communication devices are transported via the wireless network to the wireless network gateway . The wireless gateway forwards the communications to the mobile data server via the Internet . Communications sent from the mobile data server are received by the wireless network gateway and transported via the wireless network to the mobile communication devices .

The WWAN may be implemented as a packet based cellular network that includes a number of transceiver base stations one of which is shown in The WWAN may be implemented using any suitable network technology. By way of example by not limitation the WWAN may be implemented as a packet based wireless network that includes a number of transceiver base stations one of which is shown in where each of the base stations provides wireless Radio Frequency RF coverage to a corresponding area or cell. The WWAN is typically operated by a mobile network service provider that provides subscription packages to users of the mobile communication devices . In some embodiments the WWAN conforms to one or more of the following wireless network types Mobitex Radio Network DataTAC GSM Global System for Mobile Communication GPRS General Packet Radio System TDMA Time Division Multiple Access CDMA Code Division Multiple Access CDPD Cellular Digital Packet Data iDEN integrated Digital Enhanced Network EvDO Evolution Data Optimized CDMA2000 EDGE Enhanced Data rates for GSM Evolution UMTS Universal Mobile Telecommunication Systems HSPDA High Speed Downlink Packet Access WiMax Worldwide Interoperability for Microwave Access or various other networks. Although WWAN is described as a Wide Area network that term is intended herein also to incorporate wireless Metropolitan Area Networks WMAN and other similar technologies for providing coordinated service wirelessly over an area larger than that covered by typical WLANs.

The WLAN comprises a wireless network which in some embodiments conforms to IEEE 802.11x standards sometimes referred to as Wi Fi such as for example the IEEE 802.11a 802.11b and or 802.11g standard. Other communication protocols may be used for the WLAN in other embodiments such as for example IEEE 802.11n IEEE 802.16e also referred to as Worldwide Interoperability for Microwave Access or WiMAX or IEEE 802.20 also referred to as Mobile Wireless Broadband Access . The WLAN includes one or more wireless RF Access Points AP one of which is shown in that collectively provide a WLAN coverage area.

The WLAN may be a personal network of the user an enterprise network or a hotspot offered by an Internet service provider ISP a mobile network provider or a property owner in a public or semi public area for example. The access points are connected to an access point AP interface which connects to the mobile data server directly for example if the access point is part of an enterprise WLAN in which the mobile data server resides or indirectly via the Internet if the access point is a personal Wi Fi network or Wi Fi hotspot in which case a mechanism for securely connecting to the mobile data server such as a virtual private network VPN may be required . The AP interface provides translation and routing services between the access points and the mobile data server to facilitate communication directly or indirectly with the mobile data server .

It will be appreciated that the WWAN and WLAN may have coverage areas that overlap at least partially. Typically the coverage area of the WWAN will be much larger than the coverage area of the WLAN and may overlap all or a large percentage of the coverage area of the WLAN . The WLAN may have sole coverage in some regions that are dead spots in the WWAN . For example some interior locations of an enterprise s buildings may be impenetrable to signals transmitted by the WWAN . Typically the channel resources such as bandwidth available for providing content to the mobile communication devices will be greater over the WLAN than over the WWAN .

The mobile data server may be implemented as one or more server modules and is typically located behind a firewall . The mobile data server manages communications to and from a set of managed mobile communication devices such that the mobile communication devices are each enabled to exchange electronic messages and other information with each other and computers for example via the Internet . The mobile data server also provides administrative control and management capabilities over users and mobile communication devices which may connect to the mobile data server .

The mobile data server allows the mobile communication devices to access the network and connected resources and services such as a messaging server for example a Microsoft Exchange IBM Lotus Domino or Novell GroupWise email server for implementing or connecting to a messaging system an Internet server for connecting to the Internet and World Wide Web WWW and application servers for implementing server based applications such as instant messaging IM applications or for accessing other servers such as content servers. The Internet server and or application servers may in some operational modes function as proxy servers for obtaining content from remote content sources such as content servers sometimes referred to as origin servers .

The mobile data server typically provides a secure exchange of data e.g. email messages personal information manager PIM data and IM data with the mobile communication devices . In some embodiments communications between the mobile data server and the mobile communication devices are encrypted. In some embodiments communications are encrypted using a symmetric encryption key implemented using Advanced Encryption Standard AES or Triple Data Encryption Standard Triple DES encryption. Private encryption keys are generated in a secure two way authenticated environment and are used for both encryption and decryption of data. In some embodiments the private encryption key is stored only in the user s mailbox on the messaging server and on the mobile communication device and can typically be regenerated by the user on mobile communication devices . Data sent to the mobile communication devices is encrypted by the mobile data server using the private encryption key retrieved from the user s mailbox. The encrypted data when received on the mobile communication devices is decrypted using the private encryption key stored in memory. Similarly data sent to the mobile data server from the mobile communication devices is encrypted using the private encryption key stored in the memory of the mobile communication device . The encrypted data when received on the mobile data server is decrypted using the private encryption key retrieved from the user s mailbox.

The mobile data server may also comprise an Internet connectivity module not shown which provides TCP IP transmission control protocol Internet protocol and HTTP hypertext transfer protocol based connectivity providing an Internet based service connection. The Internet connectivity module provides the mobile communication devices with access to the Internet and World Wide Web WWW and possibly other external communication networks connected directly or indirectly to the mobile data server . Alternatively in other embodiments the Internet connectivity module may be implemented by a separate server or server application which is connected to the mobile data server .

The wireless network gateway is adapted to send data packets received from the mobile communication device over the WWAN to the mobile data server . The mobile data server then sends the data packets to the appropriate connection point such as the messaging server Internet server or application servers where the data packets can be sent to the appropriate end point. Conversely the mobile data server sends data packets received for example from the messaging server Internet server or application server to the wireless network gateway which then transmit the data packets to the destination mobile communication device . The AP interfaces of the WLAN provide similar sending functions between the mobile communication device the mobile data server and network connection point such as the messaging server Internet server and application server .

The network may comprise a private local area network metropolitan area network wide area network or combinations thereof and may include virtual networks constructed using any of these alone or in combination. A user may connect to the mobile data server using a computer such as desktop or notebook computer via the network . If the mobile data server is operated by a mobile network provider rather than an enterprise the network may be the Internet . If the mobile data server is operated by an enterprise there may be a number of enterprise computers connected to the network .

A link may be provided for exchanging information between the mobile communication device and a computer connected to the mobile data server . The link may comprise one or both of a physical interface and short range wireless communication interface . The physical interface may comprise one or combinations of an Ethernet connection Universal Serial Bus USB connection Firewire also known as an IEEE 1394 interface connection or other serial data connection via respective ports or interfaces of the mobile communication device and computer . The short range wireless communication interface is a personal area network PAN interface. A Personal Area Network is a wireless point to point connection meaning no physical cables are required to connect the two end points. The short range wireless communication interface may comprise one or a combination of an infrared IR connection such as an Infrared Data Association IrDA connection a short range radio frequency RF connection such as Bluetooth or IEEE 802.15.3a also referred to as UltraWideband UWB or other PAN connection.

It will be appreciated that the above described communication system is provided for the purpose of illustration only and that the above described communication system comprises one possible communication network configuration of a multitude of possible configurations for use with the mobile communication devices . Suitable variations of the communication system will be understood to a person of skill in the art and are intended to fall within the scope of the present disclosure.

Reference is now made to which illustrates in block diagram form a mobile communication device in which example embodiments described in the present disclosure can be applied. The mobile communication device is a two way communication device having at least data and possibly also voice communication capabilities and the capability to communicate with other computer systems for example via the Internet . Depending on the functionality provided by the mobile communication device in various embodiments the device may be a data communication device a multiple mode communication device configured for both data and voice communication a mobile telephone a PDA personal digital assistant enabled for wireless communication or smartphone or a laptop computer with a wireless modem.

In some embodiments the mobile communication device is a handheld electronic device which includes a rigid case not shown for housing components of the device and is configured to be held with one or two hands while the device is in use. In some embodiments handheld electronic device is small enough to fit inside a standard purse or coat pocket or belt mounted holster.

The mobile communication device includes a wireless communication subsystem for exchanging radio frequency signals with the wireless network . The wireless communication subsystem comprises at least one of a WAN communication subsystem for two way communication with the WWAN and a WLAN communication subsystem two way communication with the WLAN via the access points . The wireless communication subsystem includes a receiver a transmitter and associated components such as one or more antenna elements and local oscillators LOs and a processing module such as a digital signal processor DSP . The antenna elements and may be embedded or internal to the mobile communication device and a single antenna may be shared by both receiver and transmitter as is known in the art. As will be apparent to those skilled in the field of communication the particular design of the wireless communication subsystem depends on the wireless network in which mobile communication device is intended to operate.

The mobile communication device may communicate with any one of a plurality of fixed transceiver base stations of the wireless network within its geographic coverage area. The mobile communication device may send and receive communication signals over the wireless network after the required network registration or activation procedures have been completed. Signals received by the antenna through the wireless network are input to the receiver which may perform such common receiver functions as signal amplification frequency down conversion filtering channel selection etc. as well as analog to digital A D conversion. A D conversion of a received signal allows more complex communication functions such as demodulation and decoding to be performed in the DSP . In a similar manner signals to be transmitted are processed including modulation and encoding for example by the DSP . These DSP processed signals are input to the transmitter for digital to analog D A conversion frequency up conversion filtering amplification and transmission to the wireless network via the antenna . The DSP not only processes communication signals but may also provide for receiver and transmitter control. For example the gains applied to communication signals in the receiver and the transmitter may be adaptively controlled through automatic gain control algorithms implemented in the DSP .

The mobile communication device includes a microprocessor which controls the overall operation of the mobile communication device . The microprocessor interacts with communication subsystem which performs communication functions. The microprocessor also interacts with additional device subsystems which may include but are not limited to a display device which may be a liquid crystal display LCD screen a flash memory a random access memory RAM a read only memory ROM auxiliary input output I O subsystems a data port such as serial data port for example a Universal Serial Bus USB data port a keyboard or keypad a speaker microphone a navigation tool such as a clickable scroll wheel also referred to as a track wheel or thumbwheel or trackball a short range communication subsystem and other device subsystems generally designated as . Different numbers and combinations of the aforementioned device subsystems may be present in various embodiments and not all need be present in some embodiments. The keypad maybe either a complete alphanumeric keypad a limited reduced or simplified alphanumeric keypad or a telephone type keypad. In some embodiments the mobile communication device may comprise a touchscreen display which in at least some embodiments includes a touch sensitive input surface which overlays the display device . In such embodiments the keypad may be omitted and possibly the navigation tool may be realized using the touch sensitive input surface.

The microprocessor operates under stored program control and executes software modules stored in memory such as persistent memory for example in the flash memory . The software modules comprise operating system software and software applications . Those skilled in the art will appreciate that the software modules or parts thereof may be temporarily loaded into volatile memory such as the RAM . The RAM is used for storing runtime data variables and other types of data or information as will be apparent to those skilled in the art. Although specific functions are described for various types of memory this is merely an example and those skilled in the art will appreciate that a different assignment of functions to types of memory could also be used.

The software applications may include a range of applications including for example an address book application a messaging application a calendar application and or a notepad application. In some embodiments the software applications includes one or more of a Web browser application i.e. for a Web enabled mobile communication device an email message application a push content viewing application a voice communication i.e. telephony application a map application and a media player application. Each of the software applications may include layout information defining the placement of particular fields and graphic elements e.g. text fields input fields icons etc. in the user interface i.e. the display device according to the application.

In some embodiments the auxiliary input output I O subsystems may comprise an external communication link or interface for example a Global Positioning System GPS communication subsystem for communicating with a satellite network not shown for navigation or other functionality an Ethernet interface or wireless communication interfaces for communicating with other types of wireless networks such as for example an orthogonal frequency division multiplexed OFDM network.

In some embodiments the mobile communication device also includes a removable memory card typically comprising flash memory and a memory card interface . Network access to the WWAN and possibly the WLAN is typically associated with a subscriber or user of the mobile communication device via the memory card which may be a Subscriber Identity Module SIM card or other type of memory card for use in the relevant wireless network type. The memory card is inserted in or connected to the memory card interface of the mobile communication device in order to operate in conjunction with the wireless network .

The mobile communication device stores data in an erasable persistent memory which in one example embodiment is the flash memory . In various embodiments the data includes service data comprising information required by the mobile communication device to establish and maintain communication with the wireless network for example network service data and gateway service data . The data may also include user application data such as email messages address book and contact information calendar and schedule information notepad documents image files and other commonly stored user information stored on the mobile communication device by its user and other data. The data may also include data required for the communication layers managed by the mobile data server and servers . The data stored in the persistent memory e.g. flash memory of the mobile communication device may be organized at least partially into a number of databases each containing data items of the same data type or associated with the same application. For example email messages contact records and task items may be stored in individual databases within the device memory.

The serial data port may be used in handheld communication devices such as smartphones for synchronization with the user s computer and may be used to implement link The serial data port may allow a user to set preferences on the device using the computer and extends the capabilities of the mobile communication device by providing for information or software downloads to the mobile communication device other than through the wireless network . The alternate download path may for example be used to load an encryption key onto the mobile communication device through a direct reliable and trusted connection to thereby provide secure device communication.

In some embodiments the mobile communication device is provided with a service routing application programming interface API which provides an application with the ability to route traffic through a serial data such as USB or PAN connection such as Bluetooth to the computer using standard connectivity protocols. When a user connects their mobile communication device to the host computer via a USB cable or Bluetooth connection traffic that was destined for the wireless network is automatically routed to the mobile communication device using the USB cable or Bluetooth connection. Similarly any traffic destined for the wireless network is automatically sent over the USB cable Bluetooth connection to the host computer for processing.

The mobile communication device also includes a battery as a power source which is typically one or more rechargeable batteries that may be charged for example through charging circuitry coupled to a battery interface such as the serial data port . The battery provides electrical power to at least some of the electrical circuitry in the mobile communication device and the battery interface provides a mechanical and electrical connection for the battery . The battery interface is coupled to a regulator not shown which provides power V to the circuitry of the mobile communication device .

The short range communication subsystem is an additional optional component which provides for communication between the mobile communication device and different systems or devices which need not necessarily be similar devices. For example the subsystem may include an infrared device and associated circuits and components or a wireless bus protocol compliant communication mechanism such as a Bluetooth communication module to provide for communication with similarly enabled systems and devices Bluetooth is a registered trademark of Bluetooth SIG Inc. or a communication module for IEEE 802.15.3a UWB .

A predetermined set of applications that control basic device operations including data and possibly voice communication applications will normally be installed on the mobile communication device during or after manufacture. Additional applications and or upgrades to the operating system or software applications may also be loaded onto the mobile communication device through the wireless network the auxiliary I O subsystem the serial port the short range communication subsystem or other suitable subsystems which may include other wireless communication interfaces. The downloaded programs or code modules may be permanently installed for example written into the program memory i.e. the flash memory or written into and executed from the RAM for execution by the microprocessor at runtime. Such flexibility in application installation increases the functionality of the mobile communication device and may provide enhanced on device functions communication related functions or both. For example secure communication applications may enable electronic commerce functions and other such financial transactions to be performed using the mobile communication device .

The mobile communication device may include a personal information manager PIM application having the ability to organize and manage data items relating to a user such as but not limited to instant messaging email calendar events voice mails appointments and task items. The PIM application has the ability to send and receive data items via the wireless network . In some example embodiments PIM data items are seamlessly combined synchronized and updated via the wireless network with the user s corresponding data items stored and or associated with the user s computer thereby creating a mirrored host computer on the mobile communication device with respect to these data items.

The mobile communication device may provide two principal modes of communication a data communication mode and an optional voice communication mode. In the data communication mode a received data signal such as a text message an email message or Web page download will be processed by the communication subsystem and input to the microprocessor for further processing. For example a downloaded Web page may be further processed by a browser application or an email message may be processed by an email message application and output to the display . A user of the mobile communication device may also compose data items such as email messages for example using the keypad and or the navigation tool in conjunction with the display and possibly the auxiliary I O device . The composed items may be transmitted through the wireless communication subsystem over the wireless network .

In the voice communication mode the mobile communication device provides telephony functions and operates as a typical cellular phone. The overall operation is similar except that the received signals would be output to the speaker and signals for transmission would be generated by a transducer such as the microphone . The telephony functions are provided by a combination of software firmware i.e. the voice communication module and hardware i.e. the microphone the speaker and the keyboard or keypad . Alternative voice or audio I O subsystems such as a voice message recording subsystem may also be implemented on the mobile communication device . Although voice or audio signal output is typically accomplished primarily through the speaker the display may also be used to provide an indication of the identity of a calling party duration of a voice call or other voice call related information.

Referring now to a mobile data server for use in accordance with one embodiment of the present disclosure will now be described in more detail. The mobile data server is a computer implementing one or more server applications configured for performing the processes and functions described herein. The mobile data server comprises a controller comprising at least one microprocessor for controlling its overall operation and a communication subsystem . The communication subsystem performs communication functions for directly or indirectly communicating with various connection points of the communication system such as the network and servers the AP interfaces of the WLAN the wireless network gateway of the WWAN and the mobile communication devices . The communication subsystem comprises at least a WWAN communication subsystem not shown for two way communication with the WWAN and possibly a WLAN communication subsystem not shown for two way communication with the WLAN via the access points .

The mobile data server may further comprise a display screen or monitor connected to the microprocessor one or more user input devices such as a keyboard and navigation tool such as a mouse connected to the microprocessor for sending user input signals to the microprocessor in response to user inputs one or more memories or electronic storage elements connected to the microprocessor such as a hard disk drive HDD or other non volatile memory such as flash memory a random access memory RAM a read only memory ROM a data port such as serial data port for example a Universal Serial Bus USB data port and auxiliary input output I O devices . Other features of the mobile data server for implementing the processes and functions described herein will be appreciated by persons ordinarily skilled in the art.

The microprocessor operates under stored program control and executes software modules stored in memory such as persistent memory for example in the HDD . The software modules comprise data and instructions which may comprise operating system software and software applications . Data necessary for performing the various functions of the mobile data server are also stored on the HDD . Those skilled in the art will appreciate that the software modules or parts thereof may be temporarily loaded into volatile memory such as the RAM . The RAM is used for storing runtime data variables and other types of data or information as will be apparent to those skilled in the art. Although specific functions are described for various types of memory this is merely an example and those skilled in the art will appreciate that a different assignment of functions to types of memory could also be used.

The mobile data server also includes an optimization module which configures the microprocessor to carry out the optimization processes described herein. The optimization module includes instructions for execution by microprocessor for receiving HyperText Markup Language HTML formatted email messages optimizing the email messages for delivery to one or more of the mobile communication devices and transmitting sending the optimized messages to the destination mobile communication devices. The optimization module may among other things be a stand alone software application part of the operating system or part of another software application . In some embodiments the functions performed by optimization module may be realized as a plurality of independent elements rather than a single integrated element and any one or more of these elements may be implemented as parts of other software modules. Furthermore in some embodiments at least some of the functions performed by the optimization module may be implemented in firmware of the mobile data server . Finally although the optimization module is described in connection with one embodiment as a part of the mobile data server it could in other embodiments be realized either as an independent server or as part of a multiple function server other than mobile data server but operatively coupled or connected thereto. Thus as henceforth further referenced and claimed herein unless otherwise specified optimization module shall denote both the program instructions whether software or firmware and those portions of any hardware elements necessary to execute such instructions at any particular time and shall be considered to be operatively coupled to the controller part of mobile data server whether those instructions are executed on mobile data server or on some other server.

The current HTML specification is however the present disclosure is not limited to any particular version and is intended to cover all prior and future versions revisions supplements additions and replacements to the HTML specification to the extent they are compatible with the teachings of the present disclosure.

Reference is now made to which illustrates operations for optimizing an HTML based email message for delivery to a mobile communication device in accordance with one embodiment of the present disclosure. The operations are performed by the optimization module of the mobile data server . In other embodiments the operations may be performed by a separate server connected to the mobile data server .

In a first step an HTML email message intended for one or more mobile communication device is received by the mobile data server . As will be appreciated by persons skilled in the art an email message comprises a header which includes a number of header fields and a message body. An HTML email message contains HTML content within the body of the message. The HTML content is located within an HTML portion of the message body and comprises an HTML header and HTML body. The HTML header is denoted using the tags and to mark the start and end of the HTML header respectively. The HTML body is denoted using the tags and to mark the start and end of the HTML body respectively. The email message is typically received from a messaging server such as Microsoft Exchange which receives the email message from an email client which may be a Personal Information Management PIM application such as Microsoft Outlook . The email message may be sent from any computer or mobile communication device connected to the Internet or to the network .

The operations may comprise as a preliminary step the step of parsing or analyzing all email messages received by the mobile data server to determine if the message is a plain text unformatted email message or an HTML formatted email message and processing only those email messages received by the mobile data server which are formatted using HTML. This determination may be made for example for Multipurpose Internet Mail Extensions MIME complaint email messages by parsing the email message and analyzing it for an indication of whether the message contains HTML content for example that the message contains a content type header with a value of text html or other indication of HTML content. As will be understood by persons skilled in the art the MIME specification defines a series headers for specifying attributes of an email message including the content type header field which specifies a type and subtype of the message content and defines a set of transfer encodings amongst many parameters for formatting email. The MIME specification is currently specified in six 6 Request for Comment RFC documents RFC 2045 RFC 2046 RFC 2047 RFC 4288 RFC 4289 and RFC 2077 however the present disclosure is not limited to any particular version and is intended to cover all prior and future versions revisions supplements additions and replacements to the MIME specification to the extent they are compatible with the teachings of the present disclosure and to cover other email formats and specifications which may be formatted in accordance with HTML for example proprietary email message formats .

Next in step the mobile data server parses analyzes the HTML header of the email message to determine if the email message includes a reference to an external Cascading Style Sheets CSS document. The HTML header is the standard location of CSS references in HTML. However the mobile data server may parse one or more of the other parts of the email message to determine if CSS references are located outside the HTML header elsewhere in the email message. Any CSS references that appear elsewhere in the message in a non standard location are moved to the HTML header and treated as if they were originally found in the HTML header. The external CSS document may be attached to the email message or located remotely for example on a content server . The reference to the attached or remotely located CSS document may comprise an absolute or relative URI Uniform Resource Identifier . URIs are described in RFC 3986. As will be appreciated by persons skilled in the art CSS is a stylesheet language used to style documents e.g. to describe the presentation of documents written in a markup language such as HTML. The current specification for CSS is level 2 revision 1 CSS 2.1 however the present disclosure is not limited to any particular version and is intended to cover all prior and future versions revisions supplements additions and replacements to the CSS specification to the extent they are compatible with the teachings of the present disclosure.

As will be appreciated by persons skilled in the art each CSS document referred to as a style sheet comprises one or more style rules also referred to as CSS rules which define a style. Each rule consists of one or more selectors and a declaration block. A declaration block consists of a list of semicolon separated declarations which begins with a left curly brace and ends with a right curly brace . Each declaration itself consists of a property a colon a value then a semi colon .

CSS documents allow users to apply style e.g. fonts colors and spacing to structured documents i.e. documents in a structured definition language such as HTML formatted email messages and other HTML documents. CSS content is typically applied using CSS documents or files which are separate from external to the structured documents which they are applied to. In the context of websites the separation of the style or presentation of documents from the content of documents simplifies web page authoring and web site maintenance. However in the messaging context the separation of document content and style information which results from using CSS documents poses challenges for message delivery and integration particularly in relation to mobile delivery.

As noted above a CSS document may be attached to the email message or located remotely. The reference to the attached or remotely located CSS document may comprise a URI which may be a Uniform Resource Locator URL Uniform Resource Name URN or both. Where the CSS document is attached to the email message the URI may be a relative Content ID URI described by RFC 2392 which references an attachment to the email message. Where the CSS document is located remotely for example on a content server the URI points to the location where the CSS document may be retrieved by the mobile data server .

If the email message does not include a reference to an external CSS document step then execution proceeds to step where optionally further processing and or optimization of the email message may occur for example optimization of the HTML of the email message . After the optional further processing optimization execution proceeds to step where the email message is sent or transmitted by the mobile data server to the mobile communication devices indicated by the address fields e.g. To CC and BCC fields of the email message. Next execution ends. It will be appreciated by persons skilled in the art that the mobile data server may not perform all of the transmitting functions required to deliver the email message to the mobile communication devices and that the mobile data server may send the transformed email message for delivery to the respective WWAN or WLAN communication subsystem of the wireless network which in turn transmits the email message to the destination mobile communication devices . For example the mobile data server may send the email message to the wireless network gateway of the WWAN or the AP interface of the WLAN from which the email message is transmitted to destination mobile communication devices using the communication infrastructure of the WWAN or WLAN .

If the email message includes a reference to an external CSS document execution proceeds to step where the external reference is replaced with CSS content from the CSS document attached to the email message or located remotely. If the external reference is to a remotely located CSS document the CSS document is first retrieved downloaded by the mobile data server . If more than one reference to an external CSS document is present in the HTML header each reference is replaced with CSS content from the respective CSS document.

The retrieval and replacement of remotely located CSS documents may be contingent on an option specified by the mobile device user or mobile data server administrator since retrieval of external documents may expose information to the remote server. Examples of information which may be exposed includes but is not limited to the existence and validity of the email address of the mobile device user the IP address and location of the mobile device user the name and version of the email messaging or PIM manager application on the mobile communication device and that the associated email message has been read by the mobile device user. Such restrictions can but typically do not apply to CSS attachments.

The content of the CSS document is placed within a STYLE block in the HTML header. If the HTML document is non standard and contains CSS content in the HTML body it is moved to the header. For each external reference a new STYLE block is inserted however it is possible and valid for the external CSS content to be placed in an existing STYLE block. In both cases the order that the CSS rules appear is preserved. The inserted STYLE block is processed in the same manner as if it were originally part of the email message. STYLE blocks are denoted by tags in the HTML portion of the email message using the tags and to mark the start and end of the STYLE block respectively. The HTML body refers to STYLE blocks for style presentation information used in formatting the content of the message using HTML compatible email clients application or PIM clients application .

Next in step CSS related optimizations and optionally HTML optimizations may be applied to the email message. In some embodiments CSS optimizations may comprise one or any combination of removing any unreferenced e.g. unused and unnecessary CSS rules removing any duplicate redundant CSS rules and interleaving at least some of the style entries e.g. CSS rules into the body of the email message. HTML optimizations may also be applied to the email message.

Next after the CSS related optimizations and optional HTML optimizations execution proceeds to step where the optimized email message is transmitted by the mobile data server to the mobile communication devices indicated by the address fields e.g. To CC and BCC fields of the email message. Next execution ends. As noted above it will be appreciated by persons skilled in the art that the mobile data server may not perform all of the transmitting functions required to deliver the email message to the mobile communication devices and that the mobile data server may send the transformed email message for delivery to the respective WWAN or WLAN communication subsystem of the wireless network which in turn transmits the email message to the destination mobile communication devices .

For the purpose of illustration reference will now be made to example code of an HTML formatted email message. The example code is presented for the purpose of illustrating the methods of the present disclosure only and is not intended to be limiting. Example HTML code of an email message with an attached CSS document is as follows message header fields such as MIME message headers have been omitted 

In the example code set forth above href cid attachment.css refers to a CSS document file attachment.css attached to the email message. The contents of the CSS file attachment.css may be as follows 

In accordance with the method of the present disclosure the mobile data server analyses and detects the CSS file as an attachment to the email message reads the contents of the CSS file and transforms the HTML in the email message by inserting the contents of the CSS file directly into the HTML. The transformed HTML of an email message based on the example code above would appear as follows 

After the HTML has been transformed to include the CSS content of the CSS document CSS optimizations and or HTML optimizations may be performed on the transformed email message. The CSS optimizations may include but are not limited to one or any combination of removing any unreferenced CSS rules removing any duplicate redundant CSS rules and interleaving at least some of the style entries e.g. CSS rules into the body of the email message. Interleaving comprises sorting of the CSS rules into the order that they are referenced in the HTML body determining groups of CSS rules from the sorted CSS rules in accordance with predetermined parameters or rules and moving the groups of CSS rules in groups into respective STYLE blocks in the HTML body that precede the references to the respective CSS rules. Typically a new STYLE block is inserted for each group but the CSS rules may be placed in an existing STYLE block in the HTML body which precedes the reference to the CSS rule. CSS rules which were added to interleaved STYLE blocks in the HTML body are removed from the HTML header.

Based on the example code above the transformed email message may be optimized by combining the STYLE block added by the transformation step with the pre existing STYLE block in the original email message. The optimized HTML of the email message would appear as follows 

If duplicate CSS rules are present after embedding the CSS content from the CSS document the duplicate entries may be removed. Duplicate entries may occur for example because the CSS document includes a CSS rule which corresponds to a style rule which is specified again later in the message for example in a pre existing STYLE block or in a STYLE block created for an external reference. For example if the CSS document specified the color purple .c4 color purple in the example code above this would create a duplicate entry as an equivalent entry was present in STYLE block of the original email message. Duplicate entries may also occur because multiple CSS documents are referenced by the email message and that at least some of the CSS documents included at least some CSS rules in common. If multiple CSS documents are referenced by the email message these documents may be attached to the message located remotely or combinations of both.

An unreferenced CSS rule may occur if for example the CSS content in the CSS document includes CSS rules which are not referenced in the HTML body of the email message. For example if a CSS rule for the color black where also included in the CSS document e.g. .c6 color black in the example code above this entry would be unreferenced since the HTML body of the email message does not refer to the class c6 . Thus the CSS optimizations may comprise removing this CSS rule from the transformed email message because it is unreferenced and therefore unused.

Furthermore it should be appreciated that the mobile data server may data delivery options or settings which enforce a size limit on each HTML email message retrieved from the messaging server . CSS rules that are only referenced in HTML beyond the size limit are treated as unreferenced rules and removed. Accordingly in some embodiments the mobile data server determines the size of the email message to be sent to the destination mobile communication device determines if the email message is to be sent in portions in accordance with a predetermined message size threshold e.g. 2 kB and determines the portions i.e. selects the portions of the email message to be sent to the destination mobile communication device in the transformed message if the size of the email message is greater than or equal to the predetermined message size threshold e.g. 2 kB . It will be appreciated that if the message is to be sent in portions multiple transformed email messages will need to be send to delivery the entire original email message. However the user must typically request the additional portions to receive them. The predetermined message size threshold determining if the message is to be sent in portions and message portion selection is typically based on the original email message however it could be based on the transformed email message. As noted elsewhere in the present disclosure CSS interleaving may comprise selecting groups of CSS rules based on references to the CSS rules in the portions of the message to be delivered to the mobile communication device and moving these groups of CSS rules into the HTML body of the email message.

As will be appreciated by persons skilled in the art the method described herein embeds CSS content into HTML formatted email messages. This reduces inefficiencies relating to using attached and remotely located CSS documents by eliminating the need for mobile communication devices with limited resources to open CSS documents and parse and process the contents of these documents when opening and viewing the message. The described methods also allow CSS optimizations to be performed on the email message. These optimizations sometimes referred to as joint CSS and HTML optimizations may comprise removing unreferenced CSS rules e.g. unnecessary and unused CSS rules removing redundant e.g. duplicate CSS rules and or interleaving CSS rules within the HTML body. Depending on the mobile data delivery options there may be limits on the number of attachments which are initially delivered to the mobile communication devices with the remainder or further portion of the attachments being sent only if the user requests it. Embedding or incorporating CSS content into the message reduces or avoids processing errors and presentation inefficiencies which may be caused by the message referencing attached or remotely located CSS documents which have not been delivered to the mobile communication device. Moreover depending on the mobile data delivery options if attachments are not automatically delivered with the message the incorporating CSS content into the message reduces or eliminates the need for the mobile communication device to request the attached CSS document and for the mobile data server to transmit the CSS document if and when requested by the device.

Interleaving CSS rules within the HTML body addresses several issues with the delivery of HTML based email messages to mobile communication devices . Firstly email message may not always be transmitted in its entirety to the mobile communication device . For example depending on the mobile data delivery settings for example to reduce the data charges associated with mobile data delivery only a fixed size portion of each message may be initially delivered with the remainder or further portion of the message being sent only if the user requests it for example using either a More or Auto More message request mechanism which requests the remainder or a further portion of the message from the mobile data server . Since the data in the HTML header applies to the entire document there may be portions of the HTML header that only need to be sent if the remainder or further portion of the message is requested by the user. Interleaving removes CSS rules from the HTML header and adds the corresponding CSS rules in the HTML body i.e. the CSS rules are moved . This reduces or avoids delivering CSS rules which are not used by the message portions which are sent to the mobile communication devices and thereby reduces or eliminates the processing by the mobile communication devices of CSS rules which are not used by the message portions sent. Note that interleaving CSS into the HTML body is not standards compliant and thus also requires a mobile communication device having an email message application or PIM manager application and possibly a Web browser application if HTML having interleaved CSS content is to be delivered to the mobile communication device that supports this non standard structure.

Secondly even if the entire HTML document is sent to the mobile communication device it still has limited processing and memory resources. Thus requiring the mobile communication device to parse and process a header that applies to the entire document when only a small portion of the document is initially displayed on the display screen is wasteful of device resources and may result in reduced performance such as delays in opening and viewing messages.

Thus in view of the above it will be appreciated that the described operations reduce the processing required by one or both of the mobile data server and mobile communication devices and reduces the amount of data that needs to be transmitted to receive HTML formatted emails having attached CSS documents or linked CSS documents.

While the operations have been described as occurring in a particular order it will be appreciated to persons skilled in the art that some of the steps may be performed in a different order provided that the result of the changed order of any given step will not prevent or impair the occurrence of subsequent steps. Furthermore some of the steps described above may be combined in other embodiments and some of the steps described above may be separated into a number of sub steps in other embodiments.

Furthermore while the processing and optimization of HTML formatted email messages has been described as occurring on the mobile data server in the above described embodiments the operations may be performed by the messaging server in other embodiments. Moreover while the embedding of CSS content has been described in the context of HTML formatted email messages the teachings of the present disclosure may be applied to both the Standard Generalized Markup Language SGML based HTML specification and the XML based HTML specification also referred to as Extensible HyperText Markup Language or XHTML . Moreover still the teachings of the present disclosure may be applied to HTML content such as web pages which are transmitted to mobile communication devices in the same manner as with HTML email messages including all CSS and HTML optimizations on an HTML document with embedded CSS content which have been described above and to other documents written in HTML and other kinds of Extensible Markup Language XML document.

The teachings of the present disclosure could be applied to optimize any document in any kind of markup language that allows for the separation of presentation styling information from content and which allows external references and inline specification of styling information. In this way if provided with a first document which comprises content data in the markup language and a reference to a second external document which comprises style data in the same or different markup language and if provided with the second document or access to the second document if remotely located the teachings of the present disclosure may be applied to embed the contents of the second document in the first document and to optionally further optimize the transformed code. This allows inline optimization of content for transmission for example over a limited capacity or expensive link to mobile communication devices .

In accordance with one embodiment of the present disclosure there is provided a method for optimizing and delivering HyperText Markup Language HTML email messages to mobile communication devices the method comprising receiving an email message comprising an HTML portion comprising an HTML header and an HTML body determining if the HTML header includes a reference to a Cascading Style Sheet CSS document comprising one or more rules if the HTML header includes a reference to a CSS document replacing the reference with the CSS rules of the CSS document and sending the transformed email message to a destination mobile communication device.

In accordance with another embodiment of the present disclosure there is provided a server for optimizing and delivering HyperText Markup Language HTML email messages to mobile communication devices the server comprising a controller comprising at least one processor for controlling the operation of the server a communication subsystem connected to the controller for receiving and sending email messages to the mobile communication devices over a wireless network the email messages including HTML email messages comprising an HTML portion comprising an HTML header and an HTML body an optimization module connected to the controller which configures the controller to receive HTML email messages determine if the HTML header of the email messages include a reference to a Cascading Style Sheet CSS document comprising one or more rules replace references in the email messages with the CSS rules of the respective CSS document and send the transformed email messages to destination mobile communication devices.

In accordance with a further embodiment of the present disclosure there is provided a method for optimizing and delivering content to mobile communication devices the method comprising receiving a first markup language document comprising content in a first markup language determining if the first markup language document includes a reference to a second markup language document comprising style data in a second markup language if the first markup language document includes a reference to a second markup language document comprising style data replacing the reference with the style data of the second markup language document and sending the transformed first markup language document to a destination mobile communication device. In some embodiments the first markup language document is an email message. In some embodiments the first markup language document is an HTML document and the second document is a Cascading Style Sheet CSS document. The HTML document may be an email message comprising HTML content.

In accordance with a further embodiment of the present disclosure there is provided a server for optimizing and delivering content to mobile communication devices the server comprising a controller comprising at least one processor for controlling the operation of the server a communication subsystem connected to the controller for receiving and sending email messages to the mobile communication devices over a wireless network the email messages including HTML email messages comprising an HTML portion comprising an HTML header and an HTML body an optimization module connected to the controller which configures the controller to receive first markup language documents comprising content in a first markup language determine if the first markup language documents include a reference to a second markup language document comprising style data in a second markup language replace the references with the style data of the second markup language document and send the transformed first markup language documents to destination mobile communication devices.

In accordance with further embodiments of the present disclosure there are provided a computer program product comprising a computer readable medium having stored thereon computer executable instructions comprising instructions for practising the methods of the application.

While the present disclosure is primarily described as a method a person of ordinary skill in the art will understand that the present disclosure is also directed to various apparatus such as a mobile communication device and mobile data server for carrying out at least some of the aspects and features of the described methods and including components for performing at least some of the described method steps be it by way of hardware components a computer programmed by appropriate software to enable the practice of the disclosed method by any combination of the two or in any other manner. Moreover an article of manufacture for use with the apparatus such as a pre recorded storage device or other similar computer readable medium including program instructions recorded thereon or a computer data signal carrying computer readable program instructions may direct an apparatus to facilitate the practice of the disclosed method. It is understood that such apparatus articles of manufacture and computer data signals also come within the scope of the present disclosure.

The embodiments of the present disclosure described above are intended to be examples only. Those of skill in the art may effect alterations modifications and variations to the particular embodiments without departing from the intended scope of the present disclosure. In particular features from one or more of the above described embodiments may be selected to create alternate embodiments comprised of a sub combination of features which may not be explicitly described above. In addition features from one or more of the above described embodiments may be selected and combined to create alternate embodiments comprised of a combination of features which may not be explicitly described above. Features suitable for such combinations and sub combinations would be readily apparent to persons skilled in the art upon review of the present disclosure as a whole. The subject matter described herein and in the recited claims intends to cover and embrace all suitable changes in technology.

