---

title: Method and apparatus for monitoring voltage in a meter network
abstract: Methods and systems are provided for monitoring input voltages to meters that are in a wireless metering network. A plurality of entries can be created that include voltage-related information, such as a maximum input voltage or a minimum input voltage. Each meter can further determine whether the input voltage is beyond a predetermined threshold voltage for a duration that might indicate a voltage irregularity in the network. Each meter in the network can be monitored by a collector, which can communicate information to a data collection server.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07860672&OS=07860672&RS=07860672
owner: Elster Electricity, LLC
number: 07860672
owner_city: Raleigh
owner_country: US
publication_date: 20080617
---
This application claims priority to U.S. Patent Application No. 61 016 760 filed Dec. 26 2007 and also claims priority to U.S. Patent Application No. 61 061 810 filed Jun. 16 2008 the disclosure of each of which is hereby incorporated by reference as if set forth in their entirety herein.

The present invention relates to metering networks and more particularly relates to monitoring status information of meters in a wireless metering network.

Utility companies conventionally read electric gas and water meters using both fixed network and mobile RF technologies. Specifically utility companies have historically measured and recorded energy and demand data associated with the various meters. More recently meters have been provided with the capability to capture and record various data such as voltage current instantaneous watts over a specific time interval. The data can then either be transmitted to the utility company or read remotely or locally by the utility company.

While conventional metering networks have proven useful for their intended purpose it would be desirable to provide a metering network having meters that can be easily monitored for status conditions.

In accordance with one aspect of the present invention a method is provided for monitoring voltage in a meter. The meter can be one of a plurality of meters in a wireless metering network. The method can be performed at the meter and includes the steps of sampling an input voltage reading input voltages from the sampled input voltage generating an indication when at least one of the input voltages is beyond a voltage threshold over an entirety of a duration and wirelessly communicating the indication to a collector on the network.

In accordance with another aspect of the present invention a system is provided for monitoring voltage in a wireless network of meters. The system can include a plurality of meters each receiving respective input voltages. Each meter samples an input voltage and periodically determines voltage values from the sampled input voltage. Each meter can generate an indication when at least one of the average voltages is beyond a voltage threshold for a duration. The system further includes a collector that communicates wirelessly with each of the plurality of meters to form a fixed wireless metering network. The collector can receive generated indications from each of the plurality of meters and can identify a select group of meters among the plurality of meters wherein each of the select group of meters has reported an indication.

In accordance with yet another aspect of the present invention a method is provided for monitoring a network of synchronized meters associated with a remote collector station on a meter network. The method can include the step of monitoring an input voltage at each meter. The monitoring step can include sampling the input voltage over a plurality of voltage log entry periods determining an average input voltage at a configurable average rate generating a threshold indication if the average input voltage is above a predetermined maximum voltage threshold or below a predetermined minimum voltage threshold for a predetermined validation duration and generating a voltage log that includes at least one voltage log entry during each voltage log entry period. The voltage log entry can include a determined maximum average voltage and an associated timestamp and a determined minimum average voltage and an associated timestamp. The method can further include the step of monitoring each meter at the remote collector station. The monitoring step can include reading at least a portion of the voltage log of each of meter and identifying a group of meters that have generated the threshold indication among the plurality of meters.

In accordance with still another aspect of the present invention a method is provided for monitoring voltage in a meter wherein the meter is one of a plurality of meters in a wireless metering network. The method can be performed at each meter and includes the steps of sampling an input voltage over a voltage log entry period and generating a voltage log entry corresponding to the voltage log entry period wherein the voltage log entry includes a stored minimum input voltage and a stored maximum input voltage. The method further includes the steps of continuously determining whether the sampled input voltage is less than the minimum input voltage or greater than the maximum input voltage updating the stored minimum input voltage when the sampled input voltage is less than the stored minimum input voltage updating the stored maximum input voltage when the sampled input voltage is greater than the stored maximum input voltage and wirelessly communicating the stored minimum and maximum input voltages to a collector on the network.

Referring to an example communication system employs wireless frequency hopping spread spectrum FHSS communications to communicate between nodes. In particular the example communication system is a metering system that comprises a plurality of meters which are operable to sense and record consumption or usage of a service or commodity such as for example electricity water or gas. It is understood however that the present invention is by no means limited to use in a metering system but rather can be employed in any communication system employing FHSS communications. Moreover when employed in a meter system the invention is not limited to use in a fixed network such as that illustrated in but can also be employed in a mobile network such as walk by drive by metering systems.

The meters can be located at customer premises such as for example a home or place of business. The meters include circuitry for measuring the consumption of the service or commodity being consumed at their respective locations and generating data reflecting the consumption as well as other related data. The meters can also include circuitry for wirelessly transmitting data generated by the meter to a remote location. The meters can further include circuitry for receiving data commands or instructions wirelessly as well. Meters that are operable to both receive and transmit data can be referred to as bi directional or two way meters while meters that are only capable of transmitting data can be referred to as transmit only or one way meters. In bi directional meters the circuitry for transmitting and receiving can include a transceiver. In an illustrative embodiment the meters can be for example electricity meters manufactured by Elster Electricity LLC and marketed under the tradename REX.

The system further includes one or more collectors . In one embodiment the collectors can be meters that are operable to detect and record usage of a service or commodity such as for example electricity water or gas. In addition the collectors are operable to send data to and receive data from meters . Thus like the meters the collectors can comprise both circuitry for measuring the consumption of a service or commodity and for generating data reflecting the consumption and circuitry for transmitting and receiving data. In one embodiment collector and meters communicate with and amongst one another using a frequency hopping spread spectrum FHSS technique.

The system can thus include a subnet or local area network LAN which can be defined by a collector and the meters with which the collector communicates. As used herein the meters and the collectors can be referred to as nodes in the subnet . In each subnet LAN each meter transmits data related to the commodity being metered at the meter s location. For instance each meter can monitor and transmit data related to an input or line voltage received over a power network not shown . The collector receives the data transmitted by each meter effectively collecting it and then periodically transmits the data from all of the meters in the subnet LAN to a data collection server .

The data collection server can be a specially programmed general purpose computing system and can communicate with the collectors over a network . The network can assume any suitable form of network including a wireless network or a fixed wire network such as a local area network LAN a wide area network the Internet an intranet a telephone network such as the public switched telephone network PSTN a Frequency Hopping Spread Spectrum FHSS radio network a mesh network a Wi Fi 802.11 network a Wi Max 802.16 network a land line POTS network or any combination of the above.

The data collection server is configured to store data received by the collectors for analysis. For instance in one aspect the data collection server can prepare bills. In another example the data collection server can identify and locate status issues for instance voltage integrity issues in the power network. In another aspect each collector can identify and locate the status issues among the meters in the associated subnet LAN .

Referring now to the communication system includes a network management server a network management system NMS and the data collection server that together manage one or more subnets LANs and their constituent nodes. The NMS can track changes in the state of the network such as new nodes registering and unregistering with the system changes in communication paths and the like. This information is collected for each subnet LAN and is detected and forwarded to the network management server and the data collection server . Typically the communication system will be operated by a utility company or a company providing information technology services to a utility company.

Each of the meters and collectors is assigned an identifier LAN ID that uniquely identifies that meter or collector on its subnet LAN . In this embodiment communication between nodes i.e. the collectors and meters and the system is accomplished using the LAN ID. However operators of a utility can also query and communicate with the nodes using their own identifiers. To this end a marriage file can be used to correlate a utility s identifier for a node e.g. a utility serial number with both a manufacturer serial number i.e. a serial number assigned by the manufacturer of the meter and the LAN ID for each node in the subnet LAN . In this manner the utility can refer to the meters and collectors by the utilities identifier while the system can employ the LAN ID for the purpose of designating particular meters during system communications.

The communication system can further include a device configuration database for storing configuration information related to the nodes. In the illustrated embodiment the device configuration database can include data regarding time of use TOU switchpoints etc. for the meters and collectors communicating in the system . A data collection requirements database that contains information regarding the data to be collected on a per node basis. For example a utility can specify that metering data such as load profile demand TOU etc. is to be collected from particular meter s . Reports containing information on the network configuration can be automatically generated or in accordance with a utility request.

The network management system NMS maintains a database describing the current state of the global fixed network system current network state and a database describing the historical state of the system historical network state . The current network state contains data related to current meter to collector assignments etc. for each subnet LAN . The historical network state is a database from which the state of the network at a particular point in the past can be reconstructed. The NMS is responsible for amongst other things providing reports about the state of the network. The NMS can be accessed via an application programming interface API that is exposed to a user interface and a Customer Information System CIS . Other external interfaces can also be implemented. In addition the data collection requirements stored in the database can be set via the user interface or CIS .

The data collection server collects data from the nodes e.g. collectors and stores the data in a database . The data includes metering information such as energy consumption and can be used for billing purposes etc. by a utility provider.

The network management server network management system and data collection server communicate with the nodes in each subnet LAN over the network .

Referring now to the collector can include metering circuitry that performs measurement of information related to a service or commodity such as consumption and a processor that controls the overall operation of the metering functions of the collector . The collector can further include a display for displaying information such as measured quantities and meter status and a memory for storing data. The collector further comprises wireless LAN communications circuitry for communicating wirelessly with the meters in a subnet LAN and a network interface for communication over the network .

While illustrates certain components of an example collector it should be appreciated that the invention is not limited to such components. In fact various other components typically found in an electronic meter can be a part of the collector but have not been shown in for the purposes of clarity. It should be further appreciated that the present invention can use other components to accomplish the operation of collector . The components that are shown and the functionality described for collector are thus provided as examples and are not meant to be exclusive of other components or other functionality.

In one embodiment the metering circuitry the processor the display and the memory are implemented using an A3 ALPHA meter available from Elster Electricity Inc. In that embodiment the wireless LAN communications circuitry can be implemented by a LAN Option Board e.g. a 900 MHz two way radio installed within the A3 ALPHA meter and the network interface can be implemented by a WAN Option Board e.g. a telephone modem also installed within the A3 ALPHA meter. The WAN Option Board can route messages from the network via interface port to either the meter processor or the LAN Option Board . The LAN Option Board can use a transceiver not shown for example a 900 MHz radio to communicate data to the meters . Also the LAN Option Board can have sufficient memory to store data received from the meters . This data can include but is not limited to current billing data e.g. the present values stored and displayed by meters previous billing period data previous season data load profile data and status information such as data related to line voltage integrity as received from the meters .

The LAN Option Board can be capable of synchronizing its time to a real time clock not shown in the A3 ALPHA meter thereby synchronizing the LAN reference time to the time in the meter. The processing that carries out the communication functionality and the collection and storage of metering data of the collector can be handled by the processor and or additional processors not shown in the LAN Option Board and the WAN Option Board .

The responsibility of the collector can be wide and varied. Generally the collector is responsible for managing processing and routing data communicated between the collector and the network and between the collector and the meters . The collector can continually or intermittently read the current data from the meters and store the data in a database not shown that resides in the collector . The database can be implemented as one or more tables of data within the collector . Such current data can include but is not limited to the total kWh usage the Time Of Use TOU kWh usage peak kW demand and other energy consumption measurements and status information. The collector also can read and store previous billing and previous season data from the meters and store the data in the collector database.

In one embodiment the LAN Option Board employs a CC1110 chip available from Texas Instruments Inc. to implement its wireless transceiver functionality. The CC1110 chip has a built in Received Signal Strength Indication RSSI capability that provides a measurement of the power present in a received radio signal.

Referring now to an example meter suitable for operation in the communication system can include metering circuitry for measuring the amount of a service or commodity that is consumed and for monitoring status related information such as line voltage across lines L and L. The meter can also include a processor that controls the overall functions of the meter and receives current signals CT and CT from an off board current transformer CT . The processor can communicate with a display for displaying meter data and status information and a memory for storing data and program instructions. The processor can further engage in two way communications with an optical port that can removably connect to an external electrical device for instance a user interface . Alternatively the interface can be hardwired into the meter . The interface can enable a user to send control related information such as configuration data to the microcontroller and can receive signals from the microcontroller and display information to the user. The processor can send control signals to and receive signals from a clock . The processor can further communicate with a pair of connectors that can attach to additional external devices.

The meter can further include wireless communications circuitry for transmitting and receiving data to from other meters or a collector . The wireless communication circuitry can include for example the aforementioned CC1110 chip available from Texas Instruments Inc.

The meter can additionally include a switching power supply that receives the input voltage lines L and L provides a regulated dc voltage for instance 4.5V for the amplifier in the wireless communication circuitry and also for a voltage regulator . The voltage regulator can step the voltage down to for instance 3.3V and can send the stepped down voltage to the wireless communication circuitry the microcontroller and the memory .

Referring again to in the example embodiment shown a collector directly communicates with only a subset of the plurality of meters in its particular subnet LAN. Meters with which collector directly communicates can be referred to as level one meters . The level one meters are said to be one hop from the collector . Communications between collector and meters other than level one meters are relayed through the level one meters . Thus the level one meters operate as repeaters for communications between collector and meters located further away in subnet .

Each level one meter typically will only be in range to directly communicate with only a subset of the remaining meters in the subnet . The meters with which the level one meters directly communicate can be referred to as level two meters . Level two meters are one hop from the level one meters and therefore two hops from the collector . The level two meters operate as repeaters for communications between the level one meters and the meters located further away from collector in the subnet .

While only three levels of meters are shown collector first level second level in a subnet can comprise any number of levels of meters . For example a subnet can comprise one level of meters but might also comprise eight or more levels of meters . In an embodiment wherein a subnet comprises eight levels of meters as many as 1024 meters might be registered with a single collector .

As mentioned above each meter and collector that is installed in the system has a unique identifier LAN ID stored thereon that uniquely identifies the device from all other devices in the system . Additionally meters operating in a subnet include information such as data identifying the collector with which the meter is registered the level in the subnet at which the meter is located the repeater meter at the prior level with which the meter communicates to send and receive data to from the collector an identifier indicating whether the meter is a repeater for other nodes in the subnet and if the meter operates as a repeater the identifier that uniquely identifies the repeater within the particular subnet and the number of meters for which it is a repeater. Collectors have stored thereon all of this same data for all meters that are registered therewith. Thus the collector comprises data identifying all nodes registered therewith as well as data identifying the registered path by which data is communicated from the collector to each node. Each meter therefore has a designated communications path to the collector that is either a direct path e.g. all level one nodes or an indirect path through one or more intermediate nodes that serve as repeaters.

Information is transmitted in this embodiment in the form of packets. For most network tasks such as for example reading meter data the collector communicates with the meters in the subnet using point to point transmissions. For example a message or instruction from the collector is routed through the designated set of repeaters to the desired meter . Similarly a meter communicates with the collector through the same set of repeaters but in reverse.

In some instances however the collector can need to quickly communicate information to all meters located in its subnet . Accordingly collector can issue a broadcast message that is meant to reach all nodes in the subnet . The broadcast message can be referred to as a flood broadcast message. A flood broadcast originates at the collector and propagates through the entire subnet one level at a time. For example the collector can transmit a flood broadcast to all first level meters . The first level meters that receive the message pick a random time slot and retransmit the broadcast message to the second level meters . Any second level meter can accept the broadcast thereby providing better coverage from the collector out to the end point meters. Similarly the second level meters that receive the broadcast message pick a random time slot and communicate the broadcast message to the third level meters. This process continues out until the broadcast message is received by the end nodes of the subnet. Thus a broadcast message gradually propagates outward from the collector to the nodes of the subnet .

The flood broadcast packet header contains information to prevent nodes from repeating the flood broadcast packet more than once per level. For example within a flood broadcast message a field might exist that indicates to meters nodes which receive the message the level of the subnet the message is located only nodes at that particular level can re broadcast the message to the next level. If the collector broadcasts a flood message with a level of 1 only level nodes can respond. Prior to re broadcasting the flood message the level nodes increment the field to 2 so that only level nodes respond to the broadcast. Information within the flood broadcast packet header ensures that a flood broadcast will eventually die out.

Generally a collector issues a flood broadcast several times e.g. five times successively to increase the probability that all meters in the subnet receive the broadcast. A delay is introduced before each new broadcast to allow the previous broadcast packet time to propagate through all levels of the subnet.

Referring again also to meters often undergo power interruptions that can interfere with the operation of any clock therein. Accordingly the clocks internal to meters cannot be relied upon to provide an accurate time reading. Having the correct time is necessary however when time of use metering is being employed. Indeed in an embodiment time of use schedule data can also be comprised in the same broadcast message as the time. Accordingly the collector periodically flood broadcasts the real time to meters in the associated subnet . The meters use the time broadcasts to stay synchronized with the rest of the subnet . In an illustrative embodiment the collector broadcasts the time every 15 minutes. The broadcasts can be made near the middle of 15 minute clock boundaries that are used in performing load profiling and time of use TOU schedules so as to minimize time changes near these boundaries. Because maintaining time synchronization can be a high priority lower priority tasks performed by collector can be delayed while the time broadcasts are performed.

In an illustrative embodiment the flood broadcasts transmitting time data can be repeated for example five times so as to increase the probability that all nodes receive the time. Furthermore where time of use schedule data is communicated in the same transmission as the timing data the subsequent time transmissions allow a different piece of the time of use schedule to be transmitted to the nodes.

Exception messages are used in the subnet to transmit unexpected events that occur at the meters to the collector . In an embodiment the first 4 seconds of every 32 second period are allocated as an exception window for the meters to transmit exception messages. The meters transmit their exception messages early enough in the exception window so the message has time to propagate to the associated collector before the end of the exception window. The collector can process the exceptions after the 4 second exception window. Generally the associated collector acknowledges exception messages and the collector waits until the end of the exception window to send this acknowledgement.

In an illustrative embodiment exception messages are configured as one of three different types of exception messages local exceptions which are handled directly by the collector without intervention from the data collection server an immediate exception which is generally relayed to the data collection server under an expedited schedule and a daily exception which is communicated to the communication server on a regular schedule.

Exceptions are processed as follows. When an exception is received at the collector the collector identifies the type of exception that has been received. If a local exception has been received the collector takes an action to remedy the problem. For example when the collector receives an exception requesting a node scan request such as discussed below the collector transmits a command to initiate a scan procedure to the meter from which the exception was received.

If an immediate exception type has been received the collector makes a record of the exception. An immediate exception might identify for example that there has been a power outage. The collector can log the receipt of the exception in one or more tables or files. In an illustrative example a record of receipt of an immediate exception is made in a table referred to as the Immediate Exception Log Table. The collector then waits a set period of time before taking further action with respect to the immediate exception. For example the collector can wait 64 seconds. This delay period allows the exception to be corrected before communicating the exception to the data collection server . For example where a power outage was the cause of the immediate exception the collector can wait a set period of time to allow for receipt of a message indicating the power outage has been corrected.

If the exception has not been corrected the collector communicates the immediate exception to the data collection server . For example the collector can initiate a dial up connection with the data collection server and download the exception data. After reporting an immediate exception to the data collection server the collector can delay reporting any additional immediate exceptions for a period of time such as ten minutes. This is to avoid reporting exceptions from other meters that relate to or have the same cause as the exception that was just reported.

If a daily exception was received the exception is recorded in a file or a database table. Generally daily exceptions are occurrences in the subnet that need to be reported to the data collection server but are not so urgent that they need to be communicated immediately. For example when the collector registers a new meter in the subnet the collector records a daily exception identifying that the registration has taken place. In an illustrative embodiment the exception is recorded in a database table referred to as the Daily Exception Log Table. The collector communicates the daily exceptions to the data collection server . Generally the collector communicates the daily exceptions once every 24 hours.

In the present embodiment a collector assigns designated communications paths to meters with bidirectional communication capability and can change the communication paths for previously registered meters if conditions warrant. For example when a collector is initially brought into the system it needs to identify and register the meters in its subnet . A node scan refers to a process of communication between a collector and meters whereby the collector can identify and register new nodes in a subnet and allow previously registered nodes to switch paths. A collector can implement a node scan on the entire subnet referred to as a full node scan or a node scan can be performed on specially identified nodes referred to as a node scan retry. 

A full node scan can be performed for example when a collector is first installed. The collector must identify and register nodes from which it will collect usage data. The collector initiates a node scan by broadcasting a request which can be referred to as a Node Scan Procedure request. Generally the Node Scan Procedure request directs that all unregistered meters or nodes that receive the request respond to the collector . The request can comprise information such as the unique address of the collector that initiated the procedure. The signal by which the collector transmits this request can have limited strength and therefore is detected only at those meters that are in proximity of the collector . The meters that receive the Node Scan Procedure request respond by transmitting their unique identifier as well as other data.

For each meter from which the collector receives a response to the Node Scan Procedure request the collector tries to qualify the communications path to that meter before registering the meter with the collector. That is before registering a meter the collector attempts to determine whether data communications with the meter will be sufficiently reliable.

In one embodiment the collector determines whether the communication path to a responding meter is sufficiently reliable by comparing a Received Signal Strength Indication RSSI value i.e. a measurement of the received radio signal strength measured with respect to the received response from the meter to a selected threshold value. For example the threshold value can be 60 dBm. RSSI values above this threshold would be deemed sufficiently reliable.

In another embodiment qualification is performed by transmitting a predetermined number of additional packets to the meter such as ten packets and counting the number of acknowledgements received back from the meter. If the number of acknowledgments received is greater than or equal to a selected threshold e.g. 8 out of 10 then the path is considered to be reliable. In other embodiments a combination of the two qualification techniques can be employed.

If the qualification threshold is not met the collector can add an entry for the meter to a Straggler Table. The entry includes the meter s LAN ID its qualification score e.g. 5 out of 10 or its RSSI value its level in this case level one and the unique ID of its parent in this case the collector s ID .

If the qualification threshold is met or exceeded the collector registers the node. Registering a meter comprises updating a list of the registered nodes at the collector . For example the list can be updated to identify the meter s system wide unique identifier and the communication path to the node. The collector also records the meter s level in the subnet i.e. whether the meter is a level one node level two node etc. whether the node operates as a repeater and if so the number of meters for which it operates as a repeater. The registration process further comprises transmitting registration information to the meter . For example the collector forwards to the meter an indication that it is registered the unique identifier of the collector with which it is registered the level the meter exists at in the subnet and the unique identifier of its parent meter that will server as a repeater for messages the meter can send to the collector. In the case of a level one node the parent is the collector itself. The meter stores this data and begins to operate as part of the subnet by responding to commands from its associated collector .

Qualification and registration continues for each meter that responds to the collector s initial Node Scan Procedure request. The collector can rebroadcast the Node Scan Procedure additional times so as to insure that all meters that can receive the Node Scan Procedure have an opportunity for their response to be received and the meter qualified as a level one node at the collector .

The node scan process then continues by performing a similar process as that described above at each of the now registered level one nodes. This process results in the identification and registration of level two nodes. After the level two nodes are identified a similar node scan process is performed at the level two nodes to identify level three nodes and so on.

Specifically to identify and register meters that will become level two meters for each level one meter in succession the collector transmits a command to the level one meter which can be referred to as an Initiate Node Scan Procedure command. This command instructs the level one meter to perform its own node scan process. The request comprises several data items that the receiving meter can use in completing the node scan. For example the request can comprise the number of timeslots available for responding nodes the unique address of the collector that initiated the request and a measure of the reliability of the communications between the target node and the collector. As described below the measure of reliability can be employed during a process for identifying more reliable paths for previously registered nodes.

The meter that receives the Initiate Node Scan Response request responds by performing a node scan process similar to that described above. More specifically the meter broadcasts a request to which all unregistered nodes can respond. The request comprises the number of timeslots available for responding nodes which is used to set the period for the node to wait for responses the unique address of the collector that initiated the node scan procedure a measure of the reliability of the communications between the sending node and the collector which can be used in the process of determining whether a meter s path can be switched as described below the level within the subnet of the node sending the request and an RSSI threshold which can also be used in the process of determining whether a registered meter s path can be switched . The meter issuing the node scan request then waits for and receives responses from unregistered nodes. For each response the meter stores in memory the unique identifier of the responding meter . This information is then transmitted to the collector .

For each unregistered meter that responded to the node scan issued by the level one meter the collector attempts again to determine the reliability of the communication path to that meter. In one embodiment the collector sends a Qualify Nodes Procedure command to the level one node which instructs the level one node to transmit a predetermined number of additional packets to the potential level two node and to record the number of acknowledgements received back from the potential level two node. This qualification score e.g. 8 out of 10 is then transmitted back to the collector which again compares the score to a qualification threshold. In other embodiments other measures of the communications reliability can be provided such as an RSSI value.

If the qualification threshold is not met then the collector adds an entry for the node in the Straggler Table as discussed above. However if there already is an entry in the Straggler Table for the node the collector will update that entry only if the qualification score for this node scan procedure is better than the recorded qualification score from the prior node scan that resulted in an entry for the node.

If the qualification threshold is met or exceeded the collector registers the node. Again registering a meter at level two comprises updating a list of the registered nodes at the collector . For example the list can be updated to identify the meter s unique identifier and the level of the meter in the subnet. Additionally the collector s registration information is updated to reflect that the meter from which the scan process was initiated is identified as a repeater or parent for the newly registered node. The registration process further comprises transmitting information to the newly registered meter as well as the meter that will serve as a repeater for the newly added node. For example the node that issued the node scan response request is updated to identify that it operates as a repeater and if it was previously registered as a repeater increments a data item identifying the number of nodes for which it serves as a repeater. Thereafter the collector forwards to the newly registered meter an indication that it is registered an identification of the collector with which it is registered the level the meter exists at in the subnet and the unique identifier of the node that will serve as its parent or repeater when it communicates with the collector .

The collector then performs the same qualification procedure for each other potential level two node that responded to the level one node s node scan request. Once that process is completed for the first level one node the collector initiates the same procedure at each other level one node until the process of qualifying and registering level two nodes has been completed at each level one node. Once the node scan procedure has been performed by each level one node resulting in a number of level two nodes being registered with the collector the collector will then send the Initiate Node Scan Response command to each level two node in turn. Each level two node will then perform the same node scan procedure as performed by the level one nodes potentially resulting in the registration of a number of level three nodes. The process is then performed at each successive node until a maximum number of levels is reached e.g. seven levels or no unregistered nodes are left in the subnet.

It will be appreciated that in the present embodiment during the qualification process for a given node at a given level the collector qualifies the last hop only. For example if an unregistered node responds to a node scan request from a level four node and therefore becomes a potential level five node the qualification score for that node is based on the reliability of communications between the level four node and the potential level five node i.e. packets transmitted by the level four node versus acknowledgments received from the potential level five node not based on any measure of the reliability of the communications over the full path from the collector to the potential level five node. In other embodiments of course the qualification score could be based on the full communication path.

At some point each meter will have an established communication path to the collector which will be either a direct path i.e. level one nodes or an indirect path through one or more intermediate nodes that serve as repeaters. If during operation of the network a meter registered in this manner fails to perform adequately it can be assigned a different path or possibly to a different collector as described below.

As previously mentioned a full node scan can be performed when a collector is first introduced to a network. At the conclusion of the full node scan a collector will have registered a set of meters with which it communicates and reads metering data. Full node scans might be periodically performed by an installed collector to identify new meters that have been brought on line since the last node scan and to allow registered meters to switch to a different path.

In addition to the full node scan the collector can also perform a process of scanning specific meters in the subnet which is referred to as a node scan retry. For example the collector can issue a specific request to a meter to perform a node scan outside of a full node scan when on a previous attempt to scan the node the collector was unable to confirm that the particular meter received the node scan request. Also a collector can request a node scan retry of a meter when during the course of a full node scan the collector was unable to read the node scan data from the meter . Similarly a node scan retry will be performed when an exception procedure requesting an immediate node scan is received from a meter .

The system also automatically reconfigures to accommodate a new meter that can be added. More particularly the system identifies that the new meter has begun operating and identifies a path to a collector that will become responsible for collecting the metering data. Specifically the new meter will broadcast an indication that it is unregistered. In one embodiment this broadcast might be for example embedded in or relayed as part of a request for an update of the real time as described above. The broadcast will be received at one of the registered meters in proximity to the meter that is attempting to register. The registered meter forwards the time to the meter that is attempting to register. The registered node also transmits an exception request to its collector requesting that the collector implement a node scan which presumably will locate and register the new meter. The collector then transmits a request that the registered node perform a node scan. The registered node will perform the node scan during which it requests that all unregistered nodes respond. Presumably the newly added unregistered meter will respond to the node scan. When it does the collector will then attempt to qualify and then register the new node in the same manner as described above.

Once a communication path between the collector and a meter is established the meter can begin transmitting its meter data to the collector and the collector can transmit data and instructions to the meter . As mentioned above data is transmitted in packets. Outbound packets are packets transmitted from the collector to a meter at a given level. In one embodiment outbound packets contain the following fields but other fields can also be included 

 Inbound packets are packets transmitted from a meter at a given level to the collector . In one embodiment inbound packets contain the following fields but other fields can also be included 

For example suppose a meter at level three initiates transmission of a packet destined for its collector . The level three node will insert in the RptAddr field of the inbound packet the identifier of the level two node that serves as a repeater for the level three node. The level three node will then transmit the packet. Several level two nodes can receive the packet but only the level two node having an identifier that matches the identifier in the RptAddr field of the packet will acknowledge it. The other will discard it. When the level two node with the matching identifier receives the packet it will replace the RptAddr field of the packet with the identifier of the level one packet that serves as a repeater for that level two packet and the level two packet will then transmit the packet. This time the level one node having the identifier that matches the RptAddr field will receive the packet. The level one node will insert the identifier of the collector in the RptAddr field and will transmit the packet. The collector will then receive the packet to complete the transmission.

A collector periodically retrieves meter data from the meters that are registered with it. For example meter data can be retrieved from a meter every 4 hours. Where there is a problem with reading the meter data on the regularly scheduled interval the collector will try to read the data again before the next regularly scheduled interval. Nevertheless there can be instances wherein the collector is unable to read metering data from a particular meter for a prolonged period of time. The meters store an indication of when they are read by their collector and keep track of the time since their data has last been collected by the collector . If the length of time since the last reading exceeds a defined threshold such as for example 18 hours presumably a problem has arisen in the communication path between the particular meter and the collector . Accordingly the meter changes its status to that of an unregistered meter and attempts to locate a new path to a collector via the process described above for a new node. Thus the example system is operable to reconfigure itself to address inadequacies in the system.

In some instances while a collector can be able to retrieve data from a registered meter occasionally the level of success in reading the meter can be inadequate. For example if a collector attempts to read meter data from a meter every 4 hours but is able to read the data for example only 70 percent of the time or less it can be desirable to find a more reliable path for reading the data from that particular meter. Where the frequency of reading data from a meter falls below a desired success level the collector transmits a message to the meter to respond to node scans going forward. The meter remains registered but will respond to node scans in the same manner as an unregistered node as described above. In other embodiments all registered meters can be permitted to respond to node scans but a meter will only respond to a node scan if the path to the collector through the meter that issued the node scan is shorter i.e. less hops than the meter s current path to the collector . A lesser number of hops is assumed to provide a more reliable communication path than a longer path. A node scan request always identifies the level of the node that transmits the request and using that information an already registered node that is permitted to respond to node scans can determine if a potential new path to the collector through the node that issued the node scan is shorter than the node s current path to the collector .

If an already registered meter responds to a node scan procedure the collector recognizes the response as originating from a registered meter but that by re registering the meter with the node that issued the node scan the collector can be able to switch the meter to a new more reliable path. The collector can verify that the RSSI value of the node scan response exceeds an established threshold. If it does not the potential new path will be rejected. However if the RSSI threshold is met the collector will request that the node that issued the node scan perform the qualification process described above i.e. send a predetermined number of packets to the node and count the number of acknowledgements received . If the resulting qualification score satisfies a threshold then the collector will register the node with the new path. The registration process comprises updating the collector and meter with data identifying the new repeater i.e. the node that issued the node scan with which the updated node will now communicate. Additionally if the repeater has not previously performed the operation of a repeater the repeater would need to be updated to identify that it is a repeater. Likewise the repeater with which the meter previously communicated is updated to identify that it is no longer a repeater for the particular meter . In other embodiments the threshold determination with respect to the RSSI value can be omitted. In such embodiments only the qualification of the last hop i.e. sending a predetermined number of packets to the node and counting the number of acknowledgements received will be performed to determine whether to accept or reject the new path.

In some instances a more reliable communication path for a meter can exist through a collector other than that with which the meter is registered. A meter can automatically recognize the existence of the more reliable communication path switch collectors and notify the previous collector that the change has taken place. The process of switching the registration of a meter from a first collector to a second collector begins when a registered meter receives a node scan request from a collector other than the one with which the meter is presently registered. Typically a registered meter does not respond to node scan requests. However if the request is likely to result in a more reliable transmission path even a registered meter can respond. Accordingly the meter determines if the new collector offers a potentially more reliable transmission path. For example the meter can determine if the path to the potential new collector comprises fewer hops than the path to the collector with which the meter is registered. If not the path can not be more reliable and the meter will not respond to the node scan. The meter might also determine if the RSSI of the node scan packet exceeds an RSSI threshold identified in the node scan information. If so the new collector can offer a more reliable transmission path for meter data. If not the transmission path can not be acceptable and the meter can not respond. Additionally if the reliability of communication between the potential new collector and the repeater that would service the meter meets a threshold established when the repeater was registered with its existing collector the communication path to the new collector can be more reliable. If the reliability does not exceed this threshold however the meter does not respond to the node scan.

If it is determined that the path to the new collector can be better than the path to its existing collector the meter responds to the node scan. Included in the response is information regarding any nodes for which the particular meter can operate as a repeater. For example the response might identify the number of nodes for which the meter serves as a repeater.

The collector then determines if it has the capacity to service the meter and any meters for which it operates as a repeater. If not the collector does not respond to the meter that is attempting to change collectors . If however the collector determines that it has capacity to service the meter the collector stores registration information about the meter . The collector then transmits a registration command to meter . The meter updates its registration data to identify that it is now registered with the new collector . The collector then communicates instructions to the meter to initiate a node scan request. Nodes that are unregistered or that had previously used meter as a repeater respond to the request to identify themselves to collector . The collector registers these nodes as is described above in connection with registering new meters nodes.

Under some circumstances it can be necessary to change a collector . For example a collector can be malfunctioning and need to be taken off line. Accordingly a new communication path is provided for collecting meter data from the meters serviced by the particular collector. The process of replacing a collector is performed by broadcasting a message to unregister usually from a replacement collector to all of the meters that are registered with the collector that is being removed from service. In one embodiment registered meters can be programmed to only respond to commands from the collector with which they are registered. Accordingly the command to unregister can comprise the unique identifier of the collector that is being replaced. In response to the command to unregister the meters begin to operate as unregistered meters and respond to node scan requests. To allow the unregistered command to propagate through the subnet when a node receives the command it will not unregister immediately but rather remain registered for a defined period which can be referred to as the Time to Live . During this time to live period the nodes continue to respond to application layer and immediate retries allowing the unregistration command to propagate to all nodes in the subnet. Ultimately the meters register with the replacement collector using the procedure described above.

One of collector s main responsibilities within subnet is to retrieve metering data from meters . In one embodiment collector has as a goal to obtain at least one successful read of the metering data per day from each node in its subnet. Collector attempts to retrieve the data from all nodes in its subnet at a configurable periodicity. For example collector can be configured to attempt to retrieve metering data from meters in its subnet once every 4 hours. In greater detail in one embodiment the data collection process begins with the collector identifying one of the meters in its subnet . For example collector can review a list of registered nodes and identify one for reading. The collector then communicates a command to the particular meter that it forward its metering data to the collector . If the meter reading is successful and the data is received at collector the collector determines if there are other meters that have not been read during the present reading session. If so processing continues. However if all of the meters in subnet have been read the collector waits a defined length of time such as for example 4 hours before attempting another read.

If during a read of a particular meter the meter data is not received at collector the collector begins a retry procedure wherein it attempts to retry the data read from the particular meter. Collector continues to attempt to read the data from the node until either the data is read or the next subnet reading takes place. In an embodiment collector attempts to read the data every 60 minutes. Thus wherein a subnet reading is taken every 4 hours collector can issue three retries between subnet readings.

As mentioned above a system such as the communication system described above can include communications between any node e.g. a meter or a collector to any other node e.g. a meter or a collector that are performed using an FHSS technique. As mentioned above in the example communication system described above data is transmitted in the form of packets. illustrates the general packet format. As shown each packet consists of a preamble followed by a start frame delimiter SFD followed by a data section which can have one of the formats mentioned above for outbound and inbound transmissions .

In the example system twenty five different channels frequencies are employed in a pseudo random sequence. Each packet is transmitted in its entirety on one channel. The next packet will then be transmitted on the next channel in the sequence and so on. Transmissions are asynchronous and thus a receiving node listens on a given channel for a transmitted preamble followed by a start frame delimiter and then the data. It is understood however that in other embodiments a different number of channels can be employed and different variations on the FHSS technique can also be employed. The present invention is by no means limited to the disclosed example.

According to one aspect of the invention a digital receiver such as the LAN communications circuitry of a given node which as mentioned above can be implemented using the Texas Instruments CC1110 transceiver scans each of the potential channels available e.g. each of the 25 channels in the example FHSS sequence mentioned above and generates an RSSI value for each channel that reflects detected signal strength on that channel. This process can be repeated a number of times such as for example four times to ensure a valid RSSI value on each channel. The channels are then ranked from strongest RSSI to lowest. When the digital receiver is ready to begin listening for transmitted packets it will begin listening on the channel having the strongest RSSI. If it does not detect a preamble it will then select the channel with the next strongest RSSI and so on until it finds a valid preamble and SFD on a channel. The receiver will then attempt to detect a valid SFD. If one is detected the receiver will then proceed to receive the data of the packet. If the packet is intended to be received by that node e.g. it is addressed to it the data will be processed accordingly. generally illustrates the process.

In greater detail typically the RSSI output value from the receiver will vary linearly as the signal level increases from 100 dBm to 20 dBm. The RSSI scan consists of setting an RF channel waiting for the RSSI value to stabilize and then reading the RSSI value. This procedure is used for each of the channels in the FHSS sequence or list. Because of the time uncertainty associated with the transmitted signal the full channel scan is repeated multiple times e.g. four times to gain assurance that the signal can be detected. During each RSSI scan of all the communication channels the strongest RSSI values are tagged to the specific channel and are logged for later use. After accomplishing the RSSI scans the process changes to the evaluation phase of the algorithm. For the evaluation phase the RSSI values are ordered from the strongest channel to the weakest channel. As mentioned above when the digital receiver is ready to begin listening for transmitted packets it will begin listening on the channel having the strongest RSSI. If it does not detect a preamble it will then select the channel with the next strongest RSSI and so on until it finds a valid preamble and SFD on a channel.

Some digital receivers can not handle overload in a manner that allows data to be detected in the presence of strong signals. According to another aspect of the invention attenuation can be inserted into the receiver path in order to keep the desired signal within the range of operation of the receiver e.g. 110 dBm to 20 dBm . Specifically in one embodiment beginning with the strongest RSSI channel developed in the scan process described above the algorithm checks to see if the RSSI value is above a threshold. The threshold represents the signal strength above which there is concern about the validity of the data. This level can be determined empirically for the design or from the specification sheet for the receiver or both.

If the channel RSSI exceeds the threshold the algorithm inserts a fixed amount of attenuation into the receiver loop prior to evaluating the data output signal of the radio. For example for a receiver that operates properly over a range of 110 dBm to 20 dBM if signal strength is detected above 20 dBM for example then 20 dBM of attenuation can be inserted to bring the signal into the receiver s range. If the signal is below the threshold the signal is left as is prior to evaluating the data. In either the case of the unaltered signal with RSSI below the threshold or in the case of the reduced signal with RSSI above the threshold the receiver evaluates several bits of data looking for a valid preamble. If a valid preamble is detected the receiver continues to monitor that channel looking for a start frame delimiter SFD . Once the SFD is recognized the data contents of the packet can be read.

As noted above if a valid preamble is not found in the strongest RSSI channel evaluated for valid bits the second strongest RSSI channel is selected for evaluation. Again if the signal is below the RSSI threshold it is left unaltered and if the signal is above the threshold the signal is attenuated before being evaluated. The above evaluation procedure is followed through the SFD and data if a valid preamble is found. If valid preamble is not located the third strongest RSSI channel is evaluated in a similar manner and so on. Using this technique with sufficient preamble length a detailed analysis of the majority of all the FHSS channels can be evaluated to find the active communication channel.

In accordance with another aspect of the present it may be desirable to monitor the power across the communication network for the purposes of identifying indications of system irregularities that may affect the power supply to the residence or place of business that is associated with a given meter . The meters thus sample the input also referred to herein as line voltages across lines L and L and periodically determine an input voltage to be used to monitor the input voltage. In one embodiment the meters can monitor and store information related to the input voltage can record maximum and minimum voltages and can further determine whether the input voltage indicates a voltage irregularity.

Unless otherwise specified herein it should be appreciated that the term voltage when used herein in the context of an input or line voltage used for the purposes of voltage monitoring can be determined as an average voltage a continuous voltage or a periodic sampling at regular or irregular intervals or any other alternative representation of the sampled line voltage. For instance when monitoring the line voltage and the monitored voltage is in the form of an average rms voltage the average voltage can be a fast moving average for instance 32 line cycles or a slow average for instance 8192 line cycles . The numbers of line cycles that can be used when calculating average voltage values are presented by way of example only and the number of line cycles used to calculate the average voltage can be as desired. When the monitored voltage is in the form of a continuous voltage each line cycle is measured instantaneously. When the monitored voltage is in the form of a periodic voltage the line voltage may be determined periodically for instance at every 20line cycle or at any suitable alternative line cycle . It can thus be said that the meters periodically determine voltage values from the sampled voltage across lines L and L. The type of voltage to be determined can be set locally at each meter via the interface or can be communicated to each meter on each subnet LAN .

The meters can then send voltage related data to the collector either voluntarily for instance at a predetermined time or upon occurrence of a detection of a voltage irregularity or in response to a request from the collector . The collector can thus read the information received from each associated meter and determine for instance based on the unique identification of each meter that has experienced or is experiencing a voltage irregularity whether a certain geographic region on the subnet is experiencing power difficulties. Knowledge of the geographic location of the voltage irregularity can assist in the diagnosing and repairing the cause of the voltage irregularities.

Alternatively or additionally each collector in the network can send information to the data collection server indicating 1 that a voltage irregularity should be investigated and 2 the geographical location of the voltage irregularity and or the identifiers for each meter reporting a voltage irregularity. Based on the locations of each of the meters reporting an irregularity the collection server can then determine the geographical region or regions in the network that may be experiencing a voltage irregularity.

The determination that a voltage irregularity should be investigated can be based on a single meter reporting a voltage irregularity or a predetermined number of meters reporting a voltage irregularity within a given geographic locale. An example method for monitoring voltage as performed by the meter in each subnet LAN will now be described with reference to and .

Specifically the meter begins the method by creating a new voltage log in the meter memory See at step . The voltage log is configured to store a plurality of voltage log entries that each contain information related to the line voltage. Once the voltage log has been created the meter initiates a new voltage log entry at step . When each new voltage log entry is created the memory is cleared of line voltage related data that had been previously calculated or determined in combination with the previous voltage log entry.

The memory is configured to store a predetermined number of voltage log entries in the voltage log . The number of voltage log entries stored in the memory can be determined based on a number of factors including the memory capacity and the frequency at which voltage entry data are communicated to the collector . In accordance with one aspect of the method each voltage log entry can be forwarded to the collector before being erased from the memory . In one embodiment of the present invention the meter can store any desired number of voltage log entries at a given point in time depending on the memory capacity. Once the maximum number of voltage log entries has been stored the meter will erase the oldest entries as new entries are created. In this manner the collector can receive data related to all voltage log entries before the voltage log entries are erased.

Typically voltage log entries are intended to be created over a configurable log entry duration that can be predetermined such as a predetermined period of time. While the log entry duration can be configured as any time duration as desired certain aspects of the present invention provide log entry durations as periods of time that can be evenly divisible by a multiple of 24 hour periods for example one or more days or can be evenly divisible into a 24 hour period for example. 4 hours 6 hours 8 hours 12 hours and the like such that at least a portion of the monitoring periods can align with day boundaries. Each meter keeps the network time as a clock such as clock illustrated in that counts since the most recent midnight. Once the entry duration expires a new voltage log entry can be created. Accordingly for 8 hour entry periods the first log entry is intended to begin at midnight the second log entry is intended to begin at 08 00 and the third log entry is intended to begin at 16 00. A fourth log entry is intended to begin the following day at midnight or 0 00 and so on. It should be appreciated however that any alternative method of tracking time could be utilized in accordance with the principles of the present invention. For instance the clock could keep track of standard time and the entry periods could be set to begin and end at predetermined standard times.

The log entry duration can be set locally at each meter via the interface or can be communicated to each meter on each subnet LAN from the collector network management server or other remote device. In this regard certain aspects of the present invention recognize that configurable information usable by the meters unless otherwise specified herein can be set locally at the meter upon manufacture via the meter interface or via communications from the collector network management server or other remote device. One may wish to configure the log entry duration locally for instance upon manufacture of the meters to reduce the efforts required on the part of the end user. In accordance with one aspect of the present invention all meters on a given subnet LAN can keep the same network time use the same entry period and are thus synchronized. The creation and updating of the voltage log entries will be described in more detail below with reference to .

Once the new voltage log entry has been created in the memory at step the microcontroller can operate a stored program which can be firmware based software based or the like to determine when to create the next voltage log entry. It should be appreciated that prior voltage log entries retain their stored data until they are erased from the memory but that new voltage related information is stored in the most recently created voltage log entry. However the method recognizes that certain events may cause a period to terminate prior to expiration of the entry duration. If none of those events occur then the prior terminates upon the expiration of the entry duration. Accordingly the method performs a loop that determines whether conditions exist to revert to step and begin a new voltage log entry.

For instance the interface can provide a data reset or clear data button that causes the meter to begin a new voltage log entry. A user may actuate the data reset button for instance when the meter is manufactured when a new meter is added on the subnet LAN or when meter configurations are to be changed. Alternatively the collector can send a data reset message to the meters that cause those meters receiving the message to begin a new voltage log entry. Accordingly after the new voltage log entry is initiated at step the process continues to decision block to determine whether the data reset interface has been actuated. Alternatively the microcontroller can generate a reset signal to the meter the when the data is set to be cleared regardless of what step is being performed in the method . If the data has been reset then the method reverts to step and begins a new voltage log entry.

Otherwise the method continues to decision block where it is determined whether the period of the current voltage log entry has expired. If so the process reverts to step and begins a new voltage log entry. Otherwise if the period of the current voltage log entry has not yet expired then the method reverts to decision block and the loop repeats until a condition is found to exist that causes the meter to create a new voltage log entry.

Aspects of the present invention recognize that the meters and the collector in each subnet LAN can each maintain the system time locally and are thus synchronized . Each meter can be provided with a backup power source such as a battery if desired. In such circumstances meters will remain operational during a power outage. However the present invention further recognizes that the meters might not be provided with such backup power sources or that the backup power source can become inoperable for instance a dead battery . Certain aspects of the present invention thus contemplate power outages that can be experienced at the meter .

If a meter experiences a power failure when power is restored the meter will consequently lose the real time until the time is received on the subnet LAN network. For instance in response to a power outage the meter can send a message to the collector requesting the system time. Alternatively the collector can send broadcast messages to all meters indicating the system time for instance at regular intervals. Once the meter receives the message from the collector the clock can be updated with the valid time.

However once power is restored and before the clock receives the network time the clock can begin counting forward as if power to the meter was restored at midnight or 0 00 . Because the time kept by the clock has not been verified on the subnet LAN the meter is said to keep relative time from 0 00.

Referring now to a power restoration routine can be performed concurrently with the method described above with reference to and with the voltage monitoring method described below with reference to . The power restoration routine begins at step where the meter is initialized either because the power has been restored or a meter has been brought online. Next at step the meter begins a new voltage log entry based on relative time. Because the meter is keeping relative time the method of will not determine that the period has expired at decision block . Rather the meter will continuously monitor the data reset at decision block in the manner described above.

With continuing reference to once the new voltage log entry is created at step an outage flag can be set in the new log entry to associate the entry with a power restoration. Accordingly when the voltage log entry is read by the collector or the data collection server the voltage related data associated with the voltage log entry can be identified accordingly. When the new voltage log entry is created at step the clock is counting on relative time and will remain on relative time for the duration of the voltage log entry.

Next at step the meter sends a request for the network time. The request can be sent to the collector or to any node on the subnet LAN . Alternatively as described above the meter can receive the network time on the subnet LAN as broadcast by the collector at regular intervals for instance every fifteen minutes . At decision block it is determined whether the meter is keeping valid network time. If the meter is not keeping valid time the power restoration routine reverts to step decision block until either the data is reset see decision block in or the meter receives the valid network time. It should be appreciated that the meter need not necessarily send requests for network time continuously each time the routine reverts from decision block to step and that the meter can send such requests once or only intermittently.

Once it is determined at decision block that the meter is keeping valid time the power restoration routine examines the network time and determines at decision block whether the current time is beyond the expiration period of the previous voltage log entry during which the power outage occurred. If not then the meter can merge the current data log entry with the previous data log entry at step . Once the entry logs are merged the meter ends the power restoration routine and reverts to step of method .

Otherwise if it is determined at step that the network time is beyond the expiration of the previous log entry then the routine proceeds to step . Because the previous voltage log entry was not defined by the boundaries of the entry period the meter can set a flag in the previous voltage log entry that identifies the voltage log entry as a partial time entry e.g. not defined by the boundaries of the entry period at step . The meter then ends the power restoration routine and reverts to step where a new voltage log entry is begun on valid time. Because the new voltage log entry is not defined by at least the starting boundary of the entry period a flag can be set in the new voltage log entry that identifies the new entry as a partial time entry at step .

The present invention further contemplates that power outages may be produced by flickering power and that it may not be desirable to create new voltage logs each time power is temporarily restored. Accordingly at step it can be determined whether the most recent voltage log entry is associated with the outage flag and thus the result of a power outage. If so a new voltage entry is not created and the previous voltage log entry can instead be continued in accordance with one aspect of the present invention.

Referring now to a method is provided for monitoring the line voltage. The method can determine whether a new minimum or maximum voltage has been determined. The method can also determine whether the line voltage indicates a voltage irregularity. The method can be performed concurrently with the method described above with reference to and with method described above with reference to . In this regard information that is to be stored in a voltage log entry as determined by method is stored in the current voltage log entry as determined by methods and .

As described above each meter can continuously sample the voltage across the lines L and L. Based on the sampled voltages the meter can determine the line voltage to be used for voltage monitoring. For instance the meter can continuously calculate the voltage as an average voltage using either a fast averaging method or a slow averaging method. Alternatively the determined voltage can be in the form of a continuous voltage or a periodically sampled voltage. The type of voltage being monitored for instance fast average or slow average can be set as a flag in the voltage log entry . During the description below reference is made to the voltage log entry which is illustrated in .

At step the line voltage is sampled and determined in the manner described above. Next at step it is determined whether the clock time indicates that a snapshot is to be taken. Alternatively the microcontroller can generate an interrupt signal when the snapshot is to be taken regardless of what step is being performed in the method .

A snapshot time can be set for each voltage log entry. For instance the snapshot can be set to occur upon a predetermined delay of time from the start of the voltage log entry period. The snapshot causes all meters on the subnet LAN to record the voltage at the same instant in time. With the meters time synchronized the system snapshot can provide an accurate reflection of the system voltages at a given point in time. If it is determined at decision block that a snapshot is to be taken the voltage log entry is updated with the snapshot information at step . The snapshot information can include for instance the voltage that was read at step along with a timestamp corresponding to the voltage snapshot. Because the snapshot was taken at a valid time a snapshot valid status flag can be set in the voltage log entry as well.

Though not illustrated in each meter can also determine that a snapshot is to be taken during the power restoration routine . For instance once it is determined that the meter is keeping valid time at decision block the meter can determine valid time is beyond the predetermined snapshot time. If so the meter can take the snapshot. However the snapshot valid flag would not be set in the voltage log entry thereby indicating that the snapshot was taken after the intended snapshot time. Alternatively a snapshot invalid flag not shown can be set in the voltage log entry if desired.

If it is determined at decision block that no snapshot is to be taken or once the voltage log entry has been updated at step the voltage monitoring method advances to decision block . The decision block determines whether the voltage read at step is a new minimum or maximum for the voltage log entry.

As voltages are read during the operation of voltage monitoring method it will be determined at decision block whether the voltage is less than the minimum voltage previously stored in the current voltage log entry or greater than the maximum voltage previously stored in the current voltage log entry . The minimum voltage will be updated in the voltage log entry at step when the voltage read at step is less than the previously stored minimum voltage. Likewise the maximum voltage will be updated in the voltage log entry at step when the voltage read at step is greater than the previously stored maximum voltage. Timestamps associated with the minimum and maximum voltages can also be stored in the voltage log entry at step . However if the current voltage log entry is on relative time e.g. in response to a power outage a flag without an associated timestamp can be set that associates the new minimum or maximum voltage with the power outage. When a new voltage log entry is created all data in the log entry is clear. Accordingly at decision block the first voltage determined at step will be both a new minimum voltage and a new maximum voltage and the minimum and maximum voltages are updated in the voltage log entry at step .

It should be appreciated that the maximum and minimum voltages can be continuously updated in the voltage log entry independent of whether the voltage has crossed a predetermined threshold and independent of whether the voltage has been maintained at the new minimum or maximum level for a predetermined duration.

If the voltage read at step fails to achieve a new minimum or maximum voltage at decision block or once the minimum or maximum voltage is updated at step method proceeds to decision block which in combination with decision block determines whether the voltage determined at step indicates that a voltage irregularity in the network may exist.

It should be appreciated that the line voltages on the subnet LAN are intended to operate at a predetermined voltage for instance 240V. A voltage irregularity may thus be indicated if the actual line voltage is beyond a configurable predetermined threshold. For instance the actual voltage may fall below a predetermined minimum threshold or rise above a predetermined maximum threshold. The thresholds can be set at any desired voltage for instance a voltage that indicates a predetermined percentage above or below the intended operating voltage. For instance the minimum voltage can be set at 90 of the operating voltage or 216V. The maximum voltage can be set at 105 of the operating voltage or 252V. These values are presented by way of illustration only and the scope of the present invention is in no way to be construed as being limited to the example minimum and maximum thresholds.

If it is determined that the average voltage is not beyond a predetermined threshold at decision block then the process reverts to step where the line voltage is again determined and steps are repeated. If however it is determined that the voltage read at step is less than the minimum voltage threshold or is greater than the maximum voltage threshold the method proceeds to decision block . Decision block recognizes that the voltage may cross the voltage threshold for a brief period of time that may not be indicative of a voltage irregularity in the subnet LAN . Accordingly a duration can be configured as for instance a period of time or over a predetermined number of read voltages that indicates a greater likelihood that a voltage irregularity has occurred that should be investigated. If it has been determined at decision block that the duration has not been satisfied the method reverts to step and another voltage is read.

A flag or other indicator can be set in the memory to indicate that the previous voltage was found to be beyond the associated voltage threshold along with the associated time. Accordingly subsequent iterations will allow the meter to determine whether the duration has been satisfied at decision block . If the voltage is subsequently found to be within a normal operating range e.g. between the minimum and maximum thresholds at step the flag can be cleared.

Once it has been determined at decision block that the duration has been satisfied a corresponding voltage irregularity flag can be set in the meter memory see at step . In accordance with one aspect of the present invention one of two flags can be set. If the actual voltage was less than the minimum voltage threshold for the duration the min voltage flag can be set. If the actual voltage was greater than the maximum voltage threshold for the duration the max voltage flag can be set. In accordance with certain aspects of the present invention the maximum and minimum voltage threshold flags are stored in the memory but not in the voltage log entries . Of course if desired the threshold flags could alternatively or additionally be stored in the log entries .

Once the voltage irregularity flag has been set the meter can communicate the flag with the collector . The collector can associate a time of the voltage irregularity with the time that the voltage irregularity flag was received from the associated meter . Alternatively each meter can provide a timestamp with the voltage irregularity flag that can be transmitted to the collector .

Alternatively or additionally the collector can constantly ping each meter on the subnet LAN for voltage irregularity flag status information. Once the meter forwards the voltage irregularity flag to the collector the collector can respond with an acknowledgement that the flag and timestamp have been received and the flag can then be reset at the meter . It should be appreciated that the meters can be configured to clear the voltage irregularity flags once the data associated with the existing flag has been sent to the collector regardless of whether the acknowledgement is received by the collector .

Alternatively the meter can await the acknowledgement from the collector prior to resetting the voltage irregularity flags. Alternatively still the meters can be configured to activate one of a plurality of maximum and minimum voltage irregularity flags that can be activated without resetting the previous flag if a second voltage irregularity occurs prior to an acknowledgement from the collector that the previous voltage irregularity flag has been received. When the collector receives indications of voltage irregularity flags and associated data that indicate a voltage irregularity the collector can examine the voltage log entry that corresponds temporally to the voltage irregularity flag to determine the minimum and or maximum voltages that were read during the period in which the voltage irregularity flag was set.

Relevant information such as the voltage irregularity flag and the associated time and the minimum and or maximum voltage corresponding to the period in which the voltage irregularity flag was set can be forwarded to the data collection server as desired. The voltage irregularity can be investigated when the collector or the data collection server determines that a voltage irregularity may exist when a predetermined number of meters for instance one or more indicates a voltage irregularity.

Once the appropriate voltage flag is set at step the method reverts to step and the most recently determined voltage is again read and steps are repeated.

It should be appreciated that while method determines whether to update the minimum and maximum voltages stored in the voltage log entry prior to determining whether to set the voltage irregularity flag the method could instead determine whether to set the voltage irregularity flag prior to updating the voltages in the voltage log entry . In this regard it should be appreciated that the various steps illustrated in the methods described herein need not be performed in the precise order illustrated.

Furthermore while method has been described in combination with a single phase meter it should be appreciated that the method can be used to monitor the input voltage of a polyphase meter as well. For instance the input voltage of each phase of the polyphase meter can be determined at step and the snapshot taken at step can include the voltage levels of each phase of the polyphase meter. Likewise the voltage levels of each phase of the polyphase meter can be monitored at decision block and can be updated as new minimum or maximum voltages in the manner described above with respect to step . If either phase produces a new minimum or maximum voltage the voltages of each phase can be recorded in the log along with an associated time stamp. Furthermore if it is determined at decision blocks and that the voltage for either phase is less than the minimum voltage threshold or is greater than the maximum voltage threshold for the duration the appropriate flag is set at step in the manner described above for the phase that indicates a voltage irregularity.

Referring now to certain aspects of the present invention provide for the maintaining and updating of a plurality of voltage log entries in the voltage log . Each voltage log entry can contain information relevant to the line voltage as determined by the microcontroller of each meter . Each voltage log entry can include the date and time corresponding to the voltage log entry it already being appreciated that the various timestamps stored in the voltage log entry can also indicate the period that the entry corresponds to unless a power outage has occurred. However the power outage will be indicated by the activated outage flag.

Each voltage log entry will indicate the type of voltage monitored e.g. type of voltage average whether a power outage has occurred during the period corresponding to the voltage log entry whether the entry is a partial time period for instance whether the meter was keeping relative time during the entry whether the meter is a polyphase meter and whether the snapshot taken for that entry was valid. The voltage log entry can further include a timestamp associated with the snapshot along with the voltage that was read at the time of the snapshot. The minimum and maximum voltages read are also stored in the voltage log entry along with the timestamps associated with the minimum and maximum voltages to indicate the time at which the minimum and maximum voltages occurred.

With further reference to the meter memory can indicate by way of the minimum and maximum threshold flags whether or not a voltage irregularity has occurred. For instance as described above if the line voltage was greater than a predetermined maximum voltage threshold for an entirety of a duration the voltage irregularity flag is set indicating that the maximum voltage threshold has been crossed. If the line voltage was less than a predetermined minimum voltage threshold for an entirety of a duration the voltage irregularity flag is set indicating that the minimum voltage threshold has been crossed. The collector can identify the time associated with the receipt of the voltage irregularity flags thereby providing sufficient information to determine which voltage log entry or entries are to be investigated to determine the actual minimum and maximum voltages experienced during the entry that was associated with the voltage threshold crossing. Alternatively a timestamp can be associated with each voltage irregularity flag.

If the maximum or minimum voltage threshold coincides with the determination of the minimum or maximum voltage in the voltage log entry and that minimum or maximum voltage was not subsequently updated in the voltage log entry the actual minimum or maximum voltage that caused the threshold crossing can be determined upon examination of the corresponding log entry . Alternatively the memory can also store the actual voltage value that was determined to be beyond the minimum or maximum voltage threshold. In accordance with one aspect of the present invention the minimum and maximum thresholds can be set locally at each meter via the interface or can be communicated to each meter on each subnet LAN by the collector network management server or other remote device.

In accordance with another aspect of the present invention the collector can send requests over the subnet LAN that each meter or a select group of meters based for instance on the geographic location of the meters forward the voltage log entries or select data in the voltage log entries that correspond to a specified time or time range. For instance the requested log entries may have been generated within a specified date range or a time range within one or more dates.

While systems and methods have been described and illustrated with reference to specific embodiments those skilled in the art will recognize that modification and variations can be made without departing from the principles described above and set forth in the following claims. For example although in the embodiments described above the systems and methods discussed above in accordance with certain aspects of the present invention are described in the context of a network of metering devices such as electricity gas or water meters it is understood that the present invention can be implemented in any kind of network that employs FHSS techniques. Also while the example metering system described above is a fixed network the present invention can also be employed in mobile walk by drive by systems. Furthermore it should be appreciated that certain systems and methods discussed above in accordance with aspects of the present invention can be implemented in any meter whether or not the meter is included in a meter communication network. Accordingly reference should be made to the following claims as describing the scope of the present invention.

